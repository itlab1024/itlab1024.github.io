[{"id":"d339d355269868e4606a9ed4016aeb8f","title":"scala2å­¦ä¹ ç¬”è®°ï¼ˆv2.12.11ï¼‰","content":"ä»€ä¹ˆæ˜¯Scalaï¼ŸScala æ˜¯ä¸€é—¨åŸºäºJVMå’ŒJavaå®Œå…¨å…¼å®¹çš„è¯­è¨€ï¼Œå…·æœ‰è·¨å¹³å°ï¼Œå¯ç§»æ¤æ€§ï¼Œå®Œå¤‡çš„åƒåœ¾å›æ”¶æœºåˆ¶ç­‰ç‰¹å®š\nScalaæ¯”Javaæ›´åŠ é¢å‘å¯¹è±¡ï¼Œä»–æ˜¯ä¸€é—¨çº¯é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œæˆ‘ä»¬çŸ¥é“Javaå¹¶ä¸æ˜¯ï¼Œæ¯”å¦‚ä»–å…·æœ‰åŸºæœ¬ç±»å‹ã€‚\nScalaæ˜¯ä¸€é—¨å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ï¼ŒJavaå¹¶ä¸æ˜¯ï¼ŒJDK8å¢åŠ çš„Lambdaæ˜¯å‡½æ•°å¼ã€‚\nScalaçš„éå¸¸é€‚åˆå¤§æ•°æ®å¤„ç†ï¼Œæˆ‘ä»¬ç†Ÿæ‚‰çš„Sparkã€Flinkã€Kafkaç­‰åº•å±‚éƒ½æ˜¯ä½¿ç”¨Scalaå®ç°çš„ã€‚\nScalaç›®å‰ä¸»æµç‰ˆæœ¬æ˜¯2ï¼Œç›®å‰ç‰ˆæœ¬3ä¹Ÿå·²ç»Releasedã€‚å…ˆå­¦ä¹ 2ï¼Œå†å­¦ä¹ 3ã€‚\n\nä¸ºä»€ä¹ˆå­¦ä¹ Scalaï¼ŸScalaçš„å¥½å¤„ä¸Šé¢å·²ç»æåˆ°è¿‡äº†ï¼Œè¿™äº›æ˜¯æˆ‘ä»¬å­¦ä¹ Scalaçš„ç†ç”±ï¼Œå•ä¸å®Œå…¨æ˜¯æˆ‘çš„ç†ç”±ã€‚\næˆ‘çš„ç†ç”±ä¸»è¦æ˜¯ï¼š\nå…¬å¸ä¸šåŠ¡æ˜¯ç‰©è”ç½‘ï¼ˆIOTï¼‰ï¼Œå·¥ä½œéœ€è¦å¤§æ•°æ®ç›¸å…³æŠ€æœ¯ï¼Œæ‰€ä»¥å­¦ä¹ ã€‚\n\nä¸ªäººä¹Ÿæ¯”è¾ƒå–œæ¬¢æ–°æŠ€æœ¯ï¼Œé™¤äº†Scalaï¼Œæˆ‘ä¹Ÿå­¦ä¹ ç›®å‰æµè¡Œçš„Golangè¯­è¨€ã€‚\n\nå»ºè®®ï¼šå­¦ä¹ æ–°æŠ€æœ¯è¦æ ¹æ®è‡ªå·±å®é™…æƒ…å†µè€Œå®šï¼Œé¦–å…ˆè¦å·¥ä½œéœ€è¦çš„æŠ€æœ¯ï¼Œè¿™èƒ½å¤Ÿæé«˜æŠ€æœ¯åŒæ—¶æ˜¯çš„è‡ªå·±åœ¨å²—ä½ä¸Šæ›´åŠ çªå‡ºï¼Œæ›´åŠ èƒœä»»å·¥ä½œï¼Œå…¶æ¬¡å­¦ä¹ æ—¶é—´æ¯”è¾ƒå¤šã€‚\nå­¦ä¹ èµ„æ–™æˆ‘ç›®å‰å­¦ä¹ Scalaçš„ä¸»è¦æ¸ é“ä¸»è¦æœ‰ä¸¤å¤„ï¼Œå®˜ç½‘å’Œå°šç¡…è°·è§†é¢‘ã€‚\nå®˜ç½‘æ˜¯å¿…é¡»è¦çœ‹çš„ï¼Œå¹¶ä¸”å¼ºçƒˆæ¨èçœ‹è‹±æ–‡åŸç‰ˆå†…å®¹ï¼Œæœ‰äº›ä¸­æ–‡ç½‘ç¿»è¯‘æ°´å¹³å®åœ¨æœ‰é™ï¼Œå¹¶ä¸”æœ‰é”™è¯¯ã€‚\næˆ‘è™½ç„¶ä¸»è¦çœ‹å®˜ç½‘ï¼Œä½†æ˜¯å®˜ç½‘èµ„æ–™æ¯”è¾ƒæ¾æ•£ï¼Œè‡ªå·±åˆä¸å¤ªçˆ±æ€»ç»“ï¼Œä¹Ÿè§‰å¾—æµªè´¹æ—¶é—´ï¼Œæˆ‘æ˜¯åˆå­¦ä¸€é—¨è¯­è¨€ï¼Œåœ¨å­¦ä¹ Scalaçš„è·¯ä¸Šï¼Œæˆ‘å°±æ˜¯ä¸ªèœé¸Ÿã€‚å°šç¡…è°·çš„è§†é¢‘è¿˜æ˜¯éå¸¸ä¸é”™çš„ï¼ˆä¸æ˜¯æ‰“å¹¿å‘Šå“ˆå“ˆï¼‰ã€‚\næˆ‘å­¦ä¹ çš„è¿‡ç¨‹ä¸­ä¸»è¦æ˜¯è·Ÿç€å°šç¡…è°·çš„è§†é¢‘å­¦ä¹ ï¼Œä½†æ˜¯ä¸å®Œå…¨æ“ä½œå…¶å†…å®¹ï¼Œä¸»è¦æ˜¯æ ¹æ®ä»–çš„ç›®å½•æ¥å­¦ä¹ ã€‚\nå¦å¤–è¿™é‡Œå»ºè®®ä¸‹ï¼Œæ²¡å­¦è¿‡Javaçš„ä¸è¦å­¦ä¹ scalaï¼ï¼ï¼\nScalaå…¥é—¨Scalaã€Javaã€JVMçš„å…³ç³»\nJavaå’ŒJVMçš„å…³ç³»ï¼šå†™ä»£ç (.java) &#x3D;&gt; ä½¿ç”¨javacå‘½ä»¤ç¼–è¯‘ä¸º.classæ–‡ä»¶ &#x3D;&gt; ä½¿ç”¨JVMè¿è¡Œ\nScalaå’ŒJVMçš„å…³ç³»ï¼šå†™ä»£ç (.scala) &#x3D;&gt;ä½¿ç”¨scalacå‘½ä»¤ç¼–è¯‘ä¸º.classæ–‡ä»¶ &#x3D;&gt; ä½¿ç”¨JVMè¿è¡Œ\nä¸¤è€…æå…¶ç±»ä¼¼ï¼ï¼ï¼\nScalaèƒ½å¤Ÿä½¿ç”¨Javaç±»åº“ï¼ï¼ï¼\nScalaç¯å¢ƒå®‰è£…å‰æï¼šscalaåŸºäºJVMï¼Œè¦æ±‚æˆ‘ä»¬ç¯å¢ƒè¦å®‰è£…JDKã€‚JDKçš„å®‰è£…è¯·è‡ªè¡ŒæŸ¥è¯¢ï¼Œæ£€æŸ¥JDKæ˜¯å¦å®‰è£…\nâœ  ~ java -version\nopenjdk version &quot;17.0.3&quot; 2022-04-19 LTS\nOpenJDK Runtime Environment Corretto-17.0.3.6.1 (build 17.0.3+6-LTS)\nOpenJDK 64-Bit Server VM Corretto-17.0.3.6.1 (build 17.0.3+6-LTS, mixed mode, sharing)\n\næˆ‘ç”µè„‘å®‰è£…çš„æ˜¯OpenJDK17ï¼Œåªè¦å¤§äº8å³å¯ã€‚\nScalaæ”¯æŒMacã€Windowsã€Linuxç­‰ç³»ç»Ÿã€‚æœ‰å¤šç§å®‰è£…æ–¹å¼ï¼Œ\n\nå®˜æ–¹æ¨èä½¿ç”¨cs setupå®‰è£…\nâœ  ~ brew install coursier&#x2F;formulas&#x2F;coursier &amp;&amp; cs setup\nUpdating Homebrew...\n&#x3D;&#x3D;&gt; Downloading https:&#x2F;&#x2F;github.com&#x2F;coursier&#x2F;coursier&#x2F;releases&#x2F;download&#x2F;v2.1.0-M5\nAlready downloaded: &#x2F;Users&#x2F;shizhenchao&#x2F;Library&#x2F;Caches&#x2F;Homebrew&#x2F;downloads&#x2F;a34af3e5d8010f4b87297cbcf23a7090d907d343dfbb691e9ddea9facb4b1605--coursier\n&#x3D;&#x3D;&gt; Downloading https:&#x2F;&#x2F;github.com&#x2F;coursier&#x2F;coursier&#x2F;releases&#x2F;download&#x2F;v2.1.0-M5\nAlready downloaded: &#x2F;Users&#x2F;shizhenchao&#x2F;Library&#x2F;Caches&#x2F;Homebrew&#x2F;downloads&#x2F;e56f4bc31b6326034ab85448faa48e50054affc7b327e3e82180fc861633fc54--cs-x86_64-apple-darwin.gz\n&#x3D;&#x3D;&gt; Installing coursier from coursier&#x2F;formulas\n^C^C\nOne sec, cleaning up...\n\nâœ  ~ \nâœ  ~ brew install coursier&#x2F;formulas&#x2F;coursier &amp;&amp; cs setup\nUpdating Homebrew...\n&#x3D;&#x3D;&gt; Downloading https:&#x2F;&#x2F;github.com&#x2F;coursier&#x2F;coursier&#x2F;releases&#x2F;download&#x2F;v2.1.0-M5\nAlready downloaded: &#x2F;Users&#x2F;shizhenchao&#x2F;Library&#x2F;Caches&#x2F;Homebrew&#x2F;downloads&#x2F;a34af3e5d8010f4b87297cbcf23a7090d907d343dfbb691e9ddea9facb4b1605--coursier\n&#x3D;&#x3D;&gt; Downloading https:&#x2F;&#x2F;github.com&#x2F;coursier&#x2F;coursier&#x2F;releases&#x2F;download&#x2F;v2.1.0-M5\nAlready downloaded: &#x2F;Users&#x2F;shizhenchao&#x2F;Library&#x2F;Caches&#x2F;Homebrew&#x2F;downloads&#x2F;e56f4bc31b6326034ab85448faa48e50054affc7b327e3e82180fc861633fc54--cs-x86_64-apple-darwin.gz\n&#x3D;&#x3D;&gt; Installing coursier from coursier&#x2F;formulas\n&#x3D;&#x3D;&gt; Caveats\nzsh completions have been installed to:\n  &#x2F;usr&#x2F;local&#x2F;share&#x2F;zsh&#x2F;site-functions\n&#x3D;&#x3D;&gt; Summary\nğŸº  &#x2F;usr&#x2F;local&#x2F;Cellar&#x2F;coursier&#x2F;2.1.0-M5-18-gfebf9838c: 5 files, 57.4MB, built in 49 seconds\nChecking if a JVM is installed\nFound a JVM installed under &#x2F;Users&#x2F;shizhenchao&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;corretto-17.0.3&#x2F;Contents&#x2F;Home.\n\nChecking if ~&#x2F;Library&#x2F;Application Support&#x2F;Coursier&#x2F;bin is in PATH\n\nChecking if the standard Scala applications are installed\n  Installed ammonite\n  Installed cs\n  Installed coursier\n  Installed scala\n  Installed scalac\n  Installed sbt\n  Installed sbtn\n  Installed scalafmt\n\né»˜è®¤å®‰è£…çš„scalaæ˜¯æœ€æ–°ç‰ˆæœ¬ï¼ˆ3.1.2ï¼‰\nå› ä¸ºæˆ‘ä¸»è¦æ˜¯è·Ÿç€å°šç¡…è°·è§†é¢‘å­¦ä¹ ï¼Œæ‰€ä»¥åŒæ­¥ä½¿ç”¨ä»–çš„ç‰ˆæœ¬ï¼ˆ2.12.11ï¼‰\nå®‰è£…å‚è€ƒå¦‚ä¸‹åœ°å€ï¼šhttps://scala-lang.org/download/2.12.11.html\né€šè¿‡å‘½ä»¤è¡Œç”¨cså·¥å…·å®‰è£…\nâœ  ~ cs install scala:2.12.11 &amp;&amp; cs install scalac:2.12.11\nhttps:&#x2F;&#x2F;repo1.maven.org&#x2F;maven2&#x2F;io&#x2F;get-coursier&#x2F;apps&#x2F;maven-metadata.xml\n  No new update since 2022-05-16 17:11:57\nhttps:&#x2F;&#x2F;repo1.maven.org&#x2F;maven2&#x2F;org&#x2F;scala-lang&#x2F;scala-compiler&#x2F;2.12.11&#x2F;scala-compâ€¦\n  100.0% [##########] 2.6 KiB (10.9 KiB &#x2F; s)\nhttps:&#x2F;&#x2F;repo1.maven.org&#x2F;maven2&#x2F;org&#x2F;scala-lang&#x2F;scala-reflect&#x2F;2.12.11&#x2F;scala-refleâ€¦\n  100.0% [##########] 1.8 KiB (8.0 KiB &#x2F; s)\nhttps:&#x2F;&#x2F;repo1.maven.org&#x2F;maven2&#x2F;org&#x2F;scala-lang&#x2F;scala-compiler&#x2F;2.12.11&#x2F;scala-compâ€¦\n  100.0% [##########] 10.2 MiB (4.0 MiB &#x2F; s)\nhttps:&#x2F;&#x2F;repo1.maven.org&#x2F;maven2&#x2F;org&#x2F;scala-lang&#x2F;scala-reflect&#x2F;2.12.11&#x2F;scala-refleâ€¦\n  100.0% [##########] 3.5 MiB (1.1 MiB &#x2F; s)\nWrote scala\nWrote scalac\n\nâœ  ~ scala -version\nScala code runner version 2.12.11 -- Copyright 2002-2020, LAMP&#x2F;EPFL and Lightbend, Inc.\n\næ¸©é¦¨æç¤ºï¼šå¦‚æœä½¿ç”¨äºŒè¿›åˆ¶å®‰è£…ï¼Œéœ€è¦é…ç½®ç¯å¢ƒå˜é‡ã€‚\näº¤äº’å¼å‘½ä»¤è¡Œï¼Œè¾“å…¥scalaå‘½ä»¤æ¥å£æ‰“å¼€ï¼š\nâœ  ~ scala\nWelcome to Scala 2.12.11 (OpenJDK 64-Bit Server VM, Java 17.0.3).\nType in expressions for evaluation. Or try :help.\n\nscala&gt; val a:Int &#x3D; 10\na: Int &#x3D; 10\n\nscala&gt; val b:Int &#x3D;5\nb: Int &#x3D; 5\n\nscala&gt; a + b\nres0: Int &#x3D; 15\n\nscala&gt; \n\n\n\nå†™ä»£ç å¹¶ç¼–è¯‘æ‰§è¡Œï¼Œåˆ›å»ºä¸€ä¸ªHello.scalaæ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹\nobject Hello &#123;\n\tdef main(ags: Array[String]): Unit &#x3D; &#123;\n\t\tprintln(&quot;hello&quot;)\n\t&#125;\n&#125;\n\nä½¿ç”¨scalacç¼–è¯‘æ–‡ä»¶ï¼Œä½¿ç”¨scalaæŒ‡ä»¤è¿è¡Œ\nâœ  Scala2-Tutorials git:(main) âœ— scalac Hello.scala \nâœ  Scala2-Tutorials git:(main) âœ— scala Hello         \nhello\n\n\n\nç¼–ç¨‹å·¥å…·å®˜æ–¹æ¨èä½¿ç”¨VSCodeå’ŒIDEAï¼Œæˆ‘ä¸ªäººéå¸¸å–œæ¬¢ä½¿ç”¨IDEAï¼Œæ¥ä¸‹æ¥æˆ‘ä¹Ÿä¼šåœ¨IDEAä¸Šè¿›è¡Œå¼€å‘ã€‚\nå®‰è£…æ’ä»¶ä½¿ç”¨IDEAå¼€å‘scalaéœ€è¦å®‰è£…æ’ä»¶ã€‚\n\nåˆ›å»ºé¡¹ç›®\n\n\nScalaæ”¯æŒä½¿ç”¨SBTå’ŒIntelliJåˆ›å»ºé¡¹ç›®ï¼Œæˆ‘ç”¨çš„æ˜¯sbtã€‚å…¶ä»–çš„æ–¹å¼æˆ‘å°±ä¸æ¼”ç¤ºäº†ã€‚\nHelloWorldåˆ›å»ºpackage\nåœ¨ä¸Šå›¾ä¸­scalaæ–‡ä»¶å¤¹ä¸Šé‚®ä»¶ï¼Œé€‰æ‹©åˆ›å»ºpackage\n\nåˆ›å»ºä¸€ä¸ªObjectï¼Œscalaä¸­çš„Objectæ˜¯ä¸€ä¸ªå•ä¾‹ç±»ï¼Œå…¨å±€åªæœ‰ä¸€ä»½\n\nç¼–å†™å…¥å£ç¨‹åºmainæ–¹æ³•çš„ä»£ç \n\nè§£æä¸‹ä¸Šé¢çš„mainæ–¹æ³•\npackage io.itlab1024.github.scala\n\n&#x2F;**\n * objectï¼šscalaä¸­çš„ä¸€ä¸ªå…³é”®å­—ï¼Œå£°æ˜ä¸€ä¸ªå•ä¾‹å¯¹è±¡ï¼Œä¹Ÿå«åšä¼´ç”Ÿå¯¹è±¡\n *&#x2F;\nobject HelloWorld &#123;\n  &#x2F;**\n   * ç¨‹åºçš„å…¥å£æ–¹æ³•ï¼Œ defæ˜¯å…³é”®å­—ï¼Œç”¨äºå®šä¹‰æ–¹æ³•ï¼Œæ‹¬å·å†…æ˜¯å‚æ•°ä¿¡æ¯ï¼Œargsæ˜¯å‚æ•°åï¼Œé€šè¿‡ï¼šç±»å‹å®šä¹‰æ•°æ®ç±»å‹ï¼Œ\n   * æ­¤mainæ–¹æ³•ä¸­argså‚æ•°çš„ç±»å‹æ˜¯æ˜¯å­—ç¬¦ä¸²æ•°ç»„ï¼Œå…¶å®è¿™è·Ÿjavaçš„ç±»ä¼¼ï¼Œåªä¸è¿‡è¡¨ç°å½¢å¼ä¸åŒè€Œå·²ã€‚æ‹¬å·åé¢çš„:Unitä»£è¡¨è¿”å›ç±»å‹ï¼ŒUnitåœ¨scalaä¸­ä»£è¡¨ç©ºï¼Œç±»ä¼¼äºJavaä¸­çš„Void\n   * @param args\n   *&#x2F;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    println(&quot;Hello World&quot;)\n  &#125;\n&#125;\n\nä¼´ç”Ÿå¯¹è±¡objectå…³é”®å­—æ˜¯ç”¨äºåˆ›å»ºä¼´ç”Ÿå¯¹è±¡ï¼Œä»€ä¹ˆæ˜¯ä¼´ç”Ÿå¯¹è±¡å‘¢ï¼Ÿä¼´éšè°è€Œç”Ÿï¼Ÿæƒ³æƒ³æˆ‘ä»¬å†Javaä¸­ä½¿ç”¨staticå®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚ä½•è®¿é—®å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦ä½¿ç”¨ç±»å.å±æ€§æ¥è®¿é—®ã€‚çœ‹ä¸‹ä¸‹é¢çš„ä»£ç \npackage io.itlab1024.github.scala;\n\n&#x2F;**\n * é¥®æ–™ç±»\n *&#x2F;\npublic class Drink &#123;\n    private static final String MAJOR &#x3D; &quot;æ°´&quot;;\n    &#x2F;**\n     * æ°´æœæˆåˆ†\n     *&#x2F;\n    private String fruits;\n\n    public String getFruits() &#123;\n        return fruits;\n    &#125;\n\n    public void setFruits(String fruits) &#123;\n        this.fruits &#x3D; fruits;\n    &#125;\n    \n    public void show() &#123;\n        System.out.println(&quot;MAJOR&#x3D;&quot; + Drink.MAJOR + &quot;, Fruits&#x3D;&quot; + this.fruits);\n    &#125;\n&#125;\n\nä¸Šé¢ä»£ç æ˜¯javaä¸­çš„å®šä¹‰ï¼ŒDrinkä»£è¡¨é¥®æ–™ç±»ï¼Œæœ‰ä¸¤ä¸ªæˆå‘˜å˜é‡ç±»ï¼ŒMAJORä»£è¡¨ä¸»æˆåˆ†ï¼ˆé¥®æ–™ä¸»æˆåˆ†éƒ½æ˜¯æ°´ï¼‰ï¼Œä½¿ç”¨staticå®šä¹‰ï¼Œè¿˜æœ‰ä¸€ä¸ªfruitsä»£è¡¨æ°´æœï¼Œæˆ‘ä»¬çœ‹ä¸‹ç¬¬22è¡Œä¸­Drink.MAJORä½¿ç”¨çš„æ˜¯ç±»åå­—.å±æ€§è®¿é—®ï¼Œè¿™åœ¨javaä¸­æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯è¿™å¹¶ä¸ç¬¦åˆé¢å‘å¯¹è±¡çš„è®¾è®¡ï¼Œå› ä¸ºæˆ‘å¹¶æ²¡æœ‰é€šè¿‡å¯¹è±¡è·å–å±æ€§ï¼Œscalaä¸­ä¼´ç”Ÿå¯¹è±¡å°±æ˜¯åˆ›é€ ä¸€ä¸ªä¼´ç”Ÿç±»çš„å¯¹è±¡ï¼ˆä¼´ç”Ÿå¯¹è±¡ï¼‰ã€‚è¿™æ›´ç¬¦åˆé¢å‘å¯¹è±¡çš„æ€æƒ³ã€‚\nä¸Šé¢çš„ä¾‹å­æˆ‘é€šè¿‡scalaçš„classå’Œobjectå®ç°(ç”¨æ–°çš„åå­—ScalaDrinkï¼Œå¦åˆ™ç±»å†²çªï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¿®æ”¹å†…å®¹ä¸­çš„classåçš„åå­—ï¼Œè€Œä¸æ˜¯ä¿®æ”¹æ–‡ä»¶åã€‚)\npackage io.itlab1024.github.scala.chapter01\nimport io.github.itlab1024.scala.chapter01.ScalaDrink\n\n&#x2F;**\n * Scalaä¸­Drinkç±»\n *&#x2F;\nclass ScalaDrink (fruits: String)&#123;\n  def show (): Unit &#x3D; &#123;\n    println(&quot;MAJOR&#x3D;&quot; + ScalaDrink.MAJOR + &quot;, Fruits&#x3D;&quot; + this.fruits)\n  &#125;\n&#125;\n\n&#x2F;&#x2F; ä¼´ç”Ÿå¯¹è±¡\nobject ScalaDrink &#123;\n  var MAJOR: String &#x3D; &quot;æ°´&quot;\n&#125;\n\nIDEAå·¥å…·å¾ˆæœ‰å¥½çš„ä¸ºæˆ‘ä»¬ç¼–è¾‘äº†ç±»å’Œä¼´ç”Ÿå¯¹è±¡çš„å…³ç³»ã€‚\n\nä¸ªäººä½“ä¼šï¼šscalaä¸ºäº†æ»¡è¶³çº¯é¢å‘å¯¹è±¡çš„è®¾è®¡ï¼Œæå¾—å¤æ‚äº†ï¼Œè¯­è¨€æˆ‘è§‰å¾—è¶Šç®€å•è¶Šå¥½ã€‚\nå˜é‡å’Œæ•°æ®ç±»å‹æ³¨é‡ŠScalaä¸­çš„æ³¨é‡Šè·ŸJavaä¸­çš„å®Œå…¨ä¸€æ ·ï¼Œåˆ†ä¸ºå•è¡Œæ³¨é‡Šã€å¤šè¡Œæ³¨é‡Šå’Œæ–‡æ¡£æ³¨é‡Š\npackage io.itlab1024.github.scala.chapter02\n\n&#x2F;**\n * æ–‡æ¡£æ³¨é‡Š\n *&#x2F;\nobject Test01_Comment &#123;\n  &#x2F;*\n  å¤šè¡Œæ³¨é‡Š\n  mainæ–¹æ³•çš„å®šä¹‰\n  *&#x2F;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    &#x2F;&#x2F; å•è¡Œæ³¨é‡Š\n    println(&quot;hello&quot;)\n  &#125;\n&#125;\n\nå¸¸é‡å’Œå˜é‡å¸¸é‡ä½¿ç”¨val å£°æ˜ï¼Œå˜é‡è¯´è¿‡varå£°æ˜\nvar å¸¸é‡å[: ç±»å‹] &#x3D; åˆå§‹å€¼\nval å˜é‡å[: ç±»å‹] &#x3D; åˆå§‹å€¼\næ³¨æ„ï¼šèƒ½ç”¨å¸¸é‡çš„åœ°æ–¹ä¸ç”¨å˜é‡\npackage io.itlab1024.github.scala.chapter02\n\nimport io.github.itlab1024.scala.chapter01.ScalaDrink\n\nobject Test02_Variable &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    &#x2F;&#x2F; å®šä¹‰å˜é‡\n    var i: Int &#x3D; 10\n    &#x2F;&#x2F; å®šä¹‰å¸¸é‡\n    val j: Int &#x3D; 20\n\n    &#x2F;&#x2F; ç±»å‹ç¡®å®šåä¸èƒ½ä¿®æ”¹ï¼Œscalaå…¶å®æ˜¯å¼ºç±»å‹è¯­è¨€\n    &#x2F;&#x2F;    i &#x3D; &quot;ä¸èƒ½ä¿®æ”¹ç±»å‹&quot; &#x2F;&#x2F; ç¼–è¯‘é”™è¯¯\n\n    &#x2F;&#x2F;    j &#x3D; 10; &#x2F;&#x2F; å¸¸é‡çš„å€¼ä¸èƒ½è¢«ä¿®æ”¹\n\n    &#x2F;&#x2F; å˜é‡å£°æ˜çš„æ—¶å€™å¿…é¡»è¦æœ‰åˆå§‹å€¼\n    &#x2F;&#x2F; var a: Int &#x2F;&#x2F; è¿™æ˜¯ç¼–è¯‘ä¸é€šè¿‡çš„,javaä¸­æ˜¯å…è®¸çš„\n\n\n    &#x2F;&#x2F; å¦‚æœæ˜¯å¼•ç”¨ç±»å‹ï¼Œå¯¹è±¡ä¸èƒ½æ¦‚å¿µï¼Œä½†æ˜¯å¯¹è±¡é‡Œé¢çš„å˜é‡å±æ€§ï¼ˆé€šè¿‡varä¿®é¥°ï¼‰æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œå¸¸é‡å±æ€§ï¼ˆä¸ä½¿ç”¨varä¿®é¥°æˆ–è€…ä½¿ç”¨valä¿®é¥°ï¼‰ä¾ç„¶æ˜¯ä¸èƒ½ä¿®æ”¹çš„ã€‚\n    val apple &#x3D; new ScalaDrink(&quot;è‹¹æœ&quot;)\n    &#x2F;&#x2F;    apple &#x3D; new ScalaDrink(&quot;æ©˜å­&quot;) &#x2F;&#x2F; ç¼–è¯‘ä¸é€šè¿‡\n    &#x2F;&#x2F;    apple.fruits &#x3D; &quot;æ©˜å­&quot; &#x2F;&#x2F; ç¼–è¯‘ä¸é€šè¿‡ï¼Œå› ä¸ºä¹‹å‰åˆ›å»ºçš„ScalaDrinkç±»çš„fruitså±æ€§æ²¡æœ‰ä½¿ç”¨varä¿®é¥°ã€‚\n  &#125;\n&#125;\n\né™¤äº†ä¿®é¥°ç¬¦ä¸åŒä»¥å¤–ï¼Œè·Ÿjavaç±»ä¼¼ã€‚\næ ‡è¯†ç¬¦å‘½åè§„èŒƒä»€ä¹ˆæ˜¯æ ‡è¯†ç¬¦ï¼Ÿscalaä¸­å¯¹å˜é‡ã€å¸¸é‡ã€æ–¹æ³•ã€å‡½æ•°åå­—ç»Ÿç§°ä¸ºæ ‡è¯†ç¬¦\nscalaä¸­çš„æ ‡è¯†ç¬¦å‘½åè§„åˆ™åŸºæœ¬ä¸javaä¸€è‡´ã€‚\n\næ ‡è¯†ç¬¦ç”±å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ç»„æˆï¼Œä½†æ˜¯é¦–å­—æ¯å¿…é¡»æ˜¯å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿\n\nä»¥æ“ä½œç¬¦å¼€å¤´ï¼Œä¸”åªèƒ½åŒ…å«æ“ä½œç¬¦ï¼ˆ#-*&#x2F;#!ç­‰ï¼‰\n\nç”¨åå¼•å·&#96;&#96;å°†ä»»æ„å­—ç¬¦ä¸²åŒ…èµ·æ¥ï¼Œè¿™æ˜¯åˆæ³•çš„æ ‡è¯†ç¬¦ï¼Œå³ä¾¿æ˜¯scalaä¸­çš„å…³é”®å­—ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œ\nscalaä¸­çš„å…³é”®å­—ä¸»è¦æœ‰\n\npackageï¼Œimportï¼Œclassï¼Œ**objectï¼Œtraitï¼Œextendsï¼Œwith**ï¼Œtypeï¼Œ\n\nfor\n\nprivateï¼Œprotectedï¼Œabstractï¼Œ**scaledï¼Œfinalï¼Œimplicit**ï¼Œlazyï¼Œoverride\nifï¼Œelseï¼Œ**matchï¼Œcaseï¼Œdoï¼Œwhileï¼Œforï¼Œreturnï¼Œyield**\ndefï¼Œvarï¼Œval\nthisï¼Œsuper\nnew\ntrue, false, null\n\n\n\nç¤ºä¾‹\npackage io.itlab1024.github.scala.chapter02\n\n&#x2F;**\n * æ ‡è¯†ç¬¦è§„èŒƒæµ‹è¯•\n *&#x2F;\nobject Test03_Identifier &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    &#x2F;&#x2F;    ï¼ˆ1ï¼‰æ ‡è¯†ç¬¦ç”±å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ç»„æˆï¼Œä½†æ˜¯é¦–å­—æ¯å¿…é¡»æ˜¯å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿\n    val scala: String &#x3D; &quot;scala&quot;\n    val scala134: Int &#x3D; 1\n    val _scala: String &#x3D; &quot;scala&quot;\n    &#x2F;&#x2F;    val 1scala: Int &#x3D; 1 &#x2F;&#x2F;ç¼–è¯‘ä¸é€šè¿‡ï¼Œä¸èƒ½ä»¥ä¸ºæ•°å­—å¼€å¤´\n    &#x2F;&#x2F;    val a+b &#x3D; 1 &#x2F;&#x2F; IDEAå·¥å…·å¹¶ä¸æç¤ºé”™è¯¯ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯ä¸å…è®¸çš„ï¼Œä¼šæç¤ºnot found: value +\n\n\n    &#x2F;&#x2F; (2)ä»¥æ“ä½œç¬¦å¼€å¤´ï¼Œä¸”åªèƒ½åŒ…å«æ“ä½œç¬¦ï¼ˆ#-*&#x2F;#!ç­‰ï¼‰\n    &#x2F;&#x2F; æä¸æ‡‚è°ä¼šè¿™ä¹ˆå¹²ï¼Œæœ‰å®é™…åº”ç”¨åœºæ™¯å—ï¼Ÿï¼Ÿï¼Ÿ\n    val +-*&#x2F; &#x3D; 10 &#x2F;&#x2F;æ­£ç¡®\n    val +#%^&amp;^*&amp;&amp;* &#x3D; 10 &#x2F;&#x2F;æ­£ç¡®\n    println(+#%^&amp;^*&amp;&amp;*)\n\n    &#x2F;&#x2F; (3) ç”¨åå¼•å·&#96;&#96;å°†ä»»æ„å­—ç¬¦ä¸²åŒ…èµ·æ¥ï¼Œè¿™æ˜¯åˆæ³•çš„æ ‡è¯†ç¬¦ï¼Œå³ä¾¿æ˜¯scalaä¸­çš„å…³é”®å­—ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œ\n    &#x2F;&#x2F; ä¸Šé¢æœ‰ä¸ªå®šä¹‰a+bæ˜¯å…è®¸çš„ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨åå¼•å·å¼•èµ·æ¥å°±æ˜¯å…è®¸çš„\n    val &#96;a+b&#96; &#x3D; 1\n    println(&#96;a+b&#96;)\n    &#x2F;&#x2F; å…³é”®å­—ä¹Ÿæ˜¯å…è®¸çš„\n    &#x2F;&#x2F;    val if &#x3D; 1 &#x2F;&#x2F;ç¼–è¯‘ä¸é€šè¿‡\n    val &#96;if&#96; &#x3D; 1\n    println(&#96;if&#96;) &#x2F;&#x2F;æ­£ç¡®\n\n  &#125;\n&#125;\n\n\n\nå­—ç¬¦ä¸²è¾“å‡ºå­—ç¬¦ä¸²å¯ä»¥é€šè¿‡+æ“ä½œç¬¦è¿›è¡Œç›¸åŠ ï¼Œä¾‹å¦‚&quot;a&quot; + &quot;b&quot; ç»“æœæ˜¯ab\nprintfæ ¼å¼åŒ–è¾“å‡ºï¼Œé€šè¿‡%æ¥æ˜¾ç¤ºä¸åŒå†…å®¹ï¼Œç±»ä¼¼javaä¸­çš„System.out.printfä»¥åŠGoä¸­çš„fmt.Printfã€‚\næ’å€¼å­—ç¬¦ä¸²ï¼Œåœ¨å­—ç¬¦ä¸²æ€»é€šè¿‡$è·å–å˜é‡è¿›è¡Œæ‹¼æ¥\nç¤ºä¾‹\npackage io.itlab1024.github.scala.chapter02\n\nobject Test04_String &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    &#x2F;&#x2F; å­—ç¬¦ä¸²è¿æ¥\n    val a &#x3D; &quot;I am learning &quot;\n    val b &#x3D; &quot;scala&quot;\n    println(a + b) &#x2F;&#x2F; I am learning scala\n\n    &#x2F;&#x2F; printfæ ¼å¼åŒ–è¾“å‡º\n    printf(&quot;%s%s\\n&quot;, a, b) &#x2F;&#x2F; I am learning scala\n\n    &#x2F;&#x2F; æ’å€¼å­—ç¬¦ä¸²ï¼ˆæ¨¡æ¿å­—ç¬¦ä¸²ï¼‰\n    println(s&quot;$a$b&quot;) &#x2F;&#x2F; I am learning scalaï¼Œ sæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œ å®šä¹‰æºç ï¼šdef s(args: Any*): String &#x3D; standardInterpolator(treatEscapes, args)\n\n    &#x2F;&#x2F; ä¹Ÿå¯ä»¥ä½¿ç”¨$&#123;&#125;ï¼Œé€šè¿‡+è¿ç®—ç¬¦è¿›è¡Œè¿æ¥\n    println(s&quot;$&#123;a + b&#125;&quot;) &#x2F;&#x2F; I am learning scala\n\n    &#x2F;&#x2F; $&#123;&#125;å…¶å®å¯ä»¥å†™scalaä»£ç ï¼Œè°ƒç”¨å‡½æ•°ç­‰ç­‰éƒ½æ˜¯æ”¯æŒçš„\n    println(s&quot;$&#123;1 + 2 + math.pow(1, 2)&#125;&quot;) &#x2F;&#x2F; 4.0\n\n    &#x2F;&#x2F;æ ¼å¼åŒ–å°æ•°ï¼Œæ¯”å¦‚å°æ•°ä½æ•°,éœ€è¦æ³¨æ„çš„æ˜¯è¿™å°±ä¸èƒ½ä½¿ç”¨så‡½æ•°ï¼Œå¦‚æœä½¿ç”¨ä¼šåŸæ ·è¾“å‡ºï¼Œéœ€è¦ä½¿ç”¨få‡½æ•°ã€‚\n    val f: Float &#x3D; 11.2356F\n    println(f&quot;$f%2.2f&quot;) &#x2F;&#x2F;11.24   è¿™å°±æ˜¯è¯´å°æ•°ç‚¹å‰é¢è¦ä¿è¯ä¸¤ä½ï¼Œå°æ•°ç‚¹åä¹Ÿæ˜¯ä¸¤ä½ï¼Œå¤šä½™ä½æ•°å››èˆäº”å…¥ï¼Œèˆå¼ƒ\n    &#x2F;&#x2F; ä¹Ÿå¯ä»¥çœç•¥.å‰é¢çš„æ•°å­—\n    println(f&quot;$f%.2f&quot;) &#x2F;&#x2F;11.24\n    &#x2F;&#x2F; å‰é¢çš„æ•°å­—æœ‰èŒƒå›´å—?\n    println(f&quot;$f%100.2f&quot;) &#x2F;&#x2F;è¾“å‡ºç©ºï¼Œä¸ºä»€ä¹ˆï¼Ÿæˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œæœ‰ç©ºçœ‹çœ‹æºç å§ï¼Œæˆ‘ä¼°è®¡è¿˜æœ‰å¾ˆå¤šç»†èŠ‚ï¼Œå¹³æ—¶å¯èƒ½ä¸ä¼šç”¨åˆ°ï¼Œä½†æ˜¯é¢è¯•æˆ–è€…è€ƒè¯•ä¼°è®¡å°±ä¼šå‡ºé¢˜ï¼Œæˆ‘ä»¬çŸ¥é“å¥—è·¯å°±æ˜¯è¿™æ ·\n\n    &#x2F;&#x2F;rawå‡½æ•°çš„ä½¿ç”¨\n    println(raw&quot;$f%2.2f&quot;) &#x2F;&#x2F; 11.2356%2.2fï¼Œé™¤äº†$è·å–å˜é‡å€¼å¤–ï¼Œå…¶ä»–çš„å­—ç¬¦åŸæ ·è¾“å‡ºäº†\n    println(s&quot;$f%2.2f&quot;) &#x2F;&#x2F; 11.2356%2.2f\n    &#x2F;&#x2F; så‡½æ•°å’Œrawå‡½æ•°ç»“æœä¸€æ ·ï¼Œé‚£ä¹ˆä»–ä¿©æœ‰å•¥åŒºåˆ«å‘¢\n    println(raw&quot;$f%2.2f\\tå›è½¦&quot;) &#x2F;&#x2F; 11.2356%2.2f\\tå›è½¦ï¼Œ çœŸæ­£çš„åŸæ ·è¾“å‡º\n    println(s&quot;$f%2.2f\\tå›è½¦&quot;) &#x2F;&#x2F; 11.2356%2.2f\tå›è½¦ï¼Œ \\tæœªåŸæ ·è¾“å‡ºï¼Œè¢«è§£æåˆ¶è¡¨ç¬¦\n\n\n    &#x2F;&#x2F; ä¸‰å¼•å·å­—ç¬¦ä¸²ï¼ŒstripMarginæ˜¯å­—ç¬¦ä¸²çš„å‡½æ•°ï¼Œå¿½ç•¥è¾¹ç•Œ\n    val s1: String &#x3D;\n      &quot;&quot;&quot;\n        |i\n        |am\n        |learning\n        |scala\n        |&quot;&quot;&quot;.stripMargin\n    println(s1) &#x2F;&#x2F; åŸæ ·è¾“å‡ºï¼Œæ³¨æ„ä¸ä¼šè¾“å‡º|,ä¼šæœ‰å›è½¦æ¢è¡Œ\n\n    &#x2F;&#x2F; ä¸‰å¼•å·å­—ç¬¦ä¸²åŒæ ·å¯ä»¥ä½¿ç”¨s,rawç­‰å‡½æ•°\n    val s2 &#x3D;\n      s&quot;&quot;&quot;\n         |The\n         |value\n         |is\n         |$a\n         |&quot;&quot;&quot;.stripMargin\n     println(s2)\n\n    &#x2F;&#x2F; raw\n    val s3 &#x3D;\n      raw&quot;&quot;&quot;\n           |$a \\txx\n           |&quot;&quot;&quot;.stripMargin\n   println(s3)\n\n\n  &#125;\n&#125;\n\né”®ç›˜è¾“å…¥é”®ç›˜è¾“å…¥ä¸€èˆ¬åœ¨å¼€å‘äº¤äº’å¼çš„ç¨‹åºä¸­å¾ˆæœ‰ç”¨ã€‚\nå¸¸ç”¨åŸºæœ¬è¯­æ³•\nStdIn.readLine(),StdIn.readShort(),StdIn.readDouble()ï¼ŒStdIn.readInt()ç­‰ç­‰\nç¤ºä¾‹\npackage io.itlab1024.github.scala.chapter02\n\nimport scala.io.StdIn\n\nobject Test05_StdIn &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    println(&quot;è¯·è¾“å…¥å§“å&quot;)\n    val name &#x3D; StdIn.readLine()\n    println(&quot;è¯·è¾“å…¥å¹´é¾„&quot;)\n    val age &#x3D; StdIn.readInt()\n    println(s&quot;$name çš„å¹´é¾„æ˜¯$age&quot;)\n  &#125;\n&#125;\n\n\n\næ–‡ä»¶è¾“å…¥è¾“å‡ºï¼ˆIOï¼‰æ–‡ä»¶è¾“å…¥ä¸»è¦ä½¿ç”¨åˆ°æ˜¯scalaä¸­çš„scala.ioåŒ…å†…å®¹ï¼Œä½†æ˜¯scalaå¹¶æ²¡æœ‰æä¾›æ–‡ä»¶è¾“å‡ºapiï¼Œéœ€è¦è°ƒç”¨javaçš„APIå®ç°\npackage io.itlab1024.github.scala.chapter02\n\nimport java.io.PrintWriter\nimport scala.io.Source\n\n&#x2F;**\n * æ–‡ä»¶çš„è¾“å…¥è¾“å‡º\n *\n * @author itlab1024\n *&#x2F;\nobject Test06_FileIO &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    &#x2F;&#x2F; ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œä½¿ç”¨scala.ioåŒ…ä¸‹çš„ç›¸å…³åŒ…\n    &#x2F;&#x2F; è¯»å–æ–‡ä»¶ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤,1ï¼šæ‰“å¼€æ–‡ä»¶æµï¼Œ2ï¼šè¯»å–æ–‡ä»¶ï¼Œ3ï¼šå…³é—­æ–‡ä»¶æµ\n    val bufferedSource &#x3D; Source.fromFile(&quot;src&#x2F;main&#x2F;resources&#x2F;read.text&quot;)\n    bufferedSource.foreach(print)\n    bufferedSource.close()\n\n    &#x2F;&#x2F; å†™å†…å®¹åˆ°æ–‡ä»¶,scalaä¸­æ²¡æœ‰å®ç°å†™æ–‡ä»¶çš„apiï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡è°ƒç”¨Javaçš„apiæ¥å®ç°\n    val writer &#x3D; new PrintWriter(&quot;src&#x2F;main&#x2F;resources&#x2F;write.txt&quot;)\n    writer.write(&quot;I am learning scala&quot;)\n    writer.close()\n  &#125;\n&#125;\n\næ•°æ®ç±»å‹æ•°æ®ç±»å‹æ˜¯ä»»ä½•ä¸€é—¨è¯­è¨€çš„é‡ç‚¹ï¼Œscalaä¹Ÿä¸ä¾‹å¤–ã€‚\nå­¦è¿‡javaçš„åº”è¯¥çŸ¥é“Javaæœ‰8ä¸ªåŸºæœ¬ç±»å‹charï¼Œbyteï¼Œshortï¼Œintï¼Œlongï¼Œfloatï¼Œdoubleï¼Œboolean\nè¿˜æœ‰ä¸Šé¢8ä¸­ç±»å‹å¯¹åº”çš„å¼•ç”¨ç±»å‹ï¼Œä»¥åŠStringæˆ–è€…æ˜¯è‡ªå®šä¹‰çš„å¼•ç”¨ç±»å‹ã€‚\nscalaæ˜¯çº¯é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œæ²¡æœ‰åŸºæœ¬ç±»å‹æ¦‚å¿µï¼Œæˆ‘ä»¬é€šè¿‡å®˜ç½‘ä¸€å¼ å›¾æ¥çœ‹ä¸‹ç±»å‹ç»§æ‰¿å…³ç³»ã€‚\n\n\nScalaä¸­ä¸€åˆ‡æ•°æ®éƒ½æ˜¯å¯¹è±¡ï¼Œå¹¶ä¸”æ˜¯Anyçš„å­ç±»ã€‚\nScalaä¸­ä¸»è¦åˆ†ä¸ºä¸¤ç§æ•°æ®ï¼šæ•°å€¼ç±»å‹(AnyVal)å’Œå¼•ç”¨ç±»å‹(AnyRef)ã€‚\nScalaå’ŒJavaä¸€æ ·ï¼Œä½ç²¾åº¦çš„æ•°å€¼ç±»å‹è‡ªåŠ¨è½¬æ¢ä¸ºé«˜ç²¾åº¦çš„ç±»å‹ã€‚\nScalaä¸­çš„String Opsæ˜¯Javaä¸­Stringçš„å¢å¼º\nUnitï¼šç­‰ä»·äºJavaä¸­çš„Voidç©ºå€¼ç±»å‹ï¼Œæ ‡è¯†æ–¹æ³•æ²¡æœ‰è¿”å›å€¼\nNullï¼šScalaä¸­çš„Nullæ˜¯æ‰€æœ‰åº”ç”¨ç±»å‹çš„å­ç±»\nNothingï¼šæ˜¯æ‰€æœ‰ç±»å‹çš„å­ç±»ï¼Œä¸»è¦ç”¨åœ¨ä¸€ä¸ªå‡½æ•°æ²¡æœ‰æ˜ç¡®è¿”å›å€¼æ—¶ä½¿ç”¨ï¼Œå› ä¸ºè¿™æ ·æˆ‘ä»¬å¯ä»¥æŠŠæŠ›å‡ºçš„è¿”å›å€¼è¿”å›ç»™ä»»ä½•çš„å˜é‡æˆ–è€…å‡½æ•°\n\n\n\n\næ•°å€¼ç±»å‹\nè¯´æ˜\n\n\n\nBoolean\ntrueæˆ–è€…false\n\n\nByte\n8 ä½æœ‰ç¬¦å·è¡¥ç æ•´æ•°ï¼ˆ-2^7 åˆ° 2^7-1] ä¹Ÿå°±æ˜¯ï¼š-128 åˆ° 127\n\n\nShort\n16 ä½æœ‰ç¬¦å·è¡¥ç æ•´æ•°ï¼ˆ-2^15 åˆ° 2^15-1] ä¹Ÿå°±æ˜¯ -32,768 åˆ° 32,767\n\n\nInt\n32 ä½äºŒè¿›åˆ¶è¡¥ç æ•´æ•°ï¼ˆ-2^31 åˆ° 2^31-1ï¼Œå«]-2,147,483,648 åˆ° 2,147,483,647\n\n\nLong\n64 ä½äºŒè¿›åˆ¶è¡¥ç æ•´æ•°ï¼ˆ-2^63 åˆ° 2^63-1]\n\n\nFloat\n32 ä½ IEEE 754 å•ç²¾åº¦æµ®ç‚¹ 1.40129846432481707e-45 åˆ° 3.40282346638528860e+38\n\n\nDouble\n64 ä½ IEEE 754 åŒç²¾åº¦æµ®ç‚¹4.94065645841246544e-324d åˆ° 1.79769313486231570e+308d\n\n\nChar\n16 ä½æ— ç¬¦å· Unicode å­—ç¬¦ï¼ˆ0 åˆ° 2^16-1ï¼Œå«ï¼‰0 åˆ° 65,535\n\n\nString\nå­—ç¬¦ä¸²ï¼Œç”±å¤šä¸ªCharç»„æˆ\n\n\næŒ‰ç…§ä¸Šé¢çš„è¯´æ˜å¯ä»¥çœ‹åˆ°åŸºæœ¬éƒ½æ˜¯-2^(n-1)åˆ°2^(n-1) -1ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæ˜¯æ˜¯è¿™æ ·å‘¢\næˆ‘ä»¬ä»¥Byteæ¥ä¸¾ä¾‹è¯´æ˜ï¼ŒByteæ˜¯1ä¸ªå­—èŠ‚ï¼ˆbyteï¼‰ï¼Œ8ä½å­˜ï¼ˆbitï¼‰å‚¨çš„ã€‚è¯·æ³¨æ„æ€»å…±æœ‰8ä½ï¼ˆbitï¼‰ã€‚\né¦–å…ˆæœ‰ç¬¦å·æ•°ç”¨ç¬¬ä¸€ä½ï¼ˆæ­£ç€æ•°ï¼‰æ ‡è¯†ç¬¦å·ä½1ä»£è¡¨è´Ÿæ•°ï¼Œ0ä»£è¡¨æ•´æ•°ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„7ä½å°±æ˜¯æ•°å€¼ä½\n1ç¬¦å·ä½+7æ•°å€¼ä½=8ä½\né‚£ä¹ˆ7ä½èƒ½å¤Ÿè¡¨ç¤ºå¤šå°‘ä¸ªæ•°å‘¢ï¼Ÿåº”è¯¥æ˜¯2çš„7æ¬¡æ–¹ã€‚èŒƒå›´åº”è¯¥æ˜¯0-127ï¼Œå†åŠ ä¸Šç¬¦å·ä½å°±èƒ½å¤Ÿä»£è¡¨+(0-127)å’Œ-(0-127)ï¼Œä½†æ˜¯0æ˜¯é‡å¤äº†ï¼Œæ­£æ•°0ï¼ˆ0000 0000ï¼‰å’Œè´Ÿæ•°0ï¼ˆ1000 0000ï¼‰å…¶å®æ˜¯ä¸€æ ·çš„ã€‚è¿™å°±æµªè´¹äº†ï¼Œæ‰€ä»¥è§„å®šæ­£0æ˜¯0ï¼Œè´Ÿ0ä»£è¡¨æœ€å¤§çš„è´Ÿæ•°(-128ï¼‰ã€‚\nç¤ºä¾‹\npackage io.itlab1024.github.scala.chapter02\n\n&#x2F;**\n * æ•°æ®ç±»å‹æ“ä½œ\n *&#x2F;\nobject Test07_DataType &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    &#x2F;&#x2F; Booleanç±»å‹\n    var b1: Boolean &#x3D; false\n    b1 &#x3D; true\n\n\n    &#x2F;&#x2F; Byte\n    var a: Byte &#x3D; 127 &#x2F;&#x2F;æ­£ç¡®\n    &#x2F;&#x2F;    a &#x3D; 128 &#x2F;&#x2F; ç¼–è¯‘å‡ºé”™\n    &#x2F;&#x2F;    a &#x3D; -129 &#x2F;&#x2F; ç¼–è¯‘å‡ºé”™\n\n    var b &#x3D; 128 &#x2F;&#x2F;128é»˜è®¤æ˜¯Int\n\n    &#x2F;&#x2F; Long,å¯ä»¥ä¸æŒ‡å®šç±»å‹é€šè¿‡ä»¥Lï¼ˆlï¼‰ç»“å°¾ï¼Œå»ºè®®ä½¿ç”¨å¤§å†™ã€‚\n    val c: Long &#x3D; 122\n    val c1 &#x3D; 122L\n\n\n    &#x2F;&#x2F; è‡ªåŠ¨è½¬åŒ–ç±»å‹ï¼Œä¸‹é¢çš„10å’Œ20é»˜è®¤æ˜¯Intï¼Œç›¸åŠ &#x3D;30ï¼Œæ˜¯åœ¨ByteèŒƒå›´å†…çš„ï¼Œè¿™æ˜¯å…è®¸çš„ã€‚\n    val d: Byte &#x3D; 10 + 20 &#x2F;&#x2F; IDEAæç¤ºç±»å‹ä¸åŒ¹é…ï¼ˆå¯èƒ½è§‰å¾—åé¢åº”è¯¥æ˜¯INTï¼‰ï¼Œä½†å®é™…æ˜¯å¯ä»¥è¿è¡Œçš„\n    println(d) &#x2F;&#x2F;30\n\n    val e: Byte &#x3D; 10\n    &#x2F;&#x2F;    val f: Byte &#x3D; e + 20  &#x2F;&#x2F; ç¼–è¯‘å™¨æç¤ºç±»å‹ä¸åŒ¹é…ï¼Œè¿™æ¬¡åŒ¹é…æ˜¯ç¡®å®ä¸èƒ½æ‰§è¡Œçš„ï¼Œè¿™æ˜¯å› ä¸ºè¿™æ®µä»£ç åªæœ‰åˆ°è¿è¡Œæ—¶æ‰èƒ½è·å¾—b1çš„æ•°æ®æ‰èƒ½æ‰§è¡Œã€‚\n    &#x2F;&#x2F; å¯ä»¥ä½¿ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢\n    val f: Byte &#x3D; (e + 20).toByte &#x2F;&#x2F; ä½¿ç”¨toByteå¼ºåˆ¶è½¬åŒ–ä¸ºByteç±»å‹\n\n    &#x2F;&#x2F; è¶…è¿‡èŒƒå›´æƒ…å†µ\n    val g: Byte &#x3D; 127 &#x2F;&#x2F; 127æ˜¯Byteçš„æœ€å¤§æ­£æ•°\n    val h: Byte &#x3D; 1\n    &#x2F;&#x2F;    val i: Byte &#x3D; g + h&#x2F;&#x2F; è¿è¡Œä¼šæŠ¥é”™ï¼Œå› ä¸º127 + 1 &#x3D; 128 è¶…å‡ºäº†ByteèŒƒå›´ï¼Œè€Œæ˜¯ä¸€ä¸ªIntå€¼ã€‚ä½¿ç”¨Byteæ¥æ”¶æ˜¯ä¸å…è®¸çš„ã€‚\n\n    &#x2F;&#x2F; æµ®ç‚¹ç±»å‹\n    val j &#x3D; 1.23 &#x2F;&#x2F;é»˜è®¤æ˜¯Doubleç±»å‹\n    &#x2F;&#x2F; å¯ä»¥ä½¿ç”¨F(f)æŒ‡å®šFloatç±»å‹\n    val j1 &#x3D; 1.23F\n\n    &#x2F;&#x2F; å­—ç¬¦ç±»å‹ï¼Œæ ‡è¯†å•ä¸ªå­—ç¬¦,å½“ç„¶ä¹ŸåŒ…æ‹¬æ§åˆ¶å­—ç¬¦ï¼ˆ\\t,\\nç­‰ï¼‰\n    val k: Char &#x3D; &#39;a&#39;\n    val l: Char &#x3D; &#39;\\t&#39;\n    val m: Char &#x3D; &#39;\\\\&#39; &#x2F;&#x2F; å¦‚æœæƒ³æ‰“å°\\éœ€è¦ä½¿ç”¨è½¬ä¹‰\n\n    &#x2F;&#x2F; Charç±»å‹åœ¨è®¡ç®—æœºåº•å±‚ä¿å­˜çš„æ˜¯å®é™…å­—é¢çœ‹åˆ°çš„å­—ç¬¦å—ï¼Ÿå…¶å®ä¸æ˜¯ï¼ŒçœŸæ­£ä¿å­˜çš„å…¶å®æ˜¯ASCIIç \n    val n: Int &#x3D; k\n    println(n) &#x2F;&#x2F; 97 ï¼Œä¹Ÿå°±æ˜¯è¯´å­—ç¬¦&#39;a&#39;å®é™…çš„æ•´æ•°å€¼æ˜¯97ã€‚\n\n    &#x2F;&#x2F; æ•´æ•°è½¬åŒ–ä¸ºChar\n    println(98.toChar) &#x2F;&#x2F; b\n\n\n    &#x2F;&#x2F; Unit\n    val o: Unit &#x3D; ()\n    &#x2F;&#x2F; Null\n    val p: Null &#x3D; null\n    &#x2F;&#x2F; Nothing,æ¯”å¦‚ä¸‹é¢æ–¹æ³•å¯ä»¥è¿”å›Nothingï¼Œä½†æ˜¯å®é™…å¹¶ä¸è¿™ä¹ˆåšï¼Œå› ä¸ºä»–æ˜¯æ‰€æœ‰ç±»å‹çš„å­ç±»\n    def  nothingTest() : Nothing &#x3D; &#123;\n      throw RuntimeException &#x2F;&#x2F; å¿…é¡»æŠ›å‡ºå¼‚å¸¸ï¼Œå¦åˆ™æç¤ºè¿”å›ç±»å‹åº”è¯¥æ˜¯Void\n    &#125;\n    &#x2F;&#x2F;å®é™…æˆ‘ä»¬å¯èƒ½ä¼šè¿™æ ·åš\n    def nothingTest(i: Int) : Int &#x3D; &#123;\n      if (i &#x3D;&#x3D; 0)\n        throw RuntimeException &#x2F;&#x2F; å¿…é¡»æŠ›å‡ºå¼‚å¸¸ï¼Œå¦åˆ™æç¤ºè¿”å›ç±»å‹åº”è¯¥æ˜¯Void\n      else\n        i\n    &#125;\n\n  &#125;\n&#125;\n\n\n\n\nç±»å‹è½¬æ¢Scalaä¸­çš„æ•°æ®è½¬æ¢è§„åˆ™è·ŸJavaçš„ä¸€æ ·\nå½“Scalaç¨‹åºåœ¨è¿›è¡Œèµ‹å€¼æˆ–è€…è¿ç®—æ—¶ï¼Œç²¾åº¦å°çš„ç±»å‹è‡ªåŠ¨è½¬æ¢ä¸ºç²¾åº¦å¤§çš„æ•°å€¼ç±»å‹ï¼Œè¿™å°±æ˜¯è‡ªåŠ¨ç±»å‹è½¬æ¢ï¼ˆä¹Ÿå«åšéšå¼è½¬æ¢ï¼‰ã€‚\n\nåŸºæœ¬è¯´æ˜ï¼š\nâ€‹\tè‡ªåŠ¨è½¬æ¢åŸåˆ™ï¼šå¤šç§ç±»å‹æ··åˆè¿ç®—æ—¶ï¼Œç³»ç»Ÿä¼šå…ˆè‡ªåŠ¨å°†æ‰€æœ‰ç±»å‹è½¬æ¢ä¸ºç²¾åº¦å¤§çš„ç±»å‹ï¼Œç„¶åå†åšè¿ç®—ã€‚\nâ€‹\tå°†ç²¾åº¦å¤§çš„èµ‹å€¼ç»™ç²¾åº¦å°çš„æ•°å€¼ç±»å‹æ—¶å°±ä¼šæŠ¥é”™ï¼Œåä¹‹è‡ªåŠ¨è½¬æ¢\nâ€‹\t(Byteå’ŒShort)å’ŒCharä¹‹é—´ä¸ä¼šè‡ªåŠ¨ç›¸äº’è½¬æ¢\nâ€‹\tByteï¼ŒShortï¼ŒChar ä¸‰è€…è¿ç®—ä¼šå…ˆè½¬æ¢ä¸ºIntç±»å‹\nç¤ºä¾‹\npackage io.itlab1024.github.scala.chapter02\n\n&#x2F;**\n * æ•°æ®ç±»å‹è½¬æ¢\n *&#x2F;\nobject Test08_DataTypeConversion &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    &#x2F;&#x2F;    è‡ªåŠ¨è½¬æ¢åŸåˆ™ï¼šå¤šç§ç±»å‹æ··åˆè¿ç®—æ—¶ï¼Œç³»ç»Ÿä¼šå…ˆè‡ªåŠ¨å°†æ‰€æœ‰ç±»å‹è½¬æ¢ä¸ºç²¾åº¦å¤§çš„ç±»å‹ï¼Œç„¶åå†åšè¿ç®—ã€‚\n    val a: Byte &#x3D; 10\n    val b: Long &#x3D; 23L\n    &#x2F;&#x2F;    val c: Int &#x3D; a + b &#x2F;&#x2F; ç¼–è¯‘é”™è¯¯ï¼Œæç¤ºç»“æœæ˜¯Longï¼Œä¸å…è®¸ç”¨Intç±»å‹å¸¸é‡æ¥æ”¶\n    val d: Int &#x3D; a + b.toInt &#x2F;&#x2F;è¿™å°±æ²¡æœ‰é—®é¢˜ï¼Œå› ä¸ºæˆ‘å°†bé€šè¿‡toIntæ–¹æ³•å¼ºåˆ¶è½¬æ¢ä¸ºIntï¼Œè€Œaæ˜¯Byteä¼šè‡ªåŠ¨æå‡ä¸ºIntï¼Œè®¡ç®—ç»“æœæ˜¯Int\n\n    &#x2F;&#x2F;    å°†ç²¾åº¦å¤§çš„èµ‹å€¼ç»™ç²¾åº¦å°çš„æ•°å€¼ç±»å‹æ—¶å°±ä¼šæŠ¥é”™ï¼Œåä¹‹è‡ªåŠ¨è½¬æ¢\n    val e: Int &#x3D; 1\n    val f: Long &#x3D; e &#x2F;&#x2F;è‡ªåŠ¨è½¬æ¢ä¸ºé«˜ç²¾åº¦ç±»å‹\n    &#x2F;&#x2F;    val g: Byte &#x3D; e &#x2F;&#x2F; é”™è¯¯\n\n    &#x2F;&#x2F;   (&#96;Byte&#96;å’Œ&#96;Short&#96;)å’Œ&#96;Char&#96;ä¹‹é—´ä¸ä¼šè‡ªåŠ¨ç›¸äº’è½¬æ¢\n    val h: Byte &#x3D; 1\n    &#x2F;&#x2F;    val i: Char &#x3D; h &#x2F;&#x2F; é”™è¯¯\n    val j: Short &#x3D; 1\n    &#x2F;&#x2F;    val k: Char &#x3D; j &#x2F;&#x2F;é”™è¯¯\n\n\n    &#x2F;&#x2F;   &#96;Byte&#96;ï¼Œ&#96;Short&#96;ï¼Œ&#96;Char&#96; ä¸‰è€…è¿ç®—ä¼šå…ˆè½¬æ¢ä¸º&#96;Int&#96;ç±»å‹\n    &#x2F;&#x2F;    val l: Short &#x3D; h + j &#x2F;&#x2F; é”™è¯¯æç¤ºåº”è¯¥æ˜¯Int\n\n    &#x2F;&#x2F;æ•°å€¼ç±»å‹å’ŒStringçš„äº’ç›¸è½¬æ¢ï¼ˆé‡ç‚¹ï¼Œå¹³æ—¶å¼€å‘ä¸­å¸¸ç”¨ï¼‰\n    &#x2F;&#x2F; æ•°å€¼è½¬String\n    val m: Int &#x3D; 1\n    val n: String &#x3D; m + &quot;&quot;\n\n    &#x2F;&#x2F; Stringè½¬æ¢ä¸ºæ•°å€¼\n    val o: String &#x3D; &quot;1&quot;\n    val p: Int &#x3D; o.toInt &#x2F;&#x2F; ç›´æ¥è°ƒç”¨toIntæ–¹æ³•\n\n    &#x2F;&#x2F; æ³¨æ„å¼‚å¸¸é—®é¢˜\n    &#x2F;&#x2F;    val q : Int &#x3D; &quot;1.1&quot;.toInt &#x2F;&#x2F;ç¼–è¯‘ä¸æŠ¥é”™ï¼Œè¿è¡Œæ˜¯ä¸å…è®¸çš„ã€‚\n\n\n    &#x2F;&#x2F; æ•°æ®æº¢å‡ºé—®é¢˜\n    val r: Int &#x3D; 200 &#x2F;&#x2F;200è‚¯å®šè¶…è¿‡äº†Byeçš„èŒƒå›´\n    val s: Byte &#x3D; r.toByte\n    println(s)&#x2F;&#x2F; ç»“æœæ˜¯-56 åˆ™æ˜¯å› ä¸ºç²¾åº¦ç¼ºå¤±äº†ã€‚\n    &#x2F;*æˆ‘ä»¬åˆ†æä¸‹ï¼ŒIntæ˜¯32ä½ï¼Œ\n    200çš„åŸç æ˜¯ï¼š\n    00000000 00000000 00000000 11001000\n    è¡¥ç \n    00000000 00000000 00000000 11001000\n\n    é‚£ä¹ˆè½¬åŒ–ä¸ºByteçš„æ—¶å€™è¦æˆªå–1ä¸ªè‡ªå·±8ä½ï¼Œå¾—åˆ°ç»“æœæ˜¯11001000ï¼Œé‚£ä»–çš„åŸç å°±æ˜¯å–å(00110111),å†åŠ ä¸€(10111000),ç»“æœå°±æ˜¯-56\n    *&#x2F;\n  &#125;\n&#125;\n\n\nè¿ç®—ç¬¦Scalaä¸­çš„è¿ç®—ç¬¦å’ŒJavaä¸­çš„åŸºæœ¬ç›¸åŒã€‚\nç®—æœ¯è¿ç®—ç¬¦ç®—æœ¯è¿ç®—ç¬¦ä¸»è¦æœ‰+ï¼Œ-ï¼Œ*ï¼Œ/ï¼Œ%ï¼Œä¸åšè¯¦ç»†ä»‹ç»ã€‚\n\n\n\nè¿ç®—ç¬¦\nè¯´æ˜\n\n\n\n+\nåŠ æ³•è¿ç®—ï¼Œå¯ä»¥ä½œç”¨äºæ•°å€¼ä¹Ÿå¯ç”¨äºå­—ç¬¦ä¸²è¿æ¥ï¼Œæ¯”å¦‚ 1+1ã€â€aâ€ + â€œbâ€\n\n\n-\nå‡æ³•\n\n\n*\nä¹˜æ³•\n\n\n&#x2F;\né™¤æ³•\n\n\n%\næ±‚ä½™ 10&#x2F;3 &#x3D; 1\n\n\nå…³ç³»è¿ç®—ç¬¦ï¼ˆæ¯”è¾ƒè¿ç®—ç¬¦ï¼‰å…³ç³»è¿ç®—ç¬¦ä¸»è¦æœ‰==ï¼Œ!=ï¼Œ&lt;ï¼Œ&gt;ï¼Œ&lt;=ï¼Œ&gt;=ï¼Œä¹Ÿè·ŸJavaåŸºæœ¬ç›¸åŒï¼Œè¿™é‡Œé‡ç‚¹è¯´ä¸‹==,\nè¿˜è®°å¾—javaä¸­çš„==å’Œequalsæ–¹æ³•çš„åŒºåˆ«å—ï¼Ÿ==æ˜¯ä»£è¡¨æ¯”è¾ƒå¼•ç”¨æ˜¯å¦ç›¸ç­‰ï¼Œequalsä»£è¡¨æ¯”è¾ƒå€¼æ˜¯å¦ç›¸ç­‰ï¼Œä¸å¥½ç†è§£ï¼Œscalaä¸­å°±ç®€å•äº†å¾ˆå¤š==å°±æ˜¯åˆ¤æ–­å€¼æ˜¯å¦ç›¸ç­‰ï¼Œequalsä¹Ÿæ˜¯åˆ¤æ–­çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚\né‚£ä¹ˆscalaä¸­å¦‚ä½•åˆ¤æ–­å¼•ç”¨æ˜¯å¦ç›¸ç­‰å‘¢ï¼Ÿeqæ–¹æ³•ã€‚\n\n\n\nè¿ç®—ç¬¦\nè¯´æ˜\n\n\n\n&#x3D;&#x3D;\næ¯”è¾ƒæ˜¯å¦ç›¸ç­‰ï¼Œå¯¹äºå¼•ç”¨ç±»å‹ï¼Œç­‰ä»·äºequalsæ–¹æ³•\n\n\n!&#x3D;\nä¸ç­‰äº\n\n\n&lt;\nå°äº\n\n\n&gt;\nå¤§äº\n\n\n&lt;&#x3D;\nå°äºç­‰äº\n\n\n&gt;&#x3D;\nå¤§äºç­‰äº\n\n\né€»è¾‘è¿ç®—ç¬¦é€»è¾‘è¿ç®—ç¬¦æœ‰&amp;&amp;ï¼Œ||ï¼Œï¼\n\n\n\nè¿ç®—ç¬¦\nè¯´æ˜\n\n\n\n&amp;&amp;\nçŸ­è·¯ä¸ï¼Œæ¯”å¦‚ a &gt; b &amp;&amp; c &gt; dï¼Œå¦‚æœa &gt; b &#x3D;&#x3D; false,åˆ™åé¢çš„c &gt; d ä¸ä¼šæ‰§è¡Œã€‚\n\n\n||\nçŸ­è·¯æˆ–ï¼Œ æ¯”å¦‚ a &gt; b || c &gt; dï¼Œ å¦‚æœa&gt;b &#x3D;&#x3D; true,åˆ™åé¢çš„c &gt; dä¸ä¼šè¿è¡Œã€‚\n\n\n!\néï¼Œå¦‚æœ a  &#x3D;&#x3D; false, åˆ™!a &#x3D; true\n\n\nèµ‹å€¼è¿ç®—ç¬¦=ï¼Œ+=ï¼Œ-=ï¼Œ*=ï¼Œ/=ï¼Œ%=ï¼Œ&gt;&gt;=ï¼Œ&lt;&lt;= è·ŸJavaä¹Ÿä¸€æ ·ï¼Œä¸è¯´äº†ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯scalaä¸­æ²¡æœ‰++ï¼Œ--è¿ç®—ç¬¦ï¼Œjavaä¸­æœ‰è¿™ä¸ªä¸¤ä¸ªè¿ç®—ç¬¦ï¼Œæœ‰å‘ï¼Œæ–°æ‰‹å¯èƒ½ä¼šè¿›å…¥è¯¯åŒºã€‚scalaè¿™ç‚¹è¿˜æ˜¯æ¯”è¾ƒå¥½çš„ã€‚\n\n\n\nè¿ç®—ç¬¦\nè¯´æ˜\n\n\n\n&#x3D;\nå¤åˆ¶ val a &#x3D; 1 ,ç»™aèµ‹å€¼1\n\n\n+&#x3D;\nå…ˆç›¸åŠ å†èµ‹å€¼\n\n\n-&#x3D;\nå…ˆåšå‡æ³•åœ¨èµ‹å€¼\n\n\n*&#x3D;\nå…ˆåšä¹˜æ³•å†èµ‹å€¼\n\n\n&#x2F;&#x3D;\nå…ˆåšé™¤æ³•å†èµ‹å€¼\n\n\n%&#x3D;\nå…ˆæ±‚ä½™å†èµ‹å€¼\n\n\n&gt;&gt;&#x3D;\nå…ˆå‘å³ä½ç§»å†èµ‹å€¼\n\n\n&lt;&lt;&#x3D;\nå…ˆå‘å·¦ç§»å†èµ‹å€¼\n\n\nä½è¿ç®—ç¬¦\n\n\nè¿ç®—ç¬¦\nè¯´æ˜\n\n\n\n&amp;\næŒ‰ä½ä¸\n\n\n|\næŒ‰ä½æˆ–\n\n\n^\næŒ‰ä½å¼‚æˆ–\n\n\n~\næŒ‰ä½å–å\n\n\n&lt;&lt;\nå·¦ç§»\n\n\n&gt;&gt;\nå³ç§»\n\n\nè¿ç®—ç¬¦çš„æœ¬è´¨scalaä¸­çš„è¿ç®—ç¬¦éƒ½æ˜¯æ–¹æ³•ã€‚\næ¯”å¦‚+æˆ‘ä»¬ä¹Ÿå¯é€šè¿‡ç±»ä¼¼æ–¹æ³•è°ƒç”¨çš„æ–¹å¼ä½¿ç”¨ã€‚\nval i &#x3D; j.+(1)\n\n\n\næµç¨‹æ§åˆ¶if-else\nåŸºæœ¬è¯­æ³•\nifï¼ˆæ¡ä»¶ï¼‰ &#123;\n\t&#x2F;&#x2F; å½“æ¡ä»¶æ˜¯trueçš„æ—¶å€™æ‰§è¡Œæ­¤å¤„ä»£ç \n&#125; else &#123;\n  &#x2F;&#x2F; å½“æ¡ä»¶æ˜¯falseçš„æ—¶å€™æ‰§è¡Œæ­¤å¤„ä»£ç \n&#125;\n\nç”¨æ³•ä¸javaåŸºæœ¬ä¸€è‡´ã€‚\nç‰¹åˆ«ä¹‹å¤„\nscalaä¸­æ¯ä¸ªè¡¨è¾¾å¼éƒ½æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œä¸€æ˜¯è¦ä¿è¯æ¯ä¸ªåˆ†æ”¯è¿”å›ç±»å‹ç›¸åŒï¼Œå¦‚æœç¡®å®ä¸åŒï¼Œåˆ™æ¥æ”¶è€…ç±»å‹è¦ä½¿ç”¨ä¸åŒç±»å‹çš„çˆ¶ç±»ã€‚\npackage io.itlab1024.github.scala\n\nimport scala.io.StdIn\n\n&#x2F;**\n * if - elseæ§åˆ¶\n *&#x2F;\nobject Test01_IfElse &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    &#x2F;&#x2F; if else\n    val a: Int &#x3D; 1\n    if (a &gt; 0) &#123;\n      println(&quot;æ­£æ•°&quot;)\n    &#125; else if (a &#x3D;&#x3D; 0) &#123;\n      println(&quot;0&quot;)\n    &#125; else &#123;\n      println(&quot;è´Ÿæ•°&quot;)\n    &#125;\n\n\n\n\n    &#x2F;&#x2F; if elseçš„è¿”å›å€¼\n    val b: Int &#x3D; 10\n    val c : Unit &#x3D; if (b &gt; 0) &#123;\n      println(&quot;æµ‹è¯•è¿”å›å€¼&quot;)\n    &#125;\n    println(c) &#x2F;&#x2F; ()\n\n    &#x2F;&#x2F; å¤šåˆ†æ”¯æƒ…å†µè¦ä¿è¯æœ€åè¿”å›çš„ç±»å‹ç›¸åŒ\n    val d : String &#x3D; if (b &gt; 0) &#123;\n      println(&quot;æµ‹è¯•è¿”å›å€¼&quot;) &#x2F;&#x2F; æ­¤å¤„è¿”å›æ˜¯Unitï¼Œè€Œelseä¸­è¿”å›æ˜¯Stringï¼Œè€Œæ¥æ”¶è€…dçš„ç±»å‹æ˜¯Stringï¼Œè¿™æ˜¯ä¸å…è®¸çš„ï¼ˆå‡è®¾ä¸‹è¡Œå­—ç¬¦ä¸²ä»£ç æ²¡æœ‰ï¼‰ã€‚\n      &quot;æ­¤å¤„ä¹Ÿè¿”å›Stringï¼Œä¿è¯æ¯ä¸ªåˆ†æ”¯è¿”å›çš„æ•°æ®ç±»å‹æ ¼å¼ç»Ÿä¸€&quot;\n    &#125; else &#123;\n      return &quot;abc&quot;\n    &#125;\n  &#125;\n&#125;\n\n\n\n\nmatchæ¨¡å¼åŒ¹é…scalaä¸­æ²¡æœ‰switchï¼Œå–è€Œä»£ä¹‹çš„æ˜¯match\nç›¸æ¯”äºJavaï¼Œscalaä¸­çš„matchï¼Œæ²¡æœ‰breakå…³é”®å­—ï¼Œä½¿ç”¨_ä»£è¡¨é»˜è®¤åˆ†æ”¯\npackage io.itlab1024.github.scala.chapter04\n\nobject Test02_Match &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    &#x2F;&#x2F;matchåŸºæœ¬ç”¨æ³•\n    val i &#x3D; 0\n    i match &#123;\n      case 0 &#x3D;&gt; println(&quot;ç­‰äº0&quot;)\n      case _ &#x3D;&gt; println(&quot;ä¸ç­‰äº0&quot;) &#x2F;&#x2F; _ä»£è¡¨é»˜è®¤åˆ†æ”¯\n    &#125;\n\n    &#x2F;&#x2F; matchä¹Ÿæœ‰è¿”å›å€¼\n    val str &#x3D; i match &#123;\n      case 0 &#x3D;&gt; &quot;ZERO&quot;\n      case _ &#x3D;&gt; &quot;NON ZERO&quot;\n    &#125;\n    println(str)\n\n    &#x2F;&#x2F; åŒä¸€ä¸ªcaseè¯­å¥æœ‰å¤šä¸ªåŒ¹é…å€¼çš„æ—¶å€™ï¼Œä½¿ç”¨|åˆ†éš”\n    i match &#123;\n      case 0 | 1 &#x3D;&gt; &quot;0 or 1&quot;\n      case _ &#x3D;&gt; &quot;other&quot;\n    &#125;\n\n    &#x2F;&#x2F; caseä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼\n    val o  &#x3D; 1\n    i match &#123;\n      case i if (i &#x3D;&#x3D; 0) &#x3D;&gt; &quot;zero&quot; &#x2F;&#x2F;caseåifè¡¨è¾¾å¼çš„æ‹¬å·scalaæ˜¯ä¸æ¨èä½¿ç”¨çš„ã€‚ç¼–è¾‘å™¨ä¹Ÿæç¤ºç»™æˆ‘ä»¬äº†\n      case _ if o &#x3D;&#x3D; 1 &#x3D;&gt; &quot;o is zero&quot;\n    &#125;\n\n    &#x2F;&#x2F;caseè¯­å¥ä¸­åˆ¤æ–­æ•°ç»„æ˜¯å¦åŒ…å«åŒ¹é…çš„æ•°æ®\n    i match &#123;\n      case a if 0 to 9 contains a  &#x3D;&gt; println(&quot;åŒ…å«&quot;)\n    &#125;\n  &#125;\n&#125;\n\n\n\n\nmatchè¿˜æ”¯æŒåŒ¹é…case classåé¢å­¦åˆ°çš„æ—¶å€™å†ç”¨ã€‚\nforå¾ªç¯èŒƒå›´å¾ªç¯ä¸»è¦ä½¿ç”¨toå’Œuntilå…³é”®å­—æ¥å®ç°èŒƒå›´å¾ªç¯ï¼Œå…¶ä¸­toæ ‡è¯†åŒ…å«å·¦å³è¾¹ç•Œå€¼ï¼Œæ¯”å¦‚ 0 to 10åŒ…å«0å’Œ10ï¼Œuntilåˆ™ä¸åŒ…å«10\n &#x2F;&#x2F; æ™®é€šèŒƒå›´å¾ªç¯,ä½¿ç”¨toå…³é”®å­—,åŒ…å«å·¦å³è¾¹ç•Œå€¼\n for (i &lt;- 0 to 10) &#123;\n println(i)\n &#125;\n\n&#x2F;&#x2F; ä¹Ÿå¯ä»¥ä½¿ç”¨untilæ–¹æ³•ï¼Œ ä¸åŒ…å«åé¢çš„è¾¹ç•Œå€¼\nfor (i &lt;- 0 until 10) &#123;\nprintln(i)\n&#125;\n\nå¾ªç¯å®ˆå«å¾ªç¯å®ˆå«çš„æ„æ€æ˜¯è¯´å…è®¸åœ¨forå¾ªç¯èŒƒå›´è¯­å¥åé¢å¢åŠ ifè¡¨è¾¾å¼ï¼Œåªæœ‰å½“è¡¨è¾¾å¼&#x3D;trueçš„æ—¶å€™æ‰è¿›è¡Œå¾ªç¯\n&#x2F;&#x2F; å¾ªç¯å®ˆå«\nval b : Int &#x3D; 0\nfor (i &lt;- 0 to 10 if b &gt; 1) &#123;\n&#x2F;&#x2F;æ°¸è¿œä¸ä¼šæ‰§è¡Œï¼Œå› ä¸ºå¾ªç¯å®ˆå« b &gt; &#x3D; ç»“æœæ˜¯false\n&#125;\n\nå¾ªç¯æ­¥é•¿ä¸Šé¢æˆ‘ä»¬ä½¿ç”¨çš„forå¾ªç¯éƒ½æ˜¯é»˜è®¤ä¸€æ­¥åŠ ä¸€ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½å¸Œæœ›è‡ªå®šä¹‰æ­¥é•¿ã€‚scalaä¸­ä½¿ç”¨byå…³é”®å­—æ¥æ§åˆ¶æ­¥é•¿ï¼ˆæ­¥é•¿ä¸èƒ½æ˜¯0 å¦åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ä¸”è¿˜èƒ½æ˜¯å°æ•°ï¼‰\n&#x2F;&#x2F; å¾ªç¯æ­¥é•¿\nfor (i &lt;- 1 to 10 by 2) &#123;\n\tprintln(i) &#x2F;&#x2F;1 3 5 7 9\n&#125;\n&#x2F;&#x2F; by åä¹Ÿå¯ä»¥ä½¿ç”¨è´Ÿæ•°ï¼Œå½“ä»å¤§åˆ°å°éå†çš„æ—¶å€™æœ‰ç”¨\nfor (i &lt;- 20 to 1 by -2) &#123;\n  println(i) &#x2F;&#x2F;20,8,16,14,12,10,8,6,4,2\n&#125;\n&#x2F;&#x2F; æ­¥é•¿èƒ½ä½¿ç”¨å°æ•°å—ï¼Ÿå¯ä»¥ï¼Œè¦æ±‚toå‰åä¹Ÿå¿…é¡»æ˜¯å°æ•°ï¼Œä¹Ÿå°±æ˜¯ç±»å‹ä¸€è‡´\nfor (i &lt;- 1.3 to 10.0 by 22.0) &#123; &#x2F;&#x2F;ä¼šæç¤ºtoè¿‡æœŸï¼Œä½¿ç”¨BigDecimalï¼Œå› ä¸ºDoubleå’ŒFloatè®¡ç®—ç»“æœå–å†³äºæ“ä½œç³»ç»Ÿï¼Œä¼šå‡ºç°ä¸å‡†ç¡®ã€‚\n  println(i) &#x2F;&#x2F;1 3 5 7 9\n&#125;\n&#x2F;&#x2F;ä½¿ç”¨BigDecimal\nfor (i &lt;- BigDecimal.decimal(1.3) to 10.0 by 22.0) &#123; &#x2F;&#x2F;ä¼šæç¤ºtoè¿‡æœŸï¼Œä½¿ç”¨BigDecimal\n  println(i) &#x2F;&#x2F;1 3 5 7 9\n&#125;\n\nReverse&#x2F;&#x2F; å’Œä¸‹é¢çš„forå¾ªç¯ç­‰ä»·\nfor (i &lt;- 20 to 1 reverse) &#123;\n\tprintln(i) \n&#125;\n\nfor (i &lt;- 1 to 20) &#123;\n\tprintln(i)\n&#125;\n\nå¼•å…¥å˜é‡&#x2F;&#x2F; å¼•å…¥å˜é‡,jå°±æ˜¯å¼•å…¥çš„å˜é‡ï¼Œä¸¤ä¸ªè¡¨è¾¾å¼ç”¨;éš”å¼€ã€‚\nfor (i &lt;-0 to 10 ; j &#x3D; i + 1) &#123;\n  println(s&quot;i&#x3D;$i, j&#x3D;$j&quot;)\n&#125;\n\nå¾ªç¯è¿”å›å€¼scalaä¸­é»˜è®¤æƒ…å†µä¸‹è¿”å›çš„æ˜¯Unitï¼Œå¿…é¡»ä½¿ç”¨yeildå…³é”®å­—æ¥å®ç°ä¸åŒçš„è¿”å›å€¼ã€‚\n&#x2F;&#x2F;å¾ªç¯è¿”å›å€¼\nval s1: Unit &#x3D; for (i &lt;- 1 to 10) &#123;\n\t&quot;ç»“æœ&quot;\n&#125;\nprintln(s&quot;s1 &#x3D; $s1&quot;) &#x2F;&#x2F;s1 &#x3D; ()\n\nval s2 &#x3D; for (i &lt;- 1 to 10) yield &#123;\n\t&quot;ç»“æœ&quot;\n&#125;\nprintln(s&quot;s2 &#x3D; $s2&quot;) &#x2F;&#x2F; s2 &#x3D; Vector(ç»“æœ, ç»“æœ, ç»“æœ, ç»“æœ, ç»“æœ, ç»“æœ, ç»“æœ, ç»“æœ, ç»“æœ, ç»“æœ)\n\n&#x2F;&#x2F; å°†iéƒ½ä¹˜ä»¥2 ï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ªæ•°ç»„\nval s3 &#x3D; for (i &lt;- 1 to 10) yield &#123;\n  i * 2\n&#125;\nprintln(s3) &#x2F;&#x2F;Vector(2, 4, 6, 8, 10, 12, 14, 16, 18, 20)\n\nwhileå’Œdoâ€¦whileå’ŒJavaä¸­å®Œå…¨ä¸€æ ·ï¼Œdo whileå³ä¾¿æ¡ä»¶è¡¨è¾¾å¼ä¸æˆç«‹ä¹Ÿä¼šå…ˆæ‰§è¡Œä¸€æ¬¡ã€‚\nå¾ªç¯ä¸­æ–­Javaä¸­å…³äºå¾ªç¯ä¸­æ–­æœ‰ä¸¤ä¸ªå…³é”®å­—breakå’Œcontinueï¼Œscalaä¸­æ²¡æœ‰è¿™ä¸¤ä¸ªå…³é”®å­—ï¼Œè¦ä½¿ç”¨breakableæ¥å®ç°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨try catchæ¥å®ç°ã€‚\n&#x2F;&#x2F; å¾ªç¯ä¸­æ–­\n&#x2F;&#x2F; try catch\ntry &#123;\n  for (i &lt;- 0 to 10) &#123;\n    if (i &#x3D;&#x3D; 1) &#123;\n      throw new RuntimeException\n    &#125;\n  &#125;\n&#125; catch &#123;\n  case e: Exception &#x3D;&gt; &#x2F;&#x2F; ä»€ä¹ˆä¹Ÿä¸åšï¼Œé€€å‡ºå¾ªç¯\n&#125;\n&#x2F;&#x2F; try catch è™½ç„¶å¯æ—¶é—´ï¼Œä½†æ˜¯æœ‰ç‚¹éº»çƒ¦ï¼Œ å¯ä»¥ç”¨breaksä¸‹çš„breakæ–¹æ³•\nBreaks.breakable(for (i &lt;- 0 to 10) &#123;\n  if (i &#x3D;&#x3D; 1) &#123;\n    Breaks.break();\n  &#125;\n&#125;)\n\næˆ‘åªæƒ³è¯´ä¸å¦‚javaçš„breakæ–¹ä¾¿ã€‚æˆ‘è§‰å¾—å°±æ˜¯ä¸ºäº†ä½“ç°é¢å‘å¯¹è±¡çš„æ€æƒ³ã€‚ä½†æ˜¯ç¡®å®è¦éº»çƒ¦äº†ç‚¹ã€‚\nå‡½æ•°å¼ç¼–ç¨‹å‡½æ•°åŸºæœ¬è¯­æ³•def å‡½æ•°å (å‚æ•°å˜é‡: å‚æ•°å˜é‡ç±»å‹) : è¿”å›ç±»å‹ &#123;\n  &#x2F;&#x2F;å‡½æ•°ä½“\n&#125;\n\nå‡½æ•°å®šä¹‰scalaä¸­çš„å‡½æ•°ç±»ä¼¼javaæ”¯æŒ0ä¸ªæˆ–è€…å¤šä¸ªå‚æ•°ï¼Œä¸åŒäºjavaçš„æ˜¯scalaä¸­çš„å‡½æ•°è¿˜æ”¯æŒå¤šä¸ªè¿”å›å€¼\nå•è¿”å›å€¼&#x2F;&#x2F; å‡½æ•°ï¼Œæ±‚ä¸¤ä¸ªæ•´æ•°çš„å’Œ\ndef sum (x: Int, y: Int) : Int &#x3D; &#123;\n\tx + y &#x2F;&#x2F; å¯ä»¥çœç•¥return è¿™æ˜¯scalaä¸­å‡½æ•°çš„ç‰¹ç‚¹\n&#125;\n\n\n\nå¤šä¸ªè¿”å›å€¼æ¯”å¦‚ç»™å®šä¸¤ä¸ªæ•°è¿”å›ä¸¤ä¸ªæ•°çš„å’Œä»¥åŠå·®å€¼\n&#x2F;&#x2F; å¤šè¿”å›å€¼\ndef sumAndDes(x: Int, y: Int): (Int, Int) &#x3D; &#123;&#x2F;&#x2F; å¤šä¸ªè¿”å›å€¼ç”¨æ‹¬å·åŒ…è£¹èµ·æ¥\n\treturn (x + y, x - y) &#x2F;&#x2F; returnå¯ä»¥çœç•¥\n&#125;\n\n\n\nå¯å˜å‚æ•°\nå¯å˜å‚æ•°å¯ä»¥é€šè¿‡ åœ¨ç±»å‹åä½¿ç”¨*æ¥å®šä¹‰\n&#x2F;&#x2F; å¯å˜å‚æ•°\ndef printlnValues(values: String*)  &#x3D; &#123;\n&#125;\n\nå‚æ•°é»˜è®¤å€¼&#x2F;&#x2F;å‚æ•°é»˜è®¤å€¼\ndef defaultParmasFunc(x: Int &#x3D; 10) &#x3D; &#123;&#125;\n\nå¸¦åå‚æ•°&#x2F;&#x2F; å¸¦åå‚æ•°\ndef namedParamFunc(name: String, age: Int): Unit &#x3D; &#123;\n\t&#x2F;&#x2F; å‡½æ•°ä½“\n&#125;\nnamedParamFunc(name &#x3D; &quot;å¼ ä¸‰&quot;, age &#x3D; 10) &#x2F;&#x2F; è°ƒç”¨çš„æ—¶å€™å¯ä»¥æŒ‡å®šåç§°\n\nå‡½æ•°è‡³ç®€åŸåˆ™\nreturnå¯ä»¥çœç•¥ï¼Œscalaä½¿ç”¨å‡½æ•°ä½“æœ€åä¸€ä¸ªä»£ç ä½œä¸ºè¿”å›å€¼\nå¦‚æœå‡½æ•°ä½“åªæœ‰ä¸€ä¸ªè¡Œä»£ç ï¼Œå¤§æ‹¬å·å¯ä»¥çœç•¥\nè¿”å›å€¼ç±»å‹å¦‚æœèƒ½å¤Ÿæ¨æ–­å‡ºæ¥ï¼Œé‚£ä¹ˆå¯ä»¥çœç•¥\nå¦‚æœæœ‰returnï¼Œåˆ™ä¸èƒ½çœç•¥è¿”å›å€¼ç±»å‹ï¼Œå¿…é¡»æŒ‡å®š\nå¦‚æœå‡½æ•°æ˜ç¡®å£°æ˜Unitï¼Œé‚£ä¹ˆå³ä¾¿å‡½æ•°ä½“ä¸­ä½¿ç”¨returnä¹Ÿä¸ä¼šèµ·ä½œç”¨\nscalaå¦‚æœæ— è¿”å›å€¼ç±»å‹ï¼Œå¯ä»¥çœç•¥ç­‰å·\nå¦‚æœå‡½æ•°æ— å‚ï¼Œä½†æ˜¯å£°æ˜äº†å‚æ•°åˆ—è¡¨ï¼Œé‚£ä¹ˆè°ƒç”¨æ—¶å°æ‹¬å·å¯ä»¥çœç•¥\nå¦‚æœå‡½æ•°æ²¡æœ‰å‚æ•°åˆ—è¡¨ï¼Œé‚£ä¹ˆå°æ‹¬å·å¯ä»¥çœç•¥ï¼Œè°ƒç”¨æ—¶å°æ‹¬å·å¿…é¡»çœç•¥\nå¦‚æœä¸å…³å¿ƒåç§°åªå…³å¿ƒå¤„ç†é€»è¾‘ï¼Œé‚£ä¹ˆdefå…³é”®å­—å¯ä»¥çœç•¥ï¼Œè¿™å°±æ˜¯åŒ¿åå‡½æ•°\n\nä»£ç ç¤ºä¾‹ï¼š\n&#x2F;&#x2F; å‡½æ•°è‡³ç®€åŸåˆ™\n&#x2F;&#x2F;    * returnå¯ä»¥çœç•¥ï¼Œscalaä½¿ç”¨å‡½æ•°ä½“æœ€åä¸€ä¸ªä»£ç ä½œä¸ºè¿”å›å€¼\ndef func1(x: Int): Int &#x3D; &#123;\n  x + 1\n&#125;\n\n&#x2F;&#x2F;    * å¦‚æœå‡½æ•°ä½“åªæœ‰ä¸€ä¸ªè¡Œä»£ç ï¼Œå¤§æ‹¬å·å¯ä»¥çœç•¥\ndef func2(x: Int): Int &#x3D; x + 1\n\n&#x2F;&#x2F;    * è¿”å›å€¼ç±»å‹å¦‚æœèƒ½å¤Ÿæ¨æ–­å‡ºæ¥ï¼Œé‚£ä¹ˆå¯ä»¥çœç•¥\ndef func3(x: Int) &#x3D; x + 1\n\n&#x2F;&#x2F;    * å¦‚æœæœ‰returnï¼Œåˆ™ä¸èƒ½çœç•¥è¿”å›å€¼ç±»å‹ï¼Œå¿…é¡»æŒ‡å®š, æ¯”å¦‚ä¸‹é¢æ–¹æ³•çš„: Intä¸èƒ½çœç•¥\ndef func4(x: Int): Int &#x3D; return x + 1\n\n&#x2F;&#x2F;    * å¦‚æœå‡½æ•°æ˜ç¡®å£°æ˜Unitï¼Œé‚£ä¹ˆå³ä¾¿å‡½æ•°ä½“ä¸­ä½¿ç”¨returnä¹Ÿä¸ä¼šèµ·ä½œç”¨,\ndef fun5(x: Int): Unit &#x3D; return x + 1\n\nprintln(fun5(1)) &#x2F;&#x2F; ç»“æœä¸æ˜¯2ï¼Œè€Œæ˜¯(),ä¹Ÿå°±æ˜¯Unit\n\n&#x2F;&#x2F;    * scalaå¦‚æœæ— è¿”å›å€¼ç±»å‹ï¼Œå¯ä»¥çœç•¥ç­‰å·\ndef func6(x: Int) &#123;&#125;\n\n&#x2F;&#x2F;    * å¦‚æœå‡½æ•°æ— å‚ï¼Œä½†æ˜¯å£°æ˜äº†å‚æ•°åˆ—è¡¨ï¼Œé‚£ä¹ˆè°ƒç”¨æ—¶å°æ‹¬å·å¯ä»¥çœç•¥\ndef func7() &#x3D; &#123;&#125;\n\nfunc7 &#x2F;&#x2F; ç­‰ä»·äºfunc7()\n\n&#x2F;&#x2F;    * å¦‚æœå‡½æ•°æ²¡æœ‰å‚æ•°åˆ—è¡¨ï¼Œé‚£ä¹ˆå°æ‹¬å·å¯ä»¥çœç•¥ï¼Œè°ƒç”¨æ—¶å°æ‹¬å·å¿…é¡»çœç•¥\ndef fun8 &#x3D; &#123;&#125;\n\nfun8 &#x2F;&#x2F; ä¸èƒ½ä½¿ç”¨fun8()\n\n&#x2F;&#x2F;    å¦‚æœä¸å…³å¿ƒåç§°åªå…³å¿ƒå¤„ç†é€»è¾‘ï¼Œé‚£ä¹ˆdefå…³é”®å­—å¯ä»¥çœç•¥ï¼Œè¿™å°±æ˜¯åŒ¿åå‡½æ•°\nval func9 &#x3D; (name: String) &#x3D;&gt; &#123;\n  &#x2F;&#x2F; å‡½æ•°ä½“\n  println(name)\n&#125;\n&#x2F;&#x2F;      å¦‚ä½•è°ƒç”¨å‘¢,scalaä¸­ä»€ä¹ˆéƒ½æœ‰è¿”å›å€¼\n&#x2F;&#x2F;      ä¸Šé¢çš„ä¾‹å­å¯ä»¥ä¿®æ”¹ä¸º\nfunc9(&quot;åå­—&quot;)\n\n\n\nå‡½æ•°çš„å€¼ä¼ é€’&#x2F;&#x2F; ----å‡½æ•°çš„å€¼ä¼ é€’------\n&#x2F;&#x2F; å…ˆå®šä¹‰ä¸€ä¸ªå‡½æ•°\ndef func10(i: Int): Int &#x3D; &#123;\n  println(&quot;å‡½æ•°func10è¢«è°ƒç”¨&quot;)\n  i + 1\n&#125;\n&#x2F;&#x2F; å‡½æ•°ä½œä¸ºå€¼è¿›è¡Œä¼ é€’, å‡½æ•°åååŠ ä¸Šç©ºæ ¼å†åŠ ä¸Š_ä»£è¡¨è¿™æ˜¯ä¸€ä¸ªå‡½æ•°æ•´ä½“\nval f1 &#x3D; func10 _ &#x2F;&#x2F; ä¹Ÿå¯ä»¥å†™æˆval f1 : Int &#x3D;&gt; Int &#x3D; func10ï¼Œ ä¹Ÿå¯ä»¥å†™æˆ\nprintln(f1)\nprintln(f1(10))\n\nå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’&#x2F;&#x2F; å‡½æ•°å¯ä»¥ä½œä¸ºå‡½æ•°å‚æ•°ä¼ é€’\n    &#x2F;&#x2F; å®šä¹‰ä¸€ä¸ªäºŒå…ƒè®¡ç®—,ä¸‹é¢çš„dualEvalæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå‚æ•°æ˜¯opä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ­¤å‡½æ•°çš„å‚æ•°åˆ—è¡¨æ˜¯Intç±»å‹çš„aå’Œb\ndef dualEval(op: (Int, Int) &#x3D;&gt; Int, a: Int, b: Int): Int &#x3D; &#123;\n  op(a, b)\n&#125;\n\ndef op(a: Int, b: Int): Int &#x3D; &#123;\n  a + b\n&#125;\n\nprintln(op(1, 2)) &#x2F;&#x2F; 3\n\nå‡½æ•°å¯ä»¥ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼&#x2F;&#x2F; å‡½æ•°å¯ä»¥ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼\ndef returnFunc(): String &#x3D;&gt; String &#x3D; &#123;\n  def subFunc1(s: String) &#x3D; &#123;\n    println(s)\n    &quot;æ™•&quot;\n  &#125;\n\n  subFunc1\n&#125;\n\nval stringToString: String &#x3D;&gt; String &#x3D; returnFunc()\nval str &#x3D; stringToString(&quot;å‚æ•°&quot;)\nprintln(str)\n\nç»ƒä¹ val arr: Array[Int] &#x3D; Array(1, 2, 3)\n\n&#x2F;&#x2F; å¯¹æ•°ç»„è¿›è¡Œå¤„ç†ï¼Œå°†æ“ä½œæŠ½è±¡å‡ºæ¥ï¼Œå¤„ç†å®Œæ¯•çš„ç»“æœè¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„\ndef arrayOperation(array: Array[Int], op: Int &#x3D;&gt; Int): Array[Int] &#x3D; &#123;\n  for (a &lt;- array) yield op(a)\n&#125;\n\n&#x2F;&#x2F; å®šä¹‰ä¸€ä¸ª+1æ“ä½œ\ndef addOne(i: Int): Int &#x3D; i + 1\n\n&#x2F;&#x2F; æˆ‘ä»¬å…ˆå¯¹æ•°ç»„arrè¿›è¡ŒåŠ ä¸€ï¼Œè¿”å›æ–°çš„æ•°ç»„\nval newArr &#x3D; arrayOperation(arr, addOne)\n\nprintln(newArr.mkString(&quot;,&quot;)) &#x2F;&#x2F; 2,3,4\n\nå‡½æ•°æŸ¯é‡ŒåŒ–&amp;é—­åŒ…é—­åŒ…ï¼šå¦‚æœä¸€ä¸ªå‡½æ•°ï¼Œè®¿é—®åˆ°äº†ä»–çš„å¤–éƒ¨ï¼ˆå±€éƒ¨ï¼‰å˜é‡çš„å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å’Œä»–æ‰€åœ¨çš„ç¯å¢ƒï¼Œå°±ç§°ä¸ºé—­åŒ…\nå‡½æ•°æŸ¯é‡ŒåŒ–ï¼šæŠŠä¸€ä¸ªå‚æ•°åˆ—è¡¨çš„å¤šä¸ªå‚æ•°ï¼Œç¼–ç¨‹å¤šä¸ªå‚æ•°åˆ—è¡¨ã€‚\n &#x2F;&#x2F; é—­åŒ…\ndef add(i: Int): Int &#x3D;&gt; Int &#x3D; &#123;\n  def add2(j: Int): Int &#x3D; &#123;\n    i + j\n  &#125;\n\n  add2\n&#125;\n\nval f1 &#x3D; add(1) &#x2F;&#x2F;f1æ˜¯ä¸€ä¸ªå‡½æ•°\nprintln(f1(2)) &#x2F;&#x2F; 3\n\n&#x2F;&#x2F; å‡½æ•°æŸ¯é‡ŒåŒ–ï¼Œæ¯”å¦‚ä¸Šé¢çš„é—­åŒ…å°±å¯ä»¥å†™æˆå¦‚ä¸‹æ¨¡å¼ï¼Œå¹¶ä¸”æ¨èä½¿ç”¨å‡½æ•°çš„åº“é‡ŒåŒ–\ndef addCurrying(a: Int)(b: Int): Int &#x3D; &#123;\n  a + b\n&#125;\nprintln(addCurrying(1)(2))\n\n\n\né€’å½’è‡ªå·±è°ƒç”¨è‡ªå·±å°±æ˜¯é€’å½’ã€‚\nç¤ºä¾‹ï¼šnçš„é˜¶ä¹˜ï¼Œæ¯”å¦‚5ï¼&#x3D; 1x2x3x4x5;\npackage io.github.itlab1024.scala.chapter05\n\n&#x2F;**\n * é€’å½’\n *&#x2F;\nobject Test04_Recursion &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    println(fact(5))\n  &#125;\n\n  def fact(n: Int): Int &#x3D; &#123;\n    if (n &#x3D;&#x3D; 0) return 1\n    fact(n - 1) * n\n  &#125;\n\n&#125;\n\n&#x2F;&#x2F; é€’å½’æœ‰ä»€ä¹ˆé—®é¢˜å‘¢?ä¼šå‡ºç°æ ˆå¸§è¿‡å¤šï¼Œå‡ºç°Stack Overflowé”™è¯¯ï¼Œåœ¨scalaä¸­å¦‚ä½•è§£å†³å‘¢ï¼Ÿ\ndef fact2(n: Int) : Int &#x3D; &#123;\n  @tailrec\n  def work(n: Int, result: Int) : Int &#x3D; &#123;\n    if (n &#x3D;&#x3D; 0) return result\n    work(n-1, result * n)\n  &#125;\n  work(n , 1)\n&#125;\nprintln(fact2(5)) &#x2F;&#x2F; ç»“æœä¹Ÿæ˜¯120ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼å°±ä¸ä¼šå¢å¤šæ ˆå¸§æ•°é‡\n\n\n\næ§åˆ¶æŠ½è±¡package io.github.itlab1024.scala.chapter05\n\n&#x2F;**\n * æ§åˆ¶æŠ½è±¡\n *&#x2F;\nobject Test05_ControlAbstraction &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    &#x2F;&#x2F; é€šå¸¸å‡½æ•°è°ƒç”¨æˆ‘ä»¬éƒ½æ˜¯ä¼ é€’å€¼\n    &#x2F;&#x2F; ä¼ å€¼å‚æ•°\n    def f1(): Int &#x3D; &#123;\n      println(&quot;f1è°ƒç”¨&quot;)\n      1\n    &#125;\n\n    def f2(i: Int): Int &#x3D; &#123;\n      i\n    &#125;\n\n    println(f2(f1()))\n\n    println(&quot;------&quot;)\n\n    &#x2F;&#x2F; ä¸åŒäºä¸Šé¢çš„ä¼ å€¼å‚æ•°ï¼Œæ¥ä¸‹æ¥çœ‹ä¸‹ä»€ä¹ˆæ˜¯ä¼ åå‚æ•°\n    &#x2F;&#x2F; è¯·æ³¨æ„å‚æ•°çš„ç±»å‹ &#x3D;&gt; Int\n    def f3(i: &#x3D;&gt; Int): Unit &#x3D; &#123;\n      println(i)\n      println(i)\n    &#125;\n    f3(f1()) &#x2F;&#x2F;è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯f1è°ƒç”¨äº†å‡ æ¬¡å‘¢ï¼Ÿä¸¤æ¬¡ï¼Œå¥‡æ€ªä¸ï¼Œæ˜¯å› ä¸ºä¸Šé¢f3å¯¹äºiæ‰“å°äº†2æ¬¡ï¼Œæ‰€æœ‰f1å°±è¢«è°ƒç”¨äº†ä¸¤æ¬¡\n    &#x2F;&#x2F; è¿è¡Œç»“æœæ˜¯ï¼š\n    &#x2F;*\n    ------\n    f1è°ƒç”¨\n    1\n    f1è°ƒç”¨\n    1\n    *&#x2F;\n\n  &#125;\n&#125;\n\næ‡’åŠ è½½å½“å‡½æ•°è¿”å›å€¼è¢«å£°æ˜ä¸ºlazyçš„æ—¶å€™ï¼Œå‡½æ•°çš„æ‰§è¡Œå°†è¢«æ¨è¿Ÿï¼ŒçŸ¥é“æˆ‘ä»¬é¦–æ¬¡å¯¹å…¶å–å€¼ï¼Œè¯¥å‡½æ•°æ‰ä¼šè¿è¡Œï¼Œè¿™ç§å‡½æ•°è¢«ç§°ä¸ºæƒ°æ€§å‡½æ•°\nç±»ä¼¼äºJava JPAä¸­çš„lazyçš„æ¦‚å¿µã€‚\npackage io.github.itlab1024.scala.chapter05\n\nobject Test06_LazyFunc &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    lazy val i &#x3D; addOne(1)\n    println(i) &#x2F;&#x2F; å¦‚æœæ³¨é‡Šæ‰æ”¹è¡Œï¼Œä¹Ÿå°±æ˜¯iä¸è¢«ä½¿ç”¨ï¼Œåˆ™addOneæ–¹æ³•ä¸ä¼šè¢«æ‰§è¡Œ\n  &#125;\n\n  def addOne(i: Int): Int &#x3D; &#123;\n    println(&quot;addOneæ–¹æ³•è¢«è°ƒç”¨&quot;)\n    i + 1\n  &#125;\n&#125;\n\n\né¢å‘å¯¹è±¡ç¼–ç¨‹Scalaä¸­çš„é¢å‘å¯¹è±¡åŸºæœ¬å’ŒJavaç›¸åŒï¼Œæˆ‘æ˜¯ä¸ªjavaerï¼Œä¸€æ ·çš„åœ°æ–¹æˆ‘å°±ä¸å†™äº†ã€‚ä¸»è¦è®°å½•ä¸‹ä¸åŒçš„åœ°æ–¹ã€‚\nåŒ…scalaæœ‰ä¸¤ç§åŒ…çš„ç®¡ç†æ–¹å¼ï¼Œä¸€ç§å’Œjavaä¸€æ ·ï¼Œä¸€ä¸ªæºæ–‡ä»¶åœ¨ä¸€ä¸ªåŒ…ä¸‹ï¼ˆåŒ…åå’Œæ–‡ä»¶æ‰€åœ¨è·¯å¾„ä¸è¦æ±‚ä¸€è‡´ï¼‰ï¼Œå¦å¤–ä¸€ç§æ˜¯scalaä¸­æ”¯æŒåŒ…åçš„åµŒå¥—\nè¯¥ç§æ–¹å¼çš„ç‰¹ç‚¹æ˜¯ï¼š\nä¸€ä¸ªæºæ–‡ä»¶å¯ä»¥æœ‰å¤šä¸ªåŒ…\nå­åŒ…ä¸­çš„ç±»å¯ä»¥ç›´æ¥è®¿é—®çˆ¶åŒ…æ±‡æ€»çš„å†…å®¹ï¼Œæ— éœ€å¯¼åŒ…\n&#x2F;&#x2F; åµŒå¥—é£æ ¼çš„package\npackage p1 &#123;\n  &#x2F;&#x2F; å®šä¹‰ä¸€ä¸ªå•ä¾‹å¯¹è±¡\n  object o1 &#123;\n    val N1: String &#x3D; &quot;N1&quot;\n  &#125;\n  package p2 &#123;\n    object o2 &#123;\n      def main(args: Array[String]): Unit &#x3D; &#123;\n        o1.N1 &#x2F;&#x2F; ç›´æ¥è°ƒç”¨å¤–å±‚åŒ…\n      &#125;\n    &#125;\n  &#125;\n&#125;\n\nåŒ…å¯¹è±¡åœ¨scalaä¸­å¯ä»¥ä¸ºæ¯ä¸ªåŒ…å®šä¹‰ä¸€ä¸ªåŒåçš„åŒ…å¯¹è±¡ï¼Œå®šä¹‰åœ¨åŒ…å¯¹è±¡çš„æˆå‘˜ï¼Œåšä¸ºå…¶å¯¹åº”åŒ…ä¸‹çš„æ‰€æœ‰classå’Œobjcetçš„å…±äº«å˜é‡ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ã€‚\npackage io.github.itlab1024.scala\n\npackage object chapter06 &#123;\n  &#x2F;&#x2F; å®šä¹‰å…±äº«çš„å€¼\n  val sharedValue1 : Int &#x3D; 1\n  &#x2F;&#x2F; å®šä¹‰å…±äº«æ–¹æ³•\n  def pkgName() : String &#x3D; &#123;\n    &quot;io.github.itlab1024.scala.chapter06&quot;\n  &#125;\n&#125;\n\n&#x2F;&#x2F; è°ƒç”¨åŒ…å¯¹è±¡\npackage io.github.itlab1024.scala.chapter06\n\nobject Test02_PackageObject &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    &#x2F;&#x2F; è°ƒç”¨åŒ…å¯¹è±¡çš„æ–¹æ³•å’Œæˆå‘˜\n    println(sharedValue1)\n    println(pkgName())\n  &#125;\n&#125;\n\n\n\nåŒ…å¯¼å…¥è·Ÿjavaç›¸åŒï¼Œæœ‰ä»¥ä¸‹ä¸åŒä¹‹å¤„\n\nåµŒå¥—åŒ…å¯ä»¥ä¸é€šè¿‡çš„åŒ…ä¸‹importï¼Œè¿™æ˜¯å±€éƒ¨å¼•å…¥ï¼Œåªåœ¨å½“å‰åŒ…ä¸‹æœ‰æ•ˆã€‚\nå¯ä»¥å±è”½æŸä¸€ä¸ªç±»ï¼Œæ¯”å¦‚import java.util.&#123;HashSet =&gt; _,_&#125;\nå¯¼å…¥ç›¸åŒåŒ…çš„å¤šä¸ªç±»ï¼Œç”¨&#123;&#125;æ‹¬èµ·æ¥ï¼Œé€—å·åˆ†éš”\nã€‚ã€‚ã€‚ã€‚ã€‚ã€‚\n\npackage io.github.itlab1024.scala.chapter06\n\n&#x2F;**\n * åŒ…å¯¼å…¥\n *&#x2F;\n&#x2F;&#x2F; ç»™ç±»èµ·åˆ«å\nimport java.util.&#123;ArrayList &#x3D;&gt; MyArrays&#125;\n&#x2F;&#x2F; ä¸å¯¼å…¥HashMapï¼Œè¿™æœ‰å•¥ç”¨ï¼Ÿï¼Ÿ?\nimport java.util.&#123;HashMap &#x3D;&gt; _&#125;\n\nobject Test03_PackageImport &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    &#x2F;&#x2F; ä½¿ç”¨åˆ«å\n    val i: MyArrays[Int] &#x3D; new MyArrays[Int]()\n\n  &#125;\n&#125;\n\n&#x2F;&#x2F; åµŒå¥—åŒ…å¯¼å…¥\npackage A &#123;\n  package B &#123;\n\n  &#125;\n&#x2F;&#x2F; æœ‰äº›å°±ä¸å°è¯•äº†ï¼Œæ„Ÿè§‰ç”¨å¤„ä¸å¤§\n&#125;\n\nç±»å’Œå¯¹è±¡ç±»å’Œå¯¹è±¡çš„å®šä¹‰è·Ÿjavaä¸€æ ·ï¼Œç±»å¯ä»¥çœ‹æˆä¸€ä¸ªæ¨¡æ¿ï¼Œå¯¹è±¡å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªå…·ä½“çš„äº‹åŠ¡\næ³¨æ„ï¼šåœ¨scalaä¸­æ²¡æœ‰publicå…³é”®å­—ï¼ˆé»˜è®¤å°±æ˜¯publicçš„ï¼‰ï¼Œä¸€ä¸ª.scalaæ–‡ä»¶ä¸­å¯ä»¥å®šä¹‰å¤šä¸ªç±»ã€‚\nåŸºæœ¬è¯­æ³•ï¼š\n[ä¿®é¥°ç¬¦] class ç±»å &#123;\n\t&#x2F;&#x2F;ç±»çš„bodyä½“\n&#125;\n\nç¤ºä¾‹\npackage io.github.itlab1024.scala.chapter06\n\nimport scala.beans.BeanProperty\n\nobject Test04_Class &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    val it &#x3D; new IT\n    it.name &#x2F;&#x2F;å¯ä»¥è®¿é—®\n    &#x2F;&#x2F;    it.age &#x2F;&#x2F; å› ä¸ºæ˜¯privateï¼Œä¸èƒ½è®¿é—®\n    &#x2F;&#x2F; èµ‹å€¼\n    &#x2F;&#x2F;    it.name &#x3D; &quot;itlab1024&quot; &#x2F;&#x2F; valå¸¸é‡ä¸èƒ½å˜æ›´å€¼\n    it.weibo &#x3D; &quot;itlab&quot; &#x2F;&#x2F; å¯ä»¥\n    &#x2F;&#x2F; homeUrl æˆ‘ä»¬åŠ äº† @BeanPropertyæ³¨è§£ï¼Œå°±å¯ä»¥ä½¿ç”¨getå’Œsetæ–¹æ³•\n    it.setHomeUrl(&quot;&quot;)\n    it.getHomeUrl\n  &#125;\n&#125;\n\n&#x2F;&#x2F; å®šä¹‰ä¸€ä¸ªç±»\nclass IT &#123;\n  &#x2F;&#x2F; å®šä¹‰å±æ€§å’Œæ–¹æ³•\n  val name: String &#x3D; &quot;itlab&quot;\n  &#x2F;&#x2F; å¯ä»¥å®šä¹‰ä¸ºç§æœ‰çš„\n\n  private var age: Int &#x3D; 1\n  @BeanProperty &#x2F;&#x2F; @BeanProperty æä¾›getteræ–¹æ³•å’Œsetteræ–¹æ³•\n  var homeUrl &#x3D; &quot;itlab1024.github.io&quot;\n\n  var weibo: String &#x3D; _\n\n&#125;\n\nå°è£…å°è£…å°±æ˜¯æŠŠæŠ½è±¡å‡ºæ¥çš„æ•°æ®å’Œå¯¹æ•°æ®çš„æ“ä½œå°è£…åœ¨ä¸€èµ·ï¼Œæ•°æ®è¢«ä¿æŠ¤åœ¨å†…éƒ¨ï¼Œç¨‹åºçš„å…¶ä»–éƒ¨åˆ†åªæœ‰é€šè¿‡è¢«æˆæƒçš„æ“ä½œï¼ˆæˆå‘˜æ–¹æ³•ï¼‰ï¼Œæ‰èƒ½å¯¹æ•°æ®è¿›è¡Œæ“ä½œã€‚\nè®¿é—®æƒé™scalaä¸­æ²¡æœ‰publicå…³é”®å­—ï¼Œä½†æ˜¯æœ‰privateå’Œprotected\nprivate:åªæœ‰ç±»çš„å†…éƒ¨å’ŒåŠç”Ÿå¯¹è±¡å¯ä»¥è®¿é—®\nprotected:åŒç±»å­ç±»å¯ä»¥è®¿é—®ï¼ŒåŒä¸€ä¸ªåŒ…çš„ä¸åŒç±»ä¸èƒ½å¤Ÿè®¿é—®\nprivate [åŒ…å]ï¼šå¢åŠ åŒ…è®¿é—®æƒé™ï¼ŒåŒ…åä¸‹çš„å…¶ä»–ç±»å¯ä»¥è®¿é—®ã€‚\npackage io.github.itlab1024.scala.chapter06\n\n&#x2F;&#x2F; å®šä¹‰ä¸€ä¸ªçˆ¶ç±»\nclass Test04_ClassForAccess &#123;\n  private var idCard: String &#x3D; &quot;1333x&quot;\n  private var name: String &#x3D; &quot;itlab&quot;\n  var sex: String &#x3D; &quot;ç”·&quot;\n  private[chapter06] var age: Int &#x3D; 1\n\n  def printInfo(): Unit &#x3D; &#123;\n    println(s&quot;Persion: $idCard $name, $sex $age&quot;)\n  &#125;\n&#125;\n\npackage io.github.itlab1024.scala.chapter06\n\n&#x2F;&#x2F; å®šä¹‰ä¸€ä¸ªå­ç±»\nclass Test04_Access extends Test04_ClassForAccess &#123;\n  override def printInfo(): Unit &#x3D; &#123;\n    &#x2F;&#x2F;    println(idcard) &#x2F;&#x2F; æ— æ³•è®¿é—®ï¼Œidcardæ˜¯private åªèƒ½åœ¨æœ¬ç±»å’Œå…¶ä¼´ç”Ÿå¯¹è±¡ä¸­è®¿é—®\n    println(name) &#x2F;&#x2F;å¯ä»¥è®¿é—®ï¼Œprotectedï¼Œå¯ä»¥å†çˆ¶å­ç±»è®¿é—®\n    println(sex) &#x2F;&#x2F;å¯ä»¥è®¿é—®ï¼Œé»˜è®¤publicçš„\n\n    println(age) &#x2F;&#x2F; ageå¯ä»¥è®¿é—®ï¼Œå› ä¸ºä½¿ç”¨äº†private [chapter06]å£°æ˜äº†\n  &#125;\n&#125;\n\n\næ–¹æ³•æ–¹æ³•å’Œå‡½æ•°ä¸€æ ·ï¼Œåªä¸è¿‡æ–¹æ³•æ˜¯ç±»ä¸­å‡½æ•°çš„ä¸€ç§ç‰¹æ®Šå«æ³•\npackage io.github.itlab1024.scala.chapter06\n\nclass Test05_Method &#123;\n  &#x2F;&#x2F; å®šä¹‰ä¸€ä¸ªæ–¹æ³•\n  def method1(): Int &#x3D; &#123;\n    1\n  &#125;\n&#125;\n\nclass subClass extends Test05_Method &#123;\n  &#x2F;&#x2F; ä½¿ç”¨overrideå…³é”®å­—å®ç°å‡½æ•°çš„é‡å†™\n  override def method1(): Int &#x3D; super.method1()\n&#125;\n\nåˆ›å»ºå¯¹è±¡&#x2F;&#x2F; ä½¿ç”¨newå…³é”®å­—\nobject Test05_Method &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    val method &#x3D; new Test05_Method &#x2F;&#x2F; ä½¿ç”¨newåˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹å¯¹è±¡\n    method.method1() &#x2F;&#x2F; è°ƒç”¨æ–¹æ³•\n  &#125;\n&#125;\n\næ„é€ å™¨scalaä¸­ä¹Ÿæœ‰æ„é€ æ–¹æ³•ï¼Œå¯ä»¥å®šä¹‰å¤šä¸ªï¼Œä¸åŒçš„æ˜¯å®šä¹‰æœ‰ç‚¹åŒºåˆ«ã€‚\nscalaä¸­åˆ†ä¸ºä¸»æ„é€ å™¨ï¼ˆä»…æœ‰ä¸€ä¸ªï¼‰ï¼Œå’Œå‰¯æ„é€ å™¨ï¼ˆå¯ä»¥æœ‰å¤šä¸ªï¼‰ï¼Œç”¨thisä½œä¸ºæ–¹æ³•å\npackage io.github.itlab1024.scala.chapter06\n\n&#x2F;&#x2F; é»˜è®¤å°±æœ‰ä¸€ä¸ªä¸»æ„é€ å™¨ï¼Œä¸‹é¢çš„()å¯ä»¥çœç•¥ã€‚\nclass Test06_Constructor() &#123;\n  var name: String &#x3D; &quot;&quot;\n  var age: Int &#x3D; 10\n  println(&quot;ä¸»æ„é€ å™¨è¢«è°ƒç”¨&quot;)\n\n  &#x2F;&#x2F; å‰¯æ„é€ å™¨ï¼Œå¯ä»¥æœ‰å¤šä¸ª\n  def this(name: String) &#123;\n    this() &#x2F;&#x2F;ç›´æ¥è°ƒç”¨ä¸»æ„é€ å™¨\n    this.name &#x3D; name\n    println(&quot;å‰¯æ„é€ å™¨è¢«è°ƒç”¨&quot;)\n  &#125;\n&#125;\n\nobject Test06_Constructor &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    new Test06_Constructor()\n\n    println(&quot;--------&quot;)\n\n    new Test06_Constructor(&quot;1&quot;)\n\n    &#x2F;*\n    è¿è¡Œç»“æœï¼š\n\n    \n    ä¸»æ„é€ å™¨è¢«è°ƒç”¨\n    --------\n    ä¸»æ„é€ å™¨è¢«è°ƒç”¨\n    å‰¯æ„é€ å™¨è¢«è°ƒç”¨\n    * *&#x2F;\n  &#125;\n&#125;\n\nä¸»æ„é€ å™¨å‚æ•°ä¸Šé¢çš„ä¸»æ„é€ å™¨æ˜¯é»˜è®¤çš„ï¼Œæˆ‘ä»¬æ²¡æœ‰è¿›è¡Œä¿®æ”¹ï¼Œé»˜è®¤æ— å‚ï¼Œä¹Ÿå¯ä»¥å®šä¹‰å‚æ•°\n&#x2F;&#x2F; å‚æ•°å¯ä»¥ä½¿ç”¨valæˆ–è€…varï¼Œå¦‚æœä¸ä¿®é¥°åˆ™é€šè¿‡ å¯¹è±¡.å±æ€§å æ— æ³•è·å–åˆ°å€¼ï¼Œå¯ä»¥å¦‚ä¸‹é¢çš„ageé‚£æ ·æŒ‡å®šé»˜è®¤å€¼\nclass ConstructorParams(private var name: String, val age: Int &#x3D; 1) &#123;\n  &#x2F;&#x2F;    var name: String &#x3D; &quot;itlab&quot; &#x2F;&#x2F; æ— éœ€å†æ¬¡å®šä¹‰nameï¼Œå¦åˆ™æŠ¥é”™\n\n  &#x2F;&#x2F; å®šä¹‰æ–¹æ³•æ‰“å°name\n  def printName(): Unit &#x3D; &#123;\n    println(this.name)\n  &#125;\n&#125;\n\n&#x2F;&#x2F; mianæ–¹æ³•è°ƒç”¨\n&#x2F;&#x2F; ä¸»æ„é€ å™¨å‚æ•°\nval cp &#x3D; new ConstructorParams(&quot;itlab&quot;) &#x2F;&#x2F; ageæœ‰é»˜è®¤å€¼ï¼Œå¯ä»¥çœç•¥\ncp.age &#x2F;&#x2F; å¯ä»¥è®¿é—®\n&#x2F;&#x2F;    cp.name &#x2F;&#x2F; è®¿é—®ä¸åˆ°name\n&#x2F;&#x2F; è°ƒç”¨printnameæ–¹æ³•\ncp.printName() &#x2F;&#x2F; itlab\n\nç»§æ‰¿å’Œå¤šæ€scalaä¸­çš„ç»§æ‰¿é€šè¿‡extendså…³é”®å­—ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ç‰¹ç‚¹\n\nå­ç±»ç»§æ‰¿çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•\nå•ç»§æ‰¿\næ„é€ å™¨å…ˆæ‰§è¡Œçˆ¶ç±»å†æ‰§è¡Œå­ç±»\n\npackage io.github.itlab1024.scala.chapter06\n\nobject Test07_ClassExtends &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    val clazz &#x3D; new SubClass(&quot;itlab&quot;, 1, &quot;ç”·&quot;)\n    &#x2F;&#x2F;è¿è¡Œç»“æœ\n    &#x2F;*\n    ParentClass ä¸»æ„é€ å™¨æ‰§è¡Œ\n    SubClass ä¸»æ„é€ å™¨æ‰§è¡Œ\n    SubClass å‰¯æ„é€ å™¨è°ƒç”¨\n     *&#x2F;\n  &#125;\n&#125;\n\nclass ParentClass &#123;\n  var name: String &#x3D; &quot;ITLAB&quot;\n  var age &#x3D; 1\n  println(&quot;ParentClass ä¸»æ„é€ å™¨æ‰§è¡Œ&quot;)\n\n  def this(name: String, age: Int) &#123;\n    this()\n    println(&quot;ParentClass å‰¯æ„é€ å™¨è°ƒç”¨&quot;)\n    this.name &#x3D; name\n    this.age &#x3D; age\n  &#125;\n\n  def printName() &#x3D; &#123;\n    println(this.name)\n  &#125;\n&#125;\n\nclass SubClass extends ParentClass &#123;\n  println(&quot;SubClass ä¸»æ„é€ å™¨æ‰§è¡Œ&quot;)\n  var sex: String &#x3D; _\n\n  def this(name: String, age: Int, sex: String) &#123;\n    this()\n    println(&quot;SubClass å‰¯æ„é€ å™¨è°ƒç”¨&quot;)\n    this.name &#x3D; name\n    this.age &#x3D; age\n    this.sex &#x3D; sex\n  &#125;\n\n  &#x2F;&#x2F;é‡å†™printNameæ–¹æ³•\n  override def printName(): Unit &#x3D; &#123;\n    println(this.name + &quot; å­ç±»&quot;)\n  &#125;\n  \n  &#x2F;&#x2F; å¤šæ€ï¼Œç®€å•ä»‹ç»ä¸‹ï¼Œæ²¡ä»€ä¹ˆç‰¹åˆ«çš„ è·Ÿjavaä¸€æ ·\n  def f1() &#123;&#125;\n  def f1(i: Int)&#123;&#125;\n&#125;\n\næŠ½è±¡scalaä¸­ä½¿ç”¨abstractå®šä¹‰æŠ½è±¡ç±»ï¼Œç»§æ‰¿å’Œé‡å†™éœ€è¦æ³¨æ„çš„ç‚¹\n\nå¦‚æœçˆ¶ç±»ä¸ºæŠ½è±¡ç±»ï¼Œé‚£ä¹ˆå­ç±»éœ€è¦å°†æŠ½è±¡çš„å±æ€§å’Œæ–¹æ³•å®ç°ï¼Œå¦åˆ™å­ç±»ä¹Ÿéœ€è¦å£°æ˜ä¸ºæŠ½è±¡ç±»\né‡å†™éæŠ½è±¡æ–¹æ³•éœ€è¦ç”¨overrideä¿®é¥°ï¼Œé‡å†™æŠ½è±¡æ–¹æ³•å¯ä»¥çœç•¥overrideä¿®é¥°ã€‚\nå­ç±»è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ä½¿ç”¨superå…³é”®å­—\nå­ç±»å¯¹æŠ½è±¡å±æ€§è¿›è¡Œå®ç°ï¼Œçˆ¶ç±»æŠ½è±¡å±æ€§å¯ä»¥ç”¨varä¿®é¥°ï¼Œå­ç±»å¯¹éæŠ½è±¡å±æ€§é‡å†™ï¼Œçˆ¶ç±»éæŠ½è±¡å±æ€§åªæ”¯æŒvalç±»å‹\n\nç¤ºä¾‹\npackage io.github.itlab1024.scala.chapter06\n\nobject Test08_AbstractClass &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    val clazz &#x3D; new Class1\n    clazz.name\n  &#125;\n&#125;\n\n&#x2F;&#x2F; æŠ½è±¡ç±»\nabstract class Test08_AbstractClass &#123;\n  &#x2F;&#x2F; éæŠ½è±¡å±æ€§ï¼ŒæŠ½è±¡æ–¹æ³•ä¸­çš„å±æ€§ä¸ç”¨åˆå§‹åŒ–ï¼Œå…¶ä»–æƒ…å†µå¿…é¡»åˆå§‹åŒ–\n  var name: String &#x3D; &quot;itlab1024&quot;\n  &#x2F;&#x2F; æŠ½è±¡å±æ€§ï¼ˆåªå£°æ˜ï¼Œæ²¡æœ‰åˆå§‹åŒ–ï¼‰\n  val age: Int\n\n  &#x2F;&#x2F; éæŠ½è±¡æ–¹æ³•\n  def f1(): Unit &#x3D; &#123;&#125;\n\n  &#x2F;&#x2F; æŠ½è±¡æ–¹æ³•\n  def f2(): Unit\n&#125;\n\n&#x2F;**\n * æ™®é€šç±»ç»§æ‰¿æŠ½è±¡ç±»\n *&#x2F;\nclass Class1 extends Test08_AbstractClass &#123;\n  &#x2F;&#x2F; ageå±æ€§æ˜¯æŠ½è±¡å±æ€§ï¼Œæ‰€ä»¥æ™®é€šç±»ç»§æ‰¿çš„æ—¶å€™å¿…é¡»åˆå§‹åŒ–, overrideå¯ä»¥çœç•¥ï¼Œä½†æ˜¯æˆ‘ä¸ªäººå»ºè®®è¿˜æ˜¯åŠ ä¸Šï¼Œä»£ç æ¸…æ™°\n  override val age: Int &#x3D; 1\n\n  &#x2F;&#x2F; f2 æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œæ™®é€šç±»ç»§æ‰¿çš„æ—¶å€™å¿…é¡»å®ç°è¯¥æ–¹æ³•, overrideå¯ä»¥çœç•¥ï¼Œä½†æ˜¯æˆ‘ä¸ªäººå»ºè®®è¿˜æ˜¯åŠ ä¸Šï¼Œä»£ç æ¸…æ™°\n  override def f2(): Unit &#x3D; &#123;\n    super.f1() &#x2F;&#x2F;å¯ä»¥ä½¿ç”¨superè°ƒç”¨çˆ¶æŠ½è±¡ç±»çš„æ–¹æ³•\n    println(age)\n  &#125;\n\n  &#x2F;&#x2F; é‡å†™éæŠ½è±¡æ–¹æ³•, overrideä¸èƒ½çœç•¥\n  override def f1() &#123;\n  &#125;\n\n  &#x2F;&#x2F; é‡å†™éæŠ½è±¡å±æ€§, overrideä¸èƒ½çœç•¥, æ­¤å¤„è™½ç„¶ç¼–è¯‘æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯è¿è¡Œæ—¶ä¼šæç¤ºé”™è¯¯&quot;overriding variable name in class Test08_AbstractClass of type String;\n  &#x2F;&#x2F; variable name cannot override a mutable variable\n  &#x2F;&#x2F;  override var name: String &#x3D; &quot;&quot;&quot;\n  &#x2F;&#x2F; ä¹Ÿå°±æ˜¯è¯´å˜é‡ä¸éœ€è¦é‡å†™ï¼Œç›´æ¥ä½¿ç”¨name &#x3D; &quot;value&quot;å³å¯ã€‚å¯ä»¥å°†nameä¿®æ”¹ä¸ºvalä¸‹é¢çš„ä»£ç å°±ä¸ä¼šæœ‰æœ‰é—®é¢˜\n  override var name: String &#x3D; &quot;&quot;\n&#125;\n\nåŒ¿åå­ç±»package io.github.itlab1024.scala.chapter06\n\nabstract class Test09_AnonymousClass &#123;\n  var name: String\n  def f1()\n&#125;\nobject Test09_AnonymousClass &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    new Test09_AnonymousClass &#123;\n      override var name: String &#x3D; &quot;&quot;\n\n      override def f1(): Unit &#x3D; &#123;&#125;\n    &#125;\n  &#125;\n&#125;\n\nè·Ÿjavaä¸€æ ·ã€‚\nå•ä¾‹å¯¹è±¡ï¼ˆä¼´ç”Ÿå¯¹è±¡ï¼‰scalaä¸­æ²¡æœ‰staticï¼Œå› ä¸ºä»–è®¾è®¡ä¸ºå®Œå…¨é¢å‘å¯¹è±¡ï¼Œstaticå¹¶ä¸ç¬¦åˆé¢å‘å¯¹è±¡çš„æ€æƒ³ï¼Œä½†æ˜¯ä¸ºäº†å…¼å®¹javaçš„é™æ€æ¦‚å¿µï¼Œscalaå°±åˆ›é€ äº†ä¼´ç”Ÿå¯¹è±¡ï¼ˆä¹Ÿå«åšå•ä¾‹å¯¹è±¡ï¼‰.\nå•ä¾‹å¯¹è±¡ä½¿ç”¨objectæ¥å®šä¹‰\nç¤ºä¾‹ï¼š\npackage io.github.itlab1024.scala.chapter06\n\nimport io.github.itlab1024.scala.chapter06.Test09_Object.SCALA_NAME\n\n&#x2F;**\n * ä¼´ç”Ÿå¯¹è±¡ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªç±»çš„æ‰€æœ‰ç¤ºä¾‹å¯¹è±¡å¯èƒ½éƒ½æœ‰ä¸€ä¸ªå…±åŒå€¼ï¼Œåœ¨javaä¸­ï¼Œæˆ‘ä»¬åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ªstaticçš„å˜é‡ï¼Œç„¶åå¯¹è±¡ä¸­é€šè¿‡ç±»å‹.å±æ€§åè¿›è¡Œè®¿é—®\n * åœ¨scalaä¸­ä½¿ç”¨ä¼´ç”Ÿå¯¹è±¡æ¥è§£å†³ï¼Œæ¯”å¦‚ä¸‹é¢çš„Test09_Objectæœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯classä¿®é¥°ï¼Œä¸€ä¸ªæ˜¯objectä¿®é¥°ã€‚\n * objectæ˜¯ä¼´ç”Ÿå¯¹è±¡ï¼Œä¼´éšclassä¿®é¥°çš„ç±»è€Œç”Ÿï¼Œä¸¤è€…åå­—è¦ç›¸åŒ\n *&#x2F;\nobject Test09_Object &#123;\n  &#x2F;&#x2F; è¿™å°±ç±»ä¼¼äºjavaä¸­çš„ã€‚ public staitc final String SCALA_NAME &#x3D; &quot;scala&quot;\n  val SCALA_NAME: String &#x3D; &quot;scala&quot;\n&#125;\n\nclass Test09_Object &#123;\n  val name: String &#x3D; SCALA_NAME\n&#125;\n\né€šè¿‡ä¼´ç”Ÿå¯¹è±¡æˆ‘ä»¬èƒ½å¤Ÿå®ç°å•ä¾‹æ¨¡å¼\nç¤ºä¾‹\npackage io.github.itlab1024.scala.chapter06\n\nobject Test10_Singleton &#123;\n  private val test10_Singleton: Test10_Singleton &#x3D; new Test10_Singleton(&quot;itlab1024&quot;)\n\n  def getInstance(): Test10_Singleton &#x3D; &#123;\n    test10_Singleton\n  &#125;\n\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    println(Test10_Singleton.getInstance().eq(Test10_Singleton.getInstance())) &#x2F;&#x2F; true è¯´æ˜å®ä¾‹åªæœ‰ä¸€ä¸ª\n  &#125;\n&#125;\n\n&#x2F;&#x2F;ä¸»æ„é€ æ–¹æ³•ä½¿ç”¨privateä¿®é¥°ã€‚\nclass Test10_Singleton private(val name: String) &#123;\n\n&#125;\n\n\n\nç‰¹è´¨(Trait)scalaä¸­çš„ç‰¹è´¨å°±æ˜¯æ¥å£ï¼Œå’Œjavaä¸­çš„interfaceç±»ä¼¼\nscalaä¸­çš„ç‰¹è´¨å¯ä»¥åŒ…å«æŠ½è±¡å±æ€§å’Œæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥åŒ…å«å…·ä½“çš„å±æ€§å’Œæ–¹æ³•ï¼Œæ„Ÿè§‰è·Ÿjavaä¸­çš„abstractæ›´ç›¸ä¼¼ã€‚å­ç±»ä½¿ç”¨extendsæ¥å®ç°ç‰¹è´¨ï¼Œå¦‚æœæœ‰å¤šä¸ªç‰¹è´¨ï¼Œåˆ™withè¿æ¥ï¼Œå¦‚æœåˆç»§æ‰¿ç±»ï¼ŒåŒæ—¶åˆå®ç°ç‰¹è´¨çš„æ—¶å€™ï¼Œåº”è¯¥æŠŠç±»ç´§è·Ÿåœ¨extendsåã€‚\npackage io.github.itlab1024.scala.chapter06\n\nobject Test11_Trait &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    val s &#x3D; new S\n    s.f2()\n  &#125;\n&#125;\n\n&#x2F;&#x2F; å®šä¹‰ä¸€ä¸ªçˆ¶ç±»\nclass P &#123;\n  def f2(): Unit &#x3D; &#123;\n    println(&quot;pè°ƒç”¨&quot;)\n  &#125;\n&#125;\n\n&#x2F;&#x2F; å®šä¹‰ä¸¤ä¸ªtrait\ntrait t1 &#123;\n  var name: String\n\n  def f1(): Unit\n\n  val age: Int &#x3D; 10\n\n  def f2(): Unit &#x3D; &#123;\n    println(&quot;t1è°ƒç”¨&quot;)\n  &#125;\n&#125;\n\ntrait t2 &#123;\n  var  name: String\n\n  def f1(): Unit\n\n  val age: Int &#x3D; 10\n\n  def f2(): Unit &#x3D; &#123;\n    println(&quot;t2è°ƒç”¨&quot;)\n  &#125;\n&#125;\n\n&#x2F;&#x2F; å­ç±»,ç»§æ‰¿çˆ¶ç±»pï¼Œå®ç°ç‰¹è´¨1å’Œç‰¹è´¨2,è¯·æ³¨æ„ä¸‹é¢çš„é¡ºåº\nclass S extends P with t1 with t2 &#123;\n  override var name: String &#x3D; &quot;&quot;\n\n  override def f1(): Unit &#x3D; &#123;&#125;\n\n  override val age: Int &#x3D; 10\n\n  override def f2(): Unit &#x3D; super.f2() &#x2F;&#x2F; f2æ–¹æ³•åœ¨ä¸¤ä¸ªç‰¹è´¨é‡Œéƒ½æœ‰ï¼Œ super.f2()è°ƒç”¨çš„æ˜¯è°å‘¢ï¼Ÿæ˜¯ç‰¹è´¨t2\n&#125;\n\néœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœä¸€ä¸ªç±»ç»§æ‰¿äº†çˆ¶ç±»ï¼Œå¹¶ä¸”å®ç°äº†å¤šä¸ªç‰¹è´¨ï¼Œæ¯”å¦‚subClass extends ParentClass with trait1 with trait2 ,å¹¶ä¸”çˆ¶ç±»å’Œä¸¤ä¸ªç‰¹è´¨éƒ½å®šä¹‰äº†ç›¸åŒçš„æ–¹æ³•ï¼Œé‚£ä¹ˆå­ç±»çš„super.æ–¹æ³•()ã€‚è°ƒç”¨çš„æ˜¯traint2çš„æ–¹æ³•ï¼Œè¿™é‡Œå¯ä»¥ç†è§£ä¸ºæ–¹æ³•è¢«è¦†ç›–äº†ã€‚\nç‰¹è´¨å åŠ ã€ç‰¹è´¨é’»çŸ³é—®é¢˜ä»¥åæµ‹è¯•ã€‚\nç±»å‹æ£€æŸ¥å’Œè½¬æ¢javaä¸­ä½¿ç”¨instanceOf å…³é”®å­—ï¼Œscalaä¸­ä½¿ç”¨çš„æ˜¯å‡½æ•°isInstanceOf,è½¬æ¢åˆ™ä½¿ç”¨asInstanceOfã€‚\nç¤ºä¾‹\npackage io.github.itlab1024.scala.chapter06\n\nobject Test11_TypeCheckAndConversion &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    val ball &#x3D; new Ball\n    println(&quot;ballæ˜¯Ballç±»å‹å—?&quot; + ball.isInstanceOf[Ball]) &#x2F;&#x2F; true\n    println(&quot;ballæ˜¯BasketBallç±»å‹å—?&quot; + ball.isInstanceOf[BasketBall]) &#x2F;&#x2F; false\n    val ball2 &#x3D; new BasketBall\n\n    println(&quot;ball2æ˜¯Ballç±»å‹å—?&quot; + ball2.isInstanceOf[Ball]) &#x2F;&#x2F; true\n    println(&quot;ball2æ˜¯BasketBallç±»å‹å—?&quot; + ball2.isInstanceOf[BasketBall]) &#x2F;&#x2F; true\n\n    &#x2F;&#x2F; å¯ä»¥å°†çˆ¶ç±»å‹è£…ç½®è½¬åŒ–ä¸ºå­ç±»å‹\n    val ball3: BasketBall &#x3D; new BasketBall\n    println(&quot;ball3æ˜¯Ballç±»å‹å—?&quot; + ball3.isInstanceOf[Ball]) &#x2F;&#x2F; true\n    println(&quot;ball3æ˜¯BasketBallç±»å‹å—?&quot; + ball3.isInstanceOf[BasketBall]) &#x2F;&#x2F; true\n    &#x2F;&#x2F;    è½¬æ¢\n    val ball4: Ball &#x3D; ball3.asInstanceOf[Ball]\n\n  &#125;\n&#125;\n\nclass Ball &#123;\n\n&#125;\n\nclass BasketBall extends Ball &#123;\n\n&#125;\n\næšä¸¾ç±»å’Œåº”ç”¨ç±»\næšä¸¾ç±»éœ€è¦ç»§æ‰¿Enumeration\nåº”ç”¨ç±»éœ€è¦ç»§æ‰¿App\n\nç¤ºä¾‹\npackage io.github.itlab1024.scala.chapter06\n\nobject Test12_EnumAndAppClass &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    println(TimeUnit.YEAR) &#x2F;&#x2F;YEAR\n    println(TimeUnit.DAY) &#x2F;&#x2F; DAY\n    println(TimeUnit.HOUR) &#x2F;&#x2F; HOUR\n    println(TimeUnit.YEAR.id) &#x2F;&#x2F; 0\n    println(TimeUnit.DAY.id) &#x2F;&#x2F; 3\n    println(TimeUnit.HOUR.id) &#x2F;&#x2F; 4\n    println(TimeUnit.MONTH.id) &#x2F;&#x2F; 1\n\n    &#x2F;&#x2F; é€šè¿‡åå­—è·å–åˆ°æšä¸¾\n    val value &#x3D; TimeUnit.withName(&quot;MONTH&quot;)\n    println(value)\n  &#125;\n&#125;\n\nobject TimeUnit extends Enumeration &#123;\n  val YEAR: TimeUnit.Value &#x3D; Value(&quot;YEAR&quot;)\n  val MONTH: TimeUnit.Value &#x3D; Value\n  val DAY: TimeUnit.Value &#x3D; Value(3, &quot;DAY&quot;)\n  val HOUR: TimeUnit.Value &#x3D; Value\n  val MINUTE: TimeUnit.Value &#x3D; Value(&quot;MINUTE&quot;)\n  val SECOND: TimeUnit.Value &#x3D; Value\n&#125;\n\n&#x2F;&#x2F; åº”ç”¨ç±»\nobject MyApp extends App &#123;\n  println(&quot;ç»§æ‰¿APPå°±çœå»äº†mainçš„å®šä¹‰&quot;)\n&#125;\n\né›†åˆ\nscalaä¸­çš„é›†åˆæœ‰ä¸‰å¤§ç±»ï¼ŒSeqï¼ŒSetï¼ŒMapã€‚æ‰€æœ‰çš„é›†åˆéƒ½å®ç°Iterableç‰¹è´¨\n\nå¯¹äºå‡ ä¹æ‰€æœ‰çš„é›†åˆç±»ï¼Œscalaéƒ½æä¾›å¯å˜å’Œä¸å¯å˜ä¸¤ä¸ªç‰ˆæœ¬ï¼Œåˆ†åˆ«ä½äºscala.collection.mutableå’Œscala.collection.immutableä¸­\n\nscalaä¸å¯å˜é›†åˆï¼Œå°±æ˜¯æŒ‡è¯¥é›†åˆå¯¹è±¡ä¸å¯ä¿®æ”¹ï¼Œæ¯æ¬¡ä¿®æ”¹å°±ä¼šè¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè€Œä¸ä¼šå¯¹åŸå¯¹è±¡è¿›è¡Œæ›´æ”¹ã€‚\n\nå¯å˜é›†åˆï¼Œå°±æ˜¯è¿™ä¸ªé›†åˆå¯ä»¥ç›´æ¥å¯¹åŸé›†åˆè¿›è¡Œä¿®æ”¹ã€‚ä¸ä¼šè¿”å›æ–°çš„å¯¹è±¡\n\n\nå»ºè®®ï¼šåœ¨é›†åˆæ“ä½œçš„æ—¶å€™ï¼Œä¸å¯å˜ç”¨ç¬¦å·ï¼Œå¯å˜ç”¨æ–¹æ³•ã€‚\né›†åˆç»§æ‰¿å›¾\n\næ•°ç»„ä¸å¯å˜æ•°ç»„ç¤ºä¾‹\npackage io.github.itlab1024.scala.chapter07\n\nobject Test01_ImmutableArray &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    var arr: Array[Int] &#x3D; new Array[Int](10)\n    &#x2F;&#x2F; å¦ä¸€ç§åˆ›å»ºçš„æ–¹å¼,ä½¿ç”¨applyæ–¹æ³•\n    val array &#x3D; Array.apply(1, 2, 3) &#x2F;&#x2F; å¯çœç•¥applyæ–¹æ³•ï¼Œ Array(1, 2, 3)\n    println(array.length)\n    &#x2F;&#x2F; è®¿é—®æ•°ç»„ä¸­çš„å…ƒç´ \n    val i &#x3D; array(0)\n    println(&quot;ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯:&quot; + i) &#x2F;&#x2F; 1\n    &#x2F;&#x2F; ä¿®æ”¹,ä¸æ˜¯è¯´ä¸å¯å˜å—ï¼Œè¦æ³¨æ„çš„æ˜¯ä¸å¯å˜æ•°ç»„çš„ä¸å¯å˜æ˜¯è¯´å†…å­˜åœ°å€ä¸å˜ï¼Œå¤§å°ä¸å¯å˜ï¼Œç´¢å¼•ä¸Šçš„å…ƒç´ è¿˜æ˜¯å¯ä»¥å˜çš„\n    array(0) &#x3D; 4\n    println(array.mkString(&quot;,&quot;)) &#x2F;&#x2F; 4,2,3\n    println(&quot;------------&quot;)\n    &#x2F;&#x2F; å¾ªç¯æ•°ç»„\n    &#x2F;&#x2F; æ™®é€šfor loop\n    for(i &lt;- 0 until array.length) &#123;\n      println(i)\n    &#125;\n    println(&quot;------------&quot;)\n    &#x2F;&#x2F; ä¸Šé¢ä»£ç æç¤ºæˆ‘ä»¬å¯ä»¥ä½¿ç”¨array.indices\n    for (i &lt;- array.indices) &#123;\n      println(i)\n    &#125;\n    println(&quot;------------&quot;)\n    &#x2F;&#x2F; æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•\n    for (i &lt;- array) &#123;\n      println(i)\n    &#125;\n    println(&quot;------------&quot;)\n    &#x2F;&#x2F; ä¹Ÿå¯ä»¥ä½¿ç”¨foreachæ–¹æ³•ï¼Œå‡½æ•°å¼ç¼–ç¨‹\n    array.foreach(println)\n\n    println(&quot;------------&quot;)\n    &#x2F;&#x2F; è¿­ä»£å™¨\n    val iterator &#x3D; array.iterator\n    while (iterator.hasNext) &#123;\n      println(iterator.next())\n    &#125;\n    println(&quot;------------&quot;)\n\n    &#x2F;&#x2F; æ·»åŠ å…ƒç´ (è¿½åŠ åˆ°æœ€åï¼Œä½¿ç”¨:+()æ–¹æ³•)\n    val newArray &#x3D; array.:+(0) &#x2F;&#x2F; è¿”å›æ–°çš„æ•°ç»„\n    newArray.foreach(println)\n    println(&quot;------------&quot;)\n\n    &#x2F;&#x2F; å‘æœ€å‰é¢æ·»åŠ å…ƒç´ (ä½¿ç”¨+:()æ–¹æ³•)\n    val newArray2 &#x3D; newArray.+:(-1)\n    newArray2.foreach(println)\n\n    &#x2F;&#x2F; ç®€åŒ–ä½¿ç”¨+:å’Œ:+\n    val ints &#x3D; newArray2 :+ 1\n    val ints2 &#x3D; 29 +: newArray2\n    \n    \n\n  &#125;\n&#125;\n\nå¯å˜æ•°ç»„å¯å˜æ•°ç»„ArrayBuffer\npackage io.github.itlab1024.scala.chapter07\n\nimport scala.collection.mutable.ArrayBuffer\n\n&#x2F;**\n * å¯å˜æ•°ç»„ArrayBuffer\n *&#x2F;\nobject Test02_ArrayBuffer &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    &#x2F;&#x2F; åˆ›å»ºå¯å˜æ•°ç»„\n    val _ &#x3D; new ArrayBuffer[Int]()\n    &#x2F;&#x2F; ç¬¬äºŒç§æ–¹æ³•ä½¿ç”¨ä¼´ç”Ÿå¯¹è±¡\n    val array &#x3D; ArrayBuffer(1, 2, 3)\n    println(array) &#x2F;&#x2F; ArrayBuffer(1, 2, 3)\n    println(&quot;---------&quot;)\n\n    &#x2F;&#x2F; è®¿é—®æ•°ç»„çš„å…ƒç´ \n    val i &#x3D; array(0)\n    println(i)\n    println(&quot;---------&quot;)\n\n    &#x2F;&#x2F; ä¿®æ”¹\n    array(0) &#x3D; -1\n    println(array)\n    println(&quot;---------&quot;)\n\n    &#x2F;&#x2F; æ·»åŠ å…ƒç´  å¯ä»¥ä½¿ç”¨:+å’Œ+:çš„æ–¹å¼ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯éœ€è¦å®šä¹‰æ–°çš„æ•°ç»„æ¥æ¥æ”¶ã€‚\n    val ints &#x3D; array :+ 2 &#x2F;&#x2F; å‘åè¿½åŠ \n    println(ints)\n    println(&quot;---------&quot;)\n    &#x2F;&#x2F; å‘å‰è¿½åŠ \n    val ints1 &#x3D; 1 +: array\n    println(ints1)\n\n    println(&quot;---------&quot;)\n\n    &#x2F;&#x2F; å‘åè¿½åŠ æ¨èä½¿ç”¨+&#x3D;æ¥å®ç°\n    println(array) &#x2F;&#x2F; ArrayBuffer(-1, 2, 3)\n    println(&quot;---------&quot;)\n\n    &#x2F;&#x2F; å‘å‰è¿½åŠ ä½¿ç”¨+&#x3D;:\n    1 +&#x3D;: array\n    println(array) &#x2F;&#x2F; ArrayBuffer(1, -1, 2, 3)\n    println(&quot;---------&quot;)\n\n    &#x2F;&#x2F; ä¹Ÿå¯ä½¿ç”¨appendæ–¹æ³•å’Œprependæ–¹æ³•\n    array.append(1)\n    println(array) &#x2F;&#x2F; ArrayBuffer(1, -1, 2, 3, 1)\n    println(&quot;---------&quot;)\n    array.prepend(0)\n    println(array) &#x2F;&#x2F; ArrayBuffer(0, 1, -1, 2, 3, 1)\n    println(&quot;---------&quot;)\n\n    &#x2F;&#x2F; æ’å…¥å€¼\n    array.insert(1, 100) &#x2F;&#x2F;åœ¨ç´¢å¼•1çš„ä½ç½®æ’å…¥100ï¼Œåé¢çš„å€¼åç§»\n    println(array) &#x2F;&#x2F; ArrayBuffer(0, 100, 1, -1, 2, 3, 1)\n    println(&quot;---------&quot;)\n\n    &#x2F;&#x2F; åˆ é™¤å…ƒç´ \n    array.remove(1)\n    println(array) &#x2F;&#x2F;ArrayBuffer(0, 1, -1, 2, 3, 1)\n    println(&quot;---------&quot;)\n    &#x2F;&#x2F; ä¹Ÿå¯ä»¥åˆ é™¤ç´¢å¼•åçš„å‡ ä¸ªå€¼\n    array.remove(1, 2)\n    println(array) &#x2F;&#x2F; ArrayBuffer(0, 2, 3, 1)\n    println(&quot;---------&quot;)\n\n    &#x2F;&#x2F;ä¹Ÿå¯ä»¥æ ¹æ®å€¼æ¥åˆ é™¤\n    array -&#x3D; 1\n    println(array) &#x2F;&#x2F; ArrayBuffer(0, 2, 3)\n    println(&quot;---------&quot;)\n\n    &#x2F;&#x2F; å¦‚æœæœ‰å¤šä¸ªç›¸åŒçš„å€¼å‘¢ï¼Œä½¿ç”¨-&#x3D;åªä¼šåˆ é™¤ä¸€ä¸ªï¼Œå¹¶ä¸”ä»å·¦å‘å³å¯»æ‰¾ã€‚\n    array.append(1, 2, 1)\n    println(array) &#x2F;&#x2F; ArrayBuffer(0, 2, 3, 1, 2, 1)\n    array -&#x3D; 1\n    println(array) &#x2F;&#x2F;ArrayBuffer(0, 2, 3, 2, 1)\n    \n\n  &#125;\n&#125;\n\nå¯å˜æ•°ç»„ä¸ä¸å¯å˜æ•°ç»„çš„è½¬æ¢&#x2F;&#x2F; å¯å˜æ•°ç»„ä¸ä¸å¯å˜æ•°ç»„çš„è½¬æ¢\nvar a1 &#x3D; ArrayBuffer[Int](1, 2, 3)\n&#x2F;&#x2F; è½¬æ¢ä¸ºä¸å¯å˜æ•°ç»„\nval array1: Array[Int] &#x3D; a1.toArray\n&#x2F;&#x2F; å°†ä¸å¯å˜æ•°ç»„è½¬åŒ–ä¸ºå¯å˜æ•°ç»„\nval buffer: mutable.Buffer[Int] &#x3D; array1.toBuffer\n\nå¤šç»´æ•°ç»„package io.github.itlab1024.scala.chapter07\n\n&#x2F;**\n * å¤šç»´æ•°ç»„\n *&#x2F;\nobject Test03_MultiArray &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    &#x2F;&#x2F; åˆ›å»ºä¸€ä¸ªäºŒç»´æ•°ç»„\n    val array: Array[Array[Int]] &#x3D; Array.ofDim[Int](2, 2)\n\n    &#x2F;&#x2F; è®¾ç½®å…ƒç´ \n    array(0)(1) &#x3D; 1\n\n    &#x2F;&#x2F; è®¿é—®å…ƒç´ \n    val i: Int &#x3D; array(0)(1)\n    println(i) &#x2F;&#x2F; 1\n    println(&quot;------&quot;)\n\n    &#x2F;&#x2F; éå†äºŒç»´æ•°ç»„\n    for (i &lt;- array.indices; j &lt;- array(i).indices) &#123;\n      println(array(i)(j) + &quot;\\t&quot;)\n      if (j &#x3D;&#x3D; array(i).length - 1) println()\n    &#125;\n\n    &#x2F;&#x2F; ä½¿ç”¨foreachå¾ªç¯\n    array.foreach(_.foreach(println))\n  &#125;\n&#125;\n\nåˆ—è¡¨Listpackage io.github.itlab1024.scala.chapter07\n\nimport scala.collection.mutable.ListBuffer\n\nobject Test04_List &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    &#x2F;&#x2F; åˆ›å»ºä¸€ä¸ªä¸å¯å˜çš„List,å¯ä»¥ä½¿ç”¨applyã€‚\n    val l: List[Int] &#x3D; List.apply(1, 2, 3)\n    &#x2F;&#x2F; ä¹Ÿå¯ä»¥ä½¿ç”¨ä¼´ç”Ÿå¯¹è±¡åˆ›å»º\n    val list: List[Int] &#x3D; List(1, 2, 3)\n\n    &#x2F;&#x2F; è®¿é—®listçš„å…ƒç´ \n    val i &#x3D; list(1)\n    println(i) &#x2F;&#x2F; 2\n\n    &#x2F;&#x2F; èµ‹å€¼\n    &#x2F;&#x2F;    list(0) &#x3D; 10 &#x2F;&#x2F; è¿™æ˜¯ä¸å…è®¸çš„\n\n    &#x2F;&#x2F; éå†ï¼Œå¯ä»¥ä½¿ç”¨æ™®é€šforå¾ªç¯ï¼Œæˆ–foreach\n    for(i &lt;- list.indices) &#123;\n      println(i)\n    &#125;\n\n    &#x2F;&#x2F; æ·»åŠ å…ƒç´ \n    &#x2F;&#x2F; å‘æœ€åæ·»åŠ \n    val list1 &#x3D; list :+ 10\n    println(list1) &#x2F;&#x2F; List(1, 2, 3, 10)\n    &#x2F;&#x2F; å‘å‰æ·»åŠ \n    val list2 &#x3D; 11 +: list1\n    println(list2) &#x2F;&#x2F; List(11, 1, 2, 3, 10)\n\n\n    &#x2F;&#x2F; åˆå¹¶åˆ—è¡¨\n    val l1 &#x3D; List(1)\n    val l2 &#x3D; List(2)\n    val l3 &#x3D; l1 ::: l2 &#x2F;&#x2F; ä¹Ÿå¯ä»¥ä½¿ç”¨l1 ++ l2\n    println(l3) &#x2F;&#x2F; List(1, 2)\n\n\n    &#x2F;&#x2F; å¯å˜åˆ—è¡¨ListBuffer\n    val lb: ListBuffer[Int] &#x3D; ListBuffer[Int](1, 2, 3)\n    lb.append(4)\n    println(lb) &#x2F;&#x2F; ListBuffer(1, 2, 3, 4)\n    &#x2F;&#x2F;å…¶ä»–çš„ä¸æ“ä½œäº†ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ï¼Œè·ŸArrayBufferç±»ä¼¼\n\n  &#125;\n&#125;\n\nSetä¸å¯å˜é›†åˆSet\npackage io.github.itlab1024.scala.chapter07\n\nobject Test05_ImmutableSet &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    &#x2F;&#x2F; åˆ›å»ºSet\n    val s &#x3D; Set(1, 2)\n    &#x2F;&#x2F; æ·»åŠ å…ƒç´ \n    val ns &#x3D; s + 3\n    println(ns) &#x2F;&#x2F; Set(1, 2, 3)\n  &#125;\n&#125;\n\n\nå¯å˜é›†åˆSet\npackage io.github.itlab1024.scala.chapter07\n\nimport scala.collection.mutable\n\nobject Test06_MutableSet &#123;\n\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    &#x2F;&#x2F; åˆ›å»ºå¯å˜set\n    val set &#x3D; mutable.Set(1, 2, 3)\n    &#x2F;&#x2F; æ·»åŠ \n    set +&#x3D; 10\n    println(set) &#x2F;&#x2F;Set(1, 2, 3, 10)\n    &#x2F;&#x2F; å»ºè®®ä½¿ç”¨addæ–¹æ³•\n    set.add(9)\n    println(set) &#x2F;&#x2F; Set(9, 1, 2, 3, 10)\n  &#125;\n&#125;\n\nMapå¯å˜Map\npackage io.github.itlab1024.scala.chapter07\n\nobject Test07_ImmutableMap &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    &#x2F;&#x2F; åˆ›å»ºMap\n    val map: Map[Int, Int] &#x3D; Map[Int, Int]((1, 2), (3, 4)) &#x2F;&#x2F; ä¹Ÿå¯ä»¥ä½¿ç”¨-&gt;,æ¯”å¦‚1-&gt;2,3-&gt;4\n    println(map) &#x2F;&#x2F; Map(1 -&gt; 2, 3 -&gt; 4)\n\n    &#x2F;&#x2F; æ·»åŠ \n    val map1 &#x3D; map + (5 -&gt; 6)\n    println(map1) &#x2F;&#x2F; Map(1 -&gt; 2, 3 -&gt; 4, 5 -&gt; 6)\n\n    &#x2F;&#x2F; åˆ é™¤\n    val map2 &#x3D; map1 - 1\n    println(map2) &#x2F;&#x2F; Map(3 -&gt; 4, 5 -&gt; 6)\n\n    &#x2F;&#x2F; é€šè¿‡keyè·å–\n    val i &#x3D; map2(3)\n    println(i) &#x2F;&#x2F; 4, å¦‚æœkeyä¸å­˜åœ¨ä¼šæŠ›å‡ºå¼‚å¸¸\n\n    &#x2F;&#x2F; å¾ªç¯\n    for((k, v) &lt;- map2) &#123;\n      println(s&quot;k&#x3D;$k, v&#x3D;$v&quot;)\n    &#125;\n\n\n  &#125;\n&#125;\n\nå¯å˜çš„Map\npackage io.github.itlab1024.scala.chapter07\n\nimport scala.collection.mutable\n\nobject Test08_MutableMap &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    &#x2F;&#x2F; å®šä¹‰å¯å˜çš„map\n    val map: mutable.Map[Int, Int] &#x3D; mutable.Map(1 -&gt; 2, 3 -&gt; 4)\n    &#x2F;&#x2F; æ·»åŠ \n    map + (5 -&gt; 6)\n    println(map) &#x2F;&#x2F; Map(1 -&gt; 2, 3 -&gt; 4) ä¸ºå•¥æ²¡åŠ è¿›å»ï¼Œå…¶å®+è¿™ä¸ªå‡½æ•°å°±æ˜¯ä¸ºäº†ä¸å¯å˜è®¾è®¡çš„ã€‚ä½†æ˜¯scalaç¼ºæ— æ³•æ ¹æ®ä¸åŒçš„mapåŒºåˆ†ï¼Œå…¶å®listå’Œsetä¹Ÿæ˜¯å¦‚æ­¤\n\n    &#x2F;&#x2F; ä½¿ç”¨\n    map.put(5, 6)\n    println(map) &#x2F;&#x2F; Map(5 -&gt; 6, 1 -&gt; 2, 3 -&gt; 4)\n    \n    &#x2F;&#x2F; æ‡’äº†ï¼Œå…¶ä»–çš„ä¸è¯•äº†ï¼Œä»¥åç”¨çš„æ—¶å€™å†ç§¯ç´¯å§\n  &#125;\n&#125;\n\nå…ƒç»„å…ƒç»„å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå®¹å™¨ï¼Œå¯ä»¥å­˜æ”¾å„ç§ä¸åŒæˆ–è€…ç›¸åŒç±»å‹çš„æ•°æ®ã€‚\npackage io.github.itlab1024.scala.chapter08\n\n&#x2F;**\n * å…ƒç»„\n *&#x2F;\nobject Test01_Tuple &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    &#x2F;&#x2F; åˆ›å»ºå…ƒç»„\n    val tuple1: (Int, String, Boolean) &#x3D; (1, &quot;a&quot;, true)\n    &#x2F;&#x2F; è·å–å…ƒç»„å…ƒç´ ï¼Œé€šè¿‡_indexçš„æ–¹å¼\n    println(tuple1._1) &#x2F;&#x2F; 1\n    println(tuple1._2) &#x2F;&#x2F; a\n    println(tuple1._3) &#x2F;&#x2F; true\n\n    &#x2F;&#x2F; éå†å…ƒç»„\n    for(e &lt;- tuple1.productIterator) &#123;\n      println(e)\n    &#125;\n  &#125;\n&#125;\n\né˜Ÿåˆ—package io.github.itlab1024.scala.chapter08\n\nimport scala.collection.mutable\n\n&#x2F;**\n * scalaä¸­çš„é˜Ÿåˆ—\n *&#x2F;\nobject Test02_Queue &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    &#x2F;&#x2F; å®šä¹‰é˜Ÿåˆ—\n    val queue: mutable.Queue[Int] &#x3D; mutable.Queue[Int]()\n    println(queue) &#x2F;&#x2F;Queue()\n\n    &#x2F;&#x2F; å…¥é˜Ÿ\n    queue.enqueue(1)\n    println(queue) &#x2F;&#x2F; Queue(1)\n\n    &#x2F;&#x2F; å‡ºé˜Ÿ\n    val i &#x3D; queue.dequeue()\n    println(i) &#x2F;&#x2F; 1\n    println(queue) &#x2F;&#x2F;Queue()\n  &#125;\n&#125;\n\næ¨¡å¼åŒ¹é…ä¸»è¦å­¦ä¹ ä¸‹æ ·ä¾‹ç±»ï¼ˆcase classï¼‰çš„åŒ¹é…\npackage io.github.itlab1024.scala.chapter09\n\nobject Test01_PatternMatch &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    &#x2F;&#x2F; matché»˜è®¤æ˜¯æ— æ³•å¯¹æ™®é€šç±»è¿›è¡Œæ“ä½œçš„ï¼Œå¿…é¡»åœ¨ç±»çš„ä¼´ç”Ÿå¯¹è±¡ä¸­å®ç°è‡ªå·±çš„applyå’Œunapplyæ–¹æ³•ã€‚scalaä¸­æä¾›äº†æ ·ä¾‹ç±»ï¼Œè¿™æ ·çš„ç±»é»˜è®¤å°±æä¾›äº†è¿™äº›æ–¹æ³•\n    val t &#x3D; T(&quot;itlab1024&quot;)\n    t match &#123;\n      case T(&quot;1&quot;) &#x3D;&gt; println(&quot;åŒ¹é…1&quot;)\n      case _ &#x3D;&gt;\n    &#125;\n  &#125;\n&#125;\n\n&#x2F;&#x2F; æ ·ä¾‹ç±»\ncase class T(name: String) &#123;\n&#125;\n\nå¼‚å¸¸å¤„ç†package io.github.itlab1024.scala.chapter10\n\nobject Test01_Exception &#123;\n  def main(args: Array[String]): Unit &#x3D; &#123;\n    try &#123;\n\n    &#125; catch &#123;\n      case e: NullPointerException &#x3D;&gt; println(&quot;ç©ºæŒ‡é’ˆ&quot;)\n      case ex: ClassNotFoundException &#x3D;&gt; println(&quot;ç±»æ²¡æ²¡æ‰¾åˆ°&quot;)\n    &#125; finally &#123;\n      &#x2F;&#x2F; åˆ«å¿˜äº†å…³é—­æµç­‰æ“ä½œã€‚ã€‚ã€‚ã€‚\n    &#125;\n  &#125;\n&#125;\n\næ³›å‹scalaä¸­çš„æ³›å‹æ¯”javaç¨å¾®å¤æ‚ç‚¹ï¼Œä¼šåˆ†ä¸ºåå˜ï¼Œé€†å˜\nclass MyClass[+T] &#x2F;&#x2F; åå˜\nclass MyClass[-T] &#x2F;&#x2F; é€†å˜\nclass MyClass[T]\t&#x2F;&#x2F; ä¸å˜\n\nåå˜ï¼šSonæ˜¯Fatherçš„å­ç±»ï¼Œåˆ™MyList[Son]ä¹Ÿå¯ä»¥ä½œä¸ºMyList[Father]çš„å­ç±»\né€†å˜ï¼šSonæ˜¯Fatherçš„å­ç±»ï¼Œåˆ™MyList[Son]ä½œä¸ºMyList[Father]çš„çˆ¶ç±»\nä¸å˜ï¼šSonæ˜¯Fatherçš„å­ç±»ï¼Œåˆ™MyList[Son]å’ŒMyList[Father]æ²¡æœ‰å…³ç³»\npackage io.github.itlab1024.scala.chapter11\n\nobject Test01_Generics &#123;\n  &#x2F;&#x2F; åå˜å’Œé€†å˜\n  val l: MyList[Father] &#x3D; new MyList[Son] &#x2F;&#x2F; è¿™æ˜¯ä¸å…è®¸çš„ï¼Œä½†æ˜¯å¦‚æœå°†MyListçš„æ³›å‹ä¿®æ”¹ä¸º+Eåˆ™æ²¡æœ‰é—®é¢˜ã€‚\n  val n: MyList[Son] &#x3D; new MyList[Father] &#x2F;&#x2F; è¿™ä¹Ÿæ˜¯ä¸å…è®¸çš„ï¼Œï¼Œä½†æ˜¯å¦‚æœå°†MyListçš„æ³›å‹ä¿®æ”¹ä¸º-Eåˆ™æ²¡æœ‰é—®é¢˜ã€‚\n&#125;\n\nclass Father &#123;\n\n&#125;\n\nclass Son extends Father &#123;\n\n&#125;\n\n&#x2F;&#x2F; å®šä¹‰æ³›å‹çš„é›†åˆç±»å‹\nclass MyList[E] &#123; &#x2F;&#x2F; æ­¤å¤„ç°åœ¨æ˜¯ä¸å˜çš„æ³›å‹\n\n&#125;\n\n\n\n\n\n\n\n\n\n\n\n\næ€»ç»“ï¼Œç²—ç•¥çš„å­¦ä¹ äº†ä¸‹ï¼Œæ„Ÿè§‰scalaçš„è®¾è®¡æœ‰ç‚¹å¤æ‚äº†ï¼Œå°¤å…¶é‡Œé¢å„ç§æ–¹æ³•ï¼Œæ¯”å¦‚+=:,::,:::ç­‰ï¼Œå¾ˆéš¾è®°ã€‚\n\n\n\n\n\n\n\n\n\n\nGithubï¼šhttps://github.com/ITLab1024/Scala2-Tutorials\n\n","slug":"scala2å­¦ä¹ ç¬”è®°ï¼ˆv2-12-11ï¼‰","date":"2022-06-02T08:54:37.000Z","categories_index":"Scala","tags_index":"Scala2,2.12.11,BigData","author_index":"ITLab"},{"id":"ddc916691a7c6f09eafaf2d5a06c2348","title":"ä½¿ç”¨Kubeadmæ­å»ºKubernetesé›†ç¾¤ï¼ˆv1.22ï¼‰","content":"ç‰ˆæœ¬è¯´æ˜\nv1.22\nå‡†å¤‡ä¸‰å°æœºå™¨\nä½¿ç”¨Multipassï¼ˆå¦‚ä½•ä½¿ç”¨ï¼Œè¯·å‚è€ƒæ–‡ç« çš®çš®ï¼šä½¿ç”¨Ubuntu Multipassåˆ›å»ºè™šæ‹Ÿæœºï¼ˆæ–¹ä¾¿å¿«æ·ï¼‰ï¼‰åˆ›å»ºä¸‰ä¸ªvmã€‚ä¹Ÿå°±æ˜¯ä¸‰ä¸ªèŠ‚ç‚¹node1ï¼Œ node2ï¼Œ node3\nmultipass launch -c 2 -m 2G -n node1\n\nmultipass launch -c 2 -m 2G -n node2\n\nmultipass launch -c 2 -m 2G -n node3\n\n\n\nç³»ç»Ÿè®¾ç½®ã€å®‰è£…å®¹å™¨ï¼ˆæœ¬æ–‡ä½¿ç”¨Dockerï¼‰ã€kuberneteså·¥å…·ï¼ˆä¸‰ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦æ‰§è¡Œï¼‰\n\nç³»ç»Ÿè®¾ç½®\n\ncat &lt;&lt;EOF | sudo tee &#x2F;etc&#x2F;modules-load.d&#x2F;k8s.conf\nbr_netfilter\nEOF\n\ncat &lt;&lt;EOF | sudo tee &#x2F;etc&#x2F;sysctl.d&#x2F;k8s.conf\nnet.bridge.bridge-nf-call-ip6tables &#x3D; 1\nnet.bridge.bridge-nf-call-iptables &#x3D; 1\nEOF\nsudo sysctl --system\n\n\n\n\ndockerå®‰è£…\n\næ ¹æ®å®˜ç½‘æ–‡æ¡£è¿›è¡Œå®‰è£…ï¼Œå› ä¸ºæˆ‘æˆ‘çš„vmæ˜¯ubuntuï¼Œæ ¹æ®è¯¥è¿æ¥è¿›è¡Œå®‰è£…ï¼šhttps://docs.docker.com/engine/install/ubuntu/\n\nå¦‚æœå®‰è£…è¿‡dockerï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¸…ç†\n\nsudo apt-get remove docker docker-engine docker.io containerd runc\n \n \nsudo apt-get update\nsudo apt-get install \\\n    apt-transport-https \\\n    ca-certificates \\\n    curl \\\n    gnupg \\\n    lsb-release\n\n\ncurl -fsSL https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;ubuntu&#x2F;gpg | sudo gpg --dearmor -o &#x2F;usr&#x2F;share&#x2F;keyrings&#x2F;docker-archive-keyring.gpg\n\n\necho \\\n  &quot;deb [arch&#x3D;amd64 signed-by&#x3D;&#x2F;usr&#x2F;share&#x2F;keyrings&#x2F;docker-archive-keyring.gpg] https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;ubuntu \\\n  $(lsb_release -cs) stable&quot; | sudo tee &#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;docker.list &gt; &#x2F;dev&#x2F;null\n\n\nsudo apt-get update\nsudo apt-get install docker-ce docker-ce-cli containerd.io\n\n\n\n\nè®¾ç½®dockerçš„cgroups systemd\n\nsudo mkdir &#x2F;etc&#x2F;docker\ncat &lt;&lt;EOF | sudo tee &#x2F;etc&#x2F;docker&#x2F;daemon.json\n&#123;\n  &quot;exec-opts&quot;: [&quot;native.cgroupdriver&#x3D;systemd&quot;],\n  &quot;log-driver&quot;: &quot;json-file&quot;,\n  &quot;log-opts&quot;: &#123;\n    &quot;max-size&quot;: &quot;100m&quot;\n  &#125;,\n  &quot;storage-driver&quot;: &quot;overlay2&quot;\n&#125;\nEOF\n\n\n\n\né‡å¯dockerå¹¶è®¾ç½®å¼€æœºå¯åŠ¨\n\nsudo systemctl enable docker\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n\n\n\n\nå®‰è£…kubeadm\n\ncat &lt;&lt;EOF | sudo tee &#x2F;etc&#x2F;modules-load.d&#x2F;k8s.conf\nbr_netfilter\nEOF\n\ncat &lt;&lt;EOF | sudo tee &#x2F;etc&#x2F;sysctl.d&#x2F;k8s.conf\nnet.bridge.bridge-nf-call-ip6tables &#x3D; 1\nnet.bridge.bridge-nf-call-iptables &#x3D; 1\nEOF\nsudo sysctl --system\n\n\nsudo apt-get update\nsudo apt-get install -y apt-transport-https ca-certificates curl\n\n\nsudo curl -fsSLo &#x2F;usr&#x2F;share&#x2F;keyrings&#x2F;kubernetes-archive-keyring.gpg https:&#x2F;&#x2F;packages.cloud.google.com&#x2F;apt&#x2F;doc&#x2F;apt-key.gpg\n\n\necho &quot;deb [signed-by&#x3D;&#x2F;usr&#x2F;share&#x2F;keyrings&#x2F;kubernetes-archive-keyring.gpg] https:&#x2F;&#x2F;apt.kubernetes.io&#x2F; kubernetes-xenial main&quot; | sudo tee &#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;kubernetes.list\n\n\nsudo apt-get update\nsudo apt-get install -y kubelet kubeadm kubectl\nsudo apt-mark hold kubelet kubeadm kubectl\n\n\n\nä»¥ä¸Šæ“ä½œå„ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦æ“ä½œ\nä½¿ç”¨kubeadmæŒ‡ä»¤åˆå§‹åŒ–ï¼ˆmasterèŠ‚ç‚¹ï¼šnode1ï¼‰\nubuntu@node1:~$ sudo kubeadm init --pod-network-cidr&#x3D;10.244.0.0&#x2F;16\n[init] Using Kubernetes version: v1.22.2\n[preflight] Running pre-flight checks\n[preflight] Pulling images required for setting up a Kubernetes cluster\n[preflight] This might take a minute or two, depending on the speed of your internet connection\n[preflight] You can also perform this action in beforehand using &#39;kubeadm config images pull&#39;\n[certs] Using certificateDir folder &quot;&#x2F;etc&#x2F;kubernetes&#x2F;pki&quot;\n[certs] Generating &quot;ca&quot; certificate and key\n[certs] Generating &quot;apiserver&quot; certificate and key\n[certs] apiserver serving cert is signed for DNS names [kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local node1] and IPs [10.96.0.1 172.16.241.11]\n[certs] Generating &quot;apiserver-kubelet-client&quot; certificate and key\n[certs] Generating &quot;front-proxy-ca&quot; certificate and key\n[certs] Generating &quot;front-proxy-client&quot; certificate and key\n[certs] Generating &quot;etcd&#x2F;ca&quot; certificate and key\n[certs] Generating &quot;etcd&#x2F;server&quot; certificate and key\n[certs] etcd&#x2F;server serving cert is signed for DNS names [localhost node1] and IPs [172.16.241.11 127.0.0.1 ::1]\n[certs] Generating &quot;etcd&#x2F;peer&quot; certificate and key\n[certs] etcd&#x2F;peer serving cert is signed for DNS names [localhost node1] and IPs [172.16.241.11 127.0.0.1 ::1]\n[certs] Generating &quot;etcd&#x2F;healthcheck-client&quot; certificate and key\n[certs] Generating &quot;apiserver-etcd-client&quot; certificate and key\n[certs] Generating &quot;sa&quot; key and public key\n[kubeconfig] Using kubeconfig folder &quot;&#x2F;etc&#x2F;kubernetes&quot;\n[kubeconfig] Writing &quot;admin.conf&quot; kubeconfig file\n[kubeconfig] Writing &quot;kubelet.conf&quot; kubeconfig file\n[kubeconfig] Writing &quot;controller-manager.conf&quot; kubeconfig file\n[kubeconfig] Writing &quot;scheduler.conf&quot; kubeconfig file\n[kubelet-start] Writing kubelet environment file with flags to file &quot;&#x2F;var&#x2F;lib&#x2F;kubelet&#x2F;kubeadm-flags.env&quot;\n[kubelet-start] Writing kubelet configuration to file &quot;&#x2F;var&#x2F;lib&#x2F;kubelet&#x2F;config.yaml&quot;\n[kubelet-start] Starting the kubelet\n[control-plane] Using manifest folder &quot;&#x2F;etc&#x2F;kubernetes&#x2F;manifests&quot;\n[control-plane] Creating static Pod manifest for &quot;kube-apiserver&quot;\n[control-plane] Creating static Pod manifest for &quot;kube-controller-manager&quot;\n[control-plane] Creating static Pod manifest for &quot;kube-scheduler&quot;\n[etcd] Creating static Pod manifest for local etcd in &quot;&#x2F;etc&#x2F;kubernetes&#x2F;manifests&quot;\n[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory &quot;&#x2F;etc&#x2F;kubernetes&#x2F;manifests&quot;. This can take up to 4m0s\n[kubelet-check] Initial timeout of 40s passed.\n[apiclient] All control plane components are healthy after 58.570622 seconds\n[upload-config] Storing the configuration used in ConfigMap &quot;kubeadm-config&quot; in the &quot;kube-system&quot; Namespace\n[kubelet] Creating a ConfigMap &quot;kubelet-config-1.22&quot; in namespace kube-system with the configuration for the kubelets in the cluster\n[upload-certs] Skipping phase. Please see --upload-certs\n[mark-control-plane] Marking the node node1 as control-plane by adding the labels: [node-role.kubernetes.io&#x2F;master(deprecated) node-role.kubernetes.io&#x2F;control-plane node.kubernetes.io&#x2F;exclude-from-external-load-balancers]\n[mark-control-plane] Marking the node node1 as control-plane by adding the taints [node-role.kubernetes.io&#x2F;master:NoSchedule]\n[bootstrap-token] Using token: uyydwy.xlbh5ta1wdfecxjw\n[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles\n[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to get nodes\n[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials\n[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token\n[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster\n[bootstrap-token] Creating the &quot;cluster-info&quot; ConfigMap in the &quot;kube-public&quot; namespace\n[kubelet-finalize] Updating &quot;&#x2F;etc&#x2F;kubernetes&#x2F;kubelet.conf&quot; to point to a rotatable kubelet client certificate and key\n[addons] Applied essential addon: CoreDNS\n[addons] Applied essential addon: kube-proxy\n\nYour Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  mkdir -p $HOME&#x2F;.kube\n  sudo cp -i &#x2F;etc&#x2F;kubernetes&#x2F;admin.conf $HOME&#x2F;.kube&#x2F;config\n  sudo chown $(id -u):$(id -g) $HOME&#x2F;.kube&#x2F;config\n\nAlternatively, if you are the root user, you can run:\n\n  export KUBECONFIG&#x3D;&#x2F;etc&#x2F;kubernetes&#x2F;admin.conf\n\nYou should now deploy a pod network to the cluster.\nRun &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:\n  https:&#x2F;&#x2F;kubernetes.io&#x2F;docs&#x2F;concepts&#x2F;cluster-administration&#x2F;addons&#x2F;\n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join 172.16.241.11:6443 --token uyydwy.xlbh5ta1wdfecxjw \\\n    --discovery-token-ca-cert-hash sha256:5b3d416064c712ed79ecfc2f65ccc9f7cef745321ae03eb154e1ef880f3212a7\n\n\n\n\né…ç½®\n\næŒ‰ç…§ä¸Šé¢çš„æ—¥å¿—è®°å½•é…ç½®ï¼š\nå¦‚æœérootç”¨æˆ·æ‰§è¡Œ\nmkdir -p $HOME&#x2F;.kube\nsudo cp -i &#x2F;etc&#x2F;kubernetes&#x2F;admin.conf $HOME&#x2F;.kube&#x2F;config\nsudo chown $(id -u):$(id -g) $HOME&#x2F;.kube&#x2F;config\n\n\n\nå¦‚æœæ˜¯rootç”¨æˆ·æ‰§è¡Œ\nshell export KUBECONFIG&#x3D;&#x2F;etc&#x2F;kubernetes&#x2F;admin.conf\n\n\n\n\néªŒè¯ä¸»èŠ‚ç‚¹æ˜¯å¦æˆåŠŸï¼ˆåŠ åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œå¦åˆ™æœºå™¨é‡å¯åå¤±è´¥ã€‚ï¼‰\n\nexport KUBECONFIG&#x3D;&#x2F;etc&#x2F;kubernetes&#x2F;admin.conf\n\n\n\n\næ­£ç¡®è¿”å›ï¼Œè¯´æ˜èŠ‚ç‚¹åˆå§‹åŒ–æˆåŠŸã€‚\nå°†ä»èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ï¼ˆnode2ï¼Œnode3 æ‰§è¡Œï¼‰\nsudo kubeadm join 172.16.241.11:6443 --token uyydwy.xlbh5ta1wdfecxjw --discovery-token-ca-cert-hash sha256:5b3d416064c712ed79ecfc2f65ccc9f7cef745321ae03eb154e1ef880f3212a7\n\n\n\nå¦‚æœä¸Šé¢çš„tokenå¿˜è®°äº†æ‰§è¡Œï¼š\nkubeadm token list\n\n\n\nå¦‚æœtoken-ca-cert-bashå¿˜è®°äº†æ‰§è¡Œï¼š\nopenssl x509 -pubkey -in &#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;ca.crt | openssl rsa -pubin -outform der 2&gt;&#x2F;dev&#x2F;null | openssl dgst -sha256 -hex | sed &#39;s&#x2F;^.* &#x2F;&#x2F;&#39;\n\n\n\nå›åˆ°master(node1):\næ‰§è¡Œkubectl get nodes\n\nå¯ä»¥çœ‹åˆ°node2èŠ‚ç‚¹å·²ç»åŠ å…¥é›†ç¾¤ã€‚\nåŒç†æ“ä½œnode3èŠ‚ç‚¹ã€‚\n\né…ç½®ç½‘ç»œ\nç½‘ç»œæœ‰å¾ˆå¤šç§ï¼Œæœ¬äººä½¿ç”¨çš„æ˜¯flannel\nkubectl apply -f https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;coreos&#x2F;flannel&#x2F;master&#x2F;Documentation&#x2F;kube-flannel.yml\n\n\n\næŸ¥çœ‹èŠ‚ç‚¹ï¼š\n\nèŠ‚ç‚¹çŠ¶æ€éƒ½å˜æˆäº†Ready\néƒ¨ç½²åº”ç”¨ï¼ˆå®˜æ–¹ç¤ºä¾‹ï¼‰\n\nå‘å¸ƒåº”ç”¨\n\nkubectl create deployment kubernetes-bootcamp --image&#x3D;gcr.io&#x2F;google-samples&#x2F;kubernetes-bootcamp:v1\n\n\n\næŸ¥çœ‹æ˜¯å¦å‘å¸ƒæˆåŠŸï¼ˆä¸‹è½½é•œåƒæœ‰ç‚¹æ»¡ï¼Œè€Œä¸”è¿˜éœ€è¦ç§‘å­¦ä¸Šç½‘å“Ÿï¼‰\n\n\næµè§ˆåº”ç”¨\n\næ­¤æ—¶åº”ç”¨podåœ¨ä¸€ä¸ªç§æœ‰çš„ã€éš”ç¦»çš„ç½‘ç»œä¸Šï¼Œæ— æ³•å¤–éƒ¨è®¿é—®ã€‚å¯ä»¥ä½¿ç”¨kubectl proxy ä»£ç†è®¿é—®ã€‚\n\nå¼€æ”¾åº”ç”¨ç¨‹åº\n\nä½¿ç”¨serivceå¼€å‘åº”ç”¨ï¼š\nkubectl expose deployment&#x2F;kubernetes-bootcamp --type&#x3D;&quot;ClusterIP&quot; --port 8080\n\n\n\næŸ¥è¯¢serivce\nkubectl get services\n\n\n\n\næŸ¥çœ‹ä¸‹serviceçš„å…·ä½“æè¿°ä¿¡æ¯\n\nè®¿é—®åº”ç”¨\n\n\næ‰©å±•åº”ç”¨\n\næŸ¥çœ‹podæ•°é‡\nkubectl get deployments\n\n\n\n\næŸ¥çœ‹å‰¯æœ¬ï¼š\n\næ‰©å±•åˆ°4ä¸ªï¼š\nkubectl scale deployments&#x2F;kubernetes-bootcamp --replicas&#x3D;4\n\n\n\n\næŸ¥çœ‹podæ•°é‡ï¼š\n\næˆ‘ä»¬èƒ½çœ‹åˆ°æœ‰äº›å®¹å™¨è¿˜åœ¨åˆ›å»ºã€‚\næŸ¥çœ‹è¿™äº›podéƒ½åœ¨å“ªäº›èŠ‚ç‚¹ä¸Š\nkubectl get pods -o wide\n\n\n\n\n\næ»šåŠ¨æ›´æ–°åº”ç”¨\n\nä¸Šé¢ä½¿ç”¨çš„é•œåƒæ˜¯v1ç‰ˆæœ¬ï¼Œæ¥ä¸‹æ¥å‡çº§åˆ°v2ç‰ˆæœ¬\nkubectl set image deployments&#x2F;kubernetes-bootcamp kubernetes-bootcamp&#x3D;jocatalin&#x2F;kubernetes-bootcamp:v2\n\n\n\n\nè®¿é—®ï¼š\n\nå›æ»šæ“ä½œ\nå½“æˆ‘ä»¬å‡çº§å¤±è´¥ï¼Œæˆ–è€…å‡çº§ç‰ˆæœ¬æœ‰ä»£ç é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬ã€‚\nkubectl rollout undo deployments&#x2F;kubernetes-bootcamp\n\n\n\né‡æ–°è®¿é—®åº”ç”¨ï¼š\n\næˆ‘ä»¬çœ‹åˆ°ç‰ˆæœ¬å·²ç»å›é€€åˆ°äº†v1ã€‚\nkubernetesé›†ç¾¤æ­å»ºå°±å®Œæˆäº†ï¼Œæœ¬æ–‡åªæ˜¯åŸºæœ¬ä½¿ç”¨ã€‚æˆ‘ä¹Ÿåœ¨åˆå­¦ä¸­ã€‚kubernetesçš„çŸ¥è¯†è¿˜æ˜¯æŒºå¤šçš„ã€‚æ„Ÿè§‰å­¦ä¸åŠ¨äº† ã€‚åˆ†äº«ç»™å¤§å®¶ã€‚\n\næ¢¦æƒ³è¶Šæ˜¯ç¾ä¸½ï¼Œå°±è¶Šæ˜¯æ˜¾å¾—é¥ä¸å¯åŠã€‚å¯å¥‡æ€ªçš„æ˜¯ï¼Œä¸€æ—¦ä½ ä¸‹å®šäº†å†³å¿ƒï¼Œå¾ˆå¿«åœ°ï¼Œé‚£äº›æ¢¦æƒ³å°±ä¸€ä¸€æˆä¸ºäº†ç°å®ï¼\n","slug":"ä½¿ç”¨Kubeadmæ­å»ºKubernetesé›†ç¾¤ï¼ˆv1-22ï¼‰","date":"2022-05-02T03:18:25.000Z","categories_index":"Kubernetes","tags_index":"Kubernetes,Container","author_index":"ITLab"},{"id":"ba590f4c595f20e0726c162dbce4dd2d","title":"ubuntu-multipass","content":"ä»€ä¹ˆæ˜¯Maultipassï¼Ÿ\nå®˜æ–¹è¯´æ˜ï¼š\nUbuntu VMs on demand for any workstation\nGet an instant Ubuntu VM with a single command. Multipass can launch and run virtual machines and configure them with cloud-init like a public cloud. Prototype your cloud launches locally for free.\n\nå°±æ˜¯åˆ›å»ºUbuntuç³»ç»Ÿçš„è™šæ‹Ÿæœºã€‚\n\n\n\n\n\n\n\n\n\nä»¥å‰æ­å»ºKafkaã€zookeeperé›†ç¾¤çš„æ—¶å€™ï¼Œæ€»æ˜¯ä¼šç”¨visual box ï¼Œfusion(mac)ç­‰è™šæ‹ŸæœºæŠ€æœ¯ã€‚\n1ã€ä¸‹è½½é•œåƒ\n2ã€åˆ›å»ºè™šæ‹Ÿæœºï¼Œé€‰æ‹©é•œåƒã€è®¾ç½®ç³»ç»Ÿå±æ€§\n3ã€å®Œæˆæ­å»º\nå¾ˆå·§åœ°ï¼Œå‰å‡ å¤©çœ‹åˆ°äº†è£…äº†ä¸ªUbuntuã€WindowsåŒç³»ç»Ÿã€‚çœ‹åˆ°äº†Ubuntuç•Œé¢ï¼Œæ„Ÿè§‰æ¯”ä»¥å‰ä½¿ç”¨Ubuntuçš„æ—¶å€™æ¼‚äº®äº†æŒºå¤šã€‚äºæ˜¯æ‰“å¼€äº†Ubuntuçš„å®˜ç½‘ã€‚https://ubuntu.com/, æ— æ„é—´çœ‹åˆ°äº†multipasså·¥å…·ã€‚äºæ˜¯å°è¯•äº†ä¸‹ã€‚è§‰å¾—ç‰¹åˆ«å¥½ç”¨ã€‚å¯¹äºé‚£äº›ä¸æƒ³èŠ±é’±è´­ä¹°æœºå™¨ã€åˆæƒ³æœ‰è‡ªå·±çš„å¤šä¸ªlinuxç³»ç»Ÿçš„æœ‹å‹ï¼Œmultipasså¾ˆå¥½ç”¨ã€‚è€Œä¸”å…³é”®çš„ä¸€ç‚¹æ˜¯ç”¨èµ·æ¥ç‰¹åˆ«æ–¹ä¾¿ã€‚\næ¥ä¸‹æ¥æˆ‘å°±æŠŠæˆ‘ä½¿ç”¨multipassçš„æ“ä½œè®°å½•ä¸‹æ¥ã€‚åˆ†äº«ç»™å¤§å®¶ã€‚\n\n\n\n\n\n\n\n\n\nå®‰è£…multipass\næ‰“å¼€https://multipass.run/\nmultipassæ”¯æŒlinuxã€windowsã€macå¹³å°ä½¿ç”¨ã€‚\n\næœ¬äººå†æ¬¡ä½¿ç”¨macç‰ˆæœ¬\nå®‰è£…æœ‰ä¸¤ç§æ–¹å¼ï¼š\n\nä¸‹è½½pkgåŒ…è¿›è¡Œå®‰è£…ã€‚\n\n\n\nä½¿ç”¨brewå‘½ä»¤å®‰è£…\n\nbrew install --cask multipass\n\n\n\n\néªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ\næ‰§è¡Œmultipass\næ˜¾ç¤ºå¦‚ä¸‹ç•Œé¢å³ä»£è¡¨æˆåŠŸ\n\nå®Œæ•´æ—¥å¿—å¦‚ä¸‹ï¼š\nUsage: multipass [options] &lt;command&gt;\nCreate, control and connect to Ubuntu instances.\n\nThis is a command line utility for multipass, a\nservice that manages Ubuntu instances.\n\nOptions:\n  -h, --help     Displays help on commandline options.\n  --help-all     Displays help including Qt specific options.\n  -v, --verbose  Increase logging verbosity. Repeat the &#39;v&#39; in the short option\n                 for more detail. Maximum verbosity is obtained with 4 (or more)\n                 v&#39;s, i.e. -vvvv.\n\nAvailable commands:\n  delete    Delete instances\n  exec      Run a command on an instance\n  find      Display available images to create instances from\n  get       Get a configuration setting\n  help      Display help about a command\n  info      Display information about instances\n  launch    Create and start an Ubuntu instance\n  list      List all available instances\n  mount     Mount a local directory in the instance\n  networks  List available network interfaces\n  purge     Purge all deleted instances permanently\n  recover   Recover deleted instances\n  restart   Restart instances\n  set       Set a configuration setting\n  shell     Open a shell on a running instance\n  start     Start instances\n  stop      Stop running instances\n  suspend   Suspend running instances\n  transfer  Transfer files between the host and instances\n  umount    Unmount a directory from an instance\n  version   Show version details\n\nåˆ—å‡ºäº†æ‰€æœ‰çš„å‘½ä»¤å·²ç»å‘½ä»¤çš„å«ä¹‰ã€‚\n\n\n\n\n\n\n\n\n\nåˆ›å»ºè™šæ‹Ÿæœº\nmultipass launch -n vm1\n\nlaunchå¯é€‰æ‹©å‚æ•°å¯ä½¿ç”¨multipass launch -hæŸ¥çœ‹ã€‚\nè¿™é‡Œä»‹ç»å‡ ä¸ªä¸»è¦å‚æ•°ï¼š\n-nï¼šæŒ‡å®šè™šæ‹Ÿæœºåç§°\n-cï¼šæŒ‡å®šcpuæ ¸æ•°\n-mï¼šæŒ‡å®šå†…å­˜å¤§å°\n-dï¼šæŒ‡å®šç¡¬ç›˜å¤§å°\næ‰§è¡Œç»“æœï¼š\n\n\nè¿›å…¥è™šæ‹Ÿæœº\nmultipass shell vm1\n\nä¹Ÿå¯ä»¥ä½¿ç”¨execæŒ‡ä»¤ã€‚\n\n\nå…³é—­è™šæ‹Ÿæœº\n\n\nå¯åŠ¨è™šæ‹Ÿæœº\n\n\nåˆ é™¤è™šæ‹Ÿæœº\n\n\næ¸…æ¥šåˆ é™¤çš„è™šæ‹Ÿæœº\nåˆ é™¤è™šæ‹Ÿæœºåï¼Œé‡æ–°ä½¿ç”¨ä¸€æ ·çš„åå­—åˆ›å»ºvmï¼Œæ˜¯ä¸æˆåŠŸçš„ã€‚\n\nè¿™æ—¶å€™éœ€è¦æ¸…ç†åˆ é™¤çš„è™šæ‹Ÿæœºåæ‰èƒ½æˆåŠŸã€‚\n\n\n\n\n\n\n\n\n\n\n\n\nè‡³æ­¤ï¼ŒmultipassåŸºæœ¬ä½¿ç”¨ä»‹ç»å®Œæˆã€‚\næœ¬äººä½¿ç”¨è¯¥æ–¹å¼æ­å»ºå„ç§é›†ç¾¤ã€‚ä¾‹å¦‚redisã€kafkaã€zookeeperã€kubernetesç­‰ã€‚æ–¹ä¾¿å¿«æ·ï¼\n\næ¢¦æƒ³è¶Šæ˜¯ç¾ä¸½ï¼Œå°±è¶Šæ˜¯æ˜¾å¾—é¥ä¸å¯åŠã€‚å¯å¥‡æ€ªçš„æ˜¯ï¼Œä¸€æ—¦ä½ ä¸‹å®šäº†å†³å¿ƒï¼Œå¾ˆå¿«åœ°ï¼Œé‚£äº›æ¢¦æƒ³å°±ä¸€ä¸€æˆä¸ºäº†ç°å®ï¼","slug":"ubuntu-multipass","date":"2022-04-24T08:42:43.000Z","categories_index":"ubuntu,multipass,è™šæ‹Ÿæœº","tags_index":"multipass,ubuntu","author_index":"ITLab"},{"id":"40ea842bde81b9af210ab16629bae6dd","title":"Spring-Secutity-Oauth2å®ç°Auth Server(æ—§ç‰ˆ)","content":"\n\n\n\n\n\n\n\n\nå‰è¨€\nOauth2æˆæƒæ˜¯é¡¹ç›®ä¸­ä½¿ç”¨å¾ˆå¤šçš„åè®®ï¼Œåœ¨ä¸‰æ–¹æˆæƒä¸­æœ‰è¿™å¾ˆå¤§çš„åº”ç”¨ã€‚\n\nspring å®˜æ–¹å®£å¸ƒåœ¨spring-security5ä»¥ååˆ é™¤æ‰Authorization Serverç›¸å…³åŠŸèƒ½ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ç¬¬ä¸‰æ–¹oauth2æœåŠ¡å™¨ï¼Œä¾‹å¦‚keycloakã€‚ä½œä¸ºspringçš„å¿ å®èˆ”ç‹—ï¼Œæˆ‘è·Ÿå¾ˆå¤šå¼€å‘è€…ä¸€æ ·å¯¹springçš„è¿™ä¸ªå®£å¸ƒä¸èƒ½è®¤åŒï¼Œspring è¿«äºå¯¹å¹¿å¤§å¼€å‘è€…å¼ºçƒˆä¸æ»¡å’Œè¿«åˆ‡éœ€æ±‚ï¼Œè§‰å¾—å¦å¼€ä¸€ä¸ªé¡¹ç›®ï¼ˆSpring Authorization Serverï¼‰. æ—¶é—´è¿‡å»å¾ˆä¹…äº†ã€‚ç¤¾åŒºä¸€ç›´åœ¨å¼€å‘ä¸­ã€‚\n\nåœ¨å¼€å‘è¿‡ç¨‹ä¸­ç¤¾åŒºå°†jaråŒ…ä¸Šä¼ åˆ°maven centralï¼Œä¾‹å¦‚0.1.0-0.1.2ç‰ˆæœ¬ï¼Œä½†æ˜¯éƒ½æœªæ˜æ–‡è¯´æ˜å¯ä»¥ä½¿ç”¨åˆ°ç”Ÿäº§ç¯å¢ƒã€‚\n\nè¿‘æœŸspring å®˜æ–¹å‘å¸ƒäº†å‡ ä¸ªé€šçŸ¥ï¼š\n\n\n2021å¹´8æœˆ17æ—¥ï¼Œé€šçŸ¥ï¼šSpring Authorization Serverè¿ç§»åˆ°spring projects\n  \n\n2021å¹´8æœˆ19æ—¥ï¼Œé€šçŸ¥Spring Authorization Server ç”Ÿäº§ç¯å¢ƒå¯ç”¨ã€‚ï¼ˆå…¶å®è¿™å‡ å¤©å®˜æ–¹çš„é€šçŸ¥æœ‰å˜åŒ–ï¼Œæ¯”å¦‚å…ˆå‘çš„æ–‡æ¡£ï¼Œä¸Šé¢æœªå†™maven centralä¸Šçš„jaråœ°å€ã€‚ä¹Ÿå¯ä»¥ç†è§£ï¼Œäº‹æƒ…è¦ä¸€æ­¥ä¸€æ­¥åšçš„å˜›ğŸ˜ï¼‰\n\nçœ‹åˆ°è¯¥é€šçŸ¥åï¼Œæƒ³å°è¯•ä¸‹ã€‚äºæ˜¯è¿›å…¥ä»“åº“åœ°å€ï¼ˆhttps://github.com/spring-projects/spring-authorization-serverï¼‰ï¼Œæœªå‘ç°æœ‰ä½¿ç”¨æ–‡æ¡£ï¼Œåªæœ‰æºç å’Œä½¿ç”¨ç¤ºä¾‹ã€‚\nå› æ­¤æœ‰äº›æŠµè§¦ï¼Œæ²¡æœ‰æ–‡æ¡£ä½¿ç”¨éš¾åº¦è¾ƒå¤§ï¼Œæ— æ³•æ·±å…¥ç†è§£å¼€å‘è€…æ€æƒ³ã€‚æ‰€ä»¥æƒ³å†ç­‰ç­‰ã€‚\n\næ­¤æ—¶æƒ³èµ·ä»¥å‰çš„oauth2å®ç°æ–¹æ¡ˆï¼Œæƒ³åšä¸ªå¤ä¹ ï¼Œæ‰€ä»¥æƒ³å†™ä¸ªdemoã€‚è®°å½•ä¸‹æ¥ã€‚ä¹Ÿç»™å…¶ä»–å­¦è€…ä¸€ä¸ªå‚è€ƒã€‚å› æ­¤å†™ä¸‹æ­¤demoã€‚\n\nä¹‹åæˆ‘ä¼šä½¿ç”¨Spring Authorization Server ä¾èµ–ï¼Œå†æ¬¡å®ç°è·Ÿæœ¬demoä¸€æ ·çš„ä¾‹å­ï¼Œæ•¬è¯·å…³æ³¨ã€‚\n\n\n\nä»€ä¹ˆæ˜¯Oauth2.0\næœ¬æ–‡ä¸ä½œèµ˜è¿°ï¼Œç½‘ä¸Šæ–‡ç« è¾ƒå¤šã€‚æ¨èå‡ ä¸ªï¼Œhttps://www.ruanyifeng.com/blog/2019/04/oauth-grant-types.htmlï¼Œ https://oauth.net/2/ ã€‚https://zhuanlan.zhihu.com/p/84670338ã€‚\n\n\nä½¿ç”¨Spring Securityå’ŒSpring Security Oauth2ä¾èµ–å®ç°\n\nè¯´æ˜\nspring Bootï¼š 2.3.4.RELEASE\nspring-Security-oauth2ï¼š2.5.1.RELEASE\njdk: 1.8\nå¼€å‘å·¥å…·: IDEA\nåŒ…ç®¡ç†å·¥å…·ï¼šMAVEN\n\né¡¹ç›®ç»“æ„\nauthorization-server \t\t\t\t\t\t&#x2F;&#x2F;æˆæƒæœåŠ¡å™¨moduleæ ¹ç›®å½•\nâ”œâ”€â”€ README.md\t\t\t\t\t\t\t\t\t\t&#x2F;&#x2F; è¯´æ˜æ–‡æ¡£\t\t\t\t\nâ”œâ”€â”€ authorization-server.iml\t\t&#x2F;&#x2F; ideaç³»ç»Ÿæ–‡ä»¶ï¼ˆå¿½ç•¥ï¼‰\nâ”œâ”€â”€ pom.xml\t\t\t\t\t\t\t\t\t\t\t&#x2F;&#x2F; mavenä¾èµ–ï¼ˆæ³¨æ„çˆ¶çº§ä¾èµ–ï¼‰\nâ””â”€â”€ src\t\t\t\t\t\t\t\t\t\t\t\t\t&#x2F;&#x2F; æºç è·¯å¾„\n    â”œâ”€â”€ main\n    â”‚   â”œâ”€â”€ java\n    â”‚   â”‚   â””â”€â”€ com\n    â”‚   â”‚       â””â”€â”€ xpp\n    â”‚   â”‚           â””â”€â”€ sslt5\n    â”‚   â”‚               â””â”€â”€ as\n    â”‚   â”‚                   â”œâ”€â”€ AuthorizationServerApplication.java &#x2F;&#x2F; å¯åŠ¨ç±»\n    â”‚   â”‚                   â”œâ”€â”€ config\n    â”‚   â”‚                   â”‚   â”œâ”€â”€ AuthorizationServerConfig.java  &#x2F;&#x2F; æˆæƒæœåŠ¡å™¨é…ç½®ç±»\n    â”‚   â”‚                   â”‚   â””â”€â”€ SecurityConfig.java\t\t\t\t\t\t\t&#x2F;&#x2F;securityå®‰å…¨é…ç½®\n    â”‚   â”‚                   â”œâ”€â”€ entity\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n    â”‚   â”‚                   â”‚   â””â”€â”€ Account.java\t\t\t\t\t\t\t\t\t\t\t\t&#x2F;&#x2F;ç”¨æˆ·å®ä½“ç±»\t\t\t\t\t\t\t\n    â”‚   â”‚                   â”œâ”€â”€ repository\n    â”‚   â”‚                   â”‚   â””â”€â”€ UserRepository.java\t\t\t\t\t\t\t&#x2F;&#x2F; è´¦æˆ·Dao\n    â”‚   â”‚                   â””â”€â”€ svc\n    â”‚   â”‚                       â””â”€â”€ UserDetailSvc.java\t\t\t\t\t\t\t&#x2F;&#x2F; security user Detailsç±»\n    â”‚   â””â”€â”€ resources\t\t\t\t\t\t\t\t\t\t\t\t&#x2F;&#x2F; æºæ–‡ä»¶ç›®å½•\n    â”‚       â”œâ”€â”€ application.yml\t\t\t\t\t\t\t&#x2F;&#x2F; spring boot é…ç½®æ–‡ä»¶\n    â”‚       â”œâ”€â”€ oauth2-data.sql\t\t\t\t&#x2F;&#x2F; åˆå§‹åŒ–oauth2æ•°æ®sql\n    â”‚       â”œâ”€â”€ import.sql\t\t\t\t\t\t\t\t\t&#x2F;&#x2F; jpaåˆå§‹åŒ–Accountè¡¨è¯­å¥\n    â”‚       â””â”€â”€ oauth2-schema.sql\t\t\t&#x2F;&#x2F; åˆå§‹åŒ–åˆ›å»ºoauth2ç›¸å…³è¡¨è¯­å¥\n    â””â”€â”€ test\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t&#x2F;&#x2F; æµ‹è¯•æºç è·¯å¾„\n        â””â”€â”€ java\n\nMavenä¾èµ–ï¼š\n&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;\n&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;\n         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;\n         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;\n    &lt;parent&gt;\n        &lt;artifactId&gt;spring-security-lt5-oauth2&lt;&#x2F;artifactId&gt;\n        &lt;groupId&gt;com.xpp&lt;&#x2F;groupId&gt;\n        &lt;version&gt;0.0.1&lt;&#x2F;version&gt;\n    &lt;&#x2F;parent&gt;\n    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;\n\n    &lt;artifactId&gt;authorization-server&lt;&#x2F;artifactId&gt;\n    &lt;version&gt;0.0.1&lt;&#x2F;version&gt;\n\n    &lt;properties&gt;\n        &lt;maven.compiler.source&gt;8&lt;&#x2F;maven.compiler.source&gt;\n        &lt;maven.compiler.target&gt;8&lt;&#x2F;maven.compiler.target&gt;\n    &lt;&#x2F;properties&gt;\n\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;&#x2F;artifactId&gt;\n        &lt;&#x2F;dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-security&lt;&#x2F;artifactId&gt;\n        &lt;&#x2F;dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;\n        &lt;&#x2F;dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.security&lt;&#x2F;groupId&gt;\n            &lt;artifactId&gt;spring-security-test&lt;&#x2F;artifactId&gt;\n            &lt;scope&gt;test&lt;&#x2F;scope&gt;\n        &lt;&#x2F;dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.security.oauth&lt;&#x2F;groupId&gt;\n            &lt;artifactId&gt;spring-security-oauth2&lt;&#x2F;artifactId&gt;\n            &lt;version&gt;2.5.1.RELEASE&lt;&#x2F;version&gt;\n        &lt;&#x2F;dependency&gt;\n        &lt;dependency&gt;\n          &lt;groupId&gt;com.h2database&lt;&#x2F;groupId&gt;\n          &lt;artifactId&gt;h2&lt;&#x2F;artifactId&gt;\n          &lt;scope&gt;runtime&lt;&#x2F;scope&gt;\n        &lt;&#x2F;dependency&gt;\n    &lt;&#x2F;dependencies&gt;\n&lt;&#x2F;project&gt;\n\nSecurity configç±»\npackage com.xpp.sslt5.as.config;\n\nimport com.xpp.sslt5.as.svc.UserDetailSvc;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.authentication.AuthenticationManager;\nimport org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;\nimport org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\nimport org.springframework.security.crypto.password.PasswordEncoder;\n\n@Configuration\npublic class SecurityConfig extends WebSecurityConfigurerAdapter &#123;\n    @Bean\n    public PasswordEncoder passwordEncoder() &#123;\n        return new BCryptPasswordEncoder();\n    &#125;\n\n    @Autowired\n    private UserDetailSvc userDetailSvc;\n\n    @Override\n    protected void configure(AuthenticationManagerBuilder auth) throws Exception &#123;\n        auth.userDetailsService(userDetailSvc).passwordEncoder(passwordEncoder());\n    &#125;\n\n\n    &#x2F;&#x2F; AuthenticationManager å¯¹è±¡åœ¨ OAuth2 è®¤è¯æœåŠ¡ä¸­è¦ä½¿ç”¨ï¼Œæå‰æ”¾å…¥ IOC å®¹å™¨ä¸­\n   \t&#x2F;&#x2F; å¿…é¡»ä½¿ç”¨@Beanæ³¨å…¥IOCå®¹å™¨ä¸­ï¼Œå¦åˆ™password grant_typeæ— æ•ˆã€‚\n    @Override\n    @Bean\n    public AuthenticationManager authenticationManagerBean() throws Exception &#123;\n        return super.authenticationManagerBean();\n    &#125;\n&#125;\n\n\n\n\nAuthorization Server Config é…ç½®ç±»\npackage com.xpp.sslt5.as.config;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.authentication.AuthenticationManager;\nimport org.springframework.security.oauth2.config.annotation.configurers.ClientDetailsServiceConfigurer;\nimport org.springframework.security.oauth2.config.annotation.web.configuration.AuthorizationServerConfigurerAdapter;\nimport org.springframework.security.oauth2.config.annotation.web.configuration.EnableAuthorizationServer;\nimport org.springframework.security.oauth2.config.annotation.web.configurers.AuthorizationServerEndpointsConfigurer;\nimport org.springframework.security.oauth2.config.annotation.web.configurers.AuthorizationServerSecurityConfigurer;\nimport org.springframework.security.oauth2.provider.ClientDetailsService;\nimport org.springframework.security.oauth2.provider.approval.ApprovalStore;\nimport org.springframework.security.oauth2.provider.approval.JdbcApprovalStore;\nimport org.springframework.security.oauth2.provider.client.JdbcClientDetailsService;\nimport org.springframework.security.oauth2.provider.code.AuthorizationCodeServices;\nimport org.springframework.security.oauth2.provider.code.JdbcAuthorizationCodeServices;\nimport org.springframework.security.oauth2.provider.token.AuthorizationServerTokenServices;\nimport org.springframework.security.oauth2.provider.token.DefaultTokenServices;\nimport org.springframework.security.oauth2.provider.token.TokenStore;\nimport org.springframework.security.oauth2.provider.token.store.JdbcTokenStore;\n\nimport javax.sql.DataSource;\n\n@Configuration\n@EnableAuthorizationServer\npublic class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter &#123;\n    &#x2F;&#x2F; æ•°æ®åº“è¿æ¥æ± å¯¹è±¡ï¼ŒSpringBoot é…ç½®å®Œæˆåè‡ªåŠ¨æ³¨å…¥\n    @Autowired\n    private DataSource dataSource;\n\n    &#x2F;&#x2F; æˆæƒæ¨¡å¼ä¸“ç”¨å¯¹è±¡ï¼Œåœ¨ Security é…ç½®ä¸­æ³¨å…¥å®¹å™¨\n    @Autowired\n    private AuthenticationManager authenticationManager;\n\n    &#x2F;&#x2F; å®¢æˆ·ç«¯ä¿¡æ¯æ¥æº\n    @Bean\n    public ClientDetailsService jdbcClientDetailsService() &#123;\n        return new JdbcClientDetailsService(dataSource);\n    &#125;\n\n    &#x2F;&#x2F; token ä¿å­˜ç­–ç•¥ï¼ŒæŒ‡ä½ ç”Ÿæˆçš„ Token è¦å¾€å“ªé‡Œå­˜å‚¨\n    &#x2F;&#x2F;JdbcTokenStore ï¼Œ InMemoryTokenStoreï¼Œ JwkTokenStoreï¼ŒJwtTokenStore, RedisTokenStore\n    @Bean\n    public TokenStore tokenStore() &#123;\n        return new JdbcTokenStore(dataSource);\n    &#125;\n\n    &#x2F;&#x2F; æŒ‡å®šå®¢æˆ·ç«¯ä¿¡æ¯çš„æ•°æ®åº“æ¥æº\n    @Override\n    public void configure(ClientDetailsServiceConfigurer clients) throws Exception &#123;\n        clients.withClientDetails(jdbcClientDetailsService());\n    &#125;\n\n\n    &#x2F;&#x2F; æˆæƒä¿¡æ¯ä¿å­˜ç­–ç•¥\n    @Bean\n    public ApprovalStore approvalStore() &#123;\n        return new JdbcApprovalStore(dataSource);\n    &#125;\n\n    &#x2F;&#x2F; æˆæƒç æ¨¡å¼æ•°æ®æ¥æº\n    @Bean\n    public AuthorizationCodeServices authorizationCodeServices() &#123;\n        return new JdbcAuthorizationCodeServices(dataSource);\n    &#125;\n\n\n    &#x2F;&#x2F; ä»¤ç‰Œç®¡ç†\n    @Bean\n    public AuthorizationServerTokenServices tokenServices() &#123;\n        DefaultTokenServices tokenServices &#x3D; new DefaultTokenServices();\n        &#x2F;&#x2F; token ä¿å­˜ç­–ç•¥\n        tokenServices.setTokenStore(tokenStore());\n        &#x2F;&#x2F; æ”¯æŒåˆ·æ–°æ¨¡å¼\n        tokenServices.setSupportRefreshToken(true);\n        &#x2F;&#x2F; å®¢æˆ·ç«¯ä¿¡æ¯æ¥æº\n        tokenServices.setClientDetailsService(jdbcClientDetailsService());\n        &#x2F;&#x2F; token æœ‰æ•ˆæœŸè‡ªå®šä¹‰è®¾ç½®ï¼Œé»˜è®¤ 12 å°æ—¶\n        tokenServices.setAccessTokenValiditySeconds(60 * 60 * 12);\n        &#x2F;&#x2F; refresh token æœ‰æ•ˆæœŸè‡ªå®šä¹‰è®¾ç½®ï¼Œé»˜è®¤ 30 å¤©\n        tokenServices.setRefreshTokenValiditySeconds(60 * 60 * 24 * 7);\n\n        return tokenServices;\n    &#125;\n\n    &#x2F;&#x2F; æ£€æŸ¥ token çš„ç­–ç•¥ï¼Œå³é…ç½®ä»¤ç‰Œç«¯ç‚¹çš„å®‰å…¨çº¦æŸ\n    &#x2F;&#x2F; å°±æ˜¯è¿™ä¸ªç«¯ç‚¹è°èƒ½è®¿é—®ï¼Œè°ä¸èƒ½è®¿é—®\n    @Override\n    public void configure(AuthorizationServerSecurityConfigurer security) &#123;\n        &#x2F;&#x2F; æ­¤æ—¶æŒ‡ endpoint å®Œå…¨å…¬å¼€\n        security.tokenKeyAccess(&quot;permitAll()&quot;);\n        &#x2F;&#x2F; checkToken è¿™ä¸ª endpoint å®Œå…¨å…¬å¼€\n        security.checkTokenAccess(&quot;permitAll()&quot;);\n        &#x2F;&#x2F; æ˜¯å¦å…è®¸è¡¨å•è®¤è¯\n        security.allowFormAuthenticationForClients();\n\n    &#125;\n\n    &#x2F;&#x2F; OAuth2 çš„ä¸»é…ç½®ä¿¡æ¯\n    @Override\n    public void configure(AuthorizationServerEndpointsConfigurer endpoints) &#123;\n        endpoints\n                .approvalStore(approvalStore())\n                .authenticationManager(authenticationManager)\n                .authorizationCodeServices(authorizationCodeServices())\n                .tokenServices(tokenServices());\n    &#125;\n&#125;\n\n\nUserDetailSvcç±»\npackage com.xpp.sslt5.as.svc;\n\nimport com.xpp.sslt5.as.entity.Account;\nimport com.xpp.sslt5.as.repository.AccountRepository;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.security.core.GrantedAuthority;\nimport org.springframework.security.core.authority.SimpleGrantedAuthority;\nimport org.springframework.security.core.userdetails.User;\nimport org.springframework.security.core.userdetails.UserDetails;\nimport org.springframework.security.core.userdetails.UserDetailsService;\nimport org.springframework.security.core.userdetails.UsernameNotFoundException;\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\nimport org.springframework.stereotype.Component;\n\nimport java.util.*;\nimport java.util.stream.Collectors;\n\n@Component\npublic class UserDetailSvc implements UserDetailsService &#123;\n    @Autowired\n    private AccountRepository userRepository;\n    @Override\n    public UserDetails loadUserByUsername(String s) throws UsernameNotFoundException &#123;\n        List&lt;GrantedAuthority&gt; grantedAuths &#x3D; new ArrayList&lt;&gt;();\n        Account account &#x3D; userRepository.findByUsername(s);\n        if (Objects.isNull(account)) &#123;\n            throw new UsernameNotFoundException(&quot;No user found with username: &quot; + s);\n        &#125;\n        Arrays.stream(account.getRoleIdentifies().split(&quot;,&quot;)).collect(Collectors.toSet())\n                .forEach(x-&gt; grantedAuths.add(new SimpleGrantedAuthority(x)));\n        return new User(account.getUsername(), account.getPassword(), grantedAuths);\n    &#125;\n\n    public static void main(String[] args) &#123;\n        System.out.println(new BCryptPasswordEncoder().encode(&quot;xpp&quot;));\n    &#125;\n&#125;\n\nä»¥ä¸Šåªæ˜¯ç®€å•çš„ç´¯å‡ºæ¥é‡è¦æ–‡ä»¶ï¼Œå…¶ä»–é…ç½®æ–‡ä»¶è¯·è‡ªè¡Œå»githubä¸ŠæŸ¥çœ‹ã€‚\n\n\n\næµ‹è¯•ï¼ˆé‡ç‚¹ï¼‰\n\næˆæƒç æ¨¡å¼\nå¯åŠ¨é¡¹ç›®åï¼Œæ‰“å¼€æµè§ˆå™¨è¾“å…¥ï¼š\nhttp://localhost:8080/oauth/authorize?response_type=code&amp;client_id=xpp\nå‡ºç°å¦‚ä¸‹ç•Œé¢ï¼š\n\nå‡ºç°ä¸Šè¿°ç•Œé¢åï¼Œè¾“å…¥ç”¨æˆ·åå¯†ç (a1,a2,a3çš†å¯ï¼Œå¯†ç éƒ½æ˜¯xpp):\n\næŒ‰ç…§ä¸Šå›¾ç‚¹å‡»ï¼ŒAuthorizeæŒ‰é’®ã€‚\nå› ä¸ºæˆ‘é…ç½®çš„redirect_uriæ˜¯ç™¾åº¦ï¼Œå¦‚å›¾ï¼š\n\næˆ‘ä»¬çœ‹åˆ°ç™¾åº¦åé¢è·Ÿäº†ä¸ªcodeï¼Œå¤åˆ¶è¿™ä¸ªcodeå€¼ï¼Œæ‰“å¼€postmanè·å–tokenï¼š\næ³¨æ„clientå’Œsecretçš„æˆæƒ\n\nä¼ é€’å‚æ•°ç•Œé¢ï¼š\n\nå‘é€è¯·æ±‚è¿”å›çš„ç•Œé¢ï¼š\n\næµ‹è¯•åˆ·æ–°tokenï¼š\n\næˆ‘ä»¬çœ‹åˆ°access_tokenè·Ÿä¹‹å‰è·å–çš„å˜åŒ–äº†ï¼Œrefresh_tokenæœªå˜åŒ–ã€‚\n\nç®€åŒ–æ¨¡å¼\nè®¿é—®ç®€åŒ–æ¨¡å¼åœ°å€ï¼šhttp://localhost:8080/oauth/authorize?response_type=token&amp;client_id=xpp\nè¾“å…¥ç”¨æˆ·åå¯†ç ï¼ˆåŒä¸€ä¸ªclientä¸‹çš„ç”¨æˆ·å¦‚æœæˆæƒè¿‡ä¸ä¼šå‡ºç°ç™»å½•ç•Œé¢ï¼‰ï¼Œè¾“å…¥å¯†ç ç™»å½•å, ç‚¹å‡»æˆæƒå’ŒauthorizeæŒ‰é’®ï¼Œæµè§ˆå™¨è‡ªåŠ¨è·³è½¬åˆ°ç™¾åº¦ï¼Œåœ°å€æ¥ä¸ºï¼šhttps://www.baidu.com/#access_token=Pfa4YiIoN3Z1C2e1q-GV_E023C4&amp;token_type=bearer&amp;expires_in=43199&amp;scope=read\næˆ‘ä»¬çœ‹åˆ°çœå»äº†è¯·æ±‚oauth&#x2F;tokenï¼Œç›´æ¥åœ¨å›è°ƒåœ°å€ä¸­çœ‹åˆ°äº†access_token. è¿™å°±æ˜¯ç®€åŒ–æ¨¡å¼ã€‚\n\nå¯†ç æ¨¡å¼\n\n\nåˆ·æ–°tokenæ­¤å¤„ä¸å†ä¸¾ä¾‹æµ‹è¯•ã€‚\n\nå®¢æˆ·ç«¯æ¨¡å¼\n\n\n\n\n\n\n\n\n\n\n\n\n\nä»¥ä¸Šå°±è®²oauth2çš„åŠŸèƒ½åŸºæœ¬å®Œæˆï¼Œå¯¹äºinmemoryå’Œredisçš„æ–¹å¼æ²¡æœ‰ä¸¾ä¾‹ã€‚\nè¿™é‡Œè¿˜æœ‰ä¸¤ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€ä¸ªï¼šè·å–çš„tokenå¦‚ä½•ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯authorization clientå’Œ resource serverï¼ŒåæœŸæ…¢æ…¢è¡¥å……ã€‚\nç¬¬äºŒä¸ªï¼šç™»å½•ç”¨æˆ·å’Œclientç»´æŠ¤åº”è¯¥é€šè¿‡æ¥å£æä¾›åˆ›å»ºæ›´æ–°ç­‰æ–¹ä½æ–¹å¼ã€‚åæœŸæ…¢æ…¢è¡¥å……ã€‚\n\n\n\n\n\n\n\n\n\næœ¬æ–‡ä½¿ç”¨çš„äº‹spring-security-oauth2å®ç°ï¼Œåœ¨spring security 5ä»¥åå·²ç»å¼ƒç”¨ï¼Œåç»­ä¼šå•ç‹¬ä½¿ç”¨securityå®ç°ã€‚æ•¬è¯·æœŸå¾…ï¼ŒæœŸå¾…æ‚¨çš„å…³æ³¨ã€‚æœŸå¾…æ‚¨çš„æ„è§ã€‚\n\n\n\n\n\n\n\n\n\næºç åœ°å€ï¼šhttps://github.com/ITLab1024/spring-security-lt5-oauth2\n","slug":"Spring-Secutity-Oauth2-Demo","date":"2022-04-23T13:35:50.000Z","categories_index":"Java,Spring Security,Spring-Secutiry-Oauth2","tags_index":"Spring Security Oauth2","author_index":"ITLab"},{"id":"c6e4902349bc052e9c4272ae807ca5e6","title":"kubernetes-é»‘é©¬ç¨‹åºå‘˜","content":"Kubernetes\n1. Kubernetesä»‹ç»1.1 åº”ç”¨éƒ¨ç½²æ–¹å¼æ¼”å˜åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºçš„æ–¹å¼ä¸Šï¼Œä¸»è¦ç»å†äº†ä¸‰ä¸ªæ—¶ä»£ï¼š\n\nä¼ ç»Ÿéƒ¨ç½²ï¼šäº’è”ç½‘æ—©æœŸï¼Œä¼šç›´æ¥å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åœ¨ç‰©ç†æœºä¸Š\n\n\n\n\n\n\n\n\n\nä¼˜ç‚¹ï¼šç®€å•ï¼Œä¸éœ€è¦å…¶å®ƒæŠ€æœ¯çš„å‚ä¸\nç¼ºç‚¹ï¼šä¸èƒ½ä¸ºåº”ç”¨ç¨‹åºå®šä¹‰èµ„æºä½¿ç”¨è¾¹ç•Œï¼Œå¾ˆéš¾åˆç†åœ°åˆ†é…è®¡ç®—èµ„æºï¼Œè€Œä¸”ç¨‹åºä¹‹é—´å®¹æ˜“äº§ç”Ÿå½±å“\n\nè™šæ‹ŸåŒ–éƒ¨ç½²ï¼šå¯ä»¥åœ¨ä¸€å°ç‰©ç†æœºä¸Šè¿è¡Œå¤šä¸ªè™šæ‹Ÿæœºï¼Œæ¯ä¸ªè™šæ‹Ÿæœºéƒ½æ˜¯ç‹¬ç«‹çš„ä¸€ä¸ªç¯å¢ƒ\n\n\n\n\n\n\n\n\n\nä¼˜ç‚¹ï¼šç¨‹åºç¯å¢ƒä¸ä¼šç›¸äº’äº§ç”Ÿå½±å“ï¼Œæä¾›äº†ä¸€å®šç¨‹åº¦çš„å®‰å…¨æ€§\nç¼ºç‚¹ï¼šå¢åŠ äº†æ“ä½œç³»ç»Ÿï¼Œæµªè´¹äº†éƒ¨åˆ†èµ„æº\n\nå®¹å™¨åŒ–éƒ¨ç½²ï¼šä¸è™šæ‹ŸåŒ–ç±»ä¼¼ï¼Œä½†æ˜¯å…±äº«äº†æ“ä½œç³»ç»Ÿ\n\n\n\n\n\n\n\n\n\nä¼˜ç‚¹ï¼š\nå¯ä»¥ä¿è¯æ¯ä¸ªå®¹å™¨æ‹¥æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€CPUã€å†…å­˜ã€è¿›ç¨‹ç©ºé—´ç­‰\nè¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€è¦çš„èµ„æºéƒ½è¢«å®¹å™¨åŒ…è£…ï¼Œå¹¶å’Œåº•å±‚åŸºç¡€æ¶æ„è§£è€¦\nå®¹å™¨åŒ–çš„åº”ç”¨ç¨‹åºå¯ä»¥è·¨äº‘æœåŠ¡å•†ã€è·¨Linuxæ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆè¿›è¡Œéƒ¨ç½²\n\n\n\nå®¹å™¨åŒ–éƒ¨ç½²æ–¹å¼ç»™å¸¦æ¥å¾ˆå¤šçš„ä¾¿åˆ©ï¼Œä½†æ˜¯ä¹Ÿä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚è¯´ï¼š\n\nä¸€ä¸ªå®¹å™¨æ•…éšœåœæœºäº†ï¼Œæ€ä¹ˆæ ·è®©å¦å¤–ä¸€ä¸ªå®¹å™¨ç«‹åˆ»å¯åŠ¨å»æ›¿è¡¥åœæœºçš„å®¹å™¨\nå½“å¹¶å‘è®¿é—®é‡å˜å¤§çš„æ—¶å€™ï¼Œæ€ä¹ˆæ ·åšåˆ°æ¨ªå‘æ‰©å±•å®¹å™¨æ•°é‡\n\nè¿™äº›å®¹å™¨ç®¡ç†çš„é—®é¢˜ç»Ÿç§°ä¸ºå®¹å™¨ç¼–æ’é—®é¢˜ï¼Œä¸ºäº†è§£å†³è¿™äº›å®¹å™¨ç¼–æ’é—®é¢˜ï¼Œå°±äº§ç”Ÿäº†ä¸€äº›å®¹å™¨ç¼–æ’çš„è½¯ä»¶ï¼š\n\nSwarmï¼šDockerè‡ªå·±çš„å®¹å™¨ç¼–æ’å·¥å…·\nMesosï¼šApacheçš„ä¸€ä¸ªèµ„æºç»Ÿä¸€ç®¡æ§çš„å·¥å…·ï¼Œéœ€è¦å’ŒMarathonç»“åˆä½¿ç”¨\nKubernetesï¼šGoogleå¼€æºçš„çš„å®¹å™¨ç¼–æ’å·¥å…·\n\n\n1.2 kubernetesç®€ä»‹\nkubernetesï¼Œæ˜¯ä¸€ä¸ªå…¨æ–°çš„åŸºäºå®¹å™¨æŠ€æœ¯çš„åˆ†å¸ƒå¼æ¶æ„é¢†å…ˆæ–¹æ¡ˆï¼Œæ˜¯è°·æ­Œä¸¥æ ¼ä¿å¯†åå‡ å¹´çš„ç§˜å¯†æ­¦å™¨â€”-Borgç³»ç»Ÿçš„ä¸€ä¸ªå¼€æºç‰ˆæœ¬ï¼Œäº2014å¹´9æœˆå‘å¸ƒç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œ2015å¹´7æœˆå‘å¸ƒç¬¬ä¸€ä¸ªæ­£å¼ç‰ˆæœ¬ã€‚\nkubernetesçš„æœ¬è´¨æ˜¯ä¸€ç»„æœåŠ¡å™¨é›†ç¾¤ï¼Œå®ƒå¯ä»¥åœ¨é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œç‰¹å®šçš„ç¨‹åºï¼Œæ¥å¯¹èŠ‚ç‚¹ä¸­çš„å®¹å™¨è¿›è¡Œç®¡ç†ã€‚ç›®çš„æ˜¯å®ç°èµ„æºç®¡ç†çš„è‡ªåŠ¨åŒ–ï¼Œä¸»è¦æä¾›äº†å¦‚ä¸‹çš„ä¸»è¦åŠŸèƒ½ï¼š\n\nè‡ªæˆ‘ä¿®å¤ï¼šä¸€æ—¦æŸä¸€ä¸ªå®¹å™¨å´©æºƒï¼Œèƒ½å¤Ÿåœ¨1ç§’ä¸­å·¦å³è¿…é€Ÿå¯åŠ¨æ–°çš„å®¹å™¨\nå¼¹æ€§ä¼¸ç¼©ï¼šå¯ä»¥æ ¹æ®éœ€è¦ï¼Œè‡ªåŠ¨å¯¹é›†ç¾¤ä¸­æ­£åœ¨è¿è¡Œçš„å®¹å™¨æ•°é‡è¿›è¡Œè°ƒæ•´\næœåŠ¡å‘ç°ï¼šæœåŠ¡å¯ä»¥é€šè¿‡è‡ªåŠ¨å‘ç°çš„å½¢å¼æ‰¾åˆ°å®ƒæ‰€ä¾èµ–çš„æœåŠ¡\nè´Ÿè½½å‡è¡¡ï¼šå¦‚æœä¸€ä¸ªæœåŠ¡èµ·åŠ¨äº†å¤šä¸ªå®¹å™¨ï¼Œèƒ½å¤Ÿè‡ªåŠ¨å®ç°è¯·æ±‚çš„è´Ÿè½½å‡è¡¡\nç‰ˆæœ¬å›é€€ï¼šå¦‚æœå‘ç°æ–°å‘å¸ƒçš„ç¨‹åºç‰ˆæœ¬æœ‰é—®é¢˜ï¼Œå¯ä»¥ç«‹å³å›é€€åˆ°åŸæ¥çš„ç‰ˆæœ¬\nå­˜å‚¨ç¼–æ’ï¼šå¯ä»¥æ ¹æ®å®¹å™¨è‡ªèº«çš„éœ€æ±‚è‡ªåŠ¨åˆ›å»ºå­˜å‚¨å·\n\n1.3 kubernetesç»„ä»¶ä¸€ä¸ªkubernetesé›†ç¾¤ä¸»è¦æ˜¯ç”±**æ§åˆ¶èŠ‚ç‚¹(master)ã€å·¥ä½œèŠ‚ç‚¹(node)**æ„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½ä¼šå®‰è£…ä¸åŒçš„ç»„ä»¶ã€‚\nmasterï¼šé›†ç¾¤çš„æ§åˆ¶å¹³é¢ï¼Œè´Ÿè´£é›†ç¾¤çš„å†³ç­– ( ç®¡ç† )\n\n\n\n\n\n\n\n\n\nApiServer : èµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œæ¥æ”¶ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ï¼Œæä¾›è®¤è¯ã€æˆæƒã€APIæ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶\nScheduler : è´Ÿè´£é›†ç¾¤èµ„æºè°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°†Podè°ƒåº¦åˆ°ç›¸åº”çš„nodeèŠ‚ç‚¹ä¸Š\nControllerManager : è´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚ç¨‹åºéƒ¨ç½²å®‰æ’ã€æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰\nEtcd ï¼šè´Ÿè´£å­˜å‚¨é›†ç¾¤ä¸­å„ç§èµ„æºå¯¹è±¡çš„ä¿¡æ¯\nnodeï¼šé›†ç¾¤çš„æ•°æ®å¹³é¢ï¼Œè´Ÿè´£ä¸ºå®¹å™¨æä¾›è¿è¡Œç¯å¢ƒ ( å¹²æ´» )\n\n\n\n\n\n\n\n\n\nKubelet : è´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå³é€šè¿‡æ§åˆ¶dockerï¼Œæ¥åˆ›å»ºã€æ›´æ–°ã€é”€æ¯å®¹å™¨\nKubeProxy : è´Ÿè´£æä¾›é›†ç¾¤å†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡\nDocker : è´Ÿè´£èŠ‚ç‚¹ä¸Šå®¹å™¨çš„å„ç§æ“ä½œ\n\nä¸‹é¢ï¼Œä»¥éƒ¨ç½²ä¸€ä¸ªnginxæœåŠ¡æ¥è¯´æ˜kubernetesç³»ç»Ÿå„ä¸ªç»„ä»¶è°ƒç”¨å…³ç³»ï¼š\n\né¦–å…ˆè¦æ˜ç¡®ï¼Œä¸€æ—¦kubernetesç¯å¢ƒå¯åŠ¨ä¹‹åï¼Œmasterå’Œnodeéƒ½ä¼šå°†è‡ªèº«çš„ä¿¡æ¯å­˜å‚¨åˆ°etcdæ•°æ®åº“ä¸­\n\nä¸€ä¸ªnginxæœåŠ¡çš„å®‰è£…è¯·æ±‚ä¼šé¦–å…ˆè¢«å‘é€åˆ°masterèŠ‚ç‚¹çš„apiServerç»„ä»¶\n\napiServerç»„ä»¶ä¼šè°ƒç”¨schedulerç»„ä»¶æ¥å†³å®šåˆ°åº•åº”è¯¥æŠŠè¿™ä¸ªæœåŠ¡å®‰è£…åˆ°å“ªä¸ªnodeèŠ‚ç‚¹ä¸Š\nåœ¨æ­¤æ—¶ï¼Œå®ƒä¼šä»etcdä¸­è¯»å–å„ä¸ªnodeèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œç„¶åæŒ‰ç…§ä¸€å®šçš„ç®—æ³•è¿›è¡Œé€‰æ‹©ï¼Œå¹¶å°†ç»“æœå‘ŠçŸ¥apiServer\n\napiServerè°ƒç”¨controller-managerå»è°ƒåº¦NodeèŠ‚ç‚¹å®‰è£…nginxæœåŠ¡\n\nkubeletæ¥æ”¶åˆ°æŒ‡ä»¤åï¼Œä¼šé€šçŸ¥dockerï¼Œç„¶åç”±dockeræ¥å¯åŠ¨ä¸€ä¸ªnginxçš„pod\npodæ˜¯kubernetesçš„æœ€å°æ“ä½œå•å…ƒï¼Œå®¹å™¨å¿…é¡»è·‘åœ¨podä¸­è‡³æ­¤ï¼Œ\n\nä¸€ä¸ªnginxæœåŠ¡å°±è¿è¡Œäº†ï¼Œå¦‚æœéœ€è¦è®¿é—®nginxï¼Œå°±éœ€è¦é€šè¿‡kube-proxyæ¥å¯¹podäº§ç”Ÿè®¿é—®çš„ä»£ç†\n\n\nè¿™æ ·ï¼Œå¤–ç•Œç”¨æˆ·å°±å¯ä»¥è®¿é—®é›†ç¾¤ä¸­çš„nginxæœåŠ¡äº†\n1.4 kubernetesæ¦‚å¿µMasterï¼šé›†ç¾¤æ§åˆ¶èŠ‚ç‚¹ï¼Œæ¯ä¸ªé›†ç¾¤éœ€è¦è‡³å°‘ä¸€ä¸ªmasterèŠ‚ç‚¹è´Ÿè´£é›†ç¾¤çš„ç®¡æ§\nNodeï¼šå·¥ä½œè´Ÿè½½èŠ‚ç‚¹ï¼Œç”±masteråˆ†é…å®¹å™¨åˆ°è¿™äº›nodeå·¥ä½œèŠ‚ç‚¹ä¸Šï¼Œç„¶ånodeèŠ‚ç‚¹ä¸Šçš„dockerè´Ÿè´£å®¹å™¨çš„è¿è¡Œ\nPodï¼škubernetesçš„æœ€å°æ§åˆ¶å•å…ƒï¼Œå®¹å™¨éƒ½æ˜¯è¿è¡Œåœ¨podä¸­çš„ï¼Œä¸€ä¸ªpodä¸­å¯ä»¥æœ‰1ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨\nControllerï¼šæ§åˆ¶å™¨ï¼Œé€šè¿‡å®ƒæ¥å®ç°å¯¹podçš„ç®¡ç†ï¼Œæ¯”å¦‚å¯åŠ¨podã€åœæ­¢podã€ä¼¸ç¼©podçš„æ•°é‡ç­‰ç­‰\nServiceï¼špodå¯¹å¤–æœåŠ¡çš„ç»Ÿä¸€å…¥å£ï¼Œä¸‹é¢å¯ä»¥ç»´æŠ¤è€…åŒä¸€ç±»çš„å¤šä¸ªpod\nLabelï¼šæ ‡ç­¾ï¼Œç”¨äºå¯¹podè¿›è¡Œåˆ†ç±»ï¼ŒåŒä¸€ç±»podä¼šæ‹¥æœ‰ç›¸åŒçš„æ ‡ç­¾\nNameSpaceï¼šå‘½åç©ºé—´ï¼Œç”¨æ¥éš”ç¦»podçš„è¿è¡Œç¯å¢ƒ\n2. kubernetesé›†ç¾¤ç¯å¢ƒæ­å»º2.1 å‰ç½®çŸ¥è¯†ç‚¹ç›®å‰ç”Ÿäº§éƒ¨ç½²Kubernetes é›†ç¾¤ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š\nkubeadm\nKubeadm æ˜¯ä¸€ä¸ªK8s éƒ¨ç½²å·¥å…·ï¼Œæä¾›kubeadm init å’Œkubeadm joinï¼Œç”¨äºå¿«é€Ÿéƒ¨ç½²Kubernetes é›†ç¾¤ã€‚\nå®˜æ–¹åœ°å€ï¼šhttps://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/\näºŒè¿›åˆ¶åŒ…\nä»github ä¸‹è½½å‘è¡Œç‰ˆçš„äºŒè¿›åˆ¶åŒ…ï¼Œæ‰‹åŠ¨éƒ¨ç½²æ¯ä¸ªç»„ä»¶ï¼Œç»„æˆKubernetes é›†ç¾¤ã€‚\nKubeadm é™ä½éƒ¨ç½²é—¨æ§›ï¼Œä½†å±è”½äº†å¾ˆå¤šç»†èŠ‚ï¼Œé‡åˆ°é—®é¢˜å¾ˆéš¾æ’æŸ¥ã€‚å¦‚æœæƒ³æ›´å®¹æ˜“å¯æ§ï¼Œæ¨èä½¿ç”¨äºŒè¿›åˆ¶åŒ…éƒ¨ç½²Kubernetes é›†ç¾¤ï¼Œè™½ç„¶æ‰‹åŠ¨éƒ¨ç½²éº»çƒ¦ç‚¹ï¼ŒæœŸé—´å¯ä»¥å­¦ä¹ å¾ˆå¤šå·¥ä½œåŸç†ï¼Œä¹Ÿåˆ©äºåæœŸç»´æŠ¤ã€‚\n\n2.2 kubeadm éƒ¨ç½²æ–¹å¼ä»‹ç»kubeadm æ˜¯å®˜æ–¹ç¤¾åŒºæ¨å‡ºçš„ä¸€ä¸ªç”¨äºå¿«é€Ÿéƒ¨ç½²kubernetes é›†ç¾¤çš„å·¥å…·ï¼Œè¿™ä¸ªå·¥å…·èƒ½é€šè¿‡ä¸¤æ¡æŒ‡ä»¤å®Œæˆä¸€ä¸ªkubernetes é›†ç¾¤çš„éƒ¨ç½²ï¼š\n\nåˆ›å»ºä¸€ä¸ªMaster èŠ‚ç‚¹kubeadm init\nå°†Node èŠ‚ç‚¹åŠ å…¥åˆ°å½“å‰é›†ç¾¤ä¸­$ kubeadm join &lt;Master èŠ‚ç‚¹çš„IP å’Œç«¯å£&gt;\n\n2.3 å®‰è£…è¦æ±‚åœ¨å¼€å§‹ä¹‹å‰ï¼Œéƒ¨ç½²Kubernetes é›†ç¾¤æœºå™¨éœ€è¦æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªæ¡ä»¶ï¼š\n\nä¸€å°æˆ–å¤šå°æœºå™¨ï¼Œæ“ä½œç³»ç»ŸCentOS7.x-86_x64\nç¡¬ä»¶é…ç½®ï¼š2GB æˆ–æ›´å¤šRAMï¼Œ2 ä¸ªCPU æˆ–æ›´å¤šCPUï¼Œç¡¬ç›˜30GB æˆ–æ›´å¤š\né›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨ä¹‹é—´ç½‘ç»œäº’é€š\nå¯ä»¥è®¿é—®å¤–ç½‘ï¼Œéœ€è¦æ‹‰å–é•œåƒ\nç¦æ­¢swap åˆ†åŒº\n\n2.4 æœ€ç»ˆç›®æ ‡\nåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šå®‰è£…Docker å’Œkubeadm\néƒ¨ç½²Kubernetes Master\néƒ¨ç½²å®¹å™¨ç½‘ç»œæ’ä»¶\néƒ¨ç½²Kubernetes Nodeï¼Œå°†èŠ‚ç‚¹åŠ å…¥Kubernetes é›†ç¾¤ä¸­\néƒ¨ç½²Dashboard Web é¡µé¢ï¼Œå¯è§†åŒ–æŸ¥çœ‹Kubernetes èµ„æº\n\n2.5 å‡†å¤‡ç¯å¢ƒ\n\n\n\nè§’è‰²\nIPåœ°å€\nç»„ä»¶\n\n\n\nk8s-master01\n192.168.5.3\ndockerï¼Œkubectlï¼Œkubeadmï¼Œkubelet\n\n\nk8s-node01\n192.168.5.4\ndockerï¼Œkubectlï¼Œkubeadmï¼Œkubelet\n\n\nk8s-node02\n192.168.5.5\ndockerï¼Œkubectlï¼Œkubeadmï¼Œkubelet\n\n\n2.6 ç³»ç»Ÿåˆå§‹åŒ–2.6.1 è®¾ç½®ç³»ç»Ÿä¸»æœºåä»¥åŠ Host æ–‡ä»¶çš„ç›¸äº’è§£æhostnamectl set-hostname k8s-master01 &amp;&amp; bash\nhostnamectl set-hostname k8s-node01 &amp;&amp; bash\nhostnamectl set-hostname k8s-node02 &amp;&amp; bash\n\ncat &lt;&lt;EOF&gt;&gt; &#x2F;etc&#x2F;hosts\n192.168.5.3     k8s-master01\n192.168.5.4     k8s-node01\n192.168.5.5     k8s-node02\nEOF\n\nscp &#x2F;etc&#x2F;hosts root@192.168.5.4:&#x2F;etc&#x2F;hosts \nscp &#x2F;etc&#x2F;hosts root@192.168.5.5:&#x2F;etc&#x2F;hosts \n\n2.6.2 å®‰è£…ä¾èµ–æ–‡ä»¶ï¼ˆæ‰€æœ‰èŠ‚ç‚¹éƒ½è¦æ“ä½œï¼‰yum install -y conntrack ntpdate ntp ipvsadm ipset jq iptables curl sysstat libseccomp wget vim net-tools git\n\n2.6.3 è®¾ç½®é˜²ç«å¢™ä¸º Iptables å¹¶è®¾ç½®ç©ºè§„åˆ™ï¼ˆæ‰€æœ‰èŠ‚ç‚¹éƒ½è¦æ“ä½œï¼‰systemctl stop firewalld &amp;&amp; systemctl disable firewalld\n\nyum -y install iptables-services &amp;&amp; systemctl start iptables &amp;&amp; systemctl enable iptables &amp;&amp; iptables -F &amp;&amp; service iptables save\n\n2.6.4 å…³é—­ SELINUXï¼ˆæ‰€æœ‰èŠ‚ç‚¹éƒ½è¦æ“ä½œï¼‰swapoff -a &amp;&amp; sed -i &#39;&#x2F; swap &#x2F; s&#x2F;^\\(.*\\)$&#x2F;#\\1&#x2F;g&#39; &#x2F;etc&#x2F;fstab\n\nsetenforce 0 &amp;&amp; sed -i &#39;s&#x2F;^SELINUX&#x3D;.*&#x2F;SELINUX&#x3D;disabled&#x2F;&#39; &#x2F;etc&#x2F;selinux&#x2F;config\n\n2.6.5 è°ƒæ•´å†…æ ¸å‚æ•°ï¼Œå¯¹äº K8Sï¼ˆæ‰€æœ‰èŠ‚ç‚¹éƒ½è¦æ“ä½œï¼‰modprobe br_netfilter\n\ncat &lt;&lt;EOF&gt; kubernetes.conf \nnet.bridge.bridge-nf-call-iptables&#x3D;1\nnet.bridge.bridge-nf-call-ip6tables&#x3D;1\nnet.ipv4.ip_forward&#x3D;1\nnet.ipv4.tcp_tw_recycle&#x3D;0\nvm.swappiness&#x3D;0 # ç¦æ­¢ä½¿ç”¨ swap ç©ºé—´ï¼Œåªæœ‰å½“ç³»ç»Ÿ OOM æ—¶æ‰å…è®¸ä½¿ç”¨å®ƒ\nvm.overcommit_memory&#x3D;1 # ä¸æ£€æŸ¥ç‰©ç†å†…å­˜æ˜¯å¦å¤Ÿç”¨\nvm.panic_on_oom&#x3D;0 # å¼€å¯ OOM\nfs.inotify.max_user_instances&#x3D;8192\nfs.inotify.max_user_watches&#x3D;1048576\nfs.file-max&#x3D;52706963\nfs.nr_open&#x3D;52706963\nnet.ipv6.conf.all.disable_ipv6&#x3D;1\nnet.netfilter.nf_conntrack_max&#x3D;2310720\nEOF\n\ncp kubernetes.conf &#x2F;etc&#x2F;sysctl.d&#x2F;kubernetes.conf\n\nsysctl -p &#x2F;etc&#x2F;sysctl.d&#x2F;kubernetes.conf\n\n2.6.6 è°ƒæ•´ç³»ç»Ÿæ—¶åŒºï¼ˆæ‰€æœ‰èŠ‚ç‚¹éƒ½è¦æ“ä½œï¼‰# è®¾ç½®ç³»ç»Ÿæ—¶åŒºä¸º ä¸­å›½&#x2F;ä¸Šæµ·\ntimedatectl set-timezone Asia&#x2F;Shanghai\n# å°†å½“å‰çš„ UTC æ—¶é—´å†™å…¥ç¡¬ä»¶æ—¶é’Ÿ\ntimedatectl set-local-rtc 0\n# é‡å¯ä¾èµ–äºç³»ç»Ÿæ—¶é—´çš„æœåŠ¡\nsystemctl restart rsyslog\nsystemctl restart crond\n\n2.6.7 è®¾ç½® rsyslogd å’Œ systemd journaldï¼ˆæ‰€æœ‰èŠ‚ç‚¹éƒ½è¦æ“ä½œï¼‰# æŒä¹…åŒ–ä¿å­˜æ—¥å¿—çš„ç›®å½•\nmkdir &#x2F;var&#x2F;log&#x2F;journal \nmkdir &#x2F;etc&#x2F;systemd&#x2F;journald.conf.d\ncat &gt; &#x2F;etc&#x2F;systemd&#x2F;journald.conf.d&#x2F;99-prophet.conf &lt;&lt;EOF\n[Journal]\n# æŒä¹…åŒ–ä¿å­˜åˆ°ç£ç›˜\nStorage&#x3D;persistent\n\n# å‹ç¼©å†å²æ—¥å¿—\nCompress&#x3D;yes\n\nSyncIntervalSec&#x3D;5m\nRateLimitInterval&#x3D;30s\nRateLimitBurst&#x3D;1000\n\n# æœ€å¤§å ç”¨ç©ºé—´ 10G\nSystemMaxUse&#x3D;10G\n\n# å•æ—¥å¿—æ–‡ä»¶æœ€å¤§ 200M\nSystemMaxFileSize&#x3D;200M\n\n# æ—¥å¿—ä¿å­˜æ—¶é—´ 2 å‘¨\nMaxRetentionSec&#x3D;2week\n\n# ä¸å°†æ—¥å¿—è½¬å‘åˆ° syslog\nForwardToSyslog&#x3D;no\nEOF\n\nsystemctl restart systemd-journald\n\n2.6.8 kube-proxyå¼€å¯ipvsçš„å‰ç½®æ¡ä»¶ï¼ˆæ‰€æœ‰èŠ‚ç‚¹éƒ½è¦æ“ä½œï¼‰cat &lt;&lt;EOF&gt; &#x2F;etc&#x2F;sysconfig&#x2F;modules&#x2F;ipvs.modules \n#!&#x2F;bin&#x2F;bash\nmodprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- nf_conntrack_ipv4\nEOF\n\nchmod 755 &#x2F;etc&#x2F;sysconfig&#x2F;modules&#x2F;ipvs.modules &amp;&amp; bash &#x2F;etc&#x2F;sysconfig&#x2F;modules&#x2F;ipvs.modules &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack_ipv4\n\n2.6.9 å®‰è£… Docker è½¯ä»¶ï¼ˆæ‰€æœ‰èŠ‚ç‚¹éƒ½è¦æ“ä½œï¼‰yum install -y yum-utils device-mapper-persistent-data lvm2\n\nyum-config-manager --add-repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo\n\nyum install -y docker-ce\n\n## åˆ›å»º &#x2F;etc&#x2F;docker ç›®å½•\nmkdir &#x2F;etc&#x2F;docker\n\ncat &gt; &#x2F;etc&#x2F;docker&#x2F;daemon.json &lt;&lt;EOF\n&#123;\n&quot;exec-opts&quot;: [&quot;native.cgroupdriver&#x3D;systemd&quot;],\n&quot;log-driver&quot;: &quot;json-file&quot;,\n&quot;log-opts&quot;: &#123;\n&quot;max-size&quot;: &quot;100m&quot;\n&#125;\n&#125;\nEOF\nmkdir -p &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;docker.service.d\n# é‡å¯dockeræœåŠ¡\nsystemctl daemon-reload &amp;&amp; systemctl restart docker &amp;&amp; systemctl enable docker\nä¸Šä¼ æ–‡ä»¶åˆ°/etc/yum.repos.d/ç›®å½•ä¸‹ï¼Œä¹Ÿå¯ä»¥ ä»£æ›¿ yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo å‘½ä»¤\ndocker-ce.repo\n[docker-ce-stable]\nname&#x3D;Docker CE Stable - $basearch\nbaseurl&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;$releasever&#x2F;$basearch&#x2F;stable\nenabled&#x3D;1\ngpgcheck&#x3D;1\ngpgkey&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;gpg\n\n[docker-ce-stable-debuginfo]\nname&#x3D;Docker CE Stable - Debuginfo $basearch\nbaseurl&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;$releasever&#x2F;debug-$basearch&#x2F;stable\nenabled&#x3D;0\ngpgcheck&#x3D;1\ngpgkey&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;gpg\n\n[docker-ce-stable-source]\nname&#x3D;Docker CE Stable - Sources\nbaseurl&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;$releasever&#x2F;source&#x2F;stable\nenabled&#x3D;0\ngpgcheck&#x3D;1\ngpgkey&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;gpg\n\n[docker-ce-test]\nname&#x3D;Docker CE Test - $basearch\nbaseurl&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;$releasever&#x2F;$basearch&#x2F;test\nenabled&#x3D;0\ngpgcheck&#x3D;1\ngpgkey&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;gpg\n\n[docker-ce-test-debuginfo]\nname&#x3D;Docker CE Test - Debuginfo $basearch\nbaseurl&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;$releasever&#x2F;debug-$basearch&#x2F;test\nenabled&#x3D;0\ngpgcheck&#x3D;1\ngpgkey&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;gpg\n\n[docker-ce-test-source]\nname&#x3D;Docker CE Test - Sources\nbaseurl&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;$releasever&#x2F;source&#x2F;test\nenabled&#x3D;0\ngpgcheck&#x3D;1\ngpgkey&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;gpg\n\n[docker-ce-nightly]\nname&#x3D;Docker CE Nightly - $basearch\nbaseurl&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;$releasever&#x2F;$basearch&#x2F;nightly\nenabled&#x3D;0\ngpgcheck&#x3D;1\ngpgkey&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;gpg\n\n[docker-ce-nightly-debuginfo]\nname&#x3D;Docker CE Nightly - Debuginfo $basearch\nbaseurl&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;$releasever&#x2F;debug-$basearch&#x2F;nightly\nenabled&#x3D;0\ngpgcheck&#x3D;1\ngpgkey&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;gpg\n\n[docker-ce-nightly-source]\nname&#x3D;Docker CE Nightly - Sources\nbaseurl&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;$releasever&#x2F;source&#x2F;nightly\nenabled&#x3D;0\ngpgcheck&#x3D;1\ngpgkey&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;gpg\n\n2.6.10 å®‰è£… Kubeadm ï¼ˆæ‰€æœ‰èŠ‚ç‚¹éƒ½è¦æ“ä½œï¼‰cat &lt;&lt;EOF &gt; &#x2F;etc&#x2F;yum.repos.d&#x2F;kubernetes.repo\n[kubernetes]\nname&#x3D;Kubernetes\nbaseurl&#x3D;http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kubernetes&#x2F;yum&#x2F;repos&#x2F;kubernetes-el7-x86_64\nenabled&#x3D;1\ngpgcheck&#x3D;0\nrepo_gpgcheck&#x3D;0\ngpgkey&#x3D;http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kubernetes&#x2F;yum&#x2F;doc&#x2F;yum-key.gpg\nhttp:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kubernetes&#x2F;yum&#x2F;doc&#x2F;rpm-package-key.gpg\nEOF\n\nyum install -y kubelet kubeadm kubectl &amp;&amp; systemctl enable kubelet\n\n2.7 éƒ¨ç½²Kubernetes Master2.7.1 åˆå§‹åŒ–ä¸»èŠ‚ç‚¹ï¼ˆä¸»èŠ‚ç‚¹æ“ä½œï¼‰kubeadm init --apiserver-advertise-address&#x3D;192.168.5.3 --image-repository registry.aliyuncs.com&#x2F;google_containers --kubernetes-version v1.21.1 --service-cidr&#x3D;10.96.0.0&#x2F;12 --pod-network-cidr&#x3D;10.244.0.0&#x2F;16\n\nmkdir -p $HOME&#x2F;.kube\n\nsudo cp -i &#x2F;etc&#x2F;kubernetes&#x2F;admin.conf $HOME&#x2F;.kube&#x2F;config\n\nsudo chown $(id -u):$(id -g) $HOME&#x2F;.kube&#x2F;config\n\n2.7.2 åŠ å…¥ä¸»èŠ‚ç‚¹ä»¥åŠå…¶ä½™å·¥ä½œèŠ‚ç‚¹kubeadm join 192.168.5.3:6443 --token h0uelc.l46qp29nxscke7f7 \\\n        --discovery-token-ca-cert-hash sha256:abc807778e24bff73362ceeb783cc7f6feec96f20b4fd707c3f8e8312294e28f \n\n2.7.3 éƒ¨ç½²ç½‘ç»œkubectl apply -f https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;coreos&#x2F;flannel&#x2F;master&#x2F;Documentation&#x2F;kube-flannel.yml\n\nä¸‹è¾¹æ˜¯æ–‡ä»¶\n---\napiVersion: policy&#x2F;v1beta1\nkind: PodSecurityPolicy\nmetadata:\n  name: psp.flannel.unprivileged\n  annotations:\n    seccomp.security.alpha.kubernetes.io&#x2F;allowedProfileNames: docker&#x2F;default\n    seccomp.security.alpha.kubernetes.io&#x2F;defaultProfileName: docker&#x2F;default\n    apparmor.security.beta.kubernetes.io&#x2F;allowedProfileNames: runtime&#x2F;default\n    apparmor.security.beta.kubernetes.io&#x2F;defaultProfileName: runtime&#x2F;default\nspec:\n  privileged: false\n  volumes:\n  - configMap\n  - secret\n  - emptyDir\n  - hostPath\n  allowedHostPaths:\n  - pathPrefix: &quot;&#x2F;etc&#x2F;cni&#x2F;net.d&quot;\n  - pathPrefix: &quot;&#x2F;etc&#x2F;kube-flannel&quot;\n  - pathPrefix: &quot;&#x2F;run&#x2F;flannel&quot;\n  readOnlyRootFilesystem: false\n  # Users and groups\n  runAsUser:\n    rule: RunAsAny\n  supplementalGroups:\n    rule: RunAsAny\n  fsGroup:\n    rule: RunAsAny\n  # Privilege Escalation\n  allowPrivilegeEscalation: false\n  defaultAllowPrivilegeEscalation: false\n  # Capabilities\n  allowedCapabilities: [&#39;NET_ADMIN&#39;, &#39;NET_RAW&#39;]\n  defaultAddCapabilities: []\n  requiredDropCapabilities: []\n  # Host namespaces\n  hostPID: false\n  hostIPC: false\n  hostNetwork: true\n  hostPorts:\n  - min: 0\n    max: 65535\n  # SELinux\n  seLinux:\n    # SELinux is unused in CaaSP\n    rule: &#39;RunAsAny&#39;\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io&#x2F;v1\nmetadata:\n  name: flannel\nrules:\n- apiGroups: [&#39;extensions&#39;]\n  resources: [&#39;podsecuritypolicies&#39;]\n  verbs: [&#39;use&#39;]\n  resourceNames: [&#39;psp.flannel.unprivileged&#39;]\n- apiGroups:\n  - &quot;&quot;\n  resources:\n  - pods\n  verbs:\n  - get\n- apiGroups:\n  - &quot;&quot;\n  resources:\n  - nodes\n  verbs:\n  - list\n  - watch\n- apiGroups:\n  - &quot;&quot;\n  resources:\n  - nodes&#x2F;status\n  verbs:\n  - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io&#x2F;v1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    &#123;\n      &quot;name&quot;: &quot;cbr0&quot;,\n      &quot;cniVersion&quot;: &quot;0.3.1&quot;,\n      &quot;plugins&quot;: [\n        &#123;\n          &quot;type&quot;: &quot;flannel&quot;,\n          &quot;delegate&quot;: &#123;\n            &quot;hairpinMode&quot;: true,\n            &quot;isDefaultGateway&quot;: true\n          &#125;\n        &#125;,\n        &#123;\n          &quot;type&quot;: &quot;portmap&quot;,\n          &quot;capabilities&quot;: &#123;\n            &quot;portMappings&quot;: true\n          &#125;\n        &#125;\n      ]\n    &#125;\n  net-conf.json: |\n    &#123;\n      &quot;Network&quot;: &quot;10.244.0.0&#x2F;16&quot;,\n      &quot;Backend&quot;: &#123;\n        &quot;Type&quot;: &quot;vxlan&quot;\n      &#125;\n    &#125;\n---\napiVersion: apps&#x2F;v1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n            - matchExpressions:\n              - key: kubernetes.io&#x2F;os\n                operator: In\n                values:\n                - linux\n      hostNetwork: true\n      priorityClassName: system-node-critical\n      tolerations:\n      - operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io&#x2F;coreos&#x2F;flannel:v0.14.0\n        command:\n        - cp\n        args:\n        - -f\n        - &#x2F;etc&#x2F;kube-flannel&#x2F;cni-conf.json\n        - &#x2F;etc&#x2F;cni&#x2F;net.d&#x2F;10-flannel.conflist\n        volumeMounts:\n        - name: cni\n          mountPath: &#x2F;etc&#x2F;cni&#x2F;net.d\n        - name: flannel-cfg\n          mountPath: &#x2F;etc&#x2F;kube-flannel&#x2F;\n      containers:\n      - name: kube-flannel\n        image: quay.io&#x2F;coreos&#x2F;flannel:v0.14.0\n        command:\n        - &#x2F;opt&#x2F;bin&#x2F;flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: &quot;100m&quot;\n            memory: &quot;50Mi&quot;\n          limits:\n            cpu: &quot;100m&quot;\n            memory: &quot;50Mi&quot;\n        securityContext:\n          privileged: false\n          capabilities:\n            add: [&quot;NET_ADMIN&quot;, &quot;NET_RAW&quot;]\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: &#x2F;run&#x2F;flannel\n        - name: flannel-cfg\n          mountPath: &#x2F;etc&#x2F;kube-flannel&#x2F;\n      volumes:\n      - name: run\n        hostPath:\n          path: &#x2F;run&#x2F;flannel\n      - name: cni\n        hostPath:\n          path: &#x2F;etc&#x2F;cni&#x2F;net.d\n      - name: flannel-cfg\n        configMap:\n          name: kube-flannel-cfg\n\n\n\n2.8 æµ‹è¯•kubernetes é›†ç¾¤2.8.1 éƒ¨ç½²nginx æµ‹è¯•kubectl create deployment nginx --image&#x3D;nginx\n\nkubectl expose deployment nginx --port&#x3D;80 --type&#x3D;NodePort\n\nkubectl get pod,svc\n\n3. èµ„æºç®¡ç†3.1 èµ„æºç®¡ç†ä»‹ç»åœ¨kubernetesä¸­ï¼Œæ‰€æœ‰çš„å†…å®¹éƒ½æŠ½è±¡ä¸ºèµ„æºï¼Œç”¨æˆ·éœ€è¦é€šè¿‡æ“ä½œèµ„æºæ¥ç®¡ç†kubernetesã€‚\n\n\n\n\n\n\n\n\n\nkubernetesçš„æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªé›†ç¾¤ç³»ç»Ÿï¼Œç”¨æˆ·å¯ä»¥åœ¨é›†ç¾¤ä¸­éƒ¨ç½²å„ç§æœåŠ¡ï¼Œæ‰€è°“çš„éƒ¨ç½²æœåŠ¡ï¼Œå…¶å®å°±æ˜¯åœ¨kubernetesé›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ªä¸ªçš„å®¹å™¨ï¼Œå¹¶å°†æŒ‡å®šçš„ç¨‹åºè·‘åœ¨å®¹å™¨ä¸­ã€‚\nkubernetesçš„æœ€å°ç®¡ç†å•å…ƒæ˜¯podè€Œä¸æ˜¯å®¹å™¨ï¼Œæ‰€ä»¥åªèƒ½å°†å®¹å™¨æ”¾åœ¨Podä¸­ï¼Œè€Œkubernetesä¸€èˆ¬ä¹Ÿä¸ä¼šç›´æ¥ç®¡ç†Podï¼Œè€Œæ˜¯é€šè¿‡Podæ§åˆ¶å™¨æ¥ç®¡ç†Podçš„ã€‚\nPodå¯ä»¥æä¾›æœåŠ¡ä¹‹åï¼Œå°±è¦è€ƒè™‘å¦‚ä½•è®¿é—®Podä¸­æœåŠ¡ï¼Œkubernetesæä¾›äº†Serviceèµ„æºå®ç°è¿™ä¸ªåŠŸèƒ½ã€‚\nå½“ç„¶ï¼Œå¦‚æœPodä¸­ç¨‹åºçš„æ•°æ®éœ€è¦æŒä¹…åŒ–ï¼Œkubernetesè¿˜æä¾›äº†å„ç§å­˜å‚¨ç³»ç»Ÿã€‚\n\n\n\n\n\n\n\n\n\n\nå­¦ä¹ kubernetesçš„æ ¸å¿ƒï¼Œå°±æ˜¯å­¦ä¹ å¦‚ä½•å¯¹é›†ç¾¤ä¸Šçš„Podã€Podæ§åˆ¶å™¨ã€Serviceã€å­˜å‚¨ç­‰å„ç§èµ„æºè¿›è¡Œæ“ä½œ\n3.2 YAMLè¯­è¨€ä»‹ç»YAMLæ˜¯ä¸€ä¸ªç±»ä¼¼ XMLã€JSON çš„æ ‡è®°æ€§è¯­è¨€ã€‚å®ƒå¼ºè°ƒä»¥æ•°æ®ä¸ºä¸­å¿ƒï¼Œå¹¶ä¸æ˜¯ä»¥æ ‡è¯†è¯­è¨€ä¸ºé‡ç‚¹ã€‚å› è€ŒYAMLæœ¬èº«çš„å®šä¹‰æ¯”è¾ƒç®€å•ï¼Œå·ç§°â€ä¸€ç§äººæ€§åŒ–çš„æ•°æ®æ ¼å¼è¯­è¨€â€ã€‚\n&lt;heima&gt;\n    &lt;age&gt;15&lt;&#x2F;age&gt;\n    &lt;address&gt;Beijing&lt;&#x2F;address&gt;\n&lt;&#x2F;heima&gt;\n\nheima:\n  age: 15\n  address: Beijing\n\nYAMLçš„è¯­æ³•æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æœ‰ä¸‹é¢å‡ ä¸ªï¼š\n\nå¤§å°å†™æ•æ„Ÿ\nä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»\nç¼©è¿›ä¸å…è®¸ä½¿ç”¨tabï¼Œåªå…è®¸ç©ºæ ¼( ä½ç‰ˆæœ¬é™åˆ¶ )\nç¼©è¿›çš„ç©ºæ ¼æ•°ä¸é‡è¦ï¼Œåªè¦ç›¸åŒå±‚çº§çš„å…ƒç´ å·¦å¯¹é½å³å¯\nâ€˜#â€™è¡¨ç¤ºæ³¨é‡Š\n\nYAMLæ”¯æŒä»¥ä¸‹å‡ ç§æ•°æ®ç±»å‹ï¼š\n\nçº¯é‡ï¼šå•ä¸ªçš„ã€ä¸å¯å†åˆ†çš„å€¼\nå¯¹è±¡ï¼šé”®å€¼å¯¹çš„é›†åˆï¼Œåˆç§°ä¸ºæ˜ å°„ï¼ˆmappingï¼‰&#x2F; å“ˆå¸Œï¼ˆhashï¼‰ &#x2F; å­—å…¸ï¼ˆdictionaryï¼‰\næ•°ç»„ï¼šä¸€ç»„æŒ‰æ¬¡åºæ’åˆ—çš„å€¼ï¼Œåˆç§°ä¸ºåºåˆ—ï¼ˆsequenceï¼‰ &#x2F; åˆ—è¡¨ï¼ˆlistï¼‰\n\n# çº¯é‡, å°±æ˜¯æŒ‡çš„ä¸€ä¸ªç®€å•çš„å€¼ï¼Œå­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ã€æ•´æ•°ã€æµ®ç‚¹æ•°ã€Nullã€æ—¶é—´ã€æ—¥æœŸ\n# 1 å¸ƒå°”ç±»å‹\nc1: true (æˆ–è€…True)\n# 2 æ•´å‹\nc2: 234\n# 3 æµ®ç‚¹å‹\nc3: 3.14\n# 4 nullç±»å‹ \nc4: ~  # ä½¿ç”¨~è¡¨ç¤ºnull\n# 5 æ—¥æœŸç±»å‹\nc5: 2018-02-17    # æ—¥æœŸå¿…é¡»ä½¿ç”¨ISO 8601æ ¼å¼ï¼Œå³yyyy-MM-dd\n# 6 æ—¶é—´ç±»å‹\nc6: 2018-02-17T15:02:31+08:00  # æ—¶é—´ä½¿ç”¨ISO 8601æ ¼å¼ï¼Œæ—¶é—´å’Œæ—¥æœŸä¹‹é—´ä½¿ç”¨Tè¿æ¥ï¼Œæœ€åä½¿ç”¨+ä»£è¡¨æ—¶åŒº\n# 7 å­—ç¬¦ä¸²ç±»å‹\nc7: heima     # ç®€å•å†™æ³•ï¼Œç›´æ¥å†™å€¼ , å¦‚æœå­—ç¬¦ä¸²ä¸­é—´æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œå¿…é¡»ä½¿ç”¨åŒå¼•å·æˆ–è€…å•å¼•å·åŒ…è£¹ \nc8: line1\n    line2     # å­—ç¬¦ä¸²è¿‡å¤šçš„æƒ…å†µå¯ä»¥æ‹†æˆå¤šè¡Œï¼Œæ¯ä¸€è¡Œä¼šè¢«è½¬åŒ–æˆä¸€ä¸ªç©ºæ ¼\n\n# å¯¹è±¡\n# å½¢å¼ä¸€(æ¨è):\nheima:\n  age: 15\n  address: Beijing\n# å½¢å¼äºŒ(äº†è§£):\nheima: &#123;age: 15,address: Beijing&#125;\n\n# æ•°ç»„\n# å½¢å¼ä¸€(æ¨è):\naddress:\n  - é¡ºä¹‰\n  - æ˜Œå¹³  \n# å½¢å¼äºŒ(äº†è§£):\naddress: [é¡ºä¹‰,æ˜Œå¹³]\n\n\n\n\n\n\n\n\n\n\nå°æç¤ºï¼š\n1 ä¹¦å†™yamlåˆ‡è®°: åé¢è¦åŠ ä¸€ä¸ªç©ºæ ¼\n2 å¦‚æœéœ€è¦å°†å¤šæ®µyamlé…ç½®æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¸­é—´è¦ä½¿ç”¨---åˆ†éš”\n3 ä¸‹é¢æ˜¯ä¸€ä¸ªyamlè½¬jsonçš„ç½‘ç«™ï¼Œå¯ä»¥é€šè¿‡å®ƒéªŒè¯yamlæ˜¯å¦ä¹¦å†™æ­£ç¡®\nhttps://www.json2yaml.com/convert-yaml-to-json\n3.3 èµ„æºç®¡ç†æ–¹å¼\nå‘½ä»¤å¼å¯¹è±¡ç®¡ç†ï¼šç›´æ¥ä½¿ç”¨å‘½ä»¤å»æ“ä½œkubernetesèµ„æº\nkubectl run nginx-pod --image=nginx:1.17.1 --port=80\n\nå‘½ä»¤å¼å¯¹è±¡é…ç½®ï¼šé€šè¿‡å‘½ä»¤é…ç½®å’Œé…ç½®æ–‡ä»¶å»æ“ä½œkubernetesèµ„æº\nkubectl create/patch -f nginx-pod.yaml\n\nå£°æ˜å¼å¯¹è±¡é…ç½®ï¼šé€šè¿‡applyå‘½ä»¤å’Œé…ç½®æ–‡ä»¶å»æ“ä½œkubernetesèµ„æº\nkubectl apply -f nginx-pod.yaml\n\n\n\n\n\nç±»å‹\næ“ä½œå¯¹è±¡\né€‚ç”¨ç¯å¢ƒ\nä¼˜ç‚¹\nç¼ºç‚¹\n\n\n\nå‘½ä»¤å¼å¯¹è±¡ç®¡ç†\nå¯¹è±¡\næµ‹è¯•\nç®€å•\nåªèƒ½æ“ä½œæ´»åŠ¨å¯¹è±¡ï¼Œæ— æ³•å®¡è®¡ã€è·Ÿè¸ª\n\n\nå‘½ä»¤å¼å¯¹è±¡é…ç½®\næ–‡ä»¶\nå¼€å‘\nå¯ä»¥å®¡è®¡ã€è·Ÿè¸ª\né¡¹ç›®å¤§æ—¶ï¼Œé…ç½®æ–‡ä»¶å¤šï¼Œæ“ä½œéº»çƒ¦\n\n\nå£°æ˜å¼å¯¹è±¡é…ç½®\nç›®å½•\nå¼€å‘\næ”¯æŒç›®å½•æ“ä½œ\næ„å¤–æƒ…å†µä¸‹éš¾ä»¥è°ƒè¯•\n\n\n3.3.1 å‘½ä»¤å¼å¯¹è±¡ç®¡ç†kubectlå‘½ä»¤\nkubectlæ˜¯kubernetesé›†ç¾¤çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œé€šè¿‡å®ƒèƒ½å¤Ÿå¯¹é›†ç¾¤æœ¬èº«è¿›è¡Œç®¡ç†ï¼Œå¹¶èƒ½å¤Ÿåœ¨é›†ç¾¤ä¸Šè¿›è¡Œå®¹å™¨åŒ–åº”ç”¨çš„å®‰è£…éƒ¨ç½²ã€‚kubectlå‘½ä»¤çš„è¯­æ³•å¦‚ä¸‹ï¼š\nkubectl [command] [type] [name] [flags]\n\ncomandï¼šæŒ‡å®šè¦å¯¹èµ„æºæ‰§è¡Œçš„æ“ä½œï¼Œä¾‹å¦‚createã€getã€delete\ntypeï¼šæŒ‡å®šèµ„æºç±»å‹ï¼Œæ¯”å¦‚deploymentã€podã€service\nnameï¼šæŒ‡å®šèµ„æºçš„åç§°ï¼Œåç§°å¤§å°å†™æ•æ„Ÿ\nflagsï¼šæŒ‡å®šé¢å¤–çš„å¯é€‰å‚æ•°\n# æŸ¥çœ‹æ‰€æœ‰pod\nkubectl get pod \n\n# æŸ¥çœ‹æŸä¸ªpod\nkubectl get pod pod_name\n\n# æŸ¥çœ‹æŸä¸ªpod,ä»¥yamlæ ¼å¼å±•ç¤ºç»“æœ\nkubectl get pod pod_name -o yaml\n\nèµ„æºç±»å‹\nkubernetesä¸­æ‰€æœ‰çš„å†…å®¹éƒ½æŠ½è±¡ä¸ºèµ„æºï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹:\nkubectl api-resources\n\nç»å¸¸ä½¿ç”¨çš„èµ„æºæœ‰ä¸‹é¢è¿™äº›ï¼š\n\n\n\nèµ„æºåˆ†ç±»\nèµ„æºåç§°\nç¼©å†™\nèµ„æºä½œç”¨\n\n\n\né›†ç¾¤çº§åˆ«èµ„æº\nnodes\nno\né›†ç¾¤ç»„æˆéƒ¨åˆ†\n\n\nnamespaces\nns\néš”ç¦»Pod\n\n\n\npodèµ„æº\npods\npo\nè£…è½½å®¹å™¨\n\n\npodèµ„æºæ§åˆ¶å™¨\nreplicationcontrollers\nrc\næ§åˆ¶podèµ„æº\n\n\n\nreplicasets\nrs\næ§åˆ¶podèµ„æº\n\n\n\ndeployments\ndeploy\næ§åˆ¶podèµ„æº\n\n\n\ndaemonsets\nds\næ§åˆ¶podèµ„æº\n\n\n\njobs\n\næ§åˆ¶podèµ„æº\n\n\n\ncronjobs\ncj\næ§åˆ¶podèµ„æº\n\n\n\nhorizontalpodautoscalers\nhpa\næ§åˆ¶podèµ„æº\n\n\n\nstatefulsets\nsts\næ§åˆ¶podèµ„æº\n\n\næœåŠ¡å‘ç°èµ„æº\nservices\nsvc\nç»Ÿä¸€podå¯¹å¤–æ¥å£\n\n\n\ningress\ning\nç»Ÿä¸€podå¯¹å¤–æ¥å£\n\n\nå­˜å‚¨èµ„æº\nvolumeattachments\n\nå­˜å‚¨\n\n\n\npersistentvolumes\npv\nå­˜å‚¨\n\n\n\npersistentvolumeclaims\npvc\nå­˜å‚¨\n\n\né…ç½®èµ„æº\nconfigmaps\ncm\né…ç½®\n\n\n\nsecrets\n\né…ç½®\n\n\næ“ä½œ\nkuberneteså…è®¸å¯¹èµ„æºè¿›è¡Œå¤šç§æ“ä½œï¼Œå¯ä»¥é€šè¿‡â€“helpæŸ¥çœ‹è¯¦ç»†çš„æ“ä½œå‘½ä»¤\nkubectl --help\n\nç»å¸¸ä½¿ç”¨çš„æ“ä½œæœ‰ä¸‹é¢è¿™äº›ï¼š\n\n\n\nå‘½ä»¤åˆ†ç±»\nå‘½ä»¤\nç¿»è¯‘\nå‘½ä»¤ä½œç”¨\n\n\n\nåŸºæœ¬å‘½ä»¤\ncreate\nåˆ›å»º\nåˆ›å»ºä¸€ä¸ªèµ„æº\n\n\n\nedit\nç¼–è¾‘\nç¼–è¾‘ä¸€ä¸ªèµ„æº\n\n\n\nget\nè·å–\nè·å–ä¸€ä¸ªèµ„æº\n\n\n\npatch\næ›´æ–°\næ›´æ–°ä¸€ä¸ªèµ„æº\n\n\n\ndelete\nåˆ é™¤\nåˆ é™¤ä¸€ä¸ªèµ„æº\n\n\n\nexplain\nè§£é‡Š\nå±•ç¤ºèµ„æºæ–‡æ¡£\n\n\nè¿è¡Œå’Œè°ƒè¯•\nrun\nè¿è¡Œ\nåœ¨é›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ªæŒ‡å®šçš„é•œåƒ\n\n\n\nexpose\næš´éœ²\næš´éœ²èµ„æºä¸ºService\n\n\n\ndescribe\næè¿°\næ˜¾ç¤ºèµ„æºå†…éƒ¨ä¿¡æ¯\n\n\n\nlogs\næ—¥å¿—è¾“å‡ºå®¹å™¨åœ¨ pod ä¸­çš„æ—¥å¿—\nè¾“å‡ºå®¹å™¨åœ¨ pod ä¸­çš„æ—¥å¿—\n\n\n\nattach\nç¼ ç»•è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨\nè¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨\n\n\n\nexec\næ‰§è¡Œå®¹å™¨ä¸­çš„ä¸€ä¸ªå‘½ä»¤\næ‰§è¡Œå®¹å™¨ä¸­çš„ä¸€ä¸ªå‘½ä»¤\n\n\n\ncp\nå¤åˆ¶\nåœ¨Podå†…å¤–å¤åˆ¶æ–‡ä»¶\n\n\n\nrollout\né¦–æ¬¡å±•ç¤º\nç®¡ç†èµ„æºçš„å‘å¸ƒ\n\n\n\nscale\nè§„æ¨¡\næ‰©(ç¼©)å®¹Podçš„æ•°é‡\n\n\n\nautoscale\nè‡ªåŠ¨è°ƒæ•´\nè‡ªåŠ¨è°ƒæ•´Podçš„æ•°é‡\n\n\né«˜çº§å‘½ä»¤\napply\nrc\né€šè¿‡æ–‡ä»¶å¯¹èµ„æºè¿›è¡Œé…ç½®\n\n\n\nlabel\næ ‡ç­¾\næ›´æ–°èµ„æºä¸Šçš„æ ‡ç­¾\n\n\nå…¶ä»–å‘½ä»¤\ncluster-info\né›†ç¾¤ä¿¡æ¯\næ˜¾ç¤ºé›†ç¾¤ä¿¡æ¯\n\n\n\nversion\nç‰ˆæœ¬\næ˜¾ç¤ºå½“å‰Serverå’ŒClientçš„ç‰ˆæœ¬\n\n\nä¸‹é¢ä»¥ä¸€ä¸ªnamespace &#x2F; podçš„åˆ›å»ºå’Œåˆ é™¤ç®€å•æ¼”ç¤ºä¸‹å‘½ä»¤çš„ä½¿ç”¨ï¼š\n# åˆ›å»ºä¸€ä¸ªnamespace\n[root@master ~]# kubectl create namespace dev\nnamespace&#x2F;dev created\n\n# è·å–namespace\n[root@master ~]# kubectl get ns\nNAME              STATUS   AGE\ndefault           Active   21h\ndev               Active   21s\nkube-node-lease   Active   21h\nkube-public       Active   21h\nkube-system       Active   21h\n\n# åœ¨æ­¤namespaceä¸‹åˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªnginxçš„Pod\n[root@master ~]# kubectl run pod --image&#x3D;nginx:latest -n dev\nkubectl run --generator&#x3D;deployment&#x2F;apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator&#x3D;run-pod&#x2F;v1 or kubectl create instead.\ndeployment.apps&#x2F;pod created\n\n# æŸ¥çœ‹æ–°åˆ›å»ºçš„pod\n[root@master ~]# kubectl get pod -n dev\nNAME  READY   STATUS    RESTARTS   AGE\npod   1&#x2F;1     Running   0          21s\n\n# åˆ é™¤æŒ‡å®šçš„pod\n[root@master ~]# kubectl delete pod pod-864f9875b9-pcw7x\npod &quot;pod&quot; deleted\n\n# åˆ é™¤æŒ‡å®šçš„namespace\n[root@master ~]# kubectl delete ns dev\nnamespace &quot;dev&quot; deleted\n\n3.3.2 å‘½ä»¤å¼å¯¹è±¡é…ç½®å‘½ä»¤å¼å¯¹è±¡é…ç½®å°±æ˜¯ä½¿ç”¨å‘½ä»¤é…åˆé…ç½®æ–‡ä»¶ä¸€èµ·æ¥æ“ä½œkubernetesèµ„æºã€‚\n1ï¼‰ åˆ›å»ºä¸€ä¸ªnginxpod.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: dev\n\n---\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginxpod\n  namespace: dev\nspec:\n  containers:\n  - name: nginx-containers\n    image: nginx:latest\n\n2ï¼‰æ‰§è¡Œcreateå‘½ä»¤ï¼Œåˆ›å»ºèµ„æºï¼š\n[root@master ~]# kubectl create -f nginxpod.yaml\nnamespace&#x2F;dev created\npod&#x2F;nginxpod created\n\næ­¤æ—¶å‘ç°åˆ›å»ºäº†ä¸¤ä¸ªèµ„æºå¯¹è±¡ï¼Œåˆ†åˆ«æ˜¯namespaceå’Œpod\n3ï¼‰æ‰§è¡Œgetå‘½ä»¤ï¼ŒæŸ¥çœ‹èµ„æºï¼š\n[root@master ~]#  kubectl get -f nginxpod.yaml\nNAME            STATUS   AGE\nnamespace&#x2F;dev   Active   18s\n\nNAME            READY   STATUS    RESTARTS   AGE\npod&#x2F;nginxpod    1&#x2F;1     Running   0          17s\n\nè¿™æ ·å°±æ˜¾ç¤ºäº†ä¸¤ä¸ªèµ„æºå¯¹è±¡çš„ä¿¡æ¯\n4ï¼‰æ‰§è¡Œdeleteå‘½ä»¤ï¼Œåˆ é™¤èµ„æºï¼š\n[root@master ~]# kubectl delete -f nginxpod.yaml\nnamespace &quot;dev&quot; deleted\npod &quot;nginxpod&quot; deleted\n\næ­¤æ—¶å‘ç°ä¸¤ä¸ªèµ„æºå¯¹è±¡è¢«åˆ é™¤äº†\næ€»ç»“:\n    å‘½ä»¤å¼å¯¹è±¡é…ç½®çš„æ–¹å¼æ“ä½œèµ„æºï¼Œå¯ä»¥ç®€å•çš„è®¤ä¸ºï¼šå‘½ä»¤  +  yamlé…ç½®æ–‡ä»¶ï¼ˆé‡Œé¢æ˜¯å‘½ä»¤éœ€è¦çš„å„ç§å‚æ•°ï¼‰\n\n3.3.3 å£°æ˜å¼å¯¹è±¡é…ç½®å£°æ˜å¼å¯¹è±¡é…ç½®è·Ÿå‘½ä»¤å¼å¯¹è±¡é…ç½®å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯å®ƒåªæœ‰ä¸€ä¸ªå‘½ä»¤applyã€‚\n# é¦–å…ˆæ‰§è¡Œä¸€æ¬¡kubectl apply -f yamlæ–‡ä»¶ï¼Œå‘ç°åˆ›å»ºäº†èµ„æº\n[root@master ~]#  kubectl apply -f nginxpod.yaml\nnamespace&#x2F;dev created\npod&#x2F;nginxpod created\n\n# å†æ¬¡æ‰§è¡Œä¸€æ¬¡kubectl apply -f yamlæ–‡ä»¶ï¼Œå‘ç°è¯´èµ„æºæ²¡æœ‰å˜åŠ¨\n[root@master ~]#  kubectl apply -f nginxpod.yaml\nnamespace&#x2F;dev unchanged\npod&#x2F;nginxpod unchanged\n\næ€»ç»“:\n    å…¶å®å£°æ˜å¼å¯¹è±¡é…ç½®å°±æ˜¯ä½¿ç”¨applyæè¿°ä¸€ä¸ªèµ„æºæœ€ç»ˆçš„çŠ¶æ€ï¼ˆåœ¨yamlä¸­å®šä¹‰çŠ¶æ€ï¼‰\n    ä½¿ç”¨applyæ“ä½œèµ„æºï¼š\n        å¦‚æœèµ„æºä¸å­˜åœ¨ï¼Œå°±åˆ›å»ºï¼Œç›¸å½“äº kubectl create\n        å¦‚æœèµ„æºå·²å­˜åœ¨ï¼Œå°±æ›´æ–°ï¼Œç›¸å½“äº kubectl patch\n\n\n\n\n\n\n\n\n\n\næ‰©å±•ï¼škubectlå¯ä»¥åœ¨nodeèŠ‚ç‚¹ä¸Šè¿è¡Œå— ?\nkubectlçš„è¿è¡Œæ˜¯éœ€è¦è¿›è¡Œé…ç½®çš„ï¼Œå®ƒçš„é…ç½®æ–‡ä»¶æ˜¯$HOME&#x2F;.kubeï¼Œå¦‚æœæƒ³è¦åœ¨nodeèŠ‚ç‚¹è¿è¡Œæ­¤å‘½ä»¤ï¼Œéœ€è¦å°†masterä¸Šçš„.kubeæ–‡ä»¶å¤åˆ¶åˆ°nodeèŠ‚ç‚¹ä¸Šï¼Œå³åœ¨masterèŠ‚ç‚¹ä¸Šæ‰§è¡Œä¸‹é¢æ“ä½œï¼š\nscp  -r  HOME&#x2F;.kube   node1: HOME&#x2F;\n\n\n\n\n\n\n\n\n\n\nä½¿ç”¨æ¨è: ä¸‰ç§æ–¹å¼åº”è¯¥æ€ä¹ˆç”¨ ?\nåˆ›å»º&#x2F;æ›´æ–°èµ„æº ä½¿ç”¨å£°æ˜å¼å¯¹è±¡é…ç½® kubectl apply -f XXX.yaml\nåˆ é™¤èµ„æº ä½¿ç”¨å‘½ä»¤å¼å¯¹è±¡é…ç½® kubectl delete -f XXX.yaml\næŸ¥è¯¢èµ„æº ä½¿ç”¨å‘½ä»¤å¼å¯¹è±¡ç®¡ç† kubectl get(describe) èµ„æºåç§°\n4. å®æˆ˜å…¥é—¨æœ¬ç« èŠ‚å°†ä»‹ç»å¦‚ä½•åœ¨kubernetesé›†ç¾¤ä¸­éƒ¨ç½²ä¸€ä¸ªnginxæœåŠ¡ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¯¹å…¶è¿›è¡Œè®¿é—®ã€‚\n4.1 NamespaceNamespaceæ˜¯kubernetesç³»ç»Ÿä¸­çš„ä¸€ç§éå¸¸é‡è¦èµ„æºï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥å®ç°å¤šå¥—ç¯å¢ƒçš„èµ„æºéš”ç¦»æˆ–è€…å¤šç§Ÿæˆ·çš„èµ„æºéš”ç¦»ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œkubernetesé›†ç¾¤ä¸­çš„æ‰€æœ‰çš„Podéƒ½æ˜¯å¯ä»¥ç›¸äº’è®¿é—®çš„ã€‚ä½†æ˜¯åœ¨å®é™…ä¸­ï¼Œå¯èƒ½ä¸æƒ³è®©ä¸¤ä¸ªPodä¹‹é—´è¿›è¡Œäº’ç›¸çš„è®¿é—®ï¼Œé‚£æ­¤æ—¶å°±å¯ä»¥å°†ä¸¤ä¸ªPodåˆ’åˆ†åˆ°ä¸åŒçš„namespaceä¸‹ã€‚kubernetesé€šè¿‡å°†é›†ç¾¤å†…éƒ¨çš„èµ„æºåˆ†é…åˆ°ä¸åŒçš„Namespaceä¸­ï¼Œå¯ä»¥å½¢æˆé€»è¾‘ä¸Šçš„â€ç»„â€ï¼Œä»¥æ–¹ä¾¿ä¸åŒçš„ç»„çš„èµ„æºè¿›è¡Œéš”ç¦»ä½¿ç”¨å’Œç®¡ç†ã€‚\nå¯ä»¥é€šè¿‡kubernetesçš„æˆæƒæœºåˆ¶ï¼Œå°†ä¸åŒçš„namespaceäº¤ç»™ä¸åŒç§Ÿæˆ·è¿›è¡Œç®¡ç†ï¼Œè¿™æ ·å°±å®ç°äº†å¤šç§Ÿæˆ·çš„èµ„æºéš”ç¦»ã€‚æ­¤æ—¶è¿˜èƒ½ç»“åˆkubernetesçš„èµ„æºé…é¢æœºåˆ¶ï¼Œé™å®šä¸åŒç§Ÿæˆ·èƒ½å ç”¨çš„èµ„æºï¼Œä¾‹å¦‚CPUä½¿ç”¨é‡ã€å†…å­˜ä½¿ç”¨é‡ç­‰ç­‰ï¼Œæ¥å®ç°ç§Ÿæˆ·å¯ç”¨èµ„æºçš„ç®¡ç†ã€‚\n\nkubernetesåœ¨é›†ç¾¤å¯åŠ¨ä¹‹åï¼Œä¼šé»˜è®¤åˆ›å»ºå‡ ä¸ªnamespace\n[root@master ~]# kubectl  get namespace\nNAME              STATUS   AGE\ndefault           Active   45h     #  æ‰€æœ‰æœªæŒ‡å®šNamespaceçš„å¯¹è±¡éƒ½ä¼šè¢«åˆ†é…åœ¨defaultå‘½åç©ºé—´\nkube-node-lease   Active   45h     #  é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´çš„å¿ƒè·³ç»´æŠ¤ï¼Œv1.13å¼€å§‹å¼•å…¥\nkube-public       Active   45h     #  æ­¤å‘½åç©ºé—´ä¸‹çš„èµ„æºå¯ä»¥è¢«æ‰€æœ‰äººè®¿é—®ï¼ˆåŒ…æ‹¬æœªè®¤è¯ç”¨æˆ·ï¼‰\nkube-system       Active   45h     #  æ‰€æœ‰ç”±Kubernetesç³»ç»Ÿåˆ›å»ºçš„èµ„æºéƒ½å¤„äºè¿™ä¸ªå‘½åç©ºé—´\n\nä¸‹é¢æ¥çœ‹namespaceèµ„æºçš„å…·ä½“æ“ä½œï¼š\næŸ¥çœ‹\n# 1 æŸ¥çœ‹æ‰€æœ‰çš„ns  å‘½ä»¤ï¼škubectl get ns\n[root@master ~]# kubectl get ns\nNAME              STATUS   AGE\ndefault           Active   45h\nkube-node-lease   Active   45h\nkube-public       Active   45h     \nkube-system       Active   45h     \n\n# 2 æŸ¥çœ‹æŒ‡å®šçš„ns   å‘½ä»¤ï¼škubectl get ns nsåç§°\n[root@master ~]# kubectl get ns default\nNAME      STATUS   AGE\ndefault   Active   45h\n\n# 3 æŒ‡å®šè¾“å‡ºæ ¼å¼  å‘½ä»¤ï¼škubectl get ns nsåç§°  -o æ ¼å¼å‚æ•°\n# kubernetesæ”¯æŒçš„æ ¼å¼æœ‰å¾ˆå¤šï¼Œæ¯”è¾ƒå¸¸è§çš„æ˜¯wideã€jsonã€yaml\n[root@master ~]# kubectl get ns default -o yaml\napiVersion: v1\nkind: Namespace\nmetadata:\n  creationTimestamp: &quot;2021-05-08T04:44:16Z&quot;\n  name: default\n  resourceVersion: &quot;151&quot;\n  selfLink: &#x2F;api&#x2F;v1&#x2F;namespaces&#x2F;default\n  uid: 7405f73a-e486-43d4-9db6-145f1409f090\nspec:\n  finalizers:\n  - kubernetes\nstatus:\n  phase: Active\n  \n# 4 æŸ¥çœ‹nsè¯¦æƒ…  å‘½ä»¤ï¼škubectl describe ns nsåç§°\n[root@master ~]# kubectl describe ns default\nName:         default\nLabels:       &lt;none&gt;\nAnnotations:  &lt;none&gt;\nStatus:       Active  # Active å‘½åç©ºé—´æ­£åœ¨ä½¿ç”¨ä¸­  Terminating æ­£åœ¨åˆ é™¤å‘½åç©ºé—´\n\n# ResourceQuota é’ˆå¯¹namespaceåšçš„èµ„æºé™åˆ¶\n# LimitRangeé’ˆå¯¹namespaceä¸­çš„æ¯ä¸ªç»„ä»¶åšçš„èµ„æºé™åˆ¶\nNo resource quota.\nNo LimitRange resource.\n\nåˆ›å»º\n# åˆ›å»ºnamespace\n[root@master ~]# kubectl create ns dev\nnamespace&#x2F;dev created\n\nåˆ é™¤\n# åˆ é™¤namespace\n[root@master ~]# kubectl delete ns dev\nnamespace &quot;dev&quot; deleted\n\né…ç½®æ–¹å¼\né¦–å…ˆå‡†å¤‡ä¸€ä¸ªyamlæ–‡ä»¶ï¼šns-dev.yaml\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: dev\n\nç„¶åå°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„åˆ›å»ºå’Œåˆ é™¤å‘½ä»¤äº†ï¼š\nåˆ›å»ºï¼škubectl create -f ns-dev.yaml\nåˆ é™¤ï¼škubectl delete -f ns-dev.yaml\n4.2 PodPodæ˜¯kubernetesé›†ç¾¤è¿›è¡Œç®¡ç†çš„æœ€å°å•å…ƒï¼Œç¨‹åºè¦è¿è¡Œå¿…é¡»éƒ¨ç½²åœ¨å®¹å™¨ä¸­ï¼Œè€Œå®¹å™¨å¿…é¡»å­˜åœ¨äºPodä¸­ã€‚\nPodå¯ä»¥è®¤ä¸ºæ˜¯å®¹å™¨çš„å°è£…ï¼Œä¸€ä¸ªPodä¸­å¯ä»¥å­˜åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ã€‚\n\nkubernetesåœ¨é›†ç¾¤å¯åŠ¨ä¹‹åï¼Œé›†ç¾¤ä¸­çš„å„ä¸ªç»„ä»¶ä¹Ÿéƒ½æ˜¯ä»¥Podæ–¹å¼è¿è¡Œçš„ã€‚å¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹ï¼š\n[root@master ~]# kubectl get pod -n kube-system\nNAMESPACE     NAME                             READY   STATUS    RESTARTS   AGE\nkube-system   coredns-6955765f44-68g6v         1&#x2F;1     Running   0          2d1h\nkube-system   coredns-6955765f44-cs5r8         1&#x2F;1     Running   0          2d1h\nkube-system   etcd-master                      1&#x2F;1     Running   0          2d1h\nkube-system   kube-apiserver-master            1&#x2F;1     Running   0          2d1h\nkube-system   kube-controller-manager-master   1&#x2F;1     Running   0          2d1h\nkube-system   kube-flannel-ds-amd64-47r25      1&#x2F;1     Running   0          2d1h\nkube-system   kube-flannel-ds-amd64-ls5lh      1&#x2F;1     Running   0          2d1h\nkube-system   kube-proxy-685tk                 1&#x2F;1     Running   0          2d1h\nkube-system   kube-proxy-87spt                 1&#x2F;1     Running   0          2d1h\nkube-system   kube-scheduler-master            1&#x2F;1     Running   0          2d1h\n\nåˆ›å»ºå¹¶è¿è¡Œ\nkubernetesæ²¡æœ‰æä¾›å•ç‹¬è¿è¡ŒPodçš„å‘½ä»¤ï¼Œéƒ½æ˜¯é€šè¿‡Podæ§åˆ¶å™¨æ¥å®ç°çš„\n# å‘½ä»¤æ ¼å¼ï¼š kubectl run (podæ§åˆ¶å™¨åç§°) [å‚æ•°] \n# --image  æŒ‡å®šPodçš„é•œåƒ\n# --port   æŒ‡å®šç«¯å£\n# --namespace  æŒ‡å®šnamespace\n[root@master ~]# kubectl run nginx --image&#x3D;nginx:latest --port&#x3D;80 --namespace dev \ndeployment.apps&#x2F;nginx created\n\næŸ¥çœ‹podä¿¡æ¯\n# æŸ¥çœ‹PodåŸºæœ¬ä¿¡æ¯\n[root@master ~]# kubectl get pods -n dev\nNAME    READY   STATUS    RESTARTS   AGE\nnginx   1&#x2F;1     Running   0          43s\n\n# æŸ¥çœ‹Podçš„è¯¦ç»†ä¿¡æ¯\n[root@master ~]# kubectl describe pod nginx -n dev\nName:         nginx\nNamespace:    dev\nPriority:     0\nNode:         node1&#x2F;192.168.5.4\nStart Time:   Wed, 08 May 2021 09:29:24 +0800\nLabels:       pod-template-hash&#x3D;5ff7956ff6\n              run&#x3D;nginx\nAnnotations:  &lt;none&gt;\nStatus:       Running\nIP:           10.244.1.23\nIPs:\n  IP:           10.244.1.23\nControlled By:  ReplicaSet&#x2F;nginx\nContainers:\n  nginx:\n    Container ID:   docker:&#x2F;&#x2F;4c62b8c0648d2512380f4ffa5da2c99d16e05634979973449c98e9b829f6253c\n    Image:          nginx:latest\n    Image ID:       docker-pullable:&#x2F;&#x2F;nginx@sha256:485b610fefec7ff6c463ced9623314a04ed67e3945b9c08d7e53a47f6d108dc7\n    Port:           80&#x2F;TCP\n    Host Port:      0&#x2F;TCP\n    State:          Running\n      Started:      Wed, 08 May 2021 09:30:01 +0800\n    Ready:          True\n    Restart Count:  0\n    Environment:    &lt;none&gt;\n    Mounts:\n      &#x2F;var&#x2F;run&#x2F;secrets&#x2F;kubernetes.io&#x2F;serviceaccount from default-token-hwvvw (ro)\nConditions:\n  Type              Status\n  Initialized       True\n  Ready             True\n  ContainersReady   True\n  PodScheduled      True\nVolumes:\n  default-token-hwvvw:\n    Type:        Secret (a volume populated by a Secret)\n    SecretName:  default-token-hwvvw\n    Optional:    false\nQoS Class:       BestEffort\nNode-Selectors:  &lt;none&gt;\nTolerations:     node.kubernetes.io&#x2F;not-ready:NoExecute for 300s\n                 node.kubernetes.io&#x2F;unreachable:NoExecute for 300s\nEvents:\n  Type    Reason     Age        From               Message\n  ----    ------     ----       ----               -------\n  Normal  Scheduled  &lt;unknown&gt;  default-scheduler  Successfully assigned dev&#x2F;nginx-5ff7956ff6-fg2db to node1\n  Normal  Pulling    4m11s      kubelet, node1     Pulling image &quot;nginx:latest&quot;\n  Normal  Pulled     3m36s      kubelet, node1     Successfully pulled image &quot;nginx:latest&quot;\n  Normal  Created    3m36s      kubelet, node1     Created container nginx\n  Normal  Started    3m36s      kubelet, node1     Started container nginx\n\nè®¿é—®Pod\n# è·å–podIP\n[root@master ~]# kubectl get pods -n dev -o wide\nNAME    READY   STATUS    RESTARTS   AGE    IP             NODE    ... \nnginx   1&#x2F;1     Running   0          190s   10.244.1.23   node1   ...\n\n#è®¿é—®POD\n[root@master ~]# curl http:&#x2F;&#x2F;10.244.1.23:80\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n\t&lt;title&gt;Welcome to nginx!&lt;&#x2F;title&gt;\n&lt;&#x2F;head&gt;\n&lt;body&gt;\n\t&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;\n&lt;&#x2F;body&gt;\n&lt;&#x2F;html&gt;\n\nåˆ é™¤æŒ‡å®šPod\n# åˆ é™¤æŒ‡å®šPod\n[root@master ~]# kubectl delete pod nginx -n dev\npod &quot;nginx&quot; deleted\n\n# æ­¤æ—¶ï¼Œæ˜¾ç¤ºåˆ é™¤PodæˆåŠŸï¼Œä½†æ˜¯å†æŸ¥è¯¢ï¼Œå‘ç°åˆæ–°äº§ç”Ÿäº†ä¸€ä¸ª \n[root@master ~]# kubectl get pods -n dev\nNAME    READY   STATUS    RESTARTS   AGE\nnginx   1&#x2F;1     Running   0          21s\n\n# è¿™æ˜¯å› ä¸ºå½“å‰Podæ˜¯ç”±Podæ§åˆ¶å™¨åˆ›å»ºçš„ï¼Œæ§åˆ¶å™¨ä¼šç›‘æ§PodçŠ¶å†µï¼Œä¸€æ—¦å‘ç°Podæ­»äº¡ï¼Œä¼šç«‹å³é‡å»º\n# æ­¤æ—¶è¦æƒ³åˆ é™¤Podï¼Œå¿…é¡»åˆ é™¤Podæ§åˆ¶å™¨\n\n# å…ˆæ¥æŸ¥è¯¢ä¸€ä¸‹å½“å‰namespaceä¸‹çš„Podæ§åˆ¶å™¨\n[root@master ~]# kubectl get deploy -n  dev\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\nnginx   1&#x2F;1     1            1           9m7s\n\n# æ¥ä¸‹æ¥ï¼Œåˆ é™¤æ­¤PodPodæ§åˆ¶å™¨\n[root@master ~]# kubectl delete deploy nginx -n dev\ndeployment.apps &quot;nginx&quot; deleted\n\n# ç¨ç­‰ç‰‡åˆ»ï¼Œå†æŸ¥è¯¢Podï¼Œå‘ç°Podè¢«åˆ é™¤äº†\n[root@master ~]# kubectl get pods -n dev\nNo resources found in dev namespace.\n\né…ç½®æ“ä½œ\nåˆ›å»ºä¸€ä¸ªpod-nginx.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\n  namespace: dev\nspec:\n  containers:\n  - image: nginx:latest\n    name: pod\n    ports:\n    - name: nginx-port\n      containerPort: 80\n      protocol: TCP\n\nç„¶åå°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„åˆ›å»ºå’Œåˆ é™¤å‘½ä»¤äº†ï¼š\nåˆ›å»ºï¼škubectl create -f pod-nginx.yaml\nåˆ é™¤ï¼škubectl delete -f pod-nginx.yaml\n4.3 LabelLabelæ˜¯kubernetesç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚å®ƒçš„ä½œç”¨å°±æ˜¯åœ¨èµ„æºä¸Šæ·»åŠ æ ‡è¯†ï¼Œç”¨æ¥å¯¹å®ƒä»¬è¿›è¡ŒåŒºåˆ†å’Œé€‰æ‹©ã€‚\nLabelçš„ç‰¹ç‚¹ï¼š\n\nä¸€ä¸ªLabelä¼šä»¥key&#x2F;valueé”®å€¼å¯¹çš„å½¢å¼é™„åŠ åˆ°å„ç§å¯¹è±¡ä¸Šï¼Œå¦‚Nodeã€Podã€Serviceç­‰ç­‰\nä¸€ä¸ªèµ„æºå¯¹è±¡å¯ä»¥å®šä¹‰ä»»æ„æ•°é‡çš„Label ï¼ŒåŒä¸€ä¸ªLabelä¹Ÿå¯ä»¥è¢«æ·»åŠ åˆ°ä»»æ„æ•°é‡çš„èµ„æºå¯¹è±¡ä¸Šå»\nLabelé€šå¸¸åœ¨èµ„æºå¯¹è±¡å®šä¹‰æ—¶ç¡®å®šï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åœ¨å¯¹è±¡åˆ›å»ºååŠ¨æ€æ·»åŠ æˆ–è€…åˆ é™¤\n\nå¯ä»¥é€šè¿‡Labelå®ç°èµ„æºçš„å¤šç»´åº¦åˆ†ç»„ï¼Œä»¥ä¾¿çµæ´»ã€æ–¹ä¾¿åœ°è¿›è¡Œèµ„æºåˆ†é…ã€è°ƒåº¦ã€é…ç½®ã€éƒ¨ç½²ç­‰ç®¡ç†å·¥ä½œã€‚\n\n\n\n\n\n\n\n\n\nä¸€äº›å¸¸ç”¨çš„Label ç¤ºä¾‹å¦‚ä¸‹ï¼š\n\nç‰ˆæœ¬æ ‡ç­¾ï¼šâ€versionâ€:â€releaseâ€, â€œversionâ€:â€stableâ€â€¦â€¦\nç¯å¢ƒæ ‡ç­¾ï¼šâ€environmentâ€:â€devâ€ï¼Œâ€environmentâ€:â€testâ€ï¼Œâ€environmentâ€:â€proâ€\næ¶æ„æ ‡ç­¾ï¼šâ€tierâ€:â€frontendâ€ï¼Œâ€tierâ€:â€backendâ€\n\næ ‡ç­¾å®šä¹‰å®Œæ¯•ä¹‹åï¼Œè¿˜è¦è€ƒè™‘åˆ°æ ‡ç­¾çš„é€‰æ‹©ï¼Œè¿™å°±è¦ä½¿ç”¨åˆ°Label Selectorï¼Œå³ï¼š\nLabelç”¨äºç»™æŸä¸ªèµ„æºå¯¹è±¡å®šä¹‰æ ‡è¯†\nLabel Selectorç”¨äºæŸ¥è¯¢å’Œç­›é€‰æ‹¥æœ‰æŸäº›æ ‡ç­¾çš„èµ„æºå¯¹è±¡\nå½“å‰æœ‰ä¸¤ç§Label Selectorï¼š\n\nåŸºäºç­‰å¼çš„Label Selector\nname &#x3D; slave: é€‰æ‹©æ‰€æœ‰åŒ…å«Labelä¸­key&#x3D;â€nameâ€ä¸”value&#x3D;â€slaveâ€çš„å¯¹è±¡\nenv !&#x3D; production: é€‰æ‹©æ‰€æœ‰åŒ…æ‹¬Labelä¸­çš„key&#x3D;â€envâ€ä¸”valueä¸ç­‰äºâ€productionâ€çš„å¯¹è±¡\n\nåŸºäºé›†åˆçš„Label Selector\nname in (master, slave): é€‰æ‹©æ‰€æœ‰åŒ…å«Labelä¸­çš„key&#x3D;â€nameâ€ä¸”value&#x3D;â€masterâ€æˆ–â€slaveâ€çš„å¯¹è±¡\nname not in (frontend): é€‰æ‹©æ‰€æœ‰åŒ…å«Labelä¸­çš„key&#x3D;â€nameâ€ä¸”valueä¸ç­‰äºâ€frontendâ€çš„å¯¹è±¡\n\n\næ ‡ç­¾çš„é€‰æ‹©æ¡ä»¶å¯ä»¥ä½¿ç”¨å¤šä¸ªï¼Œæ­¤æ—¶å°†å¤šä¸ªLabel Selectorè¿›è¡Œç»„åˆï¼Œä½¿ç”¨é€—å·â€,â€è¿›è¡Œåˆ†éš”å³å¯ã€‚ä¾‹å¦‚ï¼š\nname&#x3D;slaveï¼Œenv!&#x3D;production\nname not in (frontend)ï¼Œenv!&#x3D;production\nå‘½ä»¤æ–¹å¼\n# ä¸ºpodèµ„æºæ‰“æ ‡ç­¾\n[root@master ~]# kubectl label pod nginx-pod version&#x3D;1.0 -n dev\npod&#x2F;nginx-pod labeled\n\n# ä¸ºpodèµ„æºæ›´æ–°æ ‡ç­¾\n[root@master ~]# kubectl label pod nginx-pod version&#x3D;2.0 -n dev --overwrite\npod&#x2F;nginx-pod labeled\n\n# æŸ¥çœ‹æ ‡ç­¾\n[root@master ~]# kubectl get pod nginx-pod  -n dev --show-labels\nNAME        READY   STATUS    RESTARTS   AGE   LABELS\nnginx-pod   1&#x2F;1     Running   0          10m   version&#x3D;2.0\n\n# ç­›é€‰æ ‡ç­¾\n[root@master ~]# kubectl get pod -n dev -l version&#x3D;2.0  --show-labels\nNAME        READY   STATUS    RESTARTS   AGE   LABELS\nnginx-pod   1&#x2F;1     Running   0          17m   version&#x3D;2.0\n[root@master ~]# kubectl get pod -n dev -l version!&#x3D;2.0 --show-labels\nNo resources found in dev namespace.\n\n#åˆ é™¤æ ‡ç­¾\n[root@master ~]# kubectl label pod nginx-pod version- -n dev\npod&#x2F;nginx-pod labeled\n\né…ç½®æ–¹å¼\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\n  namespace: dev\n  labels:\n    version: &quot;3.0&quot; \n    env: &quot;test&quot;\nspec:\n  containers:\n  - image: nginx:latest\n    name: pod\n    ports:\n    - name: nginx-port\n      containerPort: 80\n      protocol: TCP\n\nç„¶åå°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„æ›´æ–°å‘½ä»¤äº†ï¼škubectl apply -f pod-nginx.yaml\n4.4 Deploymentåœ¨kubernetesä¸­ï¼ŒPodæ˜¯æœ€å°çš„æ§åˆ¶å•å…ƒï¼Œä½†æ˜¯kuberneteså¾ˆå°‘ç›´æ¥æ§åˆ¶Podï¼Œä¸€èˆ¬éƒ½æ˜¯é€šè¿‡Podæ§åˆ¶å™¨æ¥å®Œæˆçš„ã€‚Podæ§åˆ¶å™¨ç”¨äºpodçš„ç®¡ç†ï¼Œç¡®ä¿podèµ„æºç¬¦åˆé¢„æœŸçš„çŠ¶æ€ï¼Œå½“podçš„èµ„æºå‡ºç°æ•…éšœæ—¶ï¼Œä¼šå°è¯•è¿›è¡Œé‡å¯æˆ–é‡å»ºpodã€‚\nåœ¨kubernetesä¸­Podæ§åˆ¶å™¨çš„ç§ç±»æœ‰å¾ˆå¤šï¼Œæœ¬ç« èŠ‚åªä»‹ç»ä¸€ç§ï¼šDeploymentã€‚\n\nå‘½ä»¤æ“ä½œ\n# å‘½ä»¤æ ¼å¼: kubectl create deployment åç§°  [å‚æ•°] \n# --image  æŒ‡å®špodçš„é•œåƒ\n# --port   æŒ‡å®šç«¯å£\n# --replicas  æŒ‡å®šåˆ›å»ºpodæ•°é‡\n# --namespace  æŒ‡å®šnamespace\n[root@master ~]# kubectl create deploy nginx --image&#x3D;nginx:latest --port&#x3D;80 --replicas&#x3D;3 -n dev\ndeployment.apps&#x2F;nginx created\n\n# æŸ¥çœ‹åˆ›å»ºçš„Pod\n[root@master ~]# kubectl get pods -n dev\nNAME                     READY   STATUS    RESTARTS   AGE\nnginx-5ff7956ff6-6k8cb   1&#x2F;1     Running   0          19s\nnginx-5ff7956ff6-jxfjt   1&#x2F;1     Running   0          19s\nnginx-5ff7956ff6-v6jqw   1&#x2F;1     Running   0          19s\n\n# æŸ¥çœ‹deploymentçš„ä¿¡æ¯\n[root@master ~]# kubectl get deploy -n dev\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\nnginx   3&#x2F;3     3            3           2m42s\n\n# UP-TO-DATEï¼šæˆåŠŸå‡çº§çš„å‰¯æœ¬æ•°é‡\n# AVAILABLEï¼šå¯ç”¨å‰¯æœ¬çš„æ•°é‡\n[root@master ~]# kubectl get deploy -n dev -o wide\nNAME    READY UP-TO-DATE  AVAILABLE   AGE     CONTAINERS   IMAGES              SELECTOR\nnginx   3&#x2F;3     3         3           2m51s   nginx        nginx:latest        run&#x3D;nginx\n\n# æŸ¥çœ‹deploymentçš„è¯¦ç»†ä¿¡æ¯\n[root@master ~]# kubectl describe deploy nginx -n dev\nName:                   nginx\nNamespace:              dev\nCreationTimestamp:      Wed, 08 May 2021 11:14:14 +0800\nLabels:                 run&#x3D;nginx\nAnnotations:            deployment.kubernetes.io&#x2F;revision: 1\nSelector:               run&#x3D;nginx\nReplicas:               3 desired | 3 updated | 3 total | 3 available | 0 unavailable\nStrategyType:           RollingUpdate\nMinReadySeconds:        0\nRollingUpdateStrategy:  25% max unavailable, 25% max surge\nPod Template:\n  Labels:  run&#x3D;nginx\n  Containers:\n   nginx:\n    Image:        nginx:latest\n    Port:         80&#x2F;TCP\n    Host Port:    0&#x2F;TCP\n    Environment:  &lt;none&gt;\n    Mounts:       &lt;none&gt;\n  Volumes:        &lt;none&gt;\nConditions:\n  Type           Status  Reason\n  ----           ------  ------\n  Available      True    MinimumReplicasAvailable\n  Progressing    True    NewReplicaSetAvailable\nOldReplicaSets:  &lt;none&gt;\nNewReplicaSet:   nginx-5ff7956ff6 (3&#x2F;3 replicas created)\nEvents:\n  Type    Reason             Age    From                   Message\n  ----    ------             ----   ----                   -------\n  Normal  ScalingReplicaSet  5m43s  deployment-controller  Scaled up replicaset nginx-5ff7956ff6 to 3\n  \n# åˆ é™¤ \n[root@master ~]# kubectl delete deploy nginx -n dev\ndeployment.apps &quot;nginx&quot; deleted\n\né…ç½®æ“ä½œ\nåˆ›å»ºä¸€ä¸ªdeploy-nginx.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š\napiVersion: apps&#x2F;v1\nkind: Deployment\nmetadata:\n  name: nginx\n  namespace: dev\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      run: nginx\n  template:\n    metadata:\n      labels:\n        run: nginx\n    spec:\n      containers:\n      - image: nginx:latest\n        name: nginx\n        ports:\n        - containerPort: 80\n          protocol: TCP\n\nç„¶åå°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„åˆ›å»ºå’Œåˆ é™¤å‘½ä»¤äº†ï¼š\nåˆ›å»ºï¼škubectl create -f deploy-nginx.yaml\nåˆ é™¤ï¼škubectl delete -f deploy-nginx.yaml\n4.5 Serviceé€šè¿‡ä¸ŠèŠ‚è¯¾çš„å­¦ä¹ ï¼Œå·²ç»èƒ½å¤Ÿåˆ©ç”¨Deploymentæ¥åˆ›å»ºä¸€ç»„Podæ¥æä¾›å…·æœ‰é«˜å¯ç”¨æ€§çš„æœåŠ¡ã€‚\nè™½ç„¶æ¯ä¸ªPodéƒ½ä¼šåˆ†é…ä¸€ä¸ªå•ç‹¬çš„Pod IPï¼Œç„¶è€Œå´å­˜åœ¨å¦‚ä¸‹ä¸¤é—®é¢˜ï¼š\n\nPod IP ä¼šéšç€Podçš„é‡å»ºäº§ç”Ÿå˜åŒ–\nPod IP ä»…ä»…æ˜¯é›†ç¾¤å†…å¯è§çš„è™šæ‹ŸIPï¼Œå¤–éƒ¨æ— æ³•è®¿é—®\n\nè¿™æ ·å¯¹äºè®¿é—®è¿™ä¸ªæœåŠ¡å¸¦æ¥äº†éš¾åº¦ã€‚å› æ­¤ï¼Œkubernetesè®¾è®¡äº†Serviceæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\nServiceå¯ä»¥çœ‹ä½œæ˜¯ä¸€ç»„åŒç±»Podå¯¹å¤–çš„è®¿é—®æ¥å£ã€‚å€ŸåŠ©Serviceï¼Œåº”ç”¨å¯ä»¥æ–¹ä¾¿åœ°å®ç°æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ã€‚\n\næ“ä½œä¸€ï¼šåˆ›å»ºé›†ç¾¤å†…éƒ¨å¯è®¿é—®çš„Service\n# æš´éœ²Service\n[root@master ~]# kubectl expose deploy nginx --name&#x3D;svc-nginx1 --type&#x3D;ClusterIP --port&#x3D;80 --target-port&#x3D;80 -n dev\nservice&#x2F;svc-nginx1 exposed\n\n# æŸ¥çœ‹service\n[root@master ~]# kubectl get svc svc-nginx1 -n dev -o wide\nNAME         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE     SELECTOR\nsvc-nginx1   ClusterIP   10.109.179.231   &lt;none&gt;        80&#x2F;TCP    3m51s   run&#x3D;nginx\n\n# è¿™é‡Œäº§ç”Ÿäº†ä¸€ä¸ªCLUSTER-IPï¼Œè¿™å°±æ˜¯serviceçš„IPï¼Œåœ¨Serviceçš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œè¿™ä¸ªåœ°å€æ˜¯ä¸ä¼šå˜åŠ¨çš„\n# å¯ä»¥é€šè¿‡è¿™ä¸ªIPè®¿é—®å½“å‰serviceå¯¹åº”çš„POD\n[root@master ~]# curl 10.109.179.231:80\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;Welcome to nginx!&lt;&#x2F;title&gt;\n&lt;&#x2F;head&gt;\n&lt;body&gt;\n&lt;h1&gt;Welcome to nginx!&lt;&#x2F;h1&gt;\n.......\n&lt;&#x2F;body&gt;\n&lt;&#x2F;html&gt;\n\næ“ä½œäºŒï¼šåˆ›å»ºé›†ç¾¤å¤–éƒ¨ä¹Ÿå¯è®¿é—®çš„Service\n# ä¸Šé¢åˆ›å»ºçš„Serviceçš„typeç±»å‹ä¸ºClusterIPï¼Œè¿™ä¸ªipåœ°å€åªç”¨é›†ç¾¤å†…éƒ¨å¯è®¿é—®\n# å¦‚æœéœ€è¦åˆ›å»ºå¤–éƒ¨ä¹Ÿå¯ä»¥è®¿é—®çš„Serviceï¼Œéœ€è¦ä¿®æ”¹typeä¸ºNodePort\n[root@master ~]# kubectl expose deploy nginx --name&#x3D;svc-nginx2 --type&#x3D;NodePort --port&#x3D;80 --target-port&#x3D;80 -n dev\nservice&#x2F;svc-nginx2 exposed\n\n# æ­¤æ—¶æŸ¥çœ‹ï¼Œä¼šå‘ç°å‡ºç°äº†NodePortç±»å‹çš„Serviceï¼Œè€Œä¸”æœ‰ä¸€å¯¹Portï¼ˆ80:31928&#x2F;TCï¼‰\n[root@master ~]# kubectl get svc  svc-nginx2  -n dev -o wide\nNAME          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE    SELECTOR\nsvc-nginx2    NodePort    10.100.94.0      &lt;none&gt;        80:31928&#x2F;TCP   9s     run&#x3D;nginx\n\n# æ¥ä¸‹æ¥å°±å¯ä»¥é€šè¿‡é›†ç¾¤å¤–çš„ä¸»æœºè®¿é—® èŠ‚ç‚¹IP:31928è®¿é—®æœåŠ¡äº†\n# ä¾‹å¦‚åœ¨çš„ç”µè„‘ä¸»æœºä¸Šé€šè¿‡æµè§ˆå™¨è®¿é—®ä¸‹é¢çš„åœ°å€\nhttp:&#x2F;&#x2F;192.168.5.4:31928&#x2F;\n\nåˆ é™¤Service\n[root@master ~]# kubectl delete svc svc-nginx-1 -n dev service &quot;svc-nginx-1&quot; deleted\n\né…ç½®æ–¹å¼\nåˆ›å»ºä¸€ä¸ªsvc-nginx.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š\napiVersion: v1\nkind: Service\nmetadata:\n  name: svc-nginx\n  namespace: dev\nspec:\n  clusterIP: 10.109.179.231 #å›ºå®šsvcçš„å†…ç½‘ip\n  ports:\n  - port: 80\n    protocol: TCP\n    targetPort: 80\n  selector:\n    run: nginx\n  type: ClusterIP\n\nç„¶åå°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„åˆ›å»ºå’Œåˆ é™¤å‘½ä»¤äº†ï¼š\nåˆ›å»ºï¼škubectl create -f svc-nginx.yaml\nåˆ é™¤ï¼škubectl delete -f svc-nginx.yaml\n\n\n\n\n\n\n\n\n\nå°ç»“\nè‡³æ­¤ï¼Œå·²ç»æŒæ¡äº†Namespaceã€Podã€Deploymentã€Serviceèµ„æºçš„åŸºæœ¬æ“ä½œï¼Œæœ‰äº†è¿™äº›æ“ä½œï¼Œå°±å¯ä»¥åœ¨kubernetesé›†ç¾¤ä¸­å®ç°ä¸€ä¸ªæœåŠ¡çš„ç®€å•éƒ¨ç½²å’Œè®¿é—®äº†ï¼Œä½†æ˜¯å¦‚æœæƒ³è¦æ›´å¥½çš„ä½¿ç”¨kubernetesï¼Œå°±éœ€è¦æ·±å…¥å­¦ä¹ è¿™å‡ ç§èµ„æºçš„ç»†èŠ‚å’ŒåŸç†ã€‚\n5. Podè¯¦è§£5.1 Podä»‹ç»5.1.1 Podç»“æ„\næ¯ä¸ªPodä¸­éƒ½å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ï¼Œè¿™äº›å®¹å™¨å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š\n\nç”¨æˆ·ç¨‹åºæ‰€åœ¨çš„å®¹å™¨ï¼Œæ•°é‡å¯å¤šå¯å°‘\n\nPauseå®¹å™¨ï¼Œè¿™æ˜¯æ¯ä¸ªPodéƒ½ä¼šæœ‰çš„ä¸€ä¸ªæ ¹å®¹å™¨ï¼Œå®ƒçš„ä½œç”¨æœ‰ä¸¤ä¸ªï¼š\n\nå¯ä»¥ä»¥å®ƒä¸ºä¾æ®ï¼Œè¯„ä¼°æ•´ä¸ªPodçš„å¥åº·çŠ¶æ€\n\nå¯ä»¥åœ¨æ ¹å®¹å™¨ä¸Šè®¾ç½®Ipåœ°å€ï¼Œå…¶å®ƒå®¹å™¨éƒ½æ­¤Ipï¼ˆPod IPï¼‰ï¼Œä»¥å®ç°Podå†…éƒ¨çš„ç½‘è·¯é€šä¿¡\nè¿™é‡Œæ˜¯Podå†…éƒ¨çš„é€šè®¯ï¼ŒPodçš„ä¹‹é—´çš„é€šè®¯é‡‡ç”¨è™šæ‹ŸäºŒå±‚ç½‘ç»œæŠ€æœ¯æ¥å®ç°ï¼Œæˆ‘ä»¬å½“å‰ç¯å¢ƒç”¨çš„æ˜¯Flannel\n\n\n\n5.1.2 Podå®šä¹‰ä¸‹é¢æ˜¯Podçš„èµ„æºæ¸…å•ï¼š\napiVersion: v1     #å¿…é€‰ï¼Œç‰ˆæœ¬å·ï¼Œä¾‹å¦‚v1\nkind: Pod       ã€€ #å¿…é€‰ï¼Œèµ„æºç±»å‹ï¼Œä¾‹å¦‚ Pod\nmetadata:       ã€€ #å¿…é€‰ï¼Œå…ƒæ•°æ®\n  name: string     #å¿…é€‰ï¼ŒPodåç§°\n  namespace: string  #Podæ‰€å±çš„å‘½åç©ºé—´,é»˜è®¤ä¸º&quot;default&quot;\n  labels:       ã€€ã€€  #è‡ªå®šä¹‰æ ‡ç­¾åˆ—è¡¨\n    - name: string      ã€€          \nspec:  #å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰\n  containers:  #å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨\n  - name: string   #å¿…é€‰ï¼Œå®¹å™¨åç§°\n    image: string  #å¿…é€‰ï¼Œå®¹å™¨çš„é•œåƒåç§°\n    imagePullPolicy: [ Always|Never|IfNotPresent ]  #è·å–é•œåƒçš„ç­–ç•¥ \n    command: [string]   #å®¹å™¨çš„å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œå¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤\n    args: [string]      #å®¹å™¨çš„å¯åŠ¨å‘½ä»¤å‚æ•°åˆ—è¡¨\n    workingDir: string  #å®¹å™¨çš„å·¥ä½œç›®å½•\n    volumeMounts:       #æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½®\n    - name: string      #å¼•ç”¨podå®šä¹‰çš„å…±äº«å­˜å‚¨å·çš„åç§°ï¼Œéœ€ç”¨volumes[]éƒ¨åˆ†å®šä¹‰çš„çš„å·å\n      mountPath: string #å­˜å‚¨å·åœ¨å®¹å™¨å†…mountçš„ç»å¯¹è·¯å¾„ï¼Œåº”å°‘äº512å­—ç¬¦\n      readOnly: boolean #æ˜¯å¦ä¸ºåªè¯»æ¨¡å¼\n    ports: #éœ€è¦æš´éœ²çš„ç«¯å£åº“å·åˆ—è¡¨\n    - name: string        #ç«¯å£çš„åç§°\n      containerPort: int  #å®¹å™¨éœ€è¦ç›‘å¬çš„ç«¯å£å·\n      hostPort: int       #å®¹å™¨æ‰€åœ¨ä¸»æœºéœ€è¦ç›‘å¬çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸Containerç›¸åŒ\n      protocol: string    #ç«¯å£åè®®ï¼Œæ”¯æŒTCPå’ŒUDPï¼Œé»˜è®¤TCP\n    env:   #å®¹å™¨è¿è¡Œå‰éœ€è®¾ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨\n    - name: string  #ç¯å¢ƒå˜é‡åç§°\n      value: string #ç¯å¢ƒå˜é‡çš„å€¼\n    resources: #èµ„æºé™åˆ¶å’Œè¯·æ±‚çš„è®¾ç½®\n      limits:  #èµ„æºé™åˆ¶çš„è®¾ç½®\n        cpu: string     #Cpuçš„é™åˆ¶ï¼Œå•ä½ä¸ºcoreæ•°ï¼Œå°†ç”¨äºdocker run --cpu-shareså‚æ•°\n        memory: string  #å†…å­˜é™åˆ¶ï¼Œå•ä½å¯ä»¥ä¸ºMib&#x2F;Gibï¼Œå°†ç”¨äºdocker run --memoryå‚æ•°\n      requests: #èµ„æºè¯·æ±‚çš„è®¾ç½®\n        cpu: string    #Cpuè¯·æ±‚ï¼Œå®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡\n        memory: string #å†…å­˜è¯·æ±‚,å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡\n    lifecycle: #ç”Ÿå‘½å‘¨æœŸé’©å­\n        postStart: #å®¹å™¨å¯åŠ¨åç«‹å³æ‰§è¡Œæ­¤é’©å­,å¦‚æœæ‰§è¡Œå¤±è´¥,ä¼šæ ¹æ®é‡å¯ç­–ç•¥è¿›è¡Œé‡å¯\n        preStop: #å®¹å™¨ç»ˆæ­¢å‰æ‰§è¡Œæ­¤é’©å­,æ— è®ºç»“æœå¦‚ä½•,å®¹å™¨éƒ½ä¼šç»ˆæ­¢\n    livenessProbe:  #å¯¹Podå†…å„å®¹å™¨å¥åº·æ£€æŸ¥çš„è®¾ç½®ï¼Œå½“æ¢æµ‹æ— å“åº”å‡ æ¬¡åå°†è‡ªåŠ¨é‡å¯è¯¥å®¹å™¨\n      exec:       ã€€ #å¯¹Podå®¹å™¨å†…æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºexecæ–¹å¼\n        command: [string]  #execæ–¹å¼éœ€è¦åˆ¶å®šçš„å‘½ä»¤æˆ–è„šæœ¬\n      httpGet:       #å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹æ³•è®¾ç½®ä¸ºHttpGetï¼Œéœ€è¦åˆ¶å®šPathã€port\n        path: string\n        port: number\n        host: string\n        scheme: string\n        HttpHeaders:\n        - name: string\n          value: string\n      tcpSocket:     #å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºtcpSocketæ–¹å¼\n         port: number\n       initialDelaySeconds: 0       #å®¹å™¨å¯åŠ¨å®Œæˆåé¦–æ¬¡æ¢æµ‹çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’\n       timeoutSeconds: 0    ã€€ã€€    #å¯¹å®¹å™¨å¥åº·æ£€æŸ¥æ¢æµ‹ç­‰å¾…å“åº”çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ï¼Œé»˜è®¤1ç§’\n       periodSeconds: 0     ã€€ã€€    #å¯¹å®¹å™¨ç›‘æ§æ£€æŸ¥çš„å®šæœŸæ¢æµ‹æ—¶é—´è®¾ç½®ï¼Œå•ä½ç§’ï¼Œé»˜è®¤10ç§’ä¸€æ¬¡\n       successThreshold: 0\n       failureThreshold: 0\n       securityContext:\n         privileged: false\n  restartPolicy: [Always | Never | OnFailure]  #Podçš„é‡å¯ç­–ç•¥\n  nodeName: &lt;string&gt; #è®¾ç½®NodeNameè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°æŒ‡å®šåˆ°åç§°çš„nodeèŠ‚ç‚¹ä¸Š\n  nodeSelector: obeject #è®¾ç½®NodeSelectorè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°åŒ…å«è¿™ä¸ªlabelçš„nodeä¸Š\n  imagePullSecrets: #Pullé•œåƒæ—¶ä½¿ç”¨çš„secretåç§°ï¼Œä»¥keyï¼šsecretkeyæ ¼å¼æŒ‡å®š\n  - name: string\n  hostNetwork: false   #æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ\n  volumes:   #åœ¨è¯¥podä¸Šå®šä¹‰å…±äº«å­˜å‚¨å·åˆ—è¡¨\n  - name: string    #å…±äº«å­˜å‚¨å·åç§° ï¼ˆvolumesç±»å‹æœ‰å¾ˆå¤šç§ï¼‰\n    emptyDir: &#123;&#125;       #ç±»å‹ä¸ºemtyDirçš„å­˜å‚¨å·ï¼Œä¸PodåŒç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ã€‚ä¸ºç©ºå€¼\n    hostPath: string   #ç±»å‹ä¸ºhostPathçš„å­˜å‚¨å·ï¼Œè¡¨ç¤ºæŒ‚è½½Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•\n      path: string      ã€€ã€€        #Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•ï¼Œå°†è¢«ç”¨äºåŒæœŸä¸­mountçš„ç›®å½•\n    secret:       ã€€ã€€ã€€#ç±»å‹ä¸ºsecretçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é›†ç¾¤ä¸å®šä¹‰çš„secretå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨\n      scretname: string  \n      items:     \n      - key: string\n        path: string\n    configMap:         #ç±»å‹ä¸ºconfigMapçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é¢„å®šä¹‰çš„configMapå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨\n      name: string\n      items:\n      - key: string\n        path: string\n\n#å°æç¤ºï¼š\n#   åœ¨è¿™é‡Œï¼Œå¯é€šè¿‡ä¸€ä¸ªå‘½ä»¤æ¥æŸ¥çœ‹æ¯ç§èµ„æºçš„å¯é…ç½®é¡¹\n#   kubectl explain èµ„æºç±»å‹         æŸ¥çœ‹æŸç§èµ„æºå¯ä»¥é…ç½®çš„ä¸€çº§å±æ€§\n#   kubectl explain èµ„æºç±»å‹.å±æ€§     æŸ¥çœ‹å±æ€§çš„å­å±æ€§\n[root@k8s-master01 ~]# kubectl explain pod\nKIND:     Pod\nVERSION:  v1\nFIELDS:\n   apiVersion   &lt;string&gt;\n   kind &lt;string&gt;\n   metadata     &lt;Object&gt;\n   spec &lt;Object&gt;\n   status       &lt;Object&gt;\n\n[root@k8s-master01 ~]# kubectl explain pod.metadata\nKIND:     Pod\nVERSION:  v1\nRESOURCE: metadata &lt;Object&gt;\nFIELDS:\n   annotations  &lt;map[string]string&gt;\n   clusterName  &lt;string&gt;\n   creationTimestamp    &lt;string&gt;\n   deletionGracePeriodSeconds   &lt;integer&gt;\n   deletionTimestamp    &lt;string&gt;\n   finalizers   &lt;[]string&gt;\n   generateName &lt;string&gt;\n   generation   &lt;integer&gt;\n   labels       &lt;map[string]string&gt;\n   managedFields        &lt;[]Object&gt;\n   name &lt;string&gt;\n   namespace    &lt;string&gt;\n   ownerReferences      &lt;[]Object&gt;\n   resourceVersion      &lt;string&gt;\n   selfLink     &lt;string&gt;\n   uid  &lt;string&gt;\n\nåœ¨kubernetesä¸­åŸºæœ¬æ‰€æœ‰èµ„æºçš„ä¸€çº§å±æ€§éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸»è¦åŒ…å«5éƒ¨åˆ†ï¼š\n\napiVersion  ç‰ˆæœ¬ï¼Œç”±kuberneteså†…éƒ¨å®šä¹‰ï¼Œç‰ˆæœ¬å·å¿…é¡»å¯ä»¥ç”¨ kubectl api-versions æŸ¥è¯¢åˆ°\nkind  ç±»å‹ï¼Œç”±kuberneteså†…éƒ¨å®šä¹‰ï¼Œç‰ˆæœ¬å·å¿…é¡»å¯ä»¥ç”¨ kubectl api-resources æŸ¥è¯¢åˆ°\nmetadata  å…ƒæ•°æ®ï¼Œä¸»è¦æ˜¯èµ„æºæ ‡è¯†å’Œè¯´æ˜ï¼Œå¸¸ç”¨çš„æœ‰nameã€namespaceã€labelsç­‰\nspec  æè¿°ï¼Œè¿™æ˜¯é…ç½®ä¸­æœ€é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œé‡Œé¢æ˜¯å¯¹å„ç§èµ„æºé…ç½®çš„è¯¦ç»†æè¿°\nstatus  çŠ¶æ€ä¿¡æ¯ï¼Œé‡Œé¢çš„å†…å®¹ä¸éœ€è¦å®šä¹‰ï¼Œç”±kubernetesè‡ªåŠ¨ç”Ÿæˆ\n\nåœ¨ä¸Šé¢çš„å±æ€§ä¸­ï¼Œspecæ˜¯æ¥ä¸‹æ¥ç ”ç©¶çš„é‡ç‚¹ï¼Œç»§ç»­çœ‹ä¸‹å®ƒçš„å¸¸è§å­å±æ€§:\n\ncontainers &lt;[]Object&gt; å®¹å™¨åˆ—è¡¨ï¼Œç”¨äºå®šä¹‰å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯\nnodeName  æ ¹æ®nodeNameçš„å€¼å°†podè°ƒåº¦åˆ°æŒ‡å®šçš„NodeèŠ‚ç‚¹ä¸Š\nnodeSelector &lt;map[]&gt; æ ¹æ®NodeSelectorä¸­å®šä¹‰çš„ä¿¡æ¯é€‰æ‹©å°†è¯¥Podè°ƒåº¦åˆ°åŒ…å«è¿™äº›labelçš„Node ä¸Š\nhostNetwork  æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ\nvolumes &lt;[]Object&gt; å­˜å‚¨å·ï¼Œç”¨äºå®šä¹‰Podä¸Šé¢æŒ‚åœ¨çš„å­˜å‚¨ä¿¡æ¯\nrestartPolicy  é‡å¯ç­–ç•¥ï¼Œè¡¨ç¤ºPodåœ¨é‡åˆ°æ•…éšœçš„æ—¶å€™çš„å¤„ç†ç­–ç•¥\n\n5.2 Podé…ç½®æœ¬å°èŠ‚ä¸»è¦æ¥ç ”ç©¶pod.spec.containerså±æ€§ï¼Œè¿™ä¹Ÿæ˜¯podé…ç½®ä¸­æœ€ä¸ºå…³é”®çš„ä¸€é¡¹é…ç½®ã€‚\n[root@k8s-master01 ~]# kubectl explain pod.spec.containers\nKIND:     Pod\nVERSION:  v1\nRESOURCE: containers &lt;[]Object&gt;   # æ•°ç»„ï¼Œä»£è¡¨å¯ä»¥æœ‰å¤šä¸ªå®¹å™¨\nFIELDS:\n   name  &lt;string&gt;     # å®¹å™¨åç§°\n   image &lt;string&gt;     # å®¹å™¨éœ€è¦çš„é•œåƒåœ°å€\n   imagePullPolicy  &lt;string&gt; # é•œåƒæ‹‰å–ç­–ç•¥ \n   command  &lt;[]string&gt; # å®¹å™¨çš„å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œå¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤\n   args     &lt;[]string&gt; # å®¹å™¨çš„å¯åŠ¨å‘½ä»¤éœ€è¦çš„å‚æ•°åˆ—è¡¨\n   env      &lt;[]Object&gt; # å®¹å™¨ç¯å¢ƒå˜é‡çš„é…ç½®\n   ports    &lt;[]Object&gt;     # å®¹å™¨éœ€è¦æš´éœ²çš„ç«¯å£å·åˆ—è¡¨\n   resources &lt;Object&gt;      # èµ„æºé™åˆ¶å’Œèµ„æºè¯·æ±‚çš„è®¾ç½®\n\n5.2.1 åŸºæœ¬é…ç½®åˆ›å»ºpod-base.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-base\n  namespace: dev\n  labels:\n    user: heima\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  - name: busybox\n    image: busybox:1.30\n\n\nä¸Šé¢å®šä¹‰äº†ä¸€ä¸ªæ¯”è¾ƒç®€å•Podçš„é…ç½®ï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªå®¹å™¨ï¼š\n\nnginxï¼šç”¨1.17.1ç‰ˆæœ¬çš„nginxé•œåƒåˆ›å»ºï¼Œï¼ˆnginxæ˜¯ä¸€ä¸ªè½»é‡çº§webå®¹å™¨ï¼‰\nbusyboxï¼šç”¨1.30ç‰ˆæœ¬çš„busyboxé•œåƒåˆ›å»ºï¼Œï¼ˆbusyboxæ˜¯ä¸€ä¸ªå°å·§çš„linuxå‘½ä»¤é›†åˆï¼‰\n\n# åˆ›å»ºPod\n[root@k8s-master01 pod]# kubectl apply -f pod-base.yaml\npod&#x2F;pod-base created\n\n# æŸ¥çœ‹PodçŠ¶å†µ\n# READY 1&#x2F;2 : è¡¨ç¤ºå½“å‰Podä¸­æœ‰2ä¸ªå®¹å™¨ï¼Œå…¶ä¸­1ä¸ªå‡†å¤‡å°±ç»ªï¼Œ1ä¸ªæœªå°±ç»ª\n# RESTARTS  : é‡å¯æ¬¡æ•°ï¼Œå› ä¸ºæœ‰1ä¸ªå®¹å™¨æ•…éšœäº†ï¼ŒPodä¸€ç›´åœ¨é‡å¯è¯•å›¾æ¢å¤å®ƒ\n[root@k8s-master01 pod]# kubectl get pod -n dev\nNAME       READY   STATUS    RESTARTS   AGE\npod-base   1&#x2F;2     Running   4          95s\n\n# å¯ä»¥é€šè¿‡describeæŸ¥çœ‹å†…éƒ¨çš„è¯¦æƒ…\n# æ­¤æ—¶å·²ç»è¿è¡Œèµ·æ¥äº†ä¸€ä¸ªåŸºæœ¬çš„Podï¼Œè™½ç„¶å®ƒæš‚æ—¶æœ‰é—®é¢˜\n[root@k8s-master01 pod]# kubectl describe pod pod-base -n dev\n\n5.2.2 é•œåƒæ‹‰å–åˆ›å»ºpod-imagepullpolicy.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-imagepullpolicy\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    imagePullPolicy: Never # ç”¨äºè®¾ç½®é•œåƒæ‹‰å–ç­–ç•¥\n  - name: busybox\n    image: busybox:1.30\n\n\nimagePullPolicyï¼Œç”¨äºè®¾ç½®é•œåƒæ‹‰å–ç­–ç•¥ï¼Œkubernetesæ”¯æŒé…ç½®ä¸‰ç§æ‹‰å–ç­–ç•¥ï¼š\n\nAlwaysï¼šæ€»æ˜¯ä»è¿œç¨‹ä»“åº“æ‹‰å–é•œåƒï¼ˆä¸€ç›´è¿œç¨‹ä¸‹è½½ï¼‰\nIfNotPresentï¼šæœ¬åœ°æœ‰åˆ™ä½¿ç”¨æœ¬åœ°é•œåƒï¼Œæœ¬åœ°æ²¡æœ‰åˆ™ä»è¿œç¨‹ä»“åº“æ‹‰å–é•œåƒï¼ˆæœ¬åœ°æœ‰å°±æœ¬åœ° æœ¬åœ°æ²¡è¿œç¨‹ä¸‹è½½ï¼‰\nNeverï¼šåªä½¿ç”¨æœ¬åœ°é•œåƒï¼Œä»ä¸å»è¿œç¨‹ä»“åº“æ‹‰å–ï¼Œæœ¬åœ°æ²¡æœ‰å°±æŠ¥é”™ ï¼ˆä¸€ç›´ä½¿ç”¨æœ¬åœ°ï¼‰\n\n\n\n\n\n\n\n\n\n\né»˜è®¤å€¼è¯´æ˜ï¼š\nå¦‚æœé•œåƒtagä¸ºå…·ä½“ç‰ˆæœ¬å·ï¼Œ é»˜è®¤ç­–ç•¥æ˜¯ï¼šIfNotPresent\nå¦‚æœé•œåƒtagä¸ºï¼šlatestï¼ˆæœ€ç»ˆç‰ˆæœ¬ï¼‰ ï¼Œé»˜è®¤ç­–ç•¥æ˜¯always\n# åˆ›å»ºPod\n[root@k8s-master01 pod]# kubectl create -f pod-imagepullpolicy.yaml\npod&#x2F;pod-imagepullpolicy created\n\n# æŸ¥çœ‹Podè¯¦æƒ…\n# æ­¤æ—¶æ˜æ˜¾å¯ä»¥çœ‹åˆ°nginxé•œåƒæœ‰ä¸€æ­¥Pulling image &quot;nginx:1.17.1&quot;çš„è¿‡ç¨‹\n[root@k8s-master01 pod]# kubectl describe pod pod-imagepullpolicy -n dev\n......\nEvents:\n  Type     Reason     Age               From               Message\n  ----     ------     ----              ----               -------\n  Normal   Scheduled  &lt;unknown&gt;         default-scheduler  Successfully assigned dev&#x2F;pod-imagePullPolicy to node1\n  Normal   Pulling    32s               kubelet, node1     Pulling image &quot;nginx:1.17.1&quot;\n  Normal   Pulled     26s               kubelet, node1     Successfully pulled image &quot;nginx:1.17.1&quot;\n  Normal   Created    26s               kubelet, node1     Created container nginx\n  Normal   Started    25s               kubelet, node1     Started container nginx\n  Normal   Pulled     7s (x3 over 25s)  kubelet, node1     Container image &quot;busybox:1.30&quot; already present on machine\n  Normal   Created    7s (x3 over 25s)  kubelet, node1     Created container busybox\n  Normal   Started    7s (x3 over 25s)  kubelet, node1     Started container busybox\n\n5.2.3 å¯åŠ¨å‘½ä»¤åœ¨å‰é¢çš„æ¡ˆä¾‹ä¸­ï¼Œä¸€ç›´æœ‰ä¸€ä¸ªé—®é¢˜æ²¡æœ‰è§£å†³ï¼Œå°±æ˜¯çš„busyboxå®¹å™¨ä¸€ç›´æ²¡æœ‰æˆåŠŸè¿è¡Œï¼Œé‚£ä¹ˆåˆ°åº•æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´è¿™ä¸ªå®¹å™¨çš„æ•…éšœå‘¢ï¼Ÿ\nåŸæ¥busyboxå¹¶ä¸æ˜¯ä¸€ä¸ªç¨‹åºï¼Œè€Œæ˜¯ç±»ä¼¼äºä¸€ä¸ªå·¥å…·ç±»çš„é›†åˆï¼Œkubernetesé›†ç¾¤å¯åŠ¨ç®¡ç†åï¼Œå®ƒä¼šè‡ªåŠ¨å…³é—­ã€‚è§£å†³æ–¹æ³•å°±æ˜¯è®©å…¶ä¸€ç›´åœ¨è¿è¡Œï¼Œè¿™å°±ç”¨åˆ°äº†commandé…ç½®ã€‚\nåˆ›å»ºpod-command.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-command\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  - name: busybox\n    image: busybox:1.30\n    command: [&quot;&#x2F;bin&#x2F;sh&quot;,&quot;-c&quot;,&quot;touch &#x2F;tmp&#x2F;hello.txt;while true;do &#x2F;bin&#x2F;echo $(date +%T) &gt;&gt; &#x2F;tmp&#x2F;hello.txt; sleep 3; done;&quot;]\n\n\ncommandï¼Œç”¨äºåœ¨podä¸­çš„å®¹å™¨åˆå§‹åŒ–å®Œæ¯•ä¹‹åè¿è¡Œä¸€ä¸ªå‘½ä»¤ã€‚\n\n\n\n\n\n\n\n\n\nç¨å¾®è§£é‡Šä¸‹ä¸Šé¢å‘½ä»¤çš„æ„æ€ï¼š\nâ€œ&#x2F;bin&#x2F;shâ€,â€-câ€, ä½¿ç”¨shæ‰§è¡Œå‘½ä»¤\ntouch &#x2F;tmp&#x2F;hello.txt; åˆ›å»ºä¸€ä¸ª&#x2F;tmp&#x2F;hello.txt æ–‡ä»¶\nwhile true;do &#x2F;bin&#x2F;echo $(date +%T) &gt;&gt; &#x2F;tmp&#x2F;hello.txt; sleep 3; done; æ¯éš”3ç§’å‘æ–‡ä»¶ä¸­å†™å…¥å½“å‰æ—¶é—´\n# åˆ›å»ºPod\n[root@k8s-master01 pod]# kubectl create  -f pod-command.yaml\npod&#x2F;pod-command created\n\n# æŸ¥çœ‹PodçŠ¶æ€\n# æ­¤æ—¶å‘ç°ä¸¤ä¸ªpodéƒ½æ­£å¸¸è¿è¡Œäº†\n[root@k8s-master01 pod]# kubectl get pods pod-command -n dev\nNAME          READY   STATUS   RESTARTS   AGE\npod-command   2&#x2F;2     Runing   0          2s\n\n# è¿›å…¥podä¸­çš„busyboxå®¹å™¨ï¼ŒæŸ¥çœ‹æ–‡ä»¶å†…å®¹\n# è¡¥å……ä¸€ä¸ªå‘½ä»¤: kubectl exec  podåç§° -n å‘½åç©ºé—´ -it -c å®¹å™¨åç§° &#x2F;bin&#x2F;sh  åœ¨å®¹å™¨å†…éƒ¨æ‰§è¡Œå‘½ä»¤\n# ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å°±å¯ä»¥è¿›å…¥æŸä¸ªå®¹å™¨çš„å†…éƒ¨ï¼Œç„¶åè¿›è¡Œç›¸å…³æ“ä½œäº†\n# æ¯”å¦‚ï¼Œå¯ä»¥æŸ¥çœ‹txtæ–‡ä»¶çš„å†…å®¹\n[root@k8s-master01 pod]# kubectl exec pod-command -n dev -it -c busybox &#x2F;bin&#x2F;sh\n&#x2F; # tail -f &#x2F;tmp&#x2F;hello.txt\n14:44:19\n14:44:22\n14:44:25\n\nç‰¹åˆ«è¯´æ˜ï¼š\n    é€šè¿‡ä¸Šé¢å‘ç°commandå·²ç»å¯ä»¥å®Œæˆå¯åŠ¨å‘½ä»¤å’Œä¼ é€’å‚æ•°çš„åŠŸèƒ½ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œè¿˜è¦æä¾›ä¸€ä¸ªargsé€‰é¡¹ï¼Œç”¨äºä¼ é€’å‚æ•°å‘¢?è¿™å…¶å®è·Ÿdockeræœ‰ç‚¹å…³ç³»ï¼Œkubernetesä¸­çš„commandã€argsä¸¤é¡¹å…¶å®æ˜¯å®ç°è¦†ç›–Dockerfileä¸­ENTRYPOINTçš„åŠŸèƒ½ã€‚\n 1 å¦‚æœcommandå’Œargså‡æ²¡æœ‰å†™ï¼Œé‚£ä¹ˆç”¨Dockerfileçš„é…ç½®ã€‚\n 2 å¦‚æœcommandå†™äº†ï¼Œä½†argsæ²¡æœ‰å†™ï¼Œé‚£ä¹ˆDockerfileé»˜è®¤çš„é…ç½®ä¼šè¢«å¿½ç•¥ï¼Œæ‰§è¡Œè¾“å…¥çš„command\n 3 å¦‚æœcommandæ²¡å†™ï¼Œä½†argså†™äº†ï¼Œé‚£ä¹ˆDockerfileä¸­é…ç½®çš„ENTRYPOINTçš„å‘½ä»¤ä¼šè¢«æ‰§è¡Œï¼Œä½¿ç”¨å½“å‰argsçš„å‚æ•°\n 4 å¦‚æœcommandå’Œargséƒ½å†™äº†ï¼Œé‚£ä¹ˆDockerfileçš„é…ç½®è¢«å¿½ç•¥ï¼Œæ‰§è¡Œcommandå¹¶è¿½åŠ ä¸Šargså‚æ•°\n\n5.2.4 ç¯å¢ƒå˜é‡åˆ›å»ºpod-env.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-env\n  namespace: dev\nspec:\n  containers:\n  - name: busybox\n    image: busybox:1.30\n    command: [&quot;&#x2F;bin&#x2F;sh&quot;,&quot;-c&quot;,&quot;while true;do &#x2F;bin&#x2F;echo $(date +%T);sleep 60; done;&quot;]\n    env: # è®¾ç½®ç¯å¢ƒå˜é‡åˆ—è¡¨\n    - name: &quot;username&quot;\n      value: &quot;admin&quot;\n    - name: &quot;password&quot;\n      value: &quot;123456&quot;\n\nenvï¼Œç¯å¢ƒå˜é‡ï¼Œç”¨äºåœ¨podä¸­çš„å®¹å™¨è®¾ç½®ç¯å¢ƒå˜é‡ã€‚\n# åˆ›å»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-env.yaml\npod&#x2F;pod-env created\n\n# è¿›å…¥å®¹å™¨ï¼Œè¾“å‡ºç¯å¢ƒå˜é‡\n[root@k8s-master01 ~]# kubectl exec pod-env -n dev -c busybox -it &#x2F;bin&#x2F;sh\n&#x2F; # echo $username\nadmin\n&#x2F; # echo $password\n123456\n\nè¿™ç§æ–¹å¼ä¸æ˜¯å¾ˆæ¨èï¼Œæ¨èå°†è¿™äº›é…ç½®å•ç‹¬å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œè¿™ç§æ–¹å¼å°†åœ¨åé¢ä»‹ç»ã€‚\n5.2.5 ç«¯å£è®¾ç½®æœ¬å°èŠ‚æ¥ä»‹ç»å®¹å™¨çš„ç«¯å£è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯containersçš„portsé€‰é¡¹ã€‚\né¦–å…ˆçœ‹ä¸‹portsæ”¯æŒçš„å­é€‰é¡¹ï¼š\n[root@k8s-master01 ~]# kubectl explain pod.spec.containers.ports\nKIND:     Pod\nVERSION:  v1\nRESOURCE: ports &lt;[]Object&gt;\nFIELDS:\n   name         &lt;string&gt;  # ç«¯å£åç§°ï¼Œå¦‚æœæŒ‡å®šï¼Œå¿…é¡»ä¿è¯nameåœ¨podä¸­æ˜¯å”¯ä¸€çš„\t\t\n   containerPort&lt;integer&gt; # å®¹å™¨è¦ç›‘å¬çš„ç«¯å£(0&lt;x&lt;65536)\n   hostPort     &lt;integer&gt; # å®¹å™¨è¦åœ¨ä¸»æœºä¸Šå…¬å¼€çš„ç«¯å£ï¼Œå¦‚æœè®¾ç½®ï¼Œä¸»æœºä¸Šåªèƒ½è¿è¡Œå®¹å™¨çš„ä¸€ä¸ªå‰¯æœ¬(ä¸€èˆ¬çœç•¥) \n   hostIP       &lt;string&gt;  # è¦å°†å¤–éƒ¨ç«¯å£ç»‘å®šåˆ°çš„ä¸»æœºIP(ä¸€èˆ¬çœç•¥)\n   protocol     &lt;string&gt;  # ç«¯å£åè®®ã€‚å¿…é¡»æ˜¯UDPã€TCPæˆ–SCTPã€‚é»˜è®¤ä¸ºâ€œTCPâ€ã€‚\n\næ¥ä¸‹æ¥ï¼Œç¼–å†™ä¸€ä¸ªæµ‹è¯•æ¡ˆä¾‹ï¼Œåˆ›å»ºpod-ports.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-ports\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports: # è®¾ç½®å®¹å™¨æš´éœ²çš„ç«¯å£åˆ—è¡¨\n    - name: nginx-port\n      containerPort: 80\n      protocol: TCP\n\n# åˆ›å»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-ports.yaml\npod&#x2F;pod-ports created\n\n# æŸ¥çœ‹pod\n# åœ¨ä¸‹é¢å¯ä»¥æ˜æ˜¾çœ‹åˆ°é…ç½®ä¿¡æ¯\n[root@k8s-master01 ~]# kubectl get pod pod-ports -n dev -o yaml\n......\nspec:\n  containers:\n  - image: nginx:1.17.1\n    imagePullPolicy: IfNotPresent\n    name: nginx\n    ports:\n    - containerPort: 80\n      name: nginx-port\n      protocol: TCP\n......\n\nè®¿é—®å®¹å™¨ä¸­çš„ç¨‹åºéœ€è¦ä½¿ç”¨çš„æ˜¯Podip:containerPort\n5.2.6 èµ„æºé…é¢å®¹å™¨ä¸­çš„ç¨‹åºè¦è¿è¡Œï¼Œè‚¯å®šæ˜¯è¦å ç”¨ä¸€å®šèµ„æºçš„ï¼Œæ¯”å¦‚cpuå’Œå†…å­˜ç­‰ï¼Œå¦‚æœä¸å¯¹æŸä¸ªå®¹å™¨çš„èµ„æºåšé™åˆ¶ï¼Œé‚£ä¹ˆå®ƒå°±å¯èƒ½åƒæ‰å¤§é‡èµ„æºï¼Œå¯¼è‡´å…¶å®ƒå®¹å™¨æ— æ³•è¿è¡Œã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œkubernetesæä¾›äº†å¯¹å†…å­˜å’Œcpuçš„èµ„æºè¿›è¡Œé…é¢çš„æœºåˆ¶ï¼Œè¿™ç§æœºåˆ¶ä¸»è¦é€šè¿‡resourcesé€‰é¡¹å®ç°ï¼Œä»–æœ‰ä¸¤ä¸ªå­é€‰é¡¹ï¼š\n\nlimitsï¼šç”¨äºé™åˆ¶è¿è¡Œæ—¶å®¹å™¨çš„æœ€å¤§å ç”¨èµ„æºï¼Œå½“å®¹å™¨å ç”¨èµ„æºè¶…è¿‡limitsæ—¶ä¼šè¢«ç»ˆæ­¢ï¼Œå¹¶è¿›è¡Œé‡å¯\nrequests ï¼šç”¨äºè®¾ç½®å®¹å™¨éœ€è¦çš„æœ€å°èµ„æºï¼Œå¦‚æœç¯å¢ƒèµ„æºä¸å¤Ÿï¼Œå®¹å™¨å°†æ— æ³•å¯åŠ¨\n\nå¯ä»¥é€šè¿‡ä¸Šé¢ä¸¤ä¸ªé€‰é¡¹è®¾ç½®èµ„æºçš„ä¸Šä¸‹é™ã€‚\næ¥ä¸‹æ¥ï¼Œç¼–å†™ä¸€ä¸ªæµ‹è¯•æ¡ˆä¾‹ï¼Œåˆ›å»ºpod-resources.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-resources\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    resources: # èµ„æºé…é¢\n      limits:  # é™åˆ¶èµ„æºï¼ˆä¸Šé™ï¼‰\n        cpu: &quot;2&quot; # CPUé™åˆ¶ï¼Œå•ä½æ˜¯coreæ•°\n        memory: &quot;10Gi&quot; # å†…å­˜é™åˆ¶\n      requests: # è¯·æ±‚èµ„æºï¼ˆä¸‹é™ï¼‰\n        cpu: &quot;1&quot;  # CPUé™åˆ¶ï¼Œå•ä½æ˜¯coreæ•°\n        memory: &quot;10Mi&quot;  # å†…å­˜é™åˆ¶\n\nåœ¨è¿™å¯¹cpuå’Œmemoryçš„å•ä½åšä¸€ä¸ªè¯´æ˜ï¼š\n\ncpuï¼šcoreæ•°ï¼Œå¯ä»¥ä¸ºæ•´æ•°æˆ–å°æ•°\nmemoryï¼š å†…å­˜å¤§å°ï¼Œå¯ä»¥ä½¿ç”¨Giã€Miã€Gã€Mç­‰å½¢å¼\n\n# è¿è¡ŒPod\n[root@k8s-master01 ~]# kubectl create  -f pod-resources.yaml\npod&#x2F;pod-resources created\n\n# æŸ¥çœ‹å‘ç°podè¿è¡Œæ­£å¸¸\n[root@k8s-master01 ~]# kubectl get pod pod-resources -n dev\nNAME            READY   STATUS    RESTARTS   AGE  \npod-resources   1&#x2F;1     Running   0          39s   \n\n# æ¥ä¸‹æ¥ï¼Œåœæ­¢Pod\n[root@k8s-master01 ~]# kubectl delete  -f pod-resources.yaml\npod &quot;pod-resources&quot; deleted\n\n# ç¼–è¾‘podï¼Œä¿®æ”¹resources.requests.memoryçš„å€¼ä¸º10Gi\n[root@k8s-master01 ~]# vim pod-resources.yaml\n\n# å†æ¬¡å¯åŠ¨pod\n[root@k8s-master01 ~]# kubectl create  -f pod-resources.yaml\npod&#x2F;pod-resources created\n\n# æŸ¥çœ‹PodçŠ¶æ€ï¼Œå‘ç°Podå¯åŠ¨å¤±è´¥\n[root@k8s-master01 ~]# kubectl get pod pod-resources -n dev -o wide\nNAME            READY   STATUS    RESTARTS   AGE          \npod-resources   0&#x2F;1     Pending   0          20s    \n\n# æŸ¥çœ‹podè¯¦æƒ…ä¼šå‘ç°ï¼Œå¦‚ä¸‹æç¤º\n[root@k8s-master01 ~]# kubectl describe pod pod-resources -n dev\n......\nWarning  FailedScheduling  35s   default-scheduler  0&#x2F;3 nodes are available: 1 node(s) had taint &#123;node-role.kubernetes.io&#x2F;master: &#125;, that the pod didn&#39;t tolerate, 2 Insufficient memory.(å†…å­˜ä¸è¶³)\n\n5.3 Podç”Ÿå‘½å‘¨æœŸæˆ‘ä»¬ä¸€èˆ¬å°†podå¯¹è±¡ä»åˆ›å»ºè‡³ç»ˆçš„è¿™æ®µæ—¶é—´èŒƒå›´ç§°ä¸ºpodçš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒä¸»è¦åŒ…å«ä¸‹é¢çš„è¿‡ç¨‹ï¼š\n\npodåˆ›å»ºè¿‡ç¨‹\nè¿è¡Œåˆå§‹åŒ–å®¹å™¨ï¼ˆinit containerï¼‰è¿‡ç¨‹\nè¿è¡Œä¸»å®¹å™¨ï¼ˆmain containerï¼‰\nå®¹å™¨å¯åŠ¨åé’©å­ï¼ˆpost startï¼‰ã€å®¹å™¨ç»ˆæ­¢å‰é’©å­ï¼ˆpre stopï¼‰\nå®¹å™¨çš„å­˜æ´»æ€§æ¢æµ‹ï¼ˆliveness probeï¼‰ã€å°±ç»ªæ€§æ¢æµ‹ï¼ˆreadiness probeï¼‰\n\n\npodç»ˆæ­¢è¿‡ç¨‹\n\n\nåœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼ŒPodä¼šå‡ºç°5ç§çŠ¶æ€ï¼ˆç›¸ä½ï¼‰ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š\n\næŒ‚èµ·ï¼ˆPendingï¼‰ï¼šapiserverå·²ç»åˆ›å»ºäº†podèµ„æºå¯¹è±¡ï¼Œä½†å®ƒå°šæœªè¢«è°ƒåº¦å®Œæˆæˆ–è€…ä»å¤„äºä¸‹è½½é•œåƒçš„è¿‡ç¨‹ä¸­\nè¿è¡Œä¸­ï¼ˆRunningï¼‰ï¼špodå·²ç»è¢«è°ƒåº¦è‡³æŸèŠ‚ç‚¹ï¼Œå¹¶ä¸”æ‰€æœ‰å®¹å™¨éƒ½å·²ç»è¢«kubeletåˆ›å»ºå®Œæˆ\næˆåŠŸï¼ˆSucceededï¼‰ï¼špodä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½å·²ç»æˆåŠŸç»ˆæ­¢å¹¶ä¸”ä¸ä¼šè¢«é‡å¯\nå¤±è´¥ï¼ˆFailedï¼‰ï¼šæ‰€æœ‰å®¹å™¨éƒ½å·²ç»ç»ˆæ­¢ï¼Œä½†è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨ç»ˆæ­¢å¤±è´¥ï¼Œå³å®¹å™¨è¿”å›äº†é0å€¼çš„é€€å‡ºçŠ¶æ€\næœªçŸ¥ï¼ˆUnknownï¼‰ï¼šapiserveræ— æ³•æ­£å¸¸è·å–åˆ°podå¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯ï¼Œé€šå¸¸ç”±ç½‘ç»œé€šä¿¡å¤±è´¥æ‰€å¯¼è‡´\n\n5.3.1 åˆ›å»ºå’Œç»ˆæ­¢podçš„åˆ›å»ºè¿‡ç¨‹\n\nç”¨æˆ·é€šè¿‡kubectlæˆ–å…¶ä»–apiå®¢æˆ·ç«¯æäº¤éœ€è¦åˆ›å»ºçš„podä¿¡æ¯ç»™apiServer\n\napiServerå¼€å§‹ç”Ÿæˆpodå¯¹è±¡çš„ä¿¡æ¯ï¼Œå¹¶å°†ä¿¡æ¯å­˜å…¥etcdï¼Œç„¶åè¿”å›ç¡®è®¤ä¿¡æ¯è‡³å®¢æˆ·ç«¯\n\napiServerå¼€å§‹åæ˜ etcdä¸­çš„podå¯¹è±¡çš„å˜åŒ–ï¼Œå…¶å®ƒç»„ä»¶ä½¿ç”¨watchæœºåˆ¶æ¥è·Ÿè¸ªæ£€æŸ¥apiServerä¸Šçš„å˜åŠ¨\n\nschedulerå‘ç°æœ‰æ–°çš„podå¯¹è±¡è¦åˆ›å»ºï¼Œå¼€å§‹ä¸ºPodåˆ†é…ä¸»æœºå¹¶å°†ç»“æœä¿¡æ¯æ›´æ–°è‡³apiServer\n\nnodeèŠ‚ç‚¹ä¸Šçš„kubeletå‘ç°æœ‰podè°ƒåº¦è¿‡æ¥ï¼Œå°è¯•è°ƒç”¨dockerå¯åŠ¨å®¹å™¨ï¼Œå¹¶å°†ç»“æœå›é€è‡³apiServer\n\napiServerå°†æ¥æ”¶åˆ°çš„podçŠ¶æ€ä¿¡æ¯å­˜å…¥etcdä¸­\n\n\n\npodçš„ç»ˆæ­¢è¿‡ç¨‹\n\nç”¨æˆ·å‘apiServerå‘é€åˆ é™¤podå¯¹è±¡çš„å‘½ä»¤\napiServcerä¸­çš„podå¯¹è±¡ä¿¡æ¯ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œæ›´æ–°ï¼Œåœ¨å®½é™æœŸå†…ï¼ˆé»˜è®¤30sï¼‰ï¼Œpodè¢«è§†ä¸ºdead\nå°†podæ ‡è®°ä¸ºterminatingçŠ¶æ€\nkubeletåœ¨ç›‘æ§åˆ°podå¯¹è±¡è½¬ä¸ºterminatingçŠ¶æ€çš„åŒæ—¶å¯åŠ¨podå…³é—­è¿‡ç¨‹\nç«¯ç‚¹æ§åˆ¶å™¨ç›‘æ§åˆ°podå¯¹è±¡çš„å…³é—­è¡Œä¸ºæ—¶å°†å…¶ä»æ‰€æœ‰åŒ¹é…åˆ°æ­¤ç«¯ç‚¹çš„serviceèµ„æºçš„ç«¯ç‚¹åˆ—è¡¨ä¸­ç§»é™¤\nå¦‚æœå½“å‰podå¯¹è±¡å®šä¹‰äº†preStopé’©å­å¤„ç†å™¨ï¼Œåˆ™åœ¨å…¶æ ‡è®°ä¸ºterminatingåå³ä¼šä»¥åŒæ­¥çš„æ–¹å¼å¯åŠ¨æ‰§è¡Œ\npodå¯¹è±¡ä¸­çš„å®¹å™¨è¿›ç¨‹æ”¶åˆ°åœæ­¢ä¿¡å·\nå®½é™æœŸç»“æŸåï¼Œè‹¥podä¸­è¿˜å­˜åœ¨ä»åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œé‚£ä¹ˆpodå¯¹è±¡ä¼šæ”¶åˆ°ç«‹å³ç»ˆæ­¢çš„ä¿¡å·\nkubeletè¯·æ±‚apiServerå°†æ­¤podèµ„æºçš„å®½é™æœŸè®¾ç½®ä¸º0ä»è€Œå®Œæˆåˆ é™¤æ“ä½œï¼Œæ­¤æ—¶podå¯¹äºç”¨æˆ·å·²ä¸å¯è§\n\n5.3.2 åˆå§‹åŒ–å®¹å™¨åˆå§‹åŒ–å®¹å™¨æ˜¯åœ¨podçš„ä¸»å®¹å™¨å¯åŠ¨ä¹‹å‰è¦è¿è¡Œçš„å®¹å™¨ï¼Œä¸»è¦æ˜¯åšä¸€äº›ä¸»å®¹å™¨çš„å‰ç½®å·¥ä½œï¼Œå®ƒå…·æœ‰ä¸¤å¤§ç‰¹å¾ï¼š\n\nåˆå§‹åŒ–å®¹å™¨å¿…é¡»è¿è¡Œå®Œæˆç›´è‡³ç»“æŸï¼Œè‹¥æŸåˆå§‹åŒ–å®¹å™¨è¿è¡Œå¤±è´¥ï¼Œé‚£ä¹ˆkuberneteséœ€è¦é‡å¯å®ƒç›´åˆ°æˆåŠŸå®Œæˆ\nåˆå§‹åŒ–å®¹å™¨å¿…é¡»æŒ‰ç…§å®šä¹‰çš„é¡ºåºæ‰§è¡Œï¼Œå½“ä¸”ä»…å½“å‰ä¸€ä¸ªæˆåŠŸä¹‹åï¼Œåé¢çš„ä¸€ä¸ªæ‰èƒ½è¿è¡Œ\n\nåˆå§‹åŒ–å®¹å™¨æœ‰å¾ˆå¤šçš„åº”ç”¨åœºæ™¯ï¼Œä¸‹é¢åˆ—å‡ºçš„æ˜¯æœ€å¸¸è§çš„å‡ ä¸ªï¼š\n\næä¾›ä¸»å®¹å™¨é•œåƒä¸­ä¸å…·å¤‡çš„å·¥å…·ç¨‹åºæˆ–è‡ªå®šä¹‰ä»£ç \nåˆå§‹åŒ–å®¹å™¨è¦å…ˆäºåº”ç”¨å®¹å™¨ä¸²è¡Œå¯åŠ¨å¹¶è¿è¡Œå®Œæˆï¼Œå› æ­¤å¯ç”¨äºå»¶ååº”ç”¨å®¹å™¨çš„å¯åŠ¨ç›´è‡³å…¶ä¾èµ–çš„æ¡ä»¶å¾—åˆ°æ»¡è¶³\n\næ¥ä¸‹æ¥åšä¸€ä¸ªæ¡ˆä¾‹ï¼Œæ¨¡æ‹Ÿä¸‹é¢è¿™ä¸ªéœ€æ±‚ï¼š\nå‡è®¾è¦ä»¥ä¸»å®¹å™¨æ¥è¿è¡Œnginxï¼Œä½†æ˜¯è¦æ±‚åœ¨è¿è¡Œnginxä¹‹å‰å…ˆè¦èƒ½å¤Ÿè¿æ¥ä¸Šmysqlå’Œredisæ‰€åœ¨æœåŠ¡å™¨\nä¸ºäº†ç®€åŒ–æµ‹è¯•ï¼Œäº‹å…ˆè§„å®šå¥½mysql(192.168.5.4)å’Œredis(192.168.5.5)æœåŠ¡å™¨çš„åœ°å€\nåˆ›å»ºpod-initcontainer.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-initcontainer\n  namespace: dev\nspec:\n  containers:\n  - name: main-container\n    image: nginx:1.17.1\n    ports: \n    - name: nginx-port\n      containerPort: 80\n  initContainers:\n  - name: test-mysql\n    image: busybox:1.30\n    command: [&#39;sh&#39;, &#39;-c&#39;, &#39;until ping 192.168.5.14 -c 1 ; do echo waiting for mysql...; sleep 2; done;&#39;]\n  - name: test-redis\n    image: busybox:1.30\n    command: [&#39;sh&#39;, &#39;-c&#39;, &#39;until ping 192.168.5.15 -c 1 ; do echo waiting for reids...; sleep 2; done;&#39;]\n\n# åˆ›å»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-initcontainer.yaml\npod&#x2F;pod-initcontainer created\n\n# æŸ¥çœ‹podçŠ¶æ€\n# å‘ç°podå¡åœ¨å¯åŠ¨ç¬¬ä¸€ä¸ªåˆå§‹åŒ–å®¹å™¨è¿‡ç¨‹ä¸­ï¼Œåé¢çš„å®¹å™¨ä¸ä¼šè¿è¡Œ\nroot@k8s-master01 ~]# kubectl describe pod  pod-initcontainer -n dev\n........\nEvents:\n  Type    Reason     Age   From               Message\n  ----    ------     ----  ----               -------\n  Normal  Scheduled  49s   default-scheduler  Successfully assigned dev&#x2F;pod-initcontainer to node1\n  Normal  Pulled     48s   kubelet, node1     Container image &quot;busybox:1.30&quot; already present on machine\n  Normal  Created    48s   kubelet, node1     Created container test-mysql\n  Normal  Started    48s   kubelet, node1     Started container test-mysql\n\n# åŠ¨æ€æŸ¥çœ‹pod\n[root@k8s-master01 ~]# kubectl get pods pod-initcontainer -n dev -w\nNAME                             READY   STATUS     RESTARTS   AGE\npod-initcontainer                0&#x2F;1     Init:0&#x2F;2   0          15s\npod-initcontainer                0&#x2F;1     Init:1&#x2F;2   0          52s\npod-initcontainer                0&#x2F;1     Init:1&#x2F;2   0          53s\npod-initcontainer                0&#x2F;1     PodInitializing   0          89s\npod-initcontainer                1&#x2F;1     Running           0          90s\n\n# æ¥ä¸‹æ¥æ–°å¼€ä¸€ä¸ªshellï¼Œä¸ºå½“å‰æœåŠ¡å™¨æ–°å¢ä¸¤ä¸ªipï¼Œè§‚å¯Ÿpodçš„å˜åŒ–\n[root@k8s-master01 ~]# ifconfig ens33:1 192.168.5.14 netmask 255.255.255.0 up\n[root@k8s-master01 ~]# ifconfig ens33:2 192.168.5.15 netmask 255.255.255.0 up\n\n5.3.3 é’©å­å‡½æ•°é’©å­å‡½æ•°èƒ½å¤Ÿæ„ŸçŸ¥è‡ªèº«ç”Ÿå‘½å‘¨æœŸä¸­çš„äº‹ä»¶ï¼Œå¹¶åœ¨ç›¸åº”çš„æ—¶åˆ»åˆ°æ¥æ—¶è¿è¡Œç”¨æˆ·æŒ‡å®šçš„ç¨‹åºä»£ç ã€‚\nkubernetesåœ¨ä¸»å®¹å™¨çš„å¯åŠ¨ä¹‹åå’Œåœæ­¢ä¹‹å‰æä¾›äº†ä¸¤ä¸ªé’©å­å‡½æ•°ï¼š\n\npost startï¼šå®¹å™¨åˆ›å»ºä¹‹åæ‰§è¡Œï¼Œå¦‚æœå¤±è´¥äº†ä¼šé‡å¯å®¹å™¨\npre stop ï¼šå®¹å™¨ç»ˆæ­¢ä¹‹å‰æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæˆä¹‹åå®¹å™¨å°†æˆåŠŸç»ˆæ­¢ï¼Œåœ¨å…¶å®Œæˆä¹‹å‰ä¼šé˜»å¡åˆ é™¤å®¹å™¨çš„æ“ä½œ\n\né’©å­å¤„ç†å™¨æ”¯æŒä½¿ç”¨ä¸‹é¢ä¸‰ç§æ–¹å¼å®šä¹‰åŠ¨ä½œï¼š\n\nExecå‘½ä»¤ï¼šåœ¨å®¹å™¨å†…æ‰§è¡Œä¸€æ¬¡å‘½ä»¤\nâ€¦â€¦\n  lifecycle:\n    postStart: \n      exec:\n        command:\n        - cat\n        - &#x2F;tmp&#x2F;healthy\nâ€¦â€¦\n\nTCPSocketï¼šåœ¨å½“å‰å®¹å™¨å°è¯•è®¿é—®æŒ‡å®šçš„socket\nâ€¦â€¦      \n  lifecycle:\n    postStart:\n      tcpSocket:\n        port: 8080\nâ€¦â€¦\n\nHTTPGetï¼šåœ¨å½“å‰å®¹å™¨ä¸­å‘æŸurlå‘èµ·httpè¯·æ±‚\nâ€¦â€¦\n  lifecycle:\n    postStart:\n      httpGet:\n        path: &#x2F; #URIåœ°å€\n        port: 80 #ç«¯å£å·\n        host: 192.168.5.3 #ä¸»æœºåœ°å€\n        scheme: HTTP #æ”¯æŒçš„åè®®ï¼Œhttpæˆ–è€…https\nâ€¦â€¦\n\næ¥ä¸‹æ¥ï¼Œä»¥execæ–¹å¼ä¸ºä¾‹ï¼Œæ¼”ç¤ºä¸‹é’©å­å‡½æ•°çš„ä½¿ç”¨ï¼Œåˆ›å»ºpod-hook-exec.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-hook-exec\n  namespace: dev\nspec:\n  containers:\n  - name: main-container\n    image: nginx:1.17.1\n    ports:\n    - name: nginx-port\n      containerPort: 80\n    lifecycle:\n      postStart: \n        exec: # åœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œä¿®æ”¹æ‰nginxçš„é»˜è®¤é¦–é¡µå†…å®¹\n          command: [&quot;&#x2F;bin&#x2F;sh&quot;, &quot;-c&quot;, &quot;echo postStart... &gt; &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;index.html&quot;]\n      preStop:\n        exec: # åœ¨å®¹å™¨åœæ­¢ä¹‹å‰åœæ­¢nginxæœåŠ¡\n          command: [&quot;&#x2F;usr&#x2F;sbin&#x2F;nginx&quot;,&quot;-s&quot;,&quot;quit&quot;]\n\n# åˆ›å»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-hook-exec.yaml\npod&#x2F;pod-hook-exec created\n\n# æŸ¥çœ‹pod\n[root@k8s-master01 ~]# kubectl get pods  pod-hook-exec -n dev -o wide\nNAME           READY   STATUS     RESTARTS   AGE    IP            NODE    \npod-hook-exec  1&#x2F;1     Running    0          29s    10.244.2.48   node2   \n\n# è®¿é—®pod\n[root@k8s-master01 ~]# curl 10.244.2.48\npostStart...\n\n5.3.4 å®¹å™¨æ¢æµ‹å®¹å™¨æ¢æµ‹ç”¨äºæ£€æµ‹å®¹å™¨ä¸­çš„åº”ç”¨å®ä¾‹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œæ˜¯ä¿éšœä¸šåŠ¡å¯ç”¨æ€§çš„ä¸€ç§ä¼ ç»Ÿæœºåˆ¶ã€‚å¦‚æœç»è¿‡æ¢æµ‹ï¼Œå®ä¾‹çš„çŠ¶æ€ä¸ç¬¦åˆé¢„æœŸï¼Œé‚£ä¹ˆkuberneteså°±ä¼šæŠŠè¯¥é—®é¢˜å®ä¾‹â€ æ‘˜é™¤ â€œï¼Œä¸æ‰¿æ‹…ä¸šåŠ¡æµé‡ã€‚kubernetesæä¾›äº†ä¸¤ç§æ¢é’ˆæ¥å®ç°å®¹å™¨æ¢æµ‹ï¼Œåˆ†åˆ«æ˜¯ï¼š\n\nliveness probesï¼šå­˜æ´»æ€§æ¢é’ˆï¼Œç”¨äºæ£€æµ‹åº”ç”¨å®ä¾‹å½“å‰æ˜¯å¦å¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯ï¼Œk8sä¼šé‡å¯å®¹å™¨\nreadiness probesï¼šå°±ç»ªæ€§æ¢é’ˆï¼Œç”¨äºæ£€æµ‹åº”ç”¨å®ä¾‹å½“å‰æ˜¯å¦å¯ä»¥æ¥æ”¶è¯·æ±‚ï¼Œå¦‚æœä¸èƒ½ï¼Œk8sä¸ä¼šè½¬å‘æµé‡\n\n\n\n\n\n\n\n\n\n\nlivenessProbe å†³å®šæ˜¯å¦é‡å¯å®¹å™¨ï¼ŒreadinessProbe å†³å®šæ˜¯å¦å°†è¯·æ±‚è½¬å‘ç»™å®¹å™¨ã€‚\nä¸Šé¢ä¸¤ç§æ¢é’ˆç›®å‰å‡æ”¯æŒä¸‰ç§æ¢æµ‹æ–¹å¼ï¼š\n\nExecå‘½ä»¤ï¼šåœ¨å®¹å™¨å†…æ‰§è¡Œä¸€æ¬¡å‘½ä»¤ï¼Œå¦‚æœå‘½ä»¤æ‰§è¡Œçš„é€€å‡ºç ä¸º0ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸ï¼Œå¦åˆ™ä¸æ­£å¸¸\nâ€¦â€¦\n  livenessProbe:\n    exec:\n      command:\n      - cat\n      - &#x2F;tmp&#x2F;healthy\nâ€¦â€¦\n\nTCPSocketï¼šå°†ä¼šå°è¯•è®¿é—®ä¸€ä¸ªç”¨æˆ·å®¹å™¨çš„ç«¯å£ï¼Œå¦‚æœèƒ½å¤Ÿå»ºç«‹è¿™æ¡è¿æ¥ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸ï¼Œå¦åˆ™ä¸æ­£å¸¸\nâ€¦â€¦      \n  livenessProbe:\n    tcpSocket:\n      port: 8080\nâ€¦â€¦\n\nHTTPGetï¼šè°ƒç”¨å®¹å™¨å†…Webåº”ç”¨çš„URLï¼Œå¦‚æœè¿”å›çš„çŠ¶æ€ç åœ¨200å’Œ399ä¹‹é—´ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸ï¼Œå¦åˆ™ä¸æ­£å¸¸\nâ€¦â€¦\n  livenessProbe:\n    httpGet:\n      path: &#x2F; #URIåœ°å€\n      port: 80 #ç«¯å£å·\n      host: 127.0.0.1 #ä¸»æœºåœ°å€\n      scheme: HTTP #æ”¯æŒçš„åè®®ï¼Œhttpæˆ–è€…https\nâ€¦â€¦\n\nä¸‹é¢ä»¥liveness probesä¸ºä¾‹ï¼Œåšå‡ ä¸ªæ¼”ç¤ºï¼š\næ–¹å¼ä¸€ï¼šExec\nåˆ›å»ºpod-liveness-exec.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-liveness-exec\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports: \n    - name: nginx-port\n      containerPort: 80\n    livenessProbe:\n      exec:\n        command: [&quot;&#x2F;bin&#x2F;cat&quot;,&quot;&#x2F;tmp&#x2F;hello.txt&quot;] # æ‰§è¡Œä¸€ä¸ªæŸ¥çœ‹æ–‡ä»¶çš„å‘½ä»¤\n\nåˆ›å»ºpodï¼Œè§‚å¯Ÿæ•ˆæœ\n# åˆ›å»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-liveness-exec.yaml\npod&#x2F;pod-liveness-exec created\n\n# æŸ¥çœ‹Podè¯¦æƒ…\n[root@k8s-master01 ~]# kubectl describe pods pod-liveness-exec -n dev\n......\n  Normal   Created    20s (x2 over 50s)  kubelet, node1     Created container nginx\n  Normal   Started    20s (x2 over 50s)  kubelet, node1     Started container nginx\n  Normal   Killing    20s                kubelet, node1     Container nginx failed liveness probe, will be restarted\n  Warning  Unhealthy  0s (x5 over 40s)   kubelet, node1     Liveness probe failed: cat: can&#39;t open &#39;&#x2F;tmp&#x2F;hello11.txt&#39;: No such file or directory\n  \n# è§‚å¯Ÿä¸Šé¢çš„ä¿¡æ¯å°±ä¼šå‘ç°nginxå®¹å™¨å¯åŠ¨ä¹‹åå°±è¿›è¡Œäº†å¥åº·æ£€æŸ¥\n# æ£€æŸ¥å¤±è´¥ä¹‹åï¼Œå®¹å™¨è¢«killæ‰ï¼Œç„¶åå°è¯•è¿›è¡Œé‡å¯ï¼ˆè¿™æ˜¯é‡å¯ç­–ç•¥çš„ä½œç”¨ï¼Œåé¢è®²è§£ï¼‰\n# ç¨ç­‰ä¸€ä¼šä¹‹åï¼Œå†è§‚å¯Ÿpodä¿¡æ¯ï¼Œå°±å¯ä»¥çœ‹åˆ°RESTARTSä¸å†æ˜¯0ï¼Œè€Œæ˜¯ä¸€ç›´å¢é•¿\n[root@k8s-master01 ~]# kubectl get pods pod-liveness-exec -n dev\nNAME                READY   STATUS             RESTARTS   AGE\npod-liveness-exec   0&#x2F;1     CrashLoopBackOff   2          3m19s\n\n# å½“ç„¶æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä¿®æ”¹æˆä¸€ä¸ªå­˜åœ¨çš„æ–‡ä»¶ï¼Œæ¯”å¦‚&#x2F;tmp&#x2F;hello.txtï¼Œå†è¯•ï¼Œç»“æœå°±æ­£å¸¸äº†......\n\næ–¹å¼äºŒï¼šTCPSocket\nåˆ›å»ºpod-liveness-tcpsocket.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-liveness-tcpsocket\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports: \n    - name: nginx-port\n      containerPort: 80\n    livenessProbe:\n      tcpSocket:\n        port: 8080 # å°è¯•è®¿é—®8080ç«¯å£\n\nåˆ›å»ºpodï¼Œè§‚å¯Ÿæ•ˆæœ\n# åˆ›å»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-liveness-tcpsocket.yaml\npod&#x2F;pod-liveness-tcpsocket created\n\n# æŸ¥çœ‹Podè¯¦æƒ…\n[root@k8s-master01 ~]# kubectl describe pods pod-liveness-tcpsocket -n dev\n......\n  Normal   Scheduled  31s                            default-scheduler  Successfully assigned dev&#x2F;pod-liveness-tcpsocket to node2\n  Normal   Pulled     &lt;invalid&gt;                      kubelet, node2     Container image &quot;nginx:1.17.1&quot; already present on machine\n  Normal   Created    &lt;invalid&gt;                      kubelet, node2     Created container nginx\n  Normal   Started    &lt;invalid&gt;                      kubelet, node2     Started container nginx\n  Warning  Unhealthy  &lt;invalid&gt; (x2 over &lt;invalid&gt;)  kubelet, node2     Liveness probe failed: dial tcp 10.244.2.44:8080: connect: connection refused\n  \n# è§‚å¯Ÿä¸Šé¢çš„ä¿¡æ¯ï¼Œå‘ç°å°è¯•è®¿é—®8080ç«¯å£,ä½†æ˜¯å¤±è´¥äº†\n# ç¨ç­‰ä¸€ä¼šä¹‹åï¼Œå†è§‚å¯Ÿpodä¿¡æ¯ï¼Œå°±å¯ä»¥çœ‹åˆ°RESTARTSä¸å†æ˜¯0ï¼Œè€Œæ˜¯ä¸€ç›´å¢é•¿\n[root@k8s-master01 ~]# kubectl get pods pod-liveness-tcpsocket  -n dev\nNAME                     READY   STATUS             RESTARTS   AGE\npod-liveness-tcpsocket   0&#x2F;1     CrashLoopBackOff   2          3m19s\n\n# å½“ç„¶æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä¿®æ”¹æˆä¸€ä¸ªå¯ä»¥è®¿é—®çš„ç«¯å£ï¼Œæ¯”å¦‚80ï¼Œå†è¯•ï¼Œç»“æœå°±æ­£å¸¸äº†......\n\næ–¹å¼ä¸‰ï¼šHTTPGet\nåˆ›å»ºpod-liveness-httpget.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-liveness-httpget\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - name: nginx-port\n      containerPort: 80\n    livenessProbe:\n      httpGet:  # å…¶å®å°±æ˜¯è®¿é—®http:&#x2F;&#x2F;127.0.0.1:80&#x2F;hello  \n        scheme: HTTP #æ”¯æŒçš„åè®®ï¼Œhttpæˆ–è€…https\n        port: 80 #ç«¯å£å·\n        path: &#x2F;hello #URIåœ°å€\n\nåˆ›å»ºpodï¼Œè§‚å¯Ÿæ•ˆæœ\n# åˆ›å»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-liveness-httpget.yaml\npod&#x2F;pod-liveness-httpget created\n\n# æŸ¥çœ‹Podè¯¦æƒ…\n[root@k8s-master01 ~]# kubectl describe pod pod-liveness-httpget -n dev\n.......\n  Normal   Pulled     6s (x3 over 64s)  kubelet, node1     Container image &quot;nginx:1.17.1&quot; already present on machine\n  Normal   Created    6s (x3 over 64s)  kubelet, node1     Created container nginx\n  Normal   Started    6s (x3 over 63s)  kubelet, node1     Started container nginx\n  Warning  Unhealthy  6s (x6 over 56s)  kubelet, node1     Liveness probe failed: HTTP probe failed with statuscode: 404\n  Normal   Killing    6s (x2 over 36s)  kubelet, node1     Container nginx failed liveness probe, will be restarted\n  \n# è§‚å¯Ÿä¸Šé¢ä¿¡æ¯ï¼Œå°è¯•è®¿é—®è·¯å¾„ï¼Œä½†æ˜¯æœªæ‰¾åˆ°,å‡ºç°404é”™è¯¯\n# ç¨ç­‰ä¸€ä¼šä¹‹åï¼Œå†è§‚å¯Ÿpodä¿¡æ¯ï¼Œå°±å¯ä»¥çœ‹åˆ°RESTARTSä¸å†æ˜¯0ï¼Œè€Œæ˜¯ä¸€ç›´å¢é•¿\n[root@k8s-master01 ~]# kubectl get pod pod-liveness-httpget -n dev\nNAME                   READY   STATUS    RESTARTS   AGE\npod-liveness-httpget   1&#x2F;1     Running   5          3m17s\n\n# å½“ç„¶æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä¿®æ”¹æˆä¸€ä¸ªå¯ä»¥è®¿é—®çš„è·¯å¾„pathï¼Œæ¯”å¦‚&#x2F;ï¼Œå†è¯•ï¼Œç»“æœå°±æ­£å¸¸äº†......\n\nè‡³æ­¤ï¼Œå·²ç»ä½¿ç”¨liveness Probeæ¼”ç¤ºäº†ä¸‰ç§æ¢æµ‹æ–¹å¼ï¼Œä½†æ˜¯æŸ¥çœ‹livenessProbeçš„å­å±æ€§ï¼Œä¼šå‘ç°é™¤äº†è¿™ä¸‰ç§æ–¹å¼ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„é…ç½®ï¼Œåœ¨è¿™é‡Œä¸€å¹¶è§£é‡Šä¸‹ï¼š\n[root@k8s-master01 ~]# kubectl explain pod.spec.containers.livenessProbe\nFIELDS:\n   exec &lt;Object&gt;  \n   tcpSocket    &lt;Object&gt;\n   httpGet      &lt;Object&gt;\n   initialDelaySeconds  &lt;integer&gt;  # å®¹å™¨å¯åŠ¨åç­‰å¾…å¤šå°‘ç§’æ‰§è¡Œç¬¬ä¸€æ¬¡æ¢æµ‹\n   timeoutSeconds       &lt;integer&gt;  # æ¢æµ‹è¶…æ—¶æ—¶é—´ã€‚é»˜è®¤1ç§’ï¼Œæœ€å°1ç§’\n   periodSeconds        &lt;integer&gt;  # æ‰§è¡Œæ¢æµ‹çš„é¢‘ç‡ã€‚é»˜è®¤æ˜¯10ç§’ï¼Œæœ€å°1ç§’\n   failureThreshold     &lt;integer&gt;  # è¿ç»­æ¢æµ‹å¤±è´¥å¤šå°‘æ¬¡æ‰è¢«è®¤å®šä¸ºå¤±è´¥ã€‚é»˜è®¤æ˜¯3ã€‚æœ€å°å€¼æ˜¯1\n   successThreshold     &lt;integer&gt;  # è¿ç»­æ¢æµ‹æˆåŠŸå¤šå°‘æ¬¡æ‰è¢«è®¤å®šä¸ºæˆåŠŸã€‚é»˜è®¤æ˜¯1\n\nä¸‹é¢ç¨å¾®é…ç½®ä¸¤ä¸ªï¼Œæ¼”ç¤ºä¸‹æ•ˆæœå³å¯ï¼š\n[root@k8s-master01 ~]# more pod-liveness-httpget.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-liveness-httpget\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - name: nginx-port\n      containerPort: 80\n    livenessProbe:\n      httpGet:\n        scheme: HTTP\n        port: 80 \n        path: &#x2F;\n      initialDelaySeconds: 30 # å®¹å™¨å¯åŠ¨å30så¼€å§‹æ¢æµ‹\n      timeoutSeconds: 5 # æ¢æµ‹è¶…æ—¶æ—¶é—´ä¸º5s\n\n5.3.5 é‡å¯ç­–ç•¥åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œä¸€æ—¦å®¹å™¨æ¢æµ‹å‡ºç°äº†é—®é¢˜ï¼Œkuberneteså°±ä¼šå¯¹å®¹å™¨æ‰€åœ¨çš„Podè¿›è¡Œé‡å¯ï¼Œå…¶å®è¿™æ˜¯ç”±podçš„é‡å¯ç­–ç•¥å†³å®šçš„ï¼Œpodçš„é‡å¯ç­–ç•¥æœ‰ 3 ç§ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š\n\nAlways ï¼šå®¹å™¨å¤±æ•ˆæ—¶ï¼Œè‡ªåŠ¨é‡å¯è¯¥å®¹å™¨ï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤å€¼ã€‚\nOnFailure ï¼š å®¹å™¨ç»ˆæ­¢è¿è¡Œä¸”é€€å‡ºç ä¸ä¸º0æ—¶é‡å¯\nNever ï¼š ä¸è®ºçŠ¶æ€ä¸ºä½•ï¼Œéƒ½ä¸é‡å¯è¯¥å®¹å™¨\n\né‡å¯ç­–ç•¥é€‚ç”¨äºpodå¯¹è±¡ä¸­çš„æ‰€æœ‰å®¹å™¨ï¼Œé¦–æ¬¡éœ€è¦é‡å¯çš„å®¹å™¨ï¼Œå°†åœ¨å…¶éœ€è¦æ—¶ç«‹å³è¿›è¡Œé‡å¯ï¼Œéšåå†æ¬¡éœ€è¦é‡å¯çš„æ“ä½œå°†ç”±kubeletå»¶è¿Ÿä¸€æ®µæ—¶é—´åè¿›è¡Œï¼Œä¸”åå¤çš„é‡å¯æ“ä½œçš„å»¶è¿Ÿæ—¶é•¿ä»¥æ­¤ä¸º10sã€20sã€40sã€80sã€160så’Œ300sï¼Œ300sæ˜¯æœ€å¤§å»¶è¿Ÿæ—¶é•¿ã€‚\nåˆ›å»ºpod-restartpolicy.yamlï¼š\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-restartpolicy\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - name: nginx-port\n      containerPort: 80\n    livenessProbe:\n      httpGet:\n        scheme: HTTP\n        port: 80\n        path: &#x2F;hello\n  restartPolicy: Never # è®¾ç½®é‡å¯ç­–ç•¥ä¸ºNever\n\nè¿è¡ŒPodæµ‹è¯•\n# åˆ›å»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-restartpolicy.yaml\npod&#x2F;pod-restartpolicy created\n\n# æŸ¥çœ‹Podè¯¦æƒ…ï¼Œå‘ç°nginxå®¹å™¨å¤±è´¥\n[root@k8s-master01 ~]# kubectl  describe pods pod-restartpolicy  -n dev\n......\n  Warning  Unhealthy  15s (x3 over 35s)  kubelet, node1     Liveness probe failed: HTTP probe failed with statuscode: 404\n  Normal   Killing    15s                kubelet, node1     Container nginx failed liveness probe\n  \n# å¤šç­‰ä¸€ä¼šï¼Œå†è§‚å¯Ÿpodçš„é‡å¯æ¬¡æ•°ï¼Œå‘ç°ä¸€ç›´æ˜¯0ï¼Œå¹¶æœªé‡å¯   \n[root@k8s-master01 ~]# kubectl  get pods pod-restartpolicy -n dev\nNAME                   READY   STATUS    RESTARTS   AGE\npod-restartpolicy      0&#x2F;1     Running   0          5min42s\n\n5.4 Podè°ƒåº¦åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªPodåœ¨å“ªä¸ªNodeèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œæ˜¯ç”±Schedulerç»„ä»¶é‡‡ç”¨ç›¸åº”çš„ç®—æ³•è®¡ç®—å‡ºæ¥çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸å—äººå·¥æ§åˆ¶çš„ã€‚ä½†æ˜¯åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè¿™å¹¶ä¸æ»¡è¶³çš„éœ€æ±‚ï¼Œå› ä¸ºå¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æƒ³æ§åˆ¶æŸäº›Podåˆ°è¾¾æŸäº›èŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿè¿™å°±è¦æ±‚äº†è§£kuberneteså¯¹Podçš„è°ƒåº¦è§„åˆ™ï¼Œkubernetesæä¾›äº†å››å¤§ç±»è°ƒåº¦æ–¹å¼ï¼š\n\nè‡ªåŠ¨è°ƒåº¦ï¼šè¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šå®Œå…¨ç”±Schedulerç»è¿‡ä¸€ç³»åˆ—çš„ç®—æ³•è®¡ç®—å¾—å‡º\nå®šå‘è°ƒåº¦ï¼šNodeNameã€NodeSelector\näº²å’Œæ€§è°ƒåº¦ï¼šNodeAffinityã€PodAffinityã€PodAntiAffinity\næ±¡ç‚¹ï¼ˆå®¹å¿ï¼‰è°ƒåº¦ï¼šTaintsã€Toleration\n\n5.4.1 å®šå‘è°ƒåº¦å®šå‘è°ƒåº¦ï¼ŒæŒ‡çš„æ˜¯åˆ©ç”¨åœ¨podä¸Šå£°æ˜nodeNameæˆ–è€…nodeSelectorï¼Œä»¥æ­¤å°†Podè°ƒåº¦åˆ°æœŸæœ›çš„nodeèŠ‚ç‚¹ä¸Šã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„è°ƒåº¦æ˜¯å¼ºåˆ¶çš„ï¼Œè¿™å°±æ„å‘³ç€å³ä½¿è¦è°ƒåº¦çš„ç›®æ ‡Nodeä¸å­˜åœ¨ï¼Œä¹Ÿä¼šå‘ä¸Šé¢è¿›è¡Œè°ƒåº¦ï¼Œåªä¸è¿‡podè¿è¡Œå¤±è´¥è€Œå·²ã€‚\nNodeName\nNodeNameç”¨äºå¼ºåˆ¶çº¦æŸå°†Podè°ƒåº¦åˆ°æŒ‡å®šçš„Nameçš„NodeèŠ‚ç‚¹ä¸Šã€‚è¿™ç§æ–¹å¼ï¼Œå…¶å®æ˜¯ç›´æ¥è·³è¿‡Schedulerçš„è°ƒåº¦é€»è¾‘ï¼Œç›´æ¥å°†Podè°ƒåº¦åˆ°æŒ‡å®šåç§°çš„èŠ‚ç‚¹ã€‚\næ¥ä¸‹æ¥ï¼Œå®éªŒä¸€ä¸‹ï¼šåˆ›å»ºä¸€ä¸ªpod-nodename.yamlæ–‡ä»¶\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-nodename\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  nodeName: node1 # æŒ‡å®šè°ƒåº¦åˆ°node1èŠ‚ç‚¹ä¸Š\n\n#åˆ›å»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-nodename.yaml\npod&#x2F;pod-nodename created\n\n#æŸ¥çœ‹Podè°ƒåº¦åˆ°NODEå±æ€§ï¼Œç¡®å®æ˜¯è°ƒåº¦åˆ°äº†node1èŠ‚ç‚¹ä¸Š\n[root@k8s-master01 ~]# kubectl get pods pod-nodename -n dev -o wide\nNAME           READY   STATUS    RESTARTS   AGE   IP            NODE      ......\npod-nodename   1&#x2F;1     Running   0          56s   10.244.1.87   node1     ......   \n\n# æ¥ä¸‹æ¥ï¼Œåˆ é™¤podï¼Œä¿®æ”¹nodeNameçš„å€¼ä¸ºnode3ï¼ˆå¹¶æ²¡æœ‰node3èŠ‚ç‚¹ï¼‰\n[root@k8s-master01 ~]# kubectl delete -f pod-nodename.yaml\npod &quot;pod-nodename&quot; deleted\n[root@k8s-master01 ~]# vim pod-nodename.yaml\n[root@k8s-master01 ~]# kubectl create -f pod-nodename.yaml\npod&#x2F;pod-nodename created\n\n#å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°å·²ç»å‘Node3èŠ‚ç‚¹è°ƒåº¦ï¼Œä½†æ˜¯ç”±äºä¸å­˜åœ¨node3èŠ‚ç‚¹ï¼Œæ‰€ä»¥podæ— æ³•æ­£å¸¸è¿è¡Œ\n[root@k8s-master01 ~]# kubectl get pods pod-nodename -n dev -o wide\nNAME           READY   STATUS    RESTARTS   AGE   IP       NODE    ......\npod-nodename   0&#x2F;1     Pending   0          6s    &lt;none&gt;   node3   ......           \n\nNodeSelector\nNodeSelectorç”¨äºå°†podè°ƒåº¦åˆ°æ·»åŠ äº†æŒ‡å®šæ ‡ç­¾çš„nodeèŠ‚ç‚¹ä¸Šã€‚å®ƒæ˜¯é€šè¿‡kubernetesçš„label-selectoræœºåˆ¶å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨podåˆ›å»ºä¹‹å‰ï¼Œä¼šç”±schedulerä½¿ç”¨MatchNodeSelectorè°ƒåº¦ç­–ç•¥è¿›è¡ŒlabelåŒ¹é…ï¼Œæ‰¾å‡ºç›®æ ‡nodeï¼Œç„¶åå°†podè°ƒåº¦åˆ°ç›®æ ‡èŠ‚ç‚¹ï¼Œè¯¥åŒ¹é…è§„åˆ™æ˜¯å¼ºåˆ¶çº¦æŸã€‚\næ¥ä¸‹æ¥ï¼Œå®éªŒä¸€ä¸‹ï¼š\n1 é¦–å…ˆåˆ†åˆ«ä¸ºnodeèŠ‚ç‚¹æ·»åŠ æ ‡ç­¾\n[root@k8s-master01 ~]# kubectl label nodes node1 nodeenv&#x3D;pro\nnode&#x2F;node2 labeled\n[root@k8s-master01 ~]# kubectl label nodes node2 nodeenv&#x3D;test\nnode&#x2F;node2 labeled\n\n2 åˆ›å»ºä¸€ä¸ªpod-nodeselector.yamlæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨å®ƒåˆ›å»ºPod\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-nodeselector\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  nodeSelector: \n    nodeenv: pro # æŒ‡å®šè°ƒåº¦åˆ°å…·æœ‰nodeenv&#x3D;proæ ‡ç­¾çš„èŠ‚ç‚¹ä¸Š\n\n#åˆ›å»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-nodeselector.yaml\npod&#x2F;pod-nodeselector created\n\n#æŸ¥çœ‹Podè°ƒåº¦åˆ°NODEå±æ€§ï¼Œç¡®å®æ˜¯è°ƒåº¦åˆ°äº†node1èŠ‚ç‚¹ä¸Š\n[root@k8s-master01 ~]# kubectl get pods pod-nodeselector -n dev -o wide\nNAME               READY   STATUS    RESTARTS   AGE     IP          NODE    ......\npod-nodeselector   1&#x2F;1     Running   0          47s   10.244.1.87   node1   ......\n\n# æ¥ä¸‹æ¥ï¼Œåˆ é™¤podï¼Œä¿®æ”¹nodeSelectorçš„å€¼ä¸ºnodeenv: xxxxï¼ˆä¸å­˜åœ¨æ‰“æœ‰æ­¤æ ‡ç­¾çš„èŠ‚ç‚¹ï¼‰\n[root@k8s-master01 ~]# kubectl delete -f pod-nodeselector.yaml\npod &quot;pod-nodeselector&quot; deleted\n[root@k8s-master01 ~]# vim pod-nodeselector.yaml\n[root@k8s-master01 ~]# kubectl create -f pod-nodeselector.yaml\npod&#x2F;pod-nodeselector created\n\n#å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°podæ— æ³•æ­£å¸¸è¿è¡Œ,Nodeçš„å€¼ä¸ºnone\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nNAME               READY   STATUS    RESTARTS   AGE     IP       NODE    \npod-nodeselector   0&#x2F;1     Pending   0          2m20s   &lt;none&gt;   &lt;none&gt;\n\n# æŸ¥çœ‹è¯¦æƒ…,å‘ç°node selectoråŒ¹é…å¤±è´¥çš„æç¤º\n[root@k8s-master01 ~]# kubectl describe pods pod-nodeselector -n dev\n.......\nEvents:\n  Type     Reason            Age        From               Message\n  ----     ------            ----       ----               -------\n  Warning  FailedScheduling  &lt;unknown&gt;  default-scheduler  0&#x2F;3 nodes are available: 3 node(s) didn&#39;t match node selector.\n\n5.4.2 äº²å’Œæ€§è°ƒåº¦ä¸Šä¸€èŠ‚ï¼Œä»‹ç»äº†ä¸¤ç§å®šå‘è°ƒåº¦çš„æ–¹å¼ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€å®šçš„é—®é¢˜ï¼Œé‚£å°±æ˜¯å¦‚æœæ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„Nodeï¼Œé‚£ä¹ˆPodå°†ä¸ä¼šè¢«è¿è¡Œï¼Œå³ä½¿åœ¨é›†ç¾¤ä¸­è¿˜æœ‰å¯ç”¨Nodeåˆ—è¡¨ä¹Ÿä¸è¡Œï¼Œè¿™å°±é™åˆ¶äº†å®ƒçš„ä½¿ç”¨åœºæ™¯ã€‚\nåŸºäºä¸Šé¢çš„é—®é¢˜ï¼Œkubernetesè¿˜æä¾›äº†ä¸€ç§äº²å’Œæ€§è°ƒåº¦ï¼ˆAffinityï¼‰ã€‚å®ƒåœ¨NodeSelectorçš„åŸºç¡€ä¹‹ä¸Šçš„è¿›è¡Œäº†æ‰©å±•ï¼Œå¯ä»¥é€šè¿‡é…ç½®çš„å½¢å¼ï¼Œå®ç°ä¼˜å…ˆé€‰æ‹©æ»¡è¶³æ¡ä»¶çš„Nodeè¿›è¡Œè°ƒåº¦ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä¹Ÿå¯ä»¥è°ƒåº¦åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹ä¸Šï¼Œä½¿è°ƒåº¦æ›´åŠ çµæ´»ã€‚\nAffinityä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼š\n\nnodeAffinity(nodeäº²å’Œæ€§ï¼‰: ä»¥nodeä¸ºç›®æ ‡ï¼Œè§£å†³podå¯ä»¥è°ƒåº¦åˆ°å“ªäº›nodeçš„é—®é¢˜\npodAffinity(podäº²å’Œæ€§) : ä»¥podä¸ºç›®æ ‡ï¼Œè§£å†³podå¯ä»¥å’Œå“ªäº›å·²å­˜åœ¨çš„podéƒ¨ç½²åœ¨åŒä¸€ä¸ªæ‹“æ‰‘åŸŸä¸­çš„é—®é¢˜\npodAntiAffinity(podåäº²å’Œæ€§) : ä»¥podä¸ºç›®æ ‡ï¼Œè§£å†³podä¸èƒ½å’Œå“ªäº›å·²å­˜åœ¨podéƒ¨ç½²åœ¨åŒä¸€ä¸ªæ‹“æ‰‘åŸŸä¸­çš„é—®é¢˜\n\n\n\n\n\n\n\n\n\n\nå…³äºäº²å’Œæ€§(åäº²å’Œæ€§)ä½¿ç”¨åœºæ™¯çš„è¯´æ˜ï¼š\näº²å’Œæ€§ï¼šå¦‚æœä¸¤ä¸ªåº”ç”¨é¢‘ç¹äº¤äº’ï¼Œé‚£å°±æœ‰å¿…è¦åˆ©ç”¨äº²å’Œæ€§è®©ä¸¤ä¸ªåº”ç”¨çš„å°½å¯èƒ½çš„é è¿‘ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å› ç½‘ç»œé€šä¿¡è€Œå¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚\nåäº²å’Œæ€§ï¼šå½“åº”ç”¨çš„é‡‡ç”¨å¤šå‰¯æœ¬éƒ¨ç½²æ—¶ï¼Œæœ‰å¿…è¦é‡‡ç”¨åäº²å’Œæ€§è®©å„ä¸ªåº”ç”¨å®ä¾‹æ‰“æ•£åˆ†å¸ƒåœ¨å„ä¸ªnodeä¸Šï¼Œè¿™æ ·å¯ä»¥æé«˜æœåŠ¡çš„é«˜å¯ç”¨æ€§ã€‚\nNodeAffinity\né¦–å…ˆæ¥çœ‹ä¸€ä¸‹NodeAffinityçš„å¯é…ç½®é¡¹ï¼š\npod.spec.affinity.nodeAffinity\n  requiredDuringSchedulingIgnoredDuringExecution  NodeèŠ‚ç‚¹å¿…é¡»æ»¡è¶³æŒ‡å®šçš„æ‰€æœ‰è§„åˆ™æ‰å¯ä»¥ï¼Œç›¸å½“äºç¡¬é™åˆ¶\n    nodeSelectorTerms  èŠ‚ç‚¹é€‰æ‹©åˆ—è¡¨\n      matchFields   æŒ‰èŠ‚ç‚¹å­—æ®µåˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨\n      matchExpressions   æŒ‰èŠ‚ç‚¹æ ‡ç­¾åˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨(æ¨è)\n        key    é”®\n        values å€¼\n        operator å…³ç³»ç¬¦ æ”¯æŒExists, DoesNotExist, In, NotIn, Gt, Lt\n  preferredDuringSchedulingIgnoredDuringExecution ä¼˜å…ˆè°ƒåº¦åˆ°æ»¡è¶³æŒ‡å®šçš„è§„åˆ™çš„Nodeï¼Œç›¸å½“äºè½¯é™åˆ¶ (å€¾å‘)\n    preference   ä¸€ä¸ªèŠ‚ç‚¹é€‰æ‹©å™¨é¡¹ï¼Œä¸ç›¸åº”çš„æƒé‡ç›¸å…³è”\n      matchFields   æŒ‰èŠ‚ç‚¹å­—æ®µåˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨\n      matchExpressions   æŒ‰èŠ‚ç‚¹æ ‡ç­¾åˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨(æ¨è)\n        key    é”®\n        values å€¼\n        operator å…³ç³»ç¬¦ æ”¯æŒIn, NotIn, Exists, DoesNotExist, Gt, Lt\n\tweight å€¾å‘æƒé‡ï¼Œåœ¨èŒƒå›´1-100ã€‚\n\nå…³ç³»ç¬¦çš„ä½¿ç”¨è¯´æ˜:\n\n- matchExpressions:\n  - key: nodeenv              # åŒ¹é…å­˜åœ¨æ ‡ç­¾çš„keyä¸ºnodeenvçš„èŠ‚ç‚¹\n    operator: Exists\n  - key: nodeenv              # åŒ¹é…æ ‡ç­¾çš„keyä¸ºnodeenv,ä¸”valueæ˜¯&quot;xxx&quot;æˆ–&quot;yyy&quot;çš„èŠ‚ç‚¹\n    operator: In\n    values: [&quot;xxx&quot;,&quot;yyy&quot;]\n  - key: nodeenv              # åŒ¹é…æ ‡ç­¾çš„keyä¸ºnodeenv,ä¸”valueå¤§äº&quot;xxx&quot;çš„èŠ‚ç‚¹\n    operator: Gt\n    values: &quot;xxx&quot;\n\næ¥ä¸‹æ¥é¦–å…ˆæ¼”ç¤ºä¸€ä¸‹requiredDuringSchedulingIgnoredDuringExecution ,\nåˆ›å»ºpod-nodeaffinity-required.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-nodeaffinity-required\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  affinity:  #äº²å’Œæ€§è®¾ç½®\n    nodeAffinity: #è®¾ç½®nodeäº²å’Œæ€§\n      requiredDuringSchedulingIgnoredDuringExecution: # ç¡¬é™åˆ¶\n        nodeSelectorTerms:\n        - matchExpressions: # åŒ¹é…envçš„å€¼åœ¨[&quot;xxx&quot;,&quot;yyy&quot;]ä¸­çš„æ ‡ç­¾\n          - key: nodeenv\n            operator: In\n            values: [&quot;xxx&quot;,&quot;yyy&quot;]\n\n# åˆ›å»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-required.yaml\npod&#x2F;pod-nodeaffinity-required created\n\n# æŸ¥çœ‹podçŠ¶æ€ ï¼ˆè¿è¡Œå¤±è´¥ï¼‰\n[root@k8s-master01 ~]# kubectl get pods pod-nodeaffinity-required -n dev -o wide\nNAME                        READY   STATUS    RESTARTS   AGE   IP       NODE    ...... \npod-nodeaffinity-required   0&#x2F;1     Pending   0          16s   &lt;none&gt;   &lt;none&gt;  ......\n\n# æŸ¥çœ‹Podçš„è¯¦æƒ…\n# å‘ç°è°ƒåº¦å¤±è´¥ï¼Œæç¤ºnodeé€‰æ‹©å¤±è´¥\n[root@k8s-master01 ~]# kubectl describe pod pod-nodeaffinity-required -n dev\n......\n  Warning  FailedScheduling  &lt;unknown&gt;  default-scheduler  0&#x2F;3 nodes are available: 3 node(s) didn&#39;t match node selector.\n  Warning  FailedScheduling  &lt;unknown&gt;  default-scheduler  0&#x2F;3 nodes are available: 3 node(s) didn&#39;t match node selector.\n\n#æ¥ä¸‹æ¥ï¼Œåœæ­¢pod\n[root@k8s-master01 ~]# kubectl delete -f pod-nodeaffinity-required.yaml\npod &quot;pod-nodeaffinity-required&quot; deleted\n\n# ä¿®æ”¹æ–‡ä»¶ï¼Œå°†values: [&quot;xxx&quot;,&quot;yyy&quot;]------&gt; [&quot;pro&quot;,&quot;yyy&quot;]\n[root@k8s-master01 ~]# vim pod-nodeaffinity-required.yaml\n\n# å†æ¬¡å¯åŠ¨\n[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-required.yaml\npod&#x2F;pod-nodeaffinity-required created\n\n# æ­¤æ—¶æŸ¥çœ‹ï¼Œå‘ç°è°ƒåº¦æˆåŠŸï¼Œå·²ç»å°†podè°ƒåº¦åˆ°äº†node1ä¸Š\n[root@k8s-master01 ~]# kubectl get pods pod-nodeaffinity-required -n dev -o wide\nNAME                        READY   STATUS    RESTARTS   AGE   IP            NODE  ...... \npod-nodeaffinity-required   1&#x2F;1     Running   0          11s   10.244.1.89   node1 ......\n\næ¥ä¸‹æ¥å†æ¼”ç¤ºä¸€ä¸‹requiredDuringSchedulingIgnoredDuringExecution ,\nåˆ›å»ºpod-nodeaffinity-preferred.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-nodeaffinity-preferred\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  affinity:  #äº²å’Œæ€§è®¾ç½®\n    nodeAffinity: #è®¾ç½®nodeäº²å’Œæ€§\n      preferredDuringSchedulingIgnoredDuringExecution: # è½¯é™åˆ¶\n      - weight: 1\n        preference:\n          matchExpressions: # åŒ¹é…envçš„å€¼åœ¨[&quot;xxx&quot;,&quot;yyy&quot;]ä¸­çš„æ ‡ç­¾(å½“å‰ç¯å¢ƒæ²¡æœ‰)\n          - key: nodeenv\n            operator: In\n            values: [&quot;xxx&quot;,&quot;yyy&quot;]\n\n# åˆ›å»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-preferred.yaml\npod&#x2F;pod-nodeaffinity-preferred created\n\n# æŸ¥çœ‹podçŠ¶æ€ ï¼ˆè¿è¡ŒæˆåŠŸï¼‰\n[root@k8s-master01 ~]# kubectl get pod pod-nodeaffinity-preferred -n dev\nNAME                         READY   STATUS    RESTARTS   AGE\npod-nodeaffinity-preferred   1&#x2F;1     Running   0          40s\n\nNodeAffinityè§„åˆ™è®¾ç½®çš„æ³¨æ„äº‹é¡¹ï¼š\n    1 å¦‚æœåŒæ—¶å®šä¹‰äº†nodeSelectorå’ŒnodeAffinityï¼Œé‚£ä¹ˆå¿…é¡»ä¸¤ä¸ªæ¡ä»¶éƒ½å¾—åˆ°æ»¡è¶³ï¼ŒPodæ‰èƒ½è¿è¡Œåœ¨æŒ‡å®šçš„Nodeä¸Š\n    2 å¦‚æœnodeAffinityæŒ‡å®šäº†å¤šä¸ªnodeSelectorTermsï¼Œé‚£ä¹ˆåªéœ€è¦å…¶ä¸­ä¸€ä¸ªèƒ½å¤ŸåŒ¹é…æˆåŠŸå³å¯\n    3 å¦‚æœä¸€ä¸ªnodeSelectorTermsä¸­æœ‰å¤šä¸ªmatchExpressions ï¼Œåˆ™ä¸€ä¸ªèŠ‚ç‚¹å¿…é¡»æ»¡è¶³æ‰€æœ‰çš„æ‰èƒ½åŒ¹é…æˆåŠŸ\n    4 å¦‚æœä¸€ä¸ªpodæ‰€åœ¨çš„Nodeåœ¨Podè¿è¡ŒæœŸé—´å…¶æ ‡ç­¾å‘ç”Ÿäº†æ”¹å˜ï¼Œä¸å†ç¬¦åˆè¯¥Podçš„èŠ‚ç‚¹äº²å’Œæ€§éœ€æ±‚ï¼Œåˆ™ç³»ç»Ÿå°†å¿½ç•¥æ­¤å˜åŒ–\n\nPodAffinity\nPodAffinityä¸»è¦å®ç°ä»¥è¿è¡Œçš„Podä¸ºå‚ç…§ï¼Œå®ç°è®©æ–°åˆ›å»ºçš„Podè·Ÿå‚ç…§podåœ¨ä¸€ä¸ªåŒºåŸŸçš„åŠŸèƒ½ã€‚\né¦–å…ˆæ¥çœ‹ä¸€ä¸‹PodAffinityçš„å¯é…ç½®é¡¹ï¼š\npod.spec.affinity.podAffinity\n  requiredDuringSchedulingIgnoredDuringExecution  ç¡¬é™åˆ¶\n    namespaces       æŒ‡å®šå‚ç…§podçš„namespace\n    topologyKey      æŒ‡å®šè°ƒåº¦ä½œç”¨åŸŸ\n    labelSelector    æ ‡ç­¾é€‰æ‹©å™¨\n      matchExpressions  æŒ‰èŠ‚ç‚¹æ ‡ç­¾åˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨(æ¨è)\n        key    é”®\n        values å€¼\n        operator å…³ç³»ç¬¦ æ”¯æŒIn, NotIn, Exists, DoesNotExist.\n      matchLabels    æŒ‡å¤šä¸ªmatchExpressionsæ˜ å°„çš„å†…å®¹\n  preferredDuringSchedulingIgnoredDuringExecution è½¯é™åˆ¶\n    podAffinityTerm  é€‰é¡¹\n      namespaces      \n      topologyKey\n      labelSelector\n        matchExpressions  \n          key    é”®\n          values å€¼\n          operator\n        matchLabels \n    weight å€¾å‘æƒé‡ï¼Œåœ¨èŒƒå›´1-100\n\ntopologyKeyç”¨äºæŒ‡å®šè°ƒåº¦æ—¶ä½œç”¨åŸŸ,ä¾‹å¦‚:\n    å¦‚æœæŒ‡å®šä¸ºkubernetes.io&#x2F;hostnameï¼Œé‚£å°±æ˜¯ä»¥NodeèŠ‚ç‚¹ä¸ºåŒºåˆ†èŒƒå›´\n\tå¦‚æœæŒ‡å®šä¸ºbeta.kubernetes.io&#x2F;os,åˆ™ä»¥NodeèŠ‚ç‚¹çš„æ“ä½œç³»ç»Ÿç±»å‹æ¥åŒºåˆ†\n\næ¥ä¸‹æ¥ï¼Œæ¼”ç¤ºä¸‹requiredDuringSchedulingIgnoredDuringExecution,\n1ï¼‰é¦–å…ˆåˆ›å»ºä¸€ä¸ªå‚ç…§Podï¼Œpod-podaffinity-target.yamlï¼š\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-podaffinity-target\n  namespace: dev\n  labels:\n    podenv: pro #è®¾ç½®æ ‡ç­¾\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  nodeName: node1 # å°†ç›®æ ‡podåç¡®æŒ‡å®šåˆ°node1ä¸Š\n\n# å¯åŠ¨ç›®æ ‡pod\n[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-target.yaml\npod&#x2F;pod-podaffinity-target created\n\n# æŸ¥çœ‹podçŠ¶å†µ\n[root@k8s-master01 ~]# kubectl get pods  pod-podaffinity-target -n dev\nNAME                     READY   STATUS    RESTARTS   AGE\npod-podaffinity-target   1&#x2F;1     Running   0          4s\n\n2ï¼‰åˆ›å»ºpod-podaffinity-required.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-podaffinity-required\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  affinity:  #äº²å’Œæ€§è®¾ç½®\n    podAffinity: #è®¾ç½®podäº²å’Œæ€§\n      requiredDuringSchedulingIgnoredDuringExecution: # ç¡¬é™åˆ¶\n      - labelSelector:\n          matchExpressions: # åŒ¹é…envçš„å€¼åœ¨[&quot;xxx&quot;,&quot;yyy&quot;]ä¸­çš„æ ‡ç­¾\n          - key: podenv\n            operator: In\n            values: [&quot;xxx&quot;,&quot;yyy&quot;]\n        topologyKey: kubernetes.io&#x2F;hostname\n\nä¸Šé¢é…ç½®è¡¨è¾¾çš„æ„æ€æ˜¯ï¼šæ–°Podå¿…é¡»è¦ä¸æ‹¥æœ‰æ ‡ç­¾nodeenv&#x3D;xxxæˆ–è€…nodeenv&#x3D;yyyçš„podåœ¨åŒä¸€Nodeä¸Šï¼Œæ˜¾ç„¶ç°åœ¨æ²¡æœ‰è¿™æ ·podï¼Œæ¥ä¸‹æ¥ï¼Œè¿è¡Œæµ‹è¯•ä¸€ä¸‹ã€‚\n# å¯åŠ¨pod\n[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-required.yaml\npod&#x2F;pod-podaffinity-required created\n\n# æŸ¥çœ‹podçŠ¶æ€ï¼Œå‘ç°æœªè¿è¡Œ\n[root@k8s-master01 ~]# kubectl get pods pod-podaffinity-required -n dev\nNAME                       READY   STATUS    RESTARTS   AGE\npod-podaffinity-required   0&#x2F;1     Pending   0          9s\n\n# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯\n[root@k8s-master01 ~]# kubectl describe pods pod-podaffinity-required  -n dev\n......\nEvents:\n  Type     Reason            Age        From               Message\n  ----     ------            ----       ----               -------\n  Warning  FailedScheduling  &lt;unknown&gt;  default-scheduler  0&#x2F;3 nodes are available: 2 node(s) didn&#39;t match pod affinity rules, 1 node(s) had taints that the pod didn&#39;t tolerate.\n\n# æ¥ä¸‹æ¥ä¿®æ”¹  values: [&quot;xxx&quot;,&quot;yyy&quot;]-----&gt;values:[&quot;pro&quot;,&quot;yyy&quot;]\n# æ„æ€æ˜¯ï¼šæ–°Podå¿…é¡»è¦ä¸æ‹¥æœ‰æ ‡ç­¾nodeenv&#x3D;xxxæˆ–è€…nodeenv&#x3D;yyyçš„podåœ¨åŒä¸€Nodeä¸Š\n[root@k8s-master01 ~]# vim pod-podaffinity-required.yaml\n\n# ç„¶åé‡æ–°åˆ›å»ºpodï¼ŒæŸ¥çœ‹æ•ˆæœ\n[root@k8s-master01 ~]# kubectl delete -f  pod-podaffinity-required.yaml\npod &quot;pod-podaffinity-required&quot; deleted\n[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-required.yaml\npod&#x2F;pod-podaffinity-required created\n\n# å‘ç°æ­¤æ—¶Podè¿è¡Œæ­£å¸¸\n[root@k8s-master01 ~]# kubectl get pods pod-podaffinity-required -n dev\nNAME                       READY   STATUS    RESTARTS   AGE   LABELS\npod-podaffinity-required   1&#x2F;1     Running   0          6s    &lt;none&gt;\n\nå…³äºPodAffinityçš„ preferredDuringSchedulingIgnoredDuringExecutionï¼Œè¿™é‡Œä¸å†æ¼”ç¤ºã€‚\nPodAntiAffinity\nPodAntiAffinityä¸»è¦å®ç°ä»¥è¿è¡Œçš„Podä¸ºå‚ç…§ï¼Œè®©æ–°åˆ›å»ºçš„Podè·Ÿå‚ç…§podä¸åœ¨ä¸€ä¸ªåŒºåŸŸä¸­çš„åŠŸèƒ½ã€‚\nå®ƒçš„é…ç½®æ–¹å¼å’Œé€‰é¡¹è·ŸPodAffintyæ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œä¸å†åšè¯¦ç»†è§£é‡Šï¼Œç›´æ¥åšä¸€ä¸ªæµ‹è¯•æ¡ˆä¾‹ã€‚\n1ï¼‰ç»§ç»­ä½¿ç”¨ä¸Šä¸ªæ¡ˆä¾‹ä¸­ç›®æ ‡pod\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide --show-labels\nNAME                     READY   STATUS    RESTARTS   AGE     IP            NODE    LABELS\npod-podaffinity-required 1&#x2F;1     Running   0          3m29s   10.244.1.38   node1   &lt;none&gt;     \npod-podaffinity-target   1&#x2F;1     Running   0          9m25s   10.244.1.37   node1   podenv&#x3D;pro\n\n2ï¼‰åˆ›å»ºpod-podantiaffinity-required.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-podantiaffinity-required\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  affinity:  #äº²å’Œæ€§è®¾ç½®\n    podAntiAffinity: #è®¾ç½®podäº²å’Œæ€§\n      requiredDuringSchedulingIgnoredDuringExecution: # ç¡¬é™åˆ¶\n      - labelSelector:\n          matchExpressions: # åŒ¹é…podenvçš„å€¼åœ¨[&quot;pro&quot;]ä¸­çš„æ ‡ç­¾\n          - key: podenv\n            operator: In\n            values: [&quot;pro&quot;]\n        topologyKey: kubernetes.io&#x2F;hostname\n\nä¸Šé¢é…ç½®è¡¨è¾¾çš„æ„æ€æ˜¯ï¼šæ–°Podå¿…é¡»è¦ä¸æ‹¥æœ‰æ ‡ç­¾nodeenv&#x3D;proçš„podä¸åœ¨åŒä¸€Nodeä¸Šï¼Œè¿è¡Œæµ‹è¯•ä¸€ä¸‹ã€‚\n# åˆ›å»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-podantiaffinity-required.yaml\npod&#x2F;pod-podantiaffinity-required created\n\n# æŸ¥çœ‹pod\n# å‘ç°è°ƒåº¦åˆ°äº†node2ä¸Š\n[root@k8s-master01 ~]# kubectl get pods pod-podantiaffinity-required -n dev -o wide\nNAME                           READY   STATUS    RESTARTS   AGE   IP            NODE   .. \npod-podantiaffinity-required   1&#x2F;1     Running   0          30s   10.244.1.96   node2  ..\n\n5.4.3 æ±¡ç‚¹å’Œå®¹å¿æ±¡ç‚¹ï¼ˆTaintsï¼‰\nå‰é¢çš„è°ƒåº¦æ–¹å¼éƒ½æ˜¯ç«™åœ¨Podçš„è§’åº¦ä¸Šï¼Œé€šè¿‡åœ¨Podä¸Šæ·»åŠ å±æ€§ï¼Œæ¥ç¡®å®šPodæ˜¯å¦è¦è°ƒåº¦åˆ°æŒ‡å®šçš„Nodeä¸Šï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥ç«™åœ¨Nodeçš„è§’åº¦ä¸Šï¼Œé€šè¿‡åœ¨Nodeä¸Šæ·»åŠ æ±¡ç‚¹å±æ€§ï¼Œæ¥å†³å®šæ˜¯å¦å…è®¸Podè°ƒåº¦è¿‡æ¥ã€‚\nNodeè¢«è®¾ç½®ä¸Šæ±¡ç‚¹ä¹‹åå°±å’ŒPodä¹‹é—´å­˜åœ¨äº†ä¸€ç§ç›¸æ–¥çš„å…³ç³»ï¼Œè¿›è€Œæ‹’ç»Podè°ƒåº¦è¿›æ¥ï¼Œç”šè‡³å¯ä»¥å°†å·²ç»å­˜åœ¨çš„Podé©±é€å‡ºå»ã€‚\næ±¡ç‚¹çš„æ ¼å¼ä¸ºï¼škey=value:effect, keyå’Œvalueæ˜¯æ±¡ç‚¹çš„æ ‡ç­¾ï¼Œeffectæè¿°æ±¡ç‚¹çš„ä½œç”¨ï¼Œæ”¯æŒå¦‚ä¸‹ä¸‰ä¸ªé€‰é¡¹ï¼š\n\nPreferNoScheduleï¼škuberneteså°†å°½é‡é¿å…æŠŠPodè°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„Nodeä¸Šï¼Œé™¤éæ²¡æœ‰å…¶ä»–èŠ‚ç‚¹å¯è°ƒåº¦\nNoScheduleï¼škuberneteså°†ä¸ä¼šæŠŠPodè°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„Nodeä¸Šï¼Œä½†ä¸ä¼šå½±å“å½“å‰Nodeä¸Šå·²å­˜åœ¨çš„Pod\nNoExecuteï¼škuberneteså°†ä¸ä¼šæŠŠPodè°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„Nodeä¸Šï¼ŒåŒæ—¶ä¹Ÿä¼šå°†Nodeä¸Šå·²å­˜åœ¨çš„Podé©±ç¦»\n\n\nä½¿ç”¨kubectlè®¾ç½®å’Œå»é™¤æ±¡ç‚¹çš„å‘½ä»¤ç¤ºä¾‹å¦‚ä¸‹ï¼š\n# è®¾ç½®æ±¡ç‚¹\nkubectl taint nodes node1 key&#x3D;value:effect\n\n# å»é™¤æ±¡ç‚¹\nkubectl taint nodes node1 key:effect-\n\n# å»é™¤æ‰€æœ‰æ±¡ç‚¹\nkubectl taint nodes node1 key-\n\næ¥ä¸‹æ¥ï¼Œæ¼”ç¤ºä¸‹æ±¡ç‚¹çš„æ•ˆæœï¼š\n\nå‡†å¤‡èŠ‚ç‚¹node1ï¼ˆä¸ºäº†æ¼”ç¤ºæ•ˆæœæ›´åŠ æ˜æ˜¾ï¼Œæš‚æ—¶åœæ­¢node2èŠ‚ç‚¹ï¼‰\nä¸ºnode1èŠ‚ç‚¹è®¾ç½®ä¸€ä¸ªæ±¡ç‚¹: tag=heima:PreferNoScheduleï¼›ç„¶ååˆ›å»ºpod1( pod1 å¯ä»¥ )\nä¿®æ”¹ä¸ºnode1èŠ‚ç‚¹è®¾ç½®ä¸€ä¸ªæ±¡ç‚¹: tag=heima:NoScheduleï¼›ç„¶ååˆ›å»ºpod2( pod1 æ­£å¸¸ pod2 å¤±è´¥ )\nä¿®æ”¹ä¸ºnode1èŠ‚ç‚¹è®¾ç½®ä¸€ä¸ªæ±¡ç‚¹: tag=heima:NoExecuteï¼›ç„¶ååˆ›å»ºpod3 ( 3ä¸ªpodéƒ½å¤±è´¥ )\n\n# ä¸ºnode1è®¾ç½®æ±¡ç‚¹(PreferNoSchedule)\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag&#x3D;heima:PreferNoSchedule\n\n# åˆ›å»ºpod1\n[root@k8s-master01 ~]# kubectl run taint1 --image&#x3D;nginx:1.17.1 -n dev\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nNAME                      READY   STATUS    RESTARTS   AGE     IP           NODE   \ntaint1-7665f7fd85-574h4   1&#x2F;1     Running   0          2m24s   10.244.1.59   node1    \n\n# ä¸ºnode1è®¾ç½®æ±¡ç‚¹(å–æ¶ˆPreferNoScheduleï¼Œè®¾ç½®NoSchedule)\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag:PreferNoSchedule-\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag&#x3D;heima:NoSchedule\n\n# åˆ›å»ºpod2\n[root@k8s-master01 ~]# kubectl run taint2 --image&#x3D;nginx:1.17.1 -n dev\n[root@k8s-master01 ~]# kubectl get pods taint2 -n dev -o wide\nNAME                      READY   STATUS    RESTARTS   AGE     IP            NODE\ntaint1-7665f7fd85-574h4   1&#x2F;1     Running   0          2m24s   10.244.1.59   node1 \ntaint2-544694789-6zmlf    0&#x2F;1     Pending   0          21s     &lt;none&gt;        &lt;none&gt;   \n\n# ä¸ºnode1è®¾ç½®æ±¡ç‚¹(å–æ¶ˆNoScheduleï¼Œè®¾ç½®NoExecute)\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag:NoSchedule-\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag&#x3D;heima:NoExecute\n\n# åˆ›å»ºpod3\n[root@k8s-master01 ~]# kubectl run taint3 --image&#x3D;nginx:1.17.1 -n dev\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nNAME                      READY   STATUS    RESTARTS   AGE   IP       NODE     NOMINATED \ntaint1-7665f7fd85-htkmp   0&#x2F;1     Pending   0          35s   &lt;none&gt;   &lt;none&gt;   &lt;none&gt;    \ntaint2-544694789-bn7wb    0&#x2F;1     Pending   0          35s   &lt;none&gt;   &lt;none&gt;   &lt;none&gt;     \ntaint3-6d78dbd749-tktkq   0&#x2F;1     Pending   0          6s    &lt;none&gt;   &lt;none&gt;   &lt;none&gt;     \n\nå°æç¤ºï¼š\n    ä½¿ç”¨kubeadmæ­å»ºçš„é›†ç¾¤ï¼Œé»˜è®¤å°±ä¼šç»™masterèŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªæ±¡ç‚¹æ ‡è®°,æ‰€ä»¥podå°±ä¸ä¼šè°ƒåº¦åˆ°masterèŠ‚ç‚¹ä¸Š.\n\nå®¹å¿ï¼ˆTolerationï¼‰\nä¸Šé¢ä»‹ç»äº†æ±¡ç‚¹çš„ä½œç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨nodeä¸Šæ·»åŠ æ±¡ç‚¹ç”¨äºæ‹’ç»podè°ƒåº¦ä¸Šæ¥ï¼Œä½†æ˜¯å¦‚æœå°±æ˜¯æƒ³å°†ä¸€ä¸ªpodè°ƒåº¦åˆ°ä¸€ä¸ªæœ‰æ±¡ç‚¹çš„nodeä¸Šå»ï¼Œè¿™æ—¶å€™åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿè¿™å°±è¦ä½¿ç”¨åˆ°å®¹å¿ã€‚\n\n\n\n\n\n\n\n\n\n\næ±¡ç‚¹å°±æ˜¯æ‹’ç»ï¼Œå®¹å¿å°±æ˜¯å¿½ç•¥ï¼ŒNodeé€šè¿‡æ±¡ç‚¹æ‹’ç»podè°ƒåº¦ä¸Šå»ï¼ŒPodé€šè¿‡å®¹å¿å¿½ç•¥æ‹’ç»\nä¸‹é¢å…ˆé€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹çœ‹ä¸‹æ•ˆæœï¼š\n\nä¸Šä¸€å°èŠ‚ï¼Œå·²ç»åœ¨node1èŠ‚ç‚¹ä¸Šæ‰“ä¸Šäº†NoExecuteçš„æ±¡ç‚¹ï¼Œæ­¤æ—¶podæ˜¯è°ƒåº¦ä¸ä¸Šå»çš„\næœ¬å°èŠ‚ï¼Œå¯ä»¥é€šè¿‡ç»™podæ·»åŠ å®¹å¿ï¼Œç„¶åå°†å…¶è°ƒåº¦ä¸Šå»\n\nåˆ›å»ºpod-toleration.yaml,å†…å®¹å¦‚ä¸‹\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-toleration\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  tolerations:      # æ·»åŠ å®¹å¿\n  - key: &quot;tag&quot;        # è¦å®¹å¿çš„æ±¡ç‚¹çš„key\n    operator: &quot;Equal&quot; # æ“ä½œç¬¦\n    value: &quot;heima&quot;    # å®¹å¿çš„æ±¡ç‚¹çš„value\n    effect: &quot;NoExecute&quot;   # æ·»åŠ å®¹å¿çš„è§„åˆ™ï¼Œè¿™é‡Œå¿…é¡»å’Œæ ‡è®°çš„æ±¡ç‚¹è§„åˆ™ç›¸åŒ\n\n# æ·»åŠ å®¹å¿ä¹‹å‰çš„pod\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nNAME             READY   STATUS    RESTARTS   AGE   IP       NODE     NOMINATED \npod-toleration   0&#x2F;1     Pending   0          3s    &lt;none&gt;   &lt;none&gt;   &lt;none&gt;           \n\n# æ·»åŠ å®¹å¿ä¹‹åçš„pod\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nNAME             READY   STATUS    RESTARTS   AGE   IP            NODE    NOMINATED\npod-toleration   1&#x2F;1     Running   0          3s    10.244.1.62   node1   &lt;none&gt;        \n\nä¸‹é¢çœ‹ä¸€ä¸‹å®¹å¿çš„è¯¦ç»†é…ç½®:\n[root@k8s-master01 ~]# kubectl explain pod.spec.tolerations\n......\nFIELDS:\n   key       # å¯¹åº”ç€è¦å®¹å¿çš„æ±¡ç‚¹çš„é”®ï¼Œç©ºæ„å‘³ç€åŒ¹é…æ‰€æœ‰çš„é”®\n   value     # å¯¹åº”ç€è¦å®¹å¿çš„æ±¡ç‚¹çš„å€¼\n   operator  # key-valueçš„è¿ç®—ç¬¦ï¼Œæ”¯æŒEqualå’ŒExistsï¼ˆé»˜è®¤ï¼‰\n   effect    # å¯¹åº”æ±¡ç‚¹çš„effectï¼Œç©ºæ„å‘³ç€åŒ¹é…æ‰€æœ‰å½±å“\n   tolerationSeconds   # å®¹å¿æ—¶é—´, å½“effectä¸ºNoExecuteæ—¶ç”Ÿæ•ˆï¼Œè¡¨ç¤ºpodåœ¨Nodeä¸Šçš„åœç•™æ—¶é—´\n\n6. Podæ§åˆ¶å™¨è¯¦è§£6.1 Podæ§åˆ¶å™¨ä»‹ç»Podæ˜¯kubernetesçš„æœ€å°ç®¡ç†å•å…ƒï¼Œåœ¨kubernetesä¸­ï¼ŒæŒ‰ç…§podçš„åˆ›å»ºæ–¹å¼å¯ä»¥å°†å…¶åˆ†ä¸ºä¸¤ç±»ï¼š\n\nè‡ªä¸»å¼podï¼škubernetesç›´æ¥åˆ›å»ºå‡ºæ¥çš„Podï¼Œè¿™ç§podåˆ é™¤åå°±æ²¡æœ‰äº†ï¼Œä¹Ÿä¸ä¼šé‡å»º\næ§åˆ¶å™¨åˆ›å»ºçš„podï¼škubernetesé€šè¿‡æ§åˆ¶å™¨åˆ›å»ºçš„podï¼Œè¿™ç§podåˆ é™¤äº†ä¹‹åè¿˜ä¼šè‡ªåŠ¨é‡å»º\n\n\n\n\n\n\n\n\n\n\nä»€ä¹ˆæ˜¯Podæ§åˆ¶å™¨\nPodæ§åˆ¶å™¨æ˜¯ç®¡ç†podçš„ä¸­é—´å±‚ï¼Œä½¿ç”¨Podæ§åˆ¶å™¨ä¹‹åï¼Œåªéœ€è¦å‘Šè¯‰Podæ§åˆ¶å™¨ï¼Œæƒ³è¦å¤šå°‘ä¸ªä»€ä¹ˆæ ·çš„Podå°±å¯ä»¥äº†ï¼Œå®ƒä¼šåˆ›å»ºå‡ºæ»¡è¶³æ¡ä»¶çš„Podå¹¶ç¡®ä¿æ¯ä¸€ä¸ªPodèµ„æºå¤„äºç”¨æˆ·æœŸæœ›çš„ç›®æ ‡çŠ¶æ€ã€‚å¦‚æœPodèµ„æºåœ¨è¿è¡Œä¸­å‡ºç°æ•…éšœï¼Œå®ƒä¼šåŸºäºæŒ‡å®šç­–ç•¥é‡æ–°ç¼–æ’Podã€‚\nåœ¨kubernetesä¸­ï¼Œæœ‰å¾ˆå¤šç±»å‹çš„podæ§åˆ¶å™¨ï¼Œæ¯ç§éƒ½æœ‰è‡ªå·±çš„é€‚åˆçš„åœºæ™¯ï¼Œå¸¸è§çš„æœ‰ä¸‹é¢è¿™äº›ï¼š\n\nReplicationControllerï¼šæ¯”è¾ƒåŸå§‹çš„podæ§åˆ¶å™¨ï¼Œå·²ç»è¢«åºŸå¼ƒï¼Œç”±ReplicaSetæ›¿ä»£\nReplicaSetï¼šä¿è¯å‰¯æœ¬æ•°é‡ä¸€ç›´ç»´æŒåœ¨æœŸæœ›å€¼ï¼Œå¹¶æ”¯æŒpodæ•°é‡æ‰©ç¼©å®¹ï¼Œé•œåƒç‰ˆæœ¬å‡çº§\nDeploymentï¼šé€šè¿‡æ§åˆ¶ReplicaSetæ¥æ§åˆ¶Podï¼Œå¹¶æ”¯æŒæ»šåŠ¨å‡çº§ã€å›é€€ç‰ˆæœ¬\nHorizontal Pod Autoscalerï¼šå¯ä»¥æ ¹æ®é›†ç¾¤è´Ÿè½½è‡ªåŠ¨æ°´å¹³è°ƒæ•´Podçš„æ•°é‡ï¼Œå®ç°å‰Šå³°å¡«è°·\nDaemonSetï¼šåœ¨é›†ç¾¤ä¸­çš„æŒ‡å®šNodeä¸Šè¿è¡Œä¸”ä»…è¿è¡Œä¸€ä¸ªå‰¯æœ¬ï¼Œä¸€èˆ¬ç”¨äºå®ˆæŠ¤è¿›ç¨‹ç±»çš„ä»»åŠ¡\nJobï¼šå®ƒåˆ›å»ºå‡ºæ¥çš„podåªè¦å®Œæˆä»»åŠ¡å°±ç«‹å³é€€å‡ºï¼Œä¸éœ€è¦é‡å¯æˆ–é‡å»ºï¼Œç”¨äºæ‰§è¡Œä¸€æ¬¡æ€§ä»»åŠ¡\nCronjobï¼šå®ƒåˆ›å»ºçš„Podè´Ÿè´£å‘¨æœŸæ€§ä»»åŠ¡æ§åˆ¶ï¼Œä¸éœ€è¦æŒç»­åå°è¿è¡Œ\nStatefulSetï¼šç®¡ç†æœ‰çŠ¶æ€åº”ç”¨\n\n6.2 ReplicaSet(RS)ReplicaSetçš„ä¸»è¦ä½œç”¨æ˜¯ä¿è¯ä¸€å®šæ•°é‡çš„podæ­£å¸¸è¿è¡Œï¼Œå®ƒä¼šæŒç»­ç›‘å¬è¿™äº›Podçš„è¿è¡ŒçŠ¶æ€ï¼Œä¸€æ—¦Podå‘ç”Ÿæ•…éšœï¼Œå°±ä¼šé‡å¯æˆ–é‡å»ºã€‚åŒæ—¶å®ƒè¿˜æ”¯æŒå¯¹podæ•°é‡çš„æ‰©ç¼©å®¹å’Œé•œåƒç‰ˆæœ¬çš„å‡é™çº§ã€‚\n\nReplicaSetçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š\napiVersion: apps&#x2F;v1 # ç‰ˆæœ¬å·\nkind: ReplicaSet # ç±»å‹       \nmetadata: # å…ƒæ•°æ®\n  name: # rsåç§° \n  namespace: # æ‰€å±å‘½åç©ºé—´ \n  labels: #æ ‡ç­¾\n    controller: rs\nspec: # è¯¦æƒ…æè¿°\n  replicas: 3 # å‰¯æœ¬æ•°é‡\n  selector: # é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod\n    matchLabels:      # LabelsåŒ¹é…è§„åˆ™\n      app: nginx-pod\n    matchExpressions: # ExpressionsåŒ¹é…è§„åˆ™\n      - &#123;key: app, operator: In, values: [nginx-pod]&#125;\n  template: # æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerPort: 80\n\nåœ¨è¿™é‡Œé¢ï¼Œéœ€è¦æ–°äº†è§£çš„é…ç½®é¡¹å°±æ˜¯specä¸‹é¢å‡ ä¸ªé€‰é¡¹ï¼š\n\nreplicasï¼šæŒ‡å®šå‰¯æœ¬æ•°é‡ï¼Œå…¶å®å°±æ˜¯å½“å‰rsåˆ›å»ºå‡ºæ¥çš„podçš„æ•°é‡ï¼Œé»˜è®¤ä¸º1\n\nselectorï¼šé€‰æ‹©å™¨ï¼Œå®ƒçš„ä½œç”¨æ˜¯å»ºç«‹podæ§åˆ¶å™¨å’Œpodä¹‹é—´çš„å…³è”å…³ç³»ï¼Œé‡‡ç”¨çš„Label Selectoræœºåˆ¶\nåœ¨podæ¨¡æ¿ä¸Šå®šä¹‰labelï¼Œåœ¨æ§åˆ¶å™¨ä¸Šå®šä¹‰é€‰æ‹©å™¨ï¼Œå°±å¯ä»¥è¡¨æ˜å½“å‰æ§åˆ¶å™¨èƒ½ç®¡ç†å“ªäº›podäº†\n\ntemplateï¼šæ¨¡æ¿ï¼Œå°±æ˜¯å½“å‰æ§åˆ¶å™¨åˆ›å»ºpodæ‰€ä½¿ç”¨çš„æ¨¡æ¿æ¿ï¼Œé‡Œé¢å…¶å®å°±æ˜¯å‰ä¸€ç« å­¦è¿‡çš„podçš„å®šä¹‰\n\n\nåˆ›å»ºReplicaSet\nåˆ›å»ºpc-replicaset.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\napiVersion: apps&#x2F;v1\nkind: ReplicaSet   \nmetadata:\n  name: pc-replicaset\n  namespace: dev\nspec:\n  replicas: 3\n  selector: \n    matchLabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n\n# åˆ›å»ºrs\n[root@k8s-master01 ~]# kubectl create -f pc-replicaset.yaml\nreplicaset.apps&#x2F;pc-replicaset created\n\n# æŸ¥çœ‹rs\n# DESIRED:æœŸæœ›å‰¯æœ¬æ•°é‡  \n# CURRENT:å½“å‰å‰¯æœ¬æ•°é‡  \n# READY:å·²ç»å‡†å¤‡å¥½æä¾›æœåŠ¡çš„å‰¯æœ¬æ•°é‡\n[root@k8s-master01 ~]# kubectl get rs pc-replicaset -n dev -o wide\nNAME          DESIRED   CURRENT READY AGE   CONTAINERS   IMAGES             SELECTOR\npc-replicaset 3         3       3     22s   nginx        nginx:1.17.1       app&#x3D;nginx-pod\n\n# æŸ¥çœ‹å½“å‰æ§åˆ¶å™¨åˆ›å»ºå‡ºæ¥çš„pod\n# è¿™é‡Œå‘ç°æ§åˆ¶å™¨åˆ›å»ºå‡ºæ¥çš„podçš„åç§°æ˜¯åœ¨æ§åˆ¶å™¨åç§°åé¢æ‹¼æ¥äº†-xxxxxéšæœºç \n[root@k8s-master01 ~]# kubectl get pod -n dev\nNAME                          READY   STATUS    RESTARTS   AGE\npc-replicaset-6vmvt   1&#x2F;1     Running   0          54s\npc-replicaset-fmb8f   1&#x2F;1     Running   0          54s\npc-replicaset-snrk2   1&#x2F;1     Running   0          54s\n\næ‰©ç¼©å®¹\n# ç¼–è¾‘rsçš„å‰¯æœ¬æ•°é‡ï¼Œä¿®æ”¹spec:replicas: 6å³å¯\n[root@k8s-master01 ~]# kubectl edit rs pc-replicaset -n dev\nreplicaset.apps&#x2F;pc-replicaset edited\n\n# æŸ¥çœ‹pod\n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                          READY   STATUS    RESTARTS   AGE\npc-replicaset-6vmvt   1&#x2F;1     Running   0          114m\npc-replicaset-cftnp   1&#x2F;1     Running   0          10s\npc-replicaset-fjlm6   1&#x2F;1     Running   0          10s\npc-replicaset-fmb8f   1&#x2F;1     Running   0          114m\npc-replicaset-s2whj   1&#x2F;1     Running   0          10s\npc-replicaset-snrk2   1&#x2F;1     Running   0          114m\n\n# å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤å®ç°\n# ä½¿ç”¨scaleå‘½ä»¤å®ç°æ‰©ç¼©å®¹ï¼Œ åé¢--replicas&#x3D;nç›´æ¥æŒ‡å®šç›®æ ‡æ•°é‡å³å¯\n[root@k8s-master01 ~]# kubectl scale rs pc-replicaset --replicas&#x3D;2 -n dev\nreplicaset.apps&#x2F;pc-replicaset scaled\n\n# å‘½ä»¤è¿è¡Œå®Œæ¯•ï¼Œç«‹å³æŸ¥çœ‹ï¼Œå‘ç°å·²ç»æœ‰4ä¸ªå¼€å§‹å‡†å¤‡é€€å‡ºäº†\n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                       READY   STATUS        RESTARTS   AGE\npc-replicaset-6vmvt   0&#x2F;1     Terminating   0          118m\npc-replicaset-cftnp   0&#x2F;1     Terminating   0          4m17s\npc-replicaset-fjlm6   0&#x2F;1     Terminating   0          4m17s\npc-replicaset-fmb8f   1&#x2F;1     Running       0          118m\npc-replicaset-s2whj   0&#x2F;1     Terminating   0          4m17s\npc-replicaset-snrk2   1&#x2F;1     Running       0          118m\n\n#ç¨ç­‰ç‰‡åˆ»ï¼Œå°±åªå‰©ä¸‹2ä¸ªäº†\n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                       READY   STATUS    RESTARTS   AGE\npc-replicaset-fmb8f   1&#x2F;1     Running   0          119m\npc-replicaset-snrk2   1&#x2F;1     Running   0          119m\n\né•œåƒå‡çº§\n# ç¼–è¾‘rsçš„å®¹å™¨é•œåƒ - image: nginx:1.17.2\n[root@k8s-master01 ~]# kubectl edit rs pc-replicaset -n dev\nreplicaset.apps&#x2F;pc-replicaset edited\n\n# å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°é•œåƒç‰ˆæœ¬å·²ç»å˜æ›´äº†\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\nNAME                DESIRED  CURRENT   READY   AGE    CONTAINERS   IMAGES        ...\npc-replicaset       2        2         2       140m   nginx         nginx:1.17.2  ...\n\n# åŒæ ·çš„é“ç†ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤å®Œæˆè¿™ä¸ªå·¥ä½œ\n# kubectl set image rs rsåç§° å®¹å™¨&#x3D;é•œåƒç‰ˆæœ¬ -n namespace\n[root@k8s-master01 ~]# kubectl set image rs pc-replicaset nginx&#x3D;nginx:1.17.1  -n dev\nreplicaset.apps&#x2F;pc-replicaset image updated\n\n# å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°é•œåƒç‰ˆæœ¬å·²ç»å˜æ›´äº†\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\nNAME                 DESIRED  CURRENT   READY   AGE    CONTAINERS   IMAGES            ...\npc-replicaset        2        2         2       145m   nginx        nginx:1.17.1 ... \n\nåˆ é™¤ReplicaSet\n# ä½¿ç”¨kubectl deleteå‘½ä»¤ä¼šåˆ é™¤æ­¤RSä»¥åŠå®ƒç®¡ç†çš„Pod\n# åœ¨kubernetesåˆ é™¤RSå‰ï¼Œä¼šå°†RSçš„replicasclearè°ƒæ•´ä¸º0ï¼Œç­‰å¾…æ‰€æœ‰çš„Podè¢«åˆ é™¤åï¼Œåœ¨æ‰§è¡ŒRSå¯¹è±¡çš„åˆ é™¤\n[root@k8s-master01 ~]# kubectl delete rs pc-replicaset -n dev\nreplicaset.apps &quot;pc-replicaset&quot; deleted\n[root@k8s-master01 ~]# kubectl get pod -n dev -o wide\nNo resources found in dev namespace.\n\n# å¦‚æœå¸Œæœ›ä»…ä»…åˆ é™¤RSå¯¹è±¡ï¼ˆä¿ç•™Podï¼‰ï¼Œå¯ä»¥ä½¿ç”¨kubectl deleteå‘½ä»¤æ—¶æ·»åŠ --cascade&#x3D;falseé€‰é¡¹ï¼ˆä¸æ¨èï¼‰ã€‚\n[root@k8s-master01 ~]# kubectl delete rs pc-replicaset -n dev --cascade&#x3D;false\nreplicaset.apps &quot;pc-replicaset&quot; deleted\n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                  READY   STATUS    RESTARTS   AGE\npc-replicaset-cl82j   1&#x2F;1     Running   0          75s\npc-replicaset-dslhb   1&#x2F;1     Running   0          75s\n\n# ä¹Ÿå¯ä»¥ä½¿ç”¨yamlç›´æ¥åˆ é™¤(æ¨è)\n[root@k8s-master01 ~]# kubectl delete -f pc-replicaset.yaml\nreplicaset.apps &quot;pc-replicaset&quot; deleted\n\n6.3 Deployment(Deploy)ä¸ºäº†æ›´å¥½çš„è§£å†³æœåŠ¡ç¼–æ’çš„é—®é¢˜ï¼Œkubernetesåœ¨V1.2ç‰ˆæœ¬å¼€å§‹ï¼Œå¼•å…¥äº†Deploymentæ§åˆ¶å™¨ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™ç§æ§åˆ¶å™¨å¹¶ä¸ç›´æ¥ç®¡ç†podï¼Œè€Œæ˜¯é€šè¿‡ç®¡ç†ReplicaSetæ¥ç®€ä»‹ç®¡ç†Podï¼Œå³ï¼šDeploymentç®¡ç†ReplicaSetï¼ŒReplicaSetç®¡ç†Podã€‚æ‰€ä»¥Deploymentæ¯”ReplicaSetåŠŸèƒ½æ›´åŠ å¼ºå¤§ã€‚\n\nDeploymentä¸»è¦åŠŸèƒ½æœ‰ä¸‹é¢å‡ ä¸ªï¼š\n\næ”¯æŒReplicaSetçš„æ‰€æœ‰åŠŸèƒ½\næ”¯æŒå‘å¸ƒçš„åœæ­¢ã€ç»§ç»­\næ”¯æŒæ»šåŠ¨å‡çº§å’Œå›æ»šç‰ˆæœ¬\n\nDeploymentçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š\napiVersion: apps&#x2F;v1 # ç‰ˆæœ¬å·\nkind: Deployment # ç±»å‹       \nmetadata: # å…ƒæ•°æ®\n  name: # rsåç§° \n  namespace: # æ‰€å±å‘½åç©ºé—´ \n  labels: #æ ‡ç­¾\n    controller: deploy\nspec: # è¯¦æƒ…æè¿°\n  replicas: 3 # å‰¯æœ¬æ•°é‡\n  revisionHistoryLimit: 3 # ä¿ç•™å†å²ç‰ˆæœ¬\n  paused: false # æš‚åœéƒ¨ç½²ï¼Œé»˜è®¤æ˜¯false\n  progressDeadlineSeconds: 600 # éƒ¨ç½²è¶…æ—¶æ—¶é—´ï¼ˆsï¼‰ï¼Œé»˜è®¤æ˜¯600\n  strategy: # ç­–ç•¥\n    type: RollingUpdate # æ»šåŠ¨æ›´æ–°ç­–ç•¥\n    rollingUpdate: # æ»šåŠ¨æ›´æ–°\n      maxSurge: 30% # æœ€å¤§é¢å¤–å¯ä»¥å­˜åœ¨çš„å‰¯æœ¬æ•°ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•°\n      maxUnavailable: 30% # æœ€å¤§ä¸å¯ç”¨çŠ¶æ€çš„ Pod çš„æœ€å¤§å€¼ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•°\n  selector: # é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod\n    matchLabels:      # LabelsåŒ¹é…è§„åˆ™\n      app: nginx-pod\n    matchExpressions: # ExpressionsåŒ¹é…è§„åˆ™\n      - &#123;key: app, operator: In, values: [nginx-pod]&#125;\n  template: # æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerPort: 80\n\nåˆ›å»ºdeployment\nåˆ›å»ºpc-deployment.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š\napiVersion: apps&#x2F;v1\nkind: Deployment      \nmetadata:\n  name: pc-deployment\n  namespace: dev\nspec: \n  replicas: 3\n  selector:\n    matchLabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n\n# åˆ›å»ºdeployment\n[root@k8s-master01 ~]# kubectl create -f pc-deployment.yaml --record&#x3D;true\ndeployment.apps&#x2F;pc-deployment created\n\n# æŸ¥çœ‹deployment\n# UP-TO-DATE æœ€æ–°ç‰ˆæœ¬çš„podçš„æ•°é‡\n# AVAILABLE  å½“å‰å¯ç”¨çš„podçš„æ•°é‡\n[root@k8s-master01 ~]# kubectl get deploy pc-deployment -n dev\nNAME            READY   UP-TO-DATE   AVAILABLE   AGE\npc-deployment   3&#x2F;3     3            3           15s\n\n# æŸ¥çœ‹rs\n# å‘ç°rsçš„åç§°æ˜¯åœ¨åŸæ¥deploymentçš„åå­—åé¢æ·»åŠ äº†ä¸€ä¸ª10ä½æ•°çš„éšæœºä¸²\n[root@k8s-master01 ~]# kubectl get rs -n dev\nNAME                       DESIRED   CURRENT   READY   AGE\npc-deployment-6696798b78   3         3         3       23s\n\n# æŸ¥çœ‹pod\n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                             READY   STATUS    RESTARTS   AGE\npc-deployment-6696798b78-d2c8n   1&#x2F;1     Running   0          107s\npc-deployment-6696798b78-smpvp   1&#x2F;1     Running   0          107s\npc-deployment-6696798b78-wvjd8   1&#x2F;1     Running   0          107s\n\næ‰©ç¼©å®¹\n# å˜æ›´å‰¯æœ¬æ•°é‡ä¸º5ä¸ª\n[root@k8s-master01 ~]# kubectl scale deploy pc-deployment --replicas&#x3D;5  -n dev\ndeployment.apps&#x2F;pc-deployment scaled\n\n# æŸ¥çœ‹deployment\n[root@k8s-master01 ~]# kubectl get deploy pc-deployment -n dev\nNAME            READY   UP-TO-DATE   AVAILABLE   AGE\npc-deployment   5&#x2F;5     5            5           2m\n\n# æŸ¥çœ‹pod\n[root@k8s-master01 ~]#  kubectl get pods -n dev\nNAME                             READY   STATUS    RESTARTS   AGE\npc-deployment-6696798b78-d2c8n   1&#x2F;1     Running   0          4m19s\npc-deployment-6696798b78-jxmdq   1&#x2F;1     Running   0          94s\npc-deployment-6696798b78-mktqv   1&#x2F;1     Running   0          93s\npc-deployment-6696798b78-smpvp   1&#x2F;1     Running   0          4m19s\npc-deployment-6696798b78-wvjd8   1&#x2F;1     Running   0          4m19s\n\n# ç¼–è¾‘deploymentçš„å‰¯æœ¬æ•°é‡ï¼Œä¿®æ”¹spec:replicas: 4å³å¯\n[root@k8s-master01 ~]# kubectl edit deploy pc-deployment -n dev\ndeployment.apps&#x2F;pc-deployment edited\n\n# æŸ¥çœ‹pod\n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                             READY   STATUS    RESTARTS   AGE\npc-deployment-6696798b78-d2c8n   1&#x2F;1     Running   0          5m23s\npc-deployment-6696798b78-jxmdq   1&#x2F;1     Running   0          2m38s\npc-deployment-6696798b78-smpvp   1&#x2F;1     Running   0          5m23s\npc-deployment-6696798b78-wvjd8   1&#x2F;1     Running   0          5m23s\n\né•œåƒæ›´æ–°\ndeploymentæ”¯æŒä¸¤ç§æ›´æ–°ç­–ç•¥:é‡å»ºæ›´æ–°å’Œæ»šåŠ¨æ›´æ–°,å¯ä»¥é€šè¿‡strategyæŒ‡å®šç­–ç•¥ç±»å‹,æ”¯æŒä¸¤ä¸ªå±æ€§:\nstrategyï¼šæŒ‡å®šæ–°çš„Podæ›¿æ¢æ—§çš„Podçš„ç­–ç•¥ï¼Œ æ”¯æŒä¸¤ä¸ªå±æ€§ï¼š\n  typeï¼šæŒ‡å®šç­–ç•¥ç±»å‹ï¼Œæ”¯æŒä¸¤ç§ç­–ç•¥\n    Recreateï¼šåœ¨åˆ›å»ºå‡ºæ–°çš„Podä¹‹å‰ä¼šå…ˆæ€æ‰æ‰€æœ‰å·²å­˜åœ¨çš„Pod\n    RollingUpdateï¼šæ»šåŠ¨æ›´æ–°ï¼Œå°±æ˜¯æ€æ­»ä¸€éƒ¨åˆ†ï¼Œå°±å¯åŠ¨ä¸€éƒ¨åˆ†ï¼Œåœ¨æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸¤ä¸ªç‰ˆæœ¬Pod\n  rollingUpdateï¼šå½“typeä¸ºRollingUpdateæ—¶ç”Ÿæ•ˆï¼Œç”¨äºä¸ºRollingUpdateè®¾ç½®å‚æ•°ï¼Œæ”¯æŒä¸¤ä¸ªå±æ€§ï¼š\n    maxUnavailableï¼šç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­ä¸å¯ç”¨Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%ã€‚\n    maxSurgeï¼š ç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­å¯ä»¥è¶…è¿‡æœŸæœ›çš„Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%ã€‚\n\né‡å»ºæ›´æ–°\n\nç¼–è¾‘pc-deployment.yaml,åœ¨specèŠ‚ç‚¹ä¸‹æ·»åŠ æ›´æ–°ç­–ç•¥\n\nspec:\n  strategy: # ç­–ç•¥\n    type: Recreate # é‡å»ºæ›´æ–°\n\n\nåˆ›å»ºdeployè¿›è¡ŒéªŒè¯\n\n# å˜æ›´é•œåƒ\n[root@k8s-master01 ~]# kubectl set image deployment pc-deployment nginx&#x3D;nginx:1.17.2 -n dev\ndeployment.apps&#x2F;pc-deployment image updated\n\n# è§‚å¯Ÿå‡çº§è¿‡ç¨‹\n[root@k8s-master01 ~]#  kubectl get pods -n dev -w\nNAME                             READY   STATUS    RESTARTS   AGE\npc-deployment-5d89bdfbf9-65qcw   1&#x2F;1     Running   0          31s\npc-deployment-5d89bdfbf9-w5nzv   1&#x2F;1     Running   0          31s\npc-deployment-5d89bdfbf9-xpt7w   1&#x2F;1     Running   0          31s\n\npc-deployment-5d89bdfbf9-xpt7w   1&#x2F;1     Terminating   0          41s\npc-deployment-5d89bdfbf9-65qcw   1&#x2F;1     Terminating   0          41s\npc-deployment-5d89bdfbf9-w5nzv   1&#x2F;1     Terminating   0          41s\n\npc-deployment-675d469f8b-grn8z   0&#x2F;1     Pending       0          0s\npc-deployment-675d469f8b-hbl4v   0&#x2F;1     Pending       0          0s\npc-deployment-675d469f8b-67nz2   0&#x2F;1     Pending       0          0s\n\npc-deployment-675d469f8b-grn8z   0&#x2F;1     ContainerCreating   0          0s\npc-deployment-675d469f8b-hbl4v   0&#x2F;1     ContainerCreating   0          0s\npc-deployment-675d469f8b-67nz2   0&#x2F;1     ContainerCreating   0          0s\n\npc-deployment-675d469f8b-grn8z   1&#x2F;1     Running             0          1s\npc-deployment-675d469f8b-67nz2   1&#x2F;1     Running             0          1s\npc-deployment-675d469f8b-hbl4v   1&#x2F;1     Running             0          2s\n\næ»šåŠ¨æ›´æ–°\n\nç¼–è¾‘pc-deployment.yaml,åœ¨specèŠ‚ç‚¹ä¸‹æ·»åŠ æ›´æ–°ç­–ç•¥\n\nspec:\n  strategy: # ç­–ç•¥\n    type: RollingUpdate # æ»šåŠ¨æ›´æ–°ç­–ç•¥\n    rollingUpdate:\n      maxSurge: 25% \n      maxUnavailable: 25%\n\n\nåˆ›å»ºdeployè¿›è¡ŒéªŒè¯\n\n# å˜æ›´é•œåƒ\n[root@k8s-master01 ~]# kubectl set image deployment pc-deployment nginx&#x3D;nginx:1.17.3 -n dev \ndeployment.apps&#x2F;pc-deployment image updated\n\n# è§‚å¯Ÿå‡çº§è¿‡ç¨‹\n[root@k8s-master01 ~]# kubectl get pods -n dev -w\nNAME                           READY   STATUS    RESTARTS   AGE\npc-deployment-c848d767-8rbzt   1&#x2F;1     Running   0          31m\npc-deployment-c848d767-h4p68   1&#x2F;1     Running   0          31m\npc-deployment-c848d767-hlmz4   1&#x2F;1     Running   0          31m\npc-deployment-c848d767-rrqcn   1&#x2F;1     Running   0          31m\n\npc-deployment-966bf7f44-226rx   0&#x2F;1     Pending             0          0s\npc-deployment-966bf7f44-226rx   0&#x2F;1     ContainerCreating   0          0s\npc-deployment-966bf7f44-226rx   1&#x2F;1     Running             0          1s\npc-deployment-c848d767-h4p68    0&#x2F;1     Terminating         0          34m\n\npc-deployment-966bf7f44-cnd44   0&#x2F;1     Pending             0          0s\npc-deployment-966bf7f44-cnd44   0&#x2F;1     ContainerCreating   0          0s\npc-deployment-966bf7f44-cnd44   1&#x2F;1     Running             0          2s\npc-deployment-c848d767-hlmz4    0&#x2F;1     Terminating         0          34m\n\npc-deployment-966bf7f44-px48p   0&#x2F;1     Pending             0          0s\npc-deployment-966bf7f44-px48p   0&#x2F;1     ContainerCreating   0          0s\npc-deployment-966bf7f44-px48p   1&#x2F;1     Running             0          0s\npc-deployment-c848d767-8rbzt    0&#x2F;1     Terminating         0          34m\n\npc-deployment-966bf7f44-dkmqp   0&#x2F;1     Pending             0          0s\npc-deployment-966bf7f44-dkmqp   0&#x2F;1     ContainerCreating   0          0s\npc-deployment-966bf7f44-dkmqp   1&#x2F;1     Running             0          2s\npc-deployment-c848d767-rrqcn    0&#x2F;1     Terminating         0          34m\n\n# è‡³æ­¤ï¼Œæ–°ç‰ˆæœ¬çš„podåˆ›å»ºå®Œæ¯•ï¼Œå°±ç‰ˆæœ¬çš„podé”€æ¯å®Œæ¯•\n# ä¸­é—´è¿‡ç¨‹æ˜¯æ»šåŠ¨è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¾¹é”€æ¯è¾¹åˆ›å»º\n\næ»šåŠ¨æ›´æ–°çš„è¿‡ç¨‹ï¼š\n\né•œåƒæ›´æ–°ä¸­rsçš„å˜åŒ–\n# æŸ¥çœ‹rs,å‘ç°åŸæ¥çš„rsçš„ä¾æ—§å­˜åœ¨ï¼Œåªæ˜¯podæ•°é‡å˜ä¸ºäº†0ï¼Œè€Œååˆæ–°äº§ç”Ÿäº†ä¸€ä¸ªrsï¼Œpodæ•°é‡ä¸º4\n# å…¶å®è¿™å°±æ˜¯deploymentèƒ½å¤Ÿè¿›è¡Œç‰ˆæœ¬å›é€€çš„å¥¥å¦™æ‰€åœ¨ï¼Œåé¢ä¼šè¯¦ç»†è§£é‡Š\n[root@k8s-master01 ~]# kubectl get rs -n dev\nNAME                       DESIRED   CURRENT   READY   AGE\npc-deployment-6696798b78   0         0         0       7m37s\npc-deployment-6696798b11   0         0         0       5m37s\npc-deployment-c848d76789   4         4         4       72s\n\nç‰ˆæœ¬å›é€€\ndeploymentæ”¯æŒç‰ˆæœ¬å‡çº§è¿‡ç¨‹ä¸­çš„æš‚åœã€ç»§ç»­åŠŸèƒ½ä»¥åŠç‰ˆæœ¬å›é€€ç­‰è¯¸å¤šåŠŸèƒ½ï¼Œä¸‹é¢å…·ä½“æ¥çœ‹.\nkubectl rolloutï¼š ç‰ˆæœ¬å‡çº§ç›¸å…³åŠŸèƒ½ï¼Œæ”¯æŒä¸‹é¢çš„é€‰é¡¹ï¼š\n\nstatus æ˜¾ç¤ºå½“å‰å‡çº§çŠ¶æ€\nhistory æ˜¾ç¤º å‡çº§å†å²è®°å½•\npause æš‚åœç‰ˆæœ¬å‡çº§è¿‡ç¨‹\nresume ç»§ç»­å·²ç»æš‚åœçš„ç‰ˆæœ¬å‡çº§è¿‡ç¨‹\nrestart é‡å¯ç‰ˆæœ¬å‡çº§è¿‡ç¨‹\nundo å›æ»šåˆ°ä¸Šä¸€çº§ç‰ˆæœ¬ï¼ˆå¯ä»¥ä½¿ç”¨â€“to-revisionå›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬ï¼‰\n\n# æŸ¥çœ‹å½“å‰å‡çº§ç‰ˆæœ¬çš„çŠ¶æ€\n[root@k8s-master01 ~]# kubectl rollout status deploy pc-deployment -n dev\ndeployment &quot;pc-deployment&quot; successfully rolled out\n\n# æŸ¥çœ‹å‡çº§å†å²è®°å½•\n[root@k8s-master01 ~]# kubectl rollout history deploy pc-deployment -n dev\ndeployment.apps&#x2F;pc-deployment\nREVISION  CHANGE-CAUSE\n1         kubectl create --filename&#x3D;pc-deployment.yaml --record&#x3D;true\n2         kubectl create --filename&#x3D;pc-deployment.yaml --record&#x3D;true\n3         kubectl create --filename&#x3D;pc-deployment.yaml --record&#x3D;true\n# å¯ä»¥å‘ç°æœ‰ä¸‰æ¬¡ç‰ˆæœ¬è®°å½•ï¼Œè¯´æ˜å®Œæˆè¿‡ä¸¤æ¬¡å‡çº§\n\n# ç‰ˆæœ¬å›æ»š\n# è¿™é‡Œç›´æ¥ä½¿ç”¨--to-revision&#x3D;1å›æ»šåˆ°äº†1ç‰ˆæœ¬ï¼Œ å¦‚æœçœç•¥è¿™ä¸ªé€‰é¡¹ï¼Œå°±æ˜¯å›é€€åˆ°ä¸Šä¸ªç‰ˆæœ¬ï¼Œå°±æ˜¯2ç‰ˆæœ¬\n[root@k8s-master01 ~]# kubectl rollout undo deployment pc-deployment --to-revision&#x3D;1 -n dev\ndeployment.apps&#x2F;pc-deployment rolled back\n\n# æŸ¥çœ‹å‘ç°ï¼Œé€šè¿‡nginxé•œåƒç‰ˆæœ¬å¯ä»¥å‘ç°åˆ°äº†ç¬¬ä¸€ç‰ˆ\n[root@k8s-master01 ~]# kubectl get deploy -n dev -o wide\nNAME            READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES         \npc-deployment   4&#x2F;4     4            4           74m   nginx        nginx:1.17.1   \n\n# æŸ¥çœ‹rsï¼Œå‘ç°ç¬¬ä¸€ä¸ªrsä¸­æœ‰4ä¸ªpodè¿è¡Œï¼Œåé¢ä¸¤ä¸ªç‰ˆæœ¬çš„rsä¸­podä¸ºè¿è¡Œ\n# å…¶å®deploymentä¹‹æ‰€ä»¥å¯æ˜¯å®ç°ç‰ˆæœ¬çš„å›æ»šï¼Œå°±æ˜¯é€šè¿‡è®°å½•ä¸‹å†å²rsæ¥å®ç°çš„ï¼Œ\n# ä¸€æ—¦æƒ³å›æ»šåˆ°å“ªä¸ªç‰ˆæœ¬ï¼Œåªéœ€è¦å°†å½“å‰ç‰ˆæœ¬podæ•°é‡é™ä¸º0ï¼Œç„¶åå°†å›æ»šç‰ˆæœ¬çš„podæå‡ä¸ºç›®æ ‡æ•°é‡å°±å¯ä»¥äº†\n[root@k8s-master01 ~]# kubectl get rs -n dev\nNAME                       DESIRED   CURRENT   READY   AGE\npc-deployment-6696798b78   4         4         4       78m\npc-deployment-966bf7f44    0         0         0       37m\npc-deployment-c848d767     0         0         0       71m\n\né‡‘ä¸é›€å‘å¸ƒ\nDeploymentæ§åˆ¶å™¨æ”¯æŒæ§åˆ¶æ›´æ–°è¿‡ç¨‹ä¸­çš„æ§åˆ¶ï¼Œå¦‚â€œæš‚åœ(pause)â€æˆ–â€œç»§ç»­(resume)â€æ›´æ–°æ“ä½œã€‚\næ¯”å¦‚æœ‰ä¸€æ‰¹æ–°çš„Podèµ„æºåˆ›å»ºå®Œæˆåç«‹å³æš‚åœæ›´æ–°è¿‡ç¨‹ï¼Œæ­¤æ—¶ï¼Œä»…å­˜åœ¨ä¸€éƒ¨åˆ†æ–°ç‰ˆæœ¬çš„åº”ç”¨ï¼Œä¸»ä½“éƒ¨åˆ†è¿˜æ˜¯æ—§çš„ç‰ˆæœ¬ã€‚ç„¶åï¼Œå†ç­›é€‰ä¸€å°éƒ¨åˆ†çš„ç”¨æˆ·è¯·æ±‚è·¯ç”±åˆ°æ–°ç‰ˆæœ¬çš„Podåº”ç”¨ï¼Œç»§ç»­è§‚å¯Ÿèƒ½å¦ç¨³å®šåœ°æŒ‰æœŸæœ›çš„æ–¹å¼è¿è¡Œã€‚ç¡®å®šæ²¡é—®é¢˜ä¹‹åå†ç»§ç»­å®Œæˆä½™ä¸‹çš„Podèµ„æºæ»šåŠ¨æ›´æ–°ï¼Œå¦åˆ™ç«‹å³å›æ»šæ›´æ–°æ“ä½œã€‚è¿™å°±æ˜¯æ‰€è°“çš„é‡‘ä¸é›€å‘å¸ƒã€‚\n# æ›´æ–°deploymentçš„ç‰ˆæœ¬ï¼Œå¹¶é…ç½®æš‚åœdeployment\n[root@k8s-master01 ~]#  kubectl set image deploy pc-deployment nginx&#x3D;nginx:1.17.4 -n dev &amp;&amp; kubectl rollout pause deployment pc-deployment  -n dev\ndeployment.apps&#x2F;pc-deployment image updated\ndeployment.apps&#x2F;pc-deployment paused\n\n#è§‚å¯Ÿæ›´æ–°çŠ¶æ€\n[root@k8s-master01 ~]# kubectl rollout status deploy pc-deployment -n devã€€\nWaiting for deployment &quot;pc-deployment&quot; rollout to finish: 2 out of 4 new replicas have been updated...\n\n# ç›‘æ§æ›´æ–°çš„è¿‡ç¨‹ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»æ–°å¢äº†ä¸€ä¸ªèµ„æºï¼Œä½†æ˜¯å¹¶æœªæŒ‰ç…§é¢„æœŸçš„çŠ¶æ€å»åˆ é™¤ä¸€ä¸ªæ—§çš„èµ„æºï¼Œå°±æ˜¯å› ä¸ºä½¿ç”¨äº†pauseæš‚åœå‘½ä»¤\n\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\nNAME                       DESIRED   CURRENT   READY   AGE     CONTAINERS   IMAGES         \npc-deployment-5d89bdfbf9   3         3         3       19m     nginx        nginx:1.17.1   \npc-deployment-675d469f8b   0         0         0       14m     nginx        nginx:1.17.2   \npc-deployment-6c9f56fcfb   2         2         2       3m16s   nginx        nginx:1.17.4   \n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                             READY   STATUS    RESTARTS   AGE\npc-deployment-5d89bdfbf9-rj8sq   1&#x2F;1     Running   0          7m33s\npc-deployment-5d89bdfbf9-ttwgg   1&#x2F;1     Running   0          7m35s\npc-deployment-5d89bdfbf9-v4wvc   1&#x2F;1     Running   0          7m34s\npc-deployment-6c9f56fcfb-996rt   1&#x2F;1     Running   0          3m31s\npc-deployment-6c9f56fcfb-j2gtj   1&#x2F;1     Running   0          3m31s\n\n# ç¡®ä¿æ›´æ–°çš„podæ²¡é—®é¢˜äº†ï¼Œç»§ç»­æ›´æ–°\n[root@k8s-master01 ~]# kubectl rollout resume deploy pc-deployment -n dev\ndeployment.apps&#x2F;pc-deployment resumed\n\n# æŸ¥çœ‹æœ€åçš„æ›´æ–°æƒ…å†µ\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\nNAME                       DESIRED   CURRENT   READY   AGE     CONTAINERS   IMAGES         \npc-deployment-5d89bdfbf9   0         0         0       21m     nginx        nginx:1.17.1   \npc-deployment-675d469f8b   0         0         0       16m     nginx        nginx:1.17.2   \npc-deployment-6c9f56fcfb   4         4         4       5m11s   nginx        nginx:1.17.4   \n\n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                             READY   STATUS    RESTARTS   AGE\npc-deployment-6c9f56fcfb-7bfwh   1&#x2F;1     Running   0          37s\npc-deployment-6c9f56fcfb-996rt   1&#x2F;1     Running   0          5m27s\npc-deployment-6c9f56fcfb-j2gtj   1&#x2F;1     Running   0          5m27s\npc-deployment-6c9f56fcfb-rf84v   1&#x2F;1     Running   0          37s\n\nåˆ é™¤Deployment\n# åˆ é™¤deploymentï¼Œå…¶ä¸‹çš„rså’Œpodä¹Ÿå°†è¢«åˆ é™¤\n[root@k8s-master01 ~]# kubectl delete -f pc-deployment.yaml\ndeployment.apps &quot;pc-deployment&quot; deleted\n\n6.4 Horizontal Pod Autoscaler(HPA)åœ¨å‰é¢çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å®ç°é€šè¿‡æ‰‹å·¥æ‰§è¡Œkubectl scaleå‘½ä»¤å®ç°Podæ‰©å®¹æˆ–ç¼©å®¹ï¼Œä½†æ˜¯è¿™æ˜¾ç„¶ä¸ç¬¦åˆKubernetesçš„å®šä½ç›®æ ‡â€“è‡ªåŠ¨åŒ–ã€æ™ºèƒ½åŒ–ã€‚ KubernetesæœŸæœ›å¯ä»¥å®ç°é€šè¿‡ç›‘æµ‹Podçš„ä½¿ç”¨æƒ…å†µï¼Œå®ç°podæ•°é‡çš„è‡ªåŠ¨è°ƒæ•´ï¼Œäºæ˜¯å°±äº§ç”Ÿäº†Horizontal Pod Autoscalerï¼ˆHPAï¼‰è¿™ç§æ§åˆ¶å™¨ã€‚\nHPAå¯ä»¥è·å–æ¯ä¸ªPodåˆ©ç”¨ç‡ï¼Œç„¶åå’ŒHPAä¸­å®šä¹‰çš„æŒ‡æ ‡è¿›è¡Œå¯¹æ¯”ï¼ŒåŒæ—¶è®¡ç®—å‡ºéœ€è¦ä¼¸ç¼©çš„å…·ä½“å€¼ï¼Œæœ€åå®ç°Podçš„æ•°é‡çš„è°ƒæ•´ã€‚å…¶å®HPAä¸ä¹‹å‰çš„Deploymentä¸€æ ·ï¼Œä¹Ÿå±äºä¸€ç§Kubernetesèµ„æºå¯¹è±¡ï¼Œå®ƒé€šè¿‡è¿½è¸ªåˆ†æRCæ§åˆ¶çš„æ‰€æœ‰ç›®æ ‡Podçš„è´Ÿè½½å˜åŒ–æƒ…å†µï¼Œæ¥ç¡®å®šæ˜¯å¦éœ€è¦é’ˆå¯¹æ€§åœ°è°ƒæ•´ç›®æ ‡Podçš„å‰¯æœ¬æ•°ï¼Œè¿™æ˜¯HPAçš„å®ç°åŸç†ã€‚\n\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥åšä¸€ä¸ªå®éªŒ\n1 å®‰è£…metrics-server\nmetrics-serverå¯ä»¥ç”¨æ¥æ”¶é›†é›†ç¾¤ä¸­çš„èµ„æºä½¿ç”¨æƒ…å†µ\n# å®‰è£…git\n[root@k8s-master01 ~]# yum install git -y\n# è·å–metrics-server, æ³¨æ„ä½¿ç”¨çš„ç‰ˆæœ¬\n[root@k8s-master01 ~]# git clone -b v0.3.6 https:&#x2F;&#x2F;github.com&#x2F;kubernetes-incubator&#x2F;metrics-server\n# ä¿®æ”¹deployment, æ³¨æ„ä¿®æ”¹çš„æ˜¯é•œåƒå’Œåˆå§‹åŒ–å‚æ•°\n[root@k8s-master01 ~]# cd &#x2F;root&#x2F;metrics-server&#x2F;deploy&#x2F;1.8+&#x2F;\n[root@k8s-master01 1.8+]# vim metrics-server-deployment.yaml\næŒ‰å›¾ä¸­æ·»åŠ ä¸‹é¢é€‰é¡¹\nhostNetwork: true\nimage: registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers&#x2F;metrics-server-amd64:v0.3.6\nargs:\n- --kubelet-insecure-tls\n- --kubelet-preferred-address-types&#x3D;InternalIP,Hostname,InternalDNS,ExternalDNS,ExternalIP\n\n\n# å®‰è£…metrics-server\n[root@k8s-master01 1.8+]# kubectl apply -f .&#x2F;\n\n# æŸ¥çœ‹podè¿è¡Œæƒ…å†µ\n[root@k8s-master01 1.8+]# kubectl get pod -n kube-system\nmetrics-server-6b976979db-2xwbj   1&#x2F;1     Running   0          90s\n\n# ä½¿ç”¨kubectl top node æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ\n[root@k8s-master01 1.8+]# kubectl top node\nNAME           CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%\nk8s-master01   289m         14%    1582Mi          54%       \nk8s-node01     81m          4%     1195Mi          40%       \nk8s-node02     72m          3%     1211Mi          41%  \n[root@k8s-master01 1.8+]# kubectl top pod -n kube-system\nNAME                              CPU(cores)   MEMORY(bytes)\ncoredns-6955765f44-7ptsb          3m           9Mi\ncoredns-6955765f44-vcwr5          3m           8Mi\netcd-master                       14m          145Mi\n...\n# è‡³æ­¤,metrics-serverå®‰è£…å®Œæˆ\n\n2 å‡†å¤‡deploymentå’Œservie\nåˆ›å»ºpc-hpa-pod.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\napiVersion: apps&#x2F;v1\nkind: Deployment\nmetadata:\n  name: nginx\n  namespace: dev\nspec:\n  strategy: # ç­–ç•¥\n    type: RollingUpdate # æ»šåŠ¨æ›´æ–°ç­–ç•¥\n  replicas: 1\n  selector:\n    matchLabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        resources: # èµ„æºé…é¢\n          limits:  # é™åˆ¶èµ„æºï¼ˆä¸Šé™ï¼‰\n            cpu: &quot;1&quot; # CPUé™åˆ¶ï¼Œå•ä½æ˜¯coreæ•°\n          requests: # è¯·æ±‚èµ„æºï¼ˆä¸‹é™ï¼‰\n            cpu: &quot;100m&quot;  # CPUé™åˆ¶ï¼Œå•ä½æ˜¯coreæ•°\n\n# åˆ›å»ºservice\n[root@k8s-master01 1.8+]# kubectl expose deployment nginx --type&#x3D;NodePort --port&#x3D;80 -n dev\n\n# æŸ¥çœ‹\n[root@k8s-master01 1.8+]# kubectl get deployment,pod,svc -n dev\nNAME                    READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps&#x2F;nginx   1&#x2F;1     1            1           47s\n\nNAME                         READY   STATUS    RESTARTS   AGE\npod&#x2F;nginx-7df9756ccc-bh8dr   1&#x2F;1     Running   0          47s\n\nNAME            TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE\nservice&#x2F;nginx   NodePort   10.101.18.29   &lt;none&gt;        80:31830&#x2F;TCP   35s\n\n3 éƒ¨ç½²HPA\nåˆ›å»ºpc-hpa.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\napiVersion: autoscaling&#x2F;v1\nkind: HorizontalPodAutoscaler\nmetadata:\n  name: pc-hpa\n  namespace: dev\nspec:\n  minReplicas: 1  #æœ€å°podæ•°é‡\n  maxReplicas: 10 #æœ€å¤§podæ•°é‡\n  targetCPUUtilizationPercentage: 3 # CPUä½¿ç”¨ç‡æŒ‡æ ‡\n  scaleTargetRef:   # æŒ‡å®šè¦æ§åˆ¶çš„nginxä¿¡æ¯\n    apiVersion: apps&#x2F;v1\n    kind: Deployment\n    name: nginx\n\n# åˆ›å»ºhpa\n[root@k8s-master01 1.8+]# kubectl create -f pc-hpa.yaml\nhorizontalpodautoscaler.autoscaling&#x2F;pc-hpa created\n\n# æŸ¥çœ‹hpa\n    [root@k8s-master01 1.8+]# kubectl get hpa -n dev\nNAME     REFERENCE          TARGETS   MINPODS   MAXPODS   REPLICAS   AGE\npc-hpa   Deployment&#x2F;nginx   0%&#x2F;3%     1         10        1          62s\n\n4 æµ‹è¯•\nä½¿ç”¨å‹æµ‹å·¥å…·å¯¹serviceåœ°å€192.168.5.4:31830è¿›è¡Œå‹æµ‹ï¼Œç„¶åé€šè¿‡æ§åˆ¶å°æŸ¥çœ‹hpaå’Œpodçš„å˜åŒ–\nhpaå˜åŒ–\n[root@k8s-master01 ~]# kubectl get hpa -n dev -w\nNAME   REFERENCE      TARGETS  MINPODS  MAXPODS  REPLICAS  AGE\npc-hpa  Deployment&#x2F;nginx  0%&#x2F;3%   1     10     1      4m11s\npc-hpa  Deployment&#x2F;nginx  0%&#x2F;3%   1     10     1      5m19s\npc-hpa  Deployment&#x2F;nginx  22%&#x2F;3%   1     10     1      6m50s\npc-hpa  Deployment&#x2F;nginx  22%&#x2F;3%   1     10     4      7m5s\npc-hpa  Deployment&#x2F;nginx  22%&#x2F;3%   1     10     8      7m21s\npc-hpa  Deployment&#x2F;nginx  6%&#x2F;3%   1     10     8      7m51s\npc-hpa  Deployment&#x2F;nginx  0%&#x2F;3%   1     10     8      9m6s\npc-hpa  Deployment&#x2F;nginx  0%&#x2F;3%   1     10     8      13m\npc-hpa  Deployment&#x2F;nginx  0%&#x2F;3%   1     10     1      14m\n\ndeploymentå˜åŒ–\n[root@k8s-master01 ~]# kubectl get deployment -n dev -w\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\nnginx   1&#x2F;1     1            1           11m\nnginx   1&#x2F;4     1            1           13m\nnginx   1&#x2F;4     1            1           13m\nnginx   1&#x2F;4     1            1           13m\nnginx   1&#x2F;4     4            1           13m\nnginx   1&#x2F;8     4            1           14m\nnginx   1&#x2F;8     4            1           14m\nnginx   1&#x2F;8     4            1           14m\nnginx   1&#x2F;8     8            1           14m\nnginx   2&#x2F;8     8            2           14m\nnginx   3&#x2F;8     8            3           14m\nnginx   4&#x2F;8     8            4           14m\nnginx   5&#x2F;8     8            5           14m\nnginx   6&#x2F;8     8            6           14m\nnginx   7&#x2F;8     8            7           14m\nnginx   8&#x2F;8     8            8           15m\nnginx   8&#x2F;1     8            8           20m\nnginx   8&#x2F;1     8            8           20m\nnginx   1&#x2F;1     1            1           20m\n\npodå˜åŒ–\n[root@k8s-master01 ~]# kubectl get pods -n dev -w\nNAME                     READY   STATUS    RESTARTS   AGE\nnginx-7df9756ccc-bh8dr   1&#x2F;1     Running   0          11m\nnginx-7df9756ccc-cpgrv   0&#x2F;1     Pending   0          0s\nnginx-7df9756ccc-8zhwk   0&#x2F;1     Pending   0          0s\nnginx-7df9756ccc-rr9bn   0&#x2F;1     Pending   0          0s\nnginx-7df9756ccc-cpgrv   0&#x2F;1     ContainerCreating   0          0s\nnginx-7df9756ccc-8zhwk   0&#x2F;1     ContainerCreating   0          0s\nnginx-7df9756ccc-rr9bn   0&#x2F;1     ContainerCreating   0          0s\nnginx-7df9756ccc-m9gsj   0&#x2F;1     Pending             0          0s\nnginx-7df9756ccc-g56qb   0&#x2F;1     Pending             0          0s\nnginx-7df9756ccc-sl9c6   0&#x2F;1     Pending             0          0s\nnginx-7df9756ccc-fgst7   0&#x2F;1     Pending             0          0s\nnginx-7df9756ccc-g56qb   0&#x2F;1     ContainerCreating   0          0s\nnginx-7df9756ccc-m9gsj   0&#x2F;1     ContainerCreating   0          0s\nnginx-7df9756ccc-sl9c6   0&#x2F;1     ContainerCreating   0          0s\nnginx-7df9756ccc-fgst7   0&#x2F;1     ContainerCreating   0          0s\nnginx-7df9756ccc-8zhwk   1&#x2F;1     Running             0          19s\nnginx-7df9756ccc-rr9bn   1&#x2F;1     Running             0          30s\nnginx-7df9756ccc-m9gsj   1&#x2F;1     Running             0          21s\nnginx-7df9756ccc-cpgrv   1&#x2F;1     Running             0          47s\nnginx-7df9756ccc-sl9c6   1&#x2F;1     Running             0          33s\nnginx-7df9756ccc-g56qb   1&#x2F;1     Running             0          48s\nnginx-7df9756ccc-fgst7   1&#x2F;1     Running             0          66s\nnginx-7df9756ccc-fgst7   1&#x2F;1     Terminating         0          6m50s\nnginx-7df9756ccc-8zhwk   1&#x2F;1     Terminating         0          7m5s\nnginx-7df9756ccc-cpgrv   1&#x2F;1     Terminating         0          7m5s\nnginx-7df9756ccc-g56qb   1&#x2F;1     Terminating         0          6m50s\nnginx-7df9756ccc-rr9bn   1&#x2F;1     Terminating         0          7m5s\nnginx-7df9756ccc-m9gsj   1&#x2F;1     Terminating         0          6m50s\nnginx-7df9756ccc-sl9c6   1&#x2F;1     Terminating         0          6m50s\n\n6.5 DaemonSet(DS)DaemonSetç±»å‹çš„æ§åˆ¶å™¨å¯ä»¥ä¿è¯åœ¨é›†ç¾¤ä¸­çš„æ¯ä¸€å°ï¼ˆæˆ–æŒ‡å®šï¼‰èŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œä¸€ä¸ªå‰¯æœ¬ã€‚ä¸€èˆ¬é€‚ç”¨äºæ—¥å¿—æ”¶é›†ã€èŠ‚ç‚¹ç›‘æ§ç­‰åœºæ™¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªPodæä¾›çš„åŠŸèƒ½æ˜¯èŠ‚ç‚¹çº§åˆ«çš„ï¼ˆæ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦ä¸”åªéœ€è¦ä¸€ä¸ªï¼‰ï¼Œé‚£ä¹ˆè¿™ç±»Podå°±é€‚åˆä½¿ç”¨DaemonSetç±»å‹çš„æ§åˆ¶å™¨åˆ›å»ºã€‚\n\nDaemonSetæ§åˆ¶å™¨çš„ç‰¹ç‚¹ï¼š\n\næ¯å½“å‘é›†ç¾¤ä¸­æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼ŒæŒ‡å®šçš„ Pod å‰¯æœ¬ä¹Ÿå°†æ·»åŠ åˆ°è¯¥èŠ‚ç‚¹ä¸Š\nå½“èŠ‚ç‚¹ä»é›†ç¾¤ä¸­ç§»é™¤æ—¶ï¼ŒPod ä¹Ÿå°±è¢«åƒåœ¾å›æ”¶äº†\n\nä¸‹é¢å…ˆæ¥çœ‹ä¸‹DaemonSetçš„èµ„æºæ¸…å•æ–‡ä»¶\napiVersion: apps&#x2F;v1 # ç‰ˆæœ¬å·\nkind: DaemonSet # ç±»å‹       \nmetadata: # å…ƒæ•°æ®\n  name: # rsåç§° \n  namespace: # æ‰€å±å‘½åç©ºé—´ \n  labels: #æ ‡ç­¾\n    controller: daemonset\nspec: # è¯¦æƒ…æè¿°\n  revisionHistoryLimit: 3 # ä¿ç•™å†å²ç‰ˆæœ¬\n  updateStrategy: # æ›´æ–°ç­–ç•¥\n    type: RollingUpdate # æ»šåŠ¨æ›´æ–°ç­–ç•¥\n    rollingUpdate: # æ»šåŠ¨æ›´æ–°\n      maxUnavailable: 1 # æœ€å¤§ä¸å¯ç”¨çŠ¶æ€çš„ Pod çš„æœ€å¤§å€¼ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•°\n  selector: # é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod\n    matchLabels:      # LabelsåŒ¹é…è§„åˆ™\n      app: nginx-pod\n    matchExpressions: # ExpressionsåŒ¹é…è§„åˆ™\n      - &#123;key: app, operator: In, values: [nginx-pod]&#125;\n  template: # æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerPort: 80\n\nåˆ›å»ºpc-daemonset.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š\napiVersion: apps&#x2F;v1\nkind: DaemonSet      \nmetadata:\n  name: pc-daemonset\n  namespace: dev\nspec: \n  selector:\n    matchLabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n\n# åˆ›å»ºdaemonset\n[root@k8s-master01 ~]# kubectl create -f  pc-daemonset.yaml\ndaemonset.apps&#x2F;pc-daemonset created\n\n# æŸ¥çœ‹daemonset\n[root@k8s-master01 ~]#  kubectl get ds -n dev -o wide\nNAME        DESIRED  CURRENT  READY  UP-TO-DATE  AVAILABLE   AGE   CONTAINERS   IMAGES         \npc-daemonset   2        2        2      2           2        24s   nginx        nginx:1.17.1   \n\n# æŸ¥çœ‹pod,å‘ç°åœ¨æ¯ä¸ªNodeä¸Šéƒ½è¿è¡Œä¸€ä¸ªpod\n[root@k8s-master01 ~]#  kubectl get pods -n dev -o wide\nNAME                 READY   STATUS    RESTARTS   AGE   IP            NODE    \npc-daemonset-9bck8   1&#x2F;1     Running   0          37s   10.244.1.43   node1     \npc-daemonset-k224w   1&#x2F;1     Running   0          37s   10.244.2.74   node2      \n\n# åˆ é™¤daemonset\n[root@k8s-master01 ~]# kubectl delete -f pc-daemonset.yaml\ndaemonset.apps &quot;pc-daemonset&quot; deleted\n\n6.6 JobJobï¼Œä¸»è¦ç”¨äºè´Ÿè´£**æ‰¹é‡å¤„ç†(ä¸€æ¬¡è¦å¤„ç†æŒ‡å®šæ•°é‡ä»»åŠ¡)çŸ­æš‚çš„ä¸€æ¬¡æ€§(æ¯ä¸ªä»»åŠ¡ä»…è¿è¡Œä¸€æ¬¡å°±ç»“æŸ)**ä»»åŠ¡ã€‚Jobç‰¹ç‚¹å¦‚ä¸‹ï¼š\n\nå½“Jobåˆ›å»ºçš„podæ‰§è¡ŒæˆåŠŸç»“æŸæ—¶ï¼ŒJobå°†è®°å½•æˆåŠŸç»“æŸçš„podæ•°é‡\nå½“æˆåŠŸç»“æŸçš„podè¾¾åˆ°æŒ‡å®šçš„æ•°é‡æ—¶ï¼ŒJobå°†å®Œæˆæ‰§è¡Œ\n\n\nJobçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š\napiVersion: batch&#x2F;v1 # ç‰ˆæœ¬å·\nkind: Job # ç±»å‹       \nmetadata: # å…ƒæ•°æ®\n  name: # rsåç§° \n  namespace: # æ‰€å±å‘½åç©ºé—´ \n  labels: #æ ‡ç­¾\n    controller: job\nspec: # è¯¦æƒ…æè¿°\n  completions: 1 # æŒ‡å®šjobéœ€è¦æˆåŠŸè¿è¡ŒPodsçš„æ¬¡æ•°ã€‚é»˜è®¤å€¼: 1\n  parallelism: 1 # æŒ‡å®šjobåœ¨ä»»ä¸€æ—¶åˆ»åº”è¯¥å¹¶å‘è¿è¡ŒPodsçš„æ•°é‡ã€‚é»˜è®¤å€¼: 1\n  activeDeadlineSeconds: 30 # æŒ‡å®šjobå¯è¿è¡Œçš„æ—¶é—´æœŸé™ï¼Œè¶…è¿‡æ—¶é—´è¿˜æœªç»“æŸï¼Œç³»ç»Ÿå°†ä¼šå°è¯•è¿›è¡Œç»ˆæ­¢ã€‚\n  backoffLimit: 6 # æŒ‡å®šjobå¤±è´¥åè¿›è¡Œé‡è¯•çš„æ¬¡æ•°ã€‚é»˜è®¤æ˜¯6\n  manualSelector: true # æ˜¯å¦å¯ä»¥ä½¿ç”¨selectoré€‰æ‹©å™¨é€‰æ‹©podï¼Œé»˜è®¤æ˜¯false\n  selector: # é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod\n    matchLabels:      # LabelsåŒ¹é…è§„åˆ™\n      app: counter-pod\n    matchExpressions: # ExpressionsåŒ¹é…è§„åˆ™\n      - &#123;key: app, operator: In, values: [counter-pod]&#125;\n  template: # æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬\n    metadata:\n      labels:\n        app: counter-pod\n    spec:\n      restartPolicy: Never # é‡å¯ç­–ç•¥åªèƒ½è®¾ç½®ä¸ºNeveræˆ–è€…OnFailure\n      containers:\n      - name: counter\n        image: busybox:1.30\n        command: [&quot;bin&#x2F;sh&quot;,&quot;-c&quot;,&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 2;done&quot;]\n\nå…³äºé‡å¯ç­–ç•¥è®¾ç½®çš„è¯´æ˜ï¼š\n    å¦‚æœæŒ‡å®šä¸ºOnFailureï¼Œåˆ™jobä¼šåœ¨podå‡ºç°æ•…éšœæ—¶é‡å¯å®¹å™¨ï¼Œè€Œä¸æ˜¯åˆ›å»ºpodï¼Œfailedæ¬¡æ•°ä¸å˜\n    å¦‚æœæŒ‡å®šä¸ºNeverï¼Œåˆ™jobä¼šåœ¨podå‡ºç°æ•…éšœæ—¶åˆ›å»ºæ–°çš„podï¼Œå¹¶ä¸”æ•…éšœpodä¸ä¼šæ¶ˆå¤±ï¼Œä¹Ÿä¸ä¼šé‡å¯ï¼Œfailedæ¬¡æ•°åŠ 1\n    å¦‚æœæŒ‡å®šä¸ºAlwaysçš„è¯ï¼Œå°±æ„å‘³ç€ä¸€ç›´é‡å¯ï¼Œæ„å‘³ç€jobä»»åŠ¡ä¼šé‡å¤å»æ‰§è¡Œäº†ï¼Œå½“ç„¶ä¸å¯¹ï¼Œæ‰€ä»¥ä¸èƒ½è®¾ç½®ä¸ºAlways\n\nåˆ›å»ºpc-job.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š\napiVersion: batch&#x2F;v1\nkind: Job      \nmetadata:\n  name: pc-job\n  namespace: dev\nspec:\n  manualSelector: true\n  selector:\n    matchLabels:\n      app: counter-pod\n  template:\n    metadata:\n      labels:\n        app: counter-pod\n    spec:\n      restartPolicy: Never\n      containers:\n      - name: counter\n        image: busybox:1.30\n        command: [&quot;bin&#x2F;sh&quot;,&quot;-c&quot;,&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done&quot;]\n\n# åˆ›å»ºjob\n[root@k8s-master01 ~]# kubectl create -f pc-job.yaml\njob.batch&#x2F;pc-job created\n\n# æŸ¥çœ‹job\n[root@k8s-master01 ~]# kubectl get job -n dev -o wide  -w\nNAME     COMPLETIONS   DURATION   AGE   CONTAINERS   IMAGES         SELECTOR\npc-job   0&#x2F;1           21s        21s   counter      busybox:1.30   app&#x3D;counter-pod\npc-job   1&#x2F;1           31s        79s   counter      busybox:1.30   app&#x3D;counter-pod\n\n# é€šè¿‡è§‚å¯ŸpodçŠ¶æ€å¯ä»¥çœ‹åˆ°ï¼Œpodåœ¨è¿è¡Œå®Œæ¯•ä»»åŠ¡åï¼Œå°±ä¼šå˜æˆCompletedçŠ¶æ€\n[root@k8s-master01 ~]# kubectl get pods -n dev -w\nNAME           READY   STATUS     RESTARTS      AGE\npc-job-rxg96   1&#x2F;1     Running     0            29s\npc-job-rxg96   0&#x2F;1     Completed   0            33s\n\n# æ¥ä¸‹æ¥ï¼Œè°ƒæ•´ä¸‹podè¿è¡Œçš„æ€»æ•°é‡å’Œå¹¶è¡Œæ•°é‡ å³ï¼šåœ¨specä¸‹è®¾ç½®ä¸‹é¢ä¸¤ä¸ªé€‰é¡¹\n#  completions: 6 # æŒ‡å®šjobéœ€è¦æˆåŠŸè¿è¡ŒPodsçš„æ¬¡æ•°ä¸º6\n#  parallelism: 3 # æŒ‡å®šjobå¹¶å‘è¿è¡ŒPodsçš„æ•°é‡ä¸º3\n#  ç„¶åé‡æ–°è¿è¡Œjobï¼Œè§‚å¯Ÿæ•ˆæœï¼Œæ­¤æ—¶ä¼šå‘ç°ï¼Œjobä¼šæ¯æ¬¡è¿è¡Œ3ä¸ªpodï¼Œæ€»å…±æ‰§è¡Œäº†6ä¸ªpod\n[root@k8s-master01 ~]# kubectl get pods -n dev -w\nNAME           READY   STATUS    RESTARTS   AGE\npc-job-684ft   1&#x2F;1     Running   0          5s\npc-job-jhj49   1&#x2F;1     Running   0          5s\npc-job-pfcvh   1&#x2F;1     Running   0          5s\npc-job-684ft   0&#x2F;1     Completed   0          11s\npc-job-v7rhr   0&#x2F;1     Pending     0          0s\npc-job-v7rhr   0&#x2F;1     Pending     0          0s\npc-job-v7rhr   0&#x2F;1     ContainerCreating   0          0s\npc-job-jhj49   0&#x2F;1     Completed           0          11s\npc-job-fhwf7   0&#x2F;1     Pending             0          0s\npc-job-fhwf7   0&#x2F;1     Pending             0          0s\npc-job-pfcvh   0&#x2F;1     Completed           0          11s\npc-job-5vg2j   0&#x2F;1     Pending             0          0s\npc-job-fhwf7   0&#x2F;1     ContainerCreating   0          0s\npc-job-5vg2j   0&#x2F;1     Pending             0          0s\npc-job-5vg2j   0&#x2F;1     ContainerCreating   0          0s\npc-job-fhwf7   1&#x2F;1     Running             0          2s\npc-job-v7rhr   1&#x2F;1     Running             0          2s\npc-job-5vg2j   1&#x2F;1     Running             0          3s\npc-job-fhwf7   0&#x2F;1     Completed           0          12s\npc-job-v7rhr   0&#x2F;1     Completed           0          12s\npc-job-5vg2j   0&#x2F;1     Completed           0          12s\n\n# åˆ é™¤job\n[root@k8s-master01 ~]# kubectl delete -f pc-job.yaml\njob.batch &quot;pc-job&quot; deleted\n\n6.7 CronJob(CJ)CronJobæ§åˆ¶å™¨ä»¥Jobæ§åˆ¶å™¨èµ„æºä¸ºå…¶ç®¡æ§å¯¹è±¡ï¼Œå¹¶å€ŸåŠ©å®ƒç®¡ç†podèµ„æºå¯¹è±¡ï¼ŒJobæ§åˆ¶å™¨å®šä¹‰çš„ä½œä¸šä»»åŠ¡åœ¨å…¶æ§åˆ¶å™¨èµ„æºåˆ›å»ºä¹‹åä¾¿ä¼šç«‹å³æ‰§è¡Œï¼Œä½†CronJobå¯ä»¥ä»¥ç±»ä¼¼äºLinuxæ“ä½œç³»ç»Ÿçš„å‘¨æœŸæ€§ä»»åŠ¡ä½œä¸šè®¡åˆ’çš„æ–¹å¼æ§åˆ¶å…¶è¿è¡Œæ—¶é—´ç‚¹åŠé‡å¤è¿è¡Œçš„æ–¹å¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒCronJobå¯ä»¥åœ¨ç‰¹å®šçš„æ—¶é—´ç‚¹(åå¤çš„)å»è¿è¡Œjobä»»åŠ¡ã€‚\n\nCronJobçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š\napiVersion: batch&#x2F;v1beta1 # ç‰ˆæœ¬å·\nkind: CronJob # ç±»å‹       \nmetadata: # å…ƒæ•°æ®\n  name: # rsåç§° \n  namespace: # æ‰€å±å‘½åç©ºé—´ \n  labels: #æ ‡ç­¾\n    controller: cronjob\nspec: # è¯¦æƒ…æè¿°\n  schedule: # cronæ ¼å¼çš„ä½œä¸šè°ƒåº¦è¿è¡Œæ—¶é—´ç‚¹,ç”¨äºæ§åˆ¶ä»»åŠ¡åœ¨ä»€ä¹ˆæ—¶é—´æ‰§è¡Œ\n  concurrencyPolicy: # å¹¶å‘æ‰§è¡Œç­–ç•¥ï¼Œç”¨äºå®šä¹‰å‰ä¸€æ¬¡ä½œä¸šè¿è¡Œå°šæœªå®Œæˆæ—¶æ˜¯å¦ä»¥åŠå¦‚ä½•è¿è¡Œåä¸€æ¬¡çš„ä½œä¸š\n  failedJobHistoryLimit: # ä¸ºå¤±è´¥çš„ä»»åŠ¡æ‰§è¡Œä¿ç•™çš„å†å²è®°å½•æ•°ï¼Œé»˜è®¤ä¸º1\n  successfulJobHistoryLimit: # ä¸ºæˆåŠŸçš„ä»»åŠ¡æ‰§è¡Œä¿ç•™çš„å†å²è®°å½•æ•°ï¼Œé»˜è®¤ä¸º3\n  startingDeadlineSeconds: # å¯åŠ¨ä½œä¸šé”™è¯¯çš„è¶…æ—¶æ—¶é•¿\n  jobTemplate: # jobæ§åˆ¶å™¨æ¨¡æ¿ï¼Œç”¨äºä¸ºcronjobæ§åˆ¶å™¨ç”Ÿæˆjobå¯¹è±¡;ä¸‹é¢å…¶å®å°±æ˜¯jobçš„å®šä¹‰\n    metadata:\n    spec:\n      completions: 1\n      parallelism: 1\n      activeDeadlineSeconds: 30\n      backoffLimit: 6\n      manualSelector: true\n      selector:\n        matchLabels:\n          app: counter-pod\n        matchExpressions: è§„åˆ™\n          - &#123;key: app, operator: In, values: [counter-pod]&#125;\n      template:\n        metadata:\n          labels:\n            app: counter-pod\n        spec:\n          restartPolicy: Never \n          containers:\n          - name: counter\n            image: busybox:1.30\n            command: [&quot;bin&#x2F;sh&quot;,&quot;-c&quot;,&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 20;done&quot;]\n\néœ€è¦é‡ç‚¹è§£é‡Šçš„å‡ ä¸ªé€‰é¡¹ï¼š\nschedule: cronè¡¨è¾¾å¼ï¼Œç”¨äºæŒ‡å®šä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´\n    *&#x2F;1    *      *    *     *\n    &lt;åˆ†é’Ÿ&gt; &lt;å°æ—¶&gt; &lt;æ—¥&gt; &lt;æœˆä»½&gt; &lt;æ˜ŸæœŸ&gt;\n\n    åˆ†é’Ÿ å€¼ä» 0 åˆ° 59.\n    å°æ—¶ å€¼ä» 0 åˆ° 23.\n    æ—¥ å€¼ä» 1 åˆ° 31.\n    æœˆ å€¼ä» 1 åˆ° 12.\n    æ˜ŸæœŸ å€¼ä» 0 åˆ° 6, 0 ä»£è¡¨æ˜ŸæœŸæ—¥\n    å¤šä¸ªæ—¶é—´å¯ä»¥ç”¨é€—å·éš”å¼€ï¼› èŒƒå›´å¯ä»¥ç”¨è¿å­—ç¬¦ç»™å‡ºï¼›*å¯ä»¥ä½œä¸ºé€šé…ç¬¦ï¼› &#x2F;è¡¨ç¤ºæ¯...\nconcurrencyPolicy:\n    Allow:   å…è®¸Jobså¹¶å‘è¿è¡Œ(é»˜è®¤)\n    Forbid:  ç¦æ­¢å¹¶å‘è¿è¡Œï¼Œå¦‚æœä¸Šä¸€æ¬¡è¿è¡Œå°šæœªå®Œæˆï¼Œåˆ™è·³è¿‡ä¸‹ä¸€æ¬¡è¿è¡Œ\n    Replace: æ›¿æ¢ï¼Œå–æ¶ˆå½“å‰æ­£åœ¨è¿è¡Œçš„ä½œä¸šå¹¶ç”¨æ–°ä½œä¸šæ›¿æ¢å®ƒ\n\nåˆ›å»ºpc-cronjob.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š\napiVersion: batch&#x2F;v1beta1\nkind: CronJob\nmetadata:\n  name: pc-cronjob\n  namespace: dev\n  labels:\n    controller: cronjob\nspec:\n  schedule: &quot;*&#x2F;1 * * * *&quot;\n  jobTemplate:\n    metadata:\n    spec:\n      template:\n        spec:\n          restartPolicy: Never\n          containers:\n          - name: counter\n            image: busybox:1.30\n            command: [&quot;bin&#x2F;sh&quot;,&quot;-c&quot;,&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done&quot;]\n\n# åˆ›å»ºcronjob\n[root@k8s-master01 ~]# kubectl create -f pc-cronjob.yaml\ncronjob.batch&#x2F;pc-cronjob created\n\n# æŸ¥çœ‹cronjob\n[root@k8s-master01 ~]# kubectl get cronjobs -n dev\nNAME         SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGE\npc-cronjob   *&#x2F;1 * * * *   False     0        &lt;none&gt;          6s\n\n# æŸ¥çœ‹job\n[root@k8s-master01 ~]# kubectl get jobs -n dev\nNAME                    COMPLETIONS   DURATION   AGE\npc-cronjob-1592587800   1&#x2F;1           28s        3m26s\npc-cronjob-1592587860   1&#x2F;1           28s        2m26s\npc-cronjob-1592587920   1&#x2F;1           28s        86s\n\n# æŸ¥çœ‹pod\n[root@k8s-master01 ~]# kubectl get pods -n dev\npc-cronjob-1592587800-x4tsm   0&#x2F;1     Completed   0          2m24s\npc-cronjob-1592587860-r5gv4   0&#x2F;1     Completed   0          84s\npc-cronjob-1592587920-9dxxq   1&#x2F;1     Running     0          24s\n\n\n# åˆ é™¤cronjob\n[root@k8s-master01 ~]# kubectl  delete -f pc-cronjob.yaml\ncronjob.batch &quot;pc-cronjob&quot; deleted\n\n7. Serviceè¯¦è§£7.1 Serviceä»‹ç»åœ¨kubernetesä¸­ï¼Œpodæ˜¯åº”ç”¨ç¨‹åºçš„è½½ä½“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡podçš„ipæ¥è®¿é—®åº”ç”¨ç¨‹åºï¼Œä½†æ˜¯podçš„ipåœ°å€ä¸æ˜¯å›ºå®šçš„ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ä¸æ–¹ä¾¿ç›´æ¥é‡‡ç”¨podçš„ipå¯¹æœåŠ¡è¿›è¡Œè®¿é—®ã€‚\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œkubernetesæä¾›äº†Serviceèµ„æºï¼ŒServiceä¼šå¯¹æä¾›åŒä¸€ä¸ªæœåŠ¡çš„å¤šä¸ªpodè¿›è¡Œèšåˆï¼Œå¹¶ä¸”æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£åœ°å€ã€‚é€šè¿‡è®¿é—®Serviceçš„å…¥å£åœ°å€å°±èƒ½è®¿é—®åˆ°åé¢çš„podæœåŠ¡ã€‚\n\nServiceåœ¨å¾ˆå¤šæƒ…å†µä¸‹åªæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼ŒçœŸæ­£èµ·ä½œç”¨çš„å…¶å®æ˜¯kube-proxyæœåŠ¡è¿›ç¨‹ï¼Œæ¯ä¸ªNodeèŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œç€ä¸€ä¸ªkube-proxyæœåŠ¡è¿›ç¨‹ã€‚å½“åˆ›å»ºServiceçš„æ—¶å€™ä¼šé€šè¿‡api-serverå‘etcdå†™å…¥åˆ›å»ºçš„serviceçš„ä¿¡æ¯ï¼Œè€Œkube-proxyä¼šåŸºäºç›‘å¬çš„æœºåˆ¶å‘ç°è¿™ç§Serviceçš„å˜åŠ¨ï¼Œç„¶åå®ƒä¼šå°†æœ€æ–°çš„Serviceä¿¡æ¯è½¬æ¢æˆå¯¹åº”çš„è®¿é—®è§„åˆ™ã€‚\n\n# 10.97.97.97:80 æ˜¯serviceæä¾›çš„è®¿é—®å…¥å£\n# å½“è®¿é—®è¿™ä¸ªå…¥å£çš„æ—¶å€™ï¼Œå¯ä»¥å‘ç°åé¢æœ‰ä¸‰ä¸ªpodçš„æœåŠ¡åœ¨ç­‰å¾…è°ƒç”¨ï¼Œ\n# kube-proxyä¼šåŸºäºrrï¼ˆè½®è¯¢ï¼‰çš„ç­–ç•¥ï¼Œå°†è¯·æ±‚åˆ†å‘åˆ°å…¶ä¸­ä¸€ä¸ªpodä¸Šå»\n# è¿™ä¸ªè§„åˆ™ä¼šåŒæ—¶åœ¨é›†ç¾¤å†…çš„æ‰€æœ‰èŠ‚ç‚¹ä¸Šéƒ½ç”Ÿæˆï¼Œæ‰€ä»¥åœ¨ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè®¿é—®éƒ½å¯ä»¥ã€‚\n[root@node1 ~]# ipvsadm -Ln\nIP Virtual Server version 1.2.1 (size&#x3D;4096)\nProt LocalAddress:Port Scheduler Flags\n  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn\nTCP  10.97.97.97:80 rr\n  -&gt; 10.244.1.39:80               Masq    1      0          0\n  -&gt; 10.244.1.40:80               Masq    1      0          0\n  -&gt; 10.244.2.33:80               Masq    1      0          0\n\nkube-proxyç›®å‰æ”¯æŒä¸‰ç§å·¥ä½œæ¨¡å¼:\nuserspace æ¨¡å¼\nuserspaceæ¨¡å¼ä¸‹ï¼Œkube-proxyä¼šä¸ºæ¯ä¸€ä¸ªServiceåˆ›å»ºä¸€ä¸ªç›‘å¬ç«¯å£ï¼Œå‘å‘Cluster IPçš„è¯·æ±‚è¢«Iptablesè§„åˆ™é‡å®šå‘åˆ°kube-proxyç›‘å¬çš„ç«¯å£ä¸Šï¼Œkube-proxyæ ¹æ®LBç®—æ³•é€‰æ‹©ä¸€ä¸ªæä¾›æœåŠ¡çš„Podå¹¶å’Œå…¶å»ºç«‹é“¾æ¥ï¼Œä»¥å°†è¯·æ±‚è½¬å‘åˆ°Podä¸Šã€‚  è¯¥æ¨¡å¼ä¸‹ï¼Œkube-proxyå……å½“äº†ä¸€ä¸ªå››å±‚è´Ÿè´£å‡è¡¡å™¨çš„è§’è‰²ã€‚ç”±äºkube-proxyè¿è¡Œåœ¨userspaceä¸­ï¼Œåœ¨è¿›è¡Œè½¬å‘å¤„ç†æ—¶ä¼šå¢åŠ å†…æ ¸å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´çš„æ•°æ®æ‹·è´ï¼Œè™½ç„¶æ¯”è¾ƒç¨³å®šï¼Œä½†æ˜¯æ•ˆç‡æ¯”è¾ƒä½ã€‚\n\niptables æ¨¡å¼\niptablesæ¨¡å¼ä¸‹ï¼Œkube-proxyä¸ºserviceåç«¯çš„æ¯ä¸ªPodåˆ›å»ºå¯¹åº”çš„iptablesè§„åˆ™ï¼Œç›´æ¥å°†å‘å‘Cluster IPçš„è¯·æ±‚é‡å®šå‘åˆ°ä¸€ä¸ªPod IPã€‚  è¯¥æ¨¡å¼ä¸‹kube-proxyä¸æ‰¿æ‹…å››å±‚è´Ÿè´£å‡è¡¡å™¨çš„è§’è‰²ï¼Œåªè´Ÿè´£åˆ›å»ºiptablesè§„åˆ™ã€‚è¯¥æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯è¾ƒuserspaceæ¨¡å¼æ•ˆç‡æ›´é«˜ï¼Œä½†ä¸èƒ½æä¾›çµæ´»çš„LBç­–ç•¥ï¼Œå½“åç«¯Podä¸å¯ç”¨æ—¶ä¹Ÿæ— æ³•è¿›è¡Œé‡è¯•ã€‚\n\nipvs æ¨¡å¼\nipvsæ¨¡å¼å’Œiptablesç±»ä¼¼ï¼Œkube-proxyç›‘æ§Podçš„å˜åŒ–å¹¶åˆ›å»ºç›¸åº”çš„ipvsè§„åˆ™ã€‚ipvsç›¸å¯¹iptablesè½¬å‘æ•ˆç‡æ›´é«˜ã€‚é™¤æ­¤ä»¥å¤–ï¼Œipvsæ”¯æŒæ›´å¤šçš„LBç®—æ³•ã€‚\n\n# æ­¤æ¨¡å¼å¿…é¡»å®‰è£…ipvså†…æ ¸æ¨¡å—ï¼Œå¦åˆ™ä¼šé™çº§ä¸ºiptables\n# å¼€å¯ipvs\n[root@k8s-master01 ~]# kubectl edit cm kube-proxy -n kube-system\n# ä¿®æ”¹mode: &quot;ipvs&quot;\n[root@k8s-master01 ~]# kubectl delete pod -l k8s-app&#x3D;kube-proxy -n kube-system\n[root@node1 ~]# ipvsadm -Ln\nIP Virtual Server version 1.2.1 (size&#x3D;4096)\nProt LocalAddress:Port Scheduler Flags\n  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn\nTCP  10.97.97.97:80 rr\n  -&gt; 10.244.1.39:80               Masq    1      0          0\n  -&gt; 10.244.1.40:80               Masq    1      0          0\n  -&gt; 10.244.2.33:80               Masq    1      0          0\n\n7.2 Serviceç±»å‹Serviceçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š\nkind: Service  # èµ„æºç±»å‹\napiVersion: v1  # èµ„æºç‰ˆæœ¬\nmetadata: # å…ƒæ•°æ®\n  name: service # èµ„æºåç§°\n  namespace: dev # å‘½åç©ºé—´\nspec: # æè¿°\n  selector: # æ ‡ç­¾é€‰æ‹©å™¨ï¼Œç”¨äºç¡®å®šå½“å‰serviceä»£ç†å“ªäº›pod\n    app: nginx\n  type: # Serviceç±»å‹ï¼ŒæŒ‡å®šserviceçš„è®¿é—®æ–¹å¼\n  clusterIP:  # è™šæ‹ŸæœåŠ¡çš„ipåœ°å€\n  sessionAffinity: # sessionäº²å’Œæ€§ï¼Œæ”¯æŒClientIPã€Noneä¸¤ä¸ªé€‰é¡¹\n  ports: # ç«¯å£ä¿¡æ¯\n    - protocol: TCP \n      port: 3017  # serviceç«¯å£\n      targetPort: 5003 # podç«¯å£\n      nodePort: 31122 # ä¸»æœºç«¯å£\n\n\nClusterIPï¼šé»˜è®¤å€¼ï¼Œå®ƒæ˜¯Kubernetesç³»ç»Ÿè‡ªåŠ¨åˆ†é…çš„è™šæ‹ŸIPï¼Œåªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®\nNodePortï¼šå°†Serviceé€šè¿‡æŒ‡å®šçš„Nodeä¸Šçš„ç«¯å£æš´éœ²ç»™å¤–éƒ¨ï¼Œé€šè¿‡æ­¤æ–¹æ³•ï¼Œå°±å¯ä»¥åœ¨é›†ç¾¤å¤–éƒ¨è®¿é—®æœåŠ¡\nLoadBalancerï¼šä½¿ç”¨å¤–æ¥è´Ÿè½½å‡è¡¡å™¨å®Œæˆåˆ°æœåŠ¡çš„è´Ÿè½½åˆ†å‘ï¼Œæ³¨æ„æ­¤æ¨¡å¼éœ€è¦å¤–éƒ¨äº‘ç¯å¢ƒæ”¯æŒ\nExternalNameï¼š æŠŠé›†ç¾¤å¤–éƒ¨çš„æœåŠ¡å¼•å…¥é›†ç¾¤å†…éƒ¨ï¼Œç›´æ¥ä½¿ç”¨\n\n7.3 Serviceä½¿ç”¨7.3.1 å®éªŒç¯å¢ƒå‡†å¤‡åœ¨ä½¿ç”¨serviceä¹‹å‰ï¼Œé¦–å…ˆåˆ©ç”¨Deploymentåˆ›å»ºå‡º3ä¸ªpodï¼Œæ³¨æ„è¦ä¸ºpodè®¾ç½®app=nginx-podçš„æ ‡ç­¾\nåˆ›å»ºdeployment.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š\napiVersion: apps&#x2F;v1\nkind: Deployment      \nmetadata:\n  name: pc-deployment\n  namespace: dev\nspec: \n  replicas: 3\n  selector:\n    matchLabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerPort: 80\n\n[root@k8s-master01 ~]# kubectl create -f deployment.yaml\ndeployment.apps&#x2F;pc-deployment created\n\n# æŸ¥çœ‹podè¯¦æƒ…\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide --show-labels\nNAME                             READY   STATUS     IP            NODE     LABELS\npc-deployment-66cb59b984-8p84h   1&#x2F;1     Running    10.244.1.39   node1    app&#x3D;nginx-pod\npc-deployment-66cb59b984-vx8vx   1&#x2F;1     Running    10.244.2.33   node2    app&#x3D;nginx-pod\npc-deployment-66cb59b984-wnncx   1&#x2F;1     Running    10.244.1.40   node1    app&#x3D;nginx-pod\n\n# ä¸ºäº†æ–¹ä¾¿åé¢çš„æµ‹è¯•ï¼Œä¿®æ”¹ä¸‹ä¸‰å°nginxçš„index.htmlé¡µé¢ï¼ˆä¸‰å°ä¿®æ”¹çš„IPåœ°å€ä¸ä¸€è‡´ï¼‰\n# kubectl exec -it pc-deployment-66cb59b984-8p84h -n dev &#x2F;bin&#x2F;sh\n# echo &quot;10.244.1.39&quot; &gt; &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;index.html\n\n#ä¿®æ”¹å®Œæ¯•ä¹‹åï¼Œè®¿é—®æµ‹è¯•\n[root@k8s-master01 ~]# curl 10.244.1.39\n10.244.1.39\n[root@k8s-master01 ~]# curl 10.244.2.33\n10.244.2.33\n[root@k8s-master01 ~]# curl 10.244.1.40\n10.244.1.40\n\n7.3.2 ClusterIPç±»å‹çš„Serviceåˆ›å»ºservice-clusterip.yamlæ–‡ä»¶\napiVersion: v1\nkind: Service\nmetadata:\n  name: service-clusterip\n  namespace: dev\nspec:\n  selector:\n    app: nginx-pod\n  clusterIP: 10.97.97.97 # serviceçš„ipåœ°å€ï¼Œå¦‚æœä¸å†™ï¼Œé»˜è®¤ä¼šç”Ÿæˆä¸€ä¸ª\n  type: ClusterIP\n  ports:\n  - port: 80  # Serviceç«¯å£       \n    targetPort: 80 # podç«¯å£\n\n# åˆ›å»ºservice\n[root@k8s-master01 ~]# kubectl create -f service-clusterip.yaml\nservice&#x2F;service-clusterip created\n\n# æŸ¥çœ‹service\n[root@k8s-master01 ~]# kubectl get svc -n dev -o wide\nNAME                TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)   AGE   SELECTOR\nservice-clusterip   ClusterIP   10.97.97.97   &lt;none&gt;        80&#x2F;TCP    13s   app&#x3D;nginx-pod\n\n# æŸ¥çœ‹serviceçš„è¯¦ç»†ä¿¡æ¯\n# åœ¨è¿™é‡Œæœ‰ä¸€ä¸ªEndpointsåˆ—è¡¨ï¼Œé‡Œé¢å°±æ˜¯å½“å‰serviceå¯ä»¥è´Ÿè½½åˆ°çš„æœåŠ¡å…¥å£\n[root@k8s-master01 ~]# kubectl describe svc service-clusterip -n dev\nName:              service-clusterip\nNamespace:         dev\nLabels:            &lt;none&gt;\nAnnotations:       &lt;none&gt;\nSelector:          app&#x3D;nginx-pod\nType:              ClusterIP\nIP:                10.97.97.97\nPort:              &lt;unset&gt;  80&#x2F;TCP\nTargetPort:        80&#x2F;TCP\nEndpoints:         10.244.1.39:80,10.244.1.40:80,10.244.2.33:80\nSession Affinity:  None\nEvents:            &lt;none&gt;\n\n# æŸ¥çœ‹ipvsçš„æ˜ å°„è§„åˆ™\n[root@k8s-master01 ~]# ipvsadm -Ln\nTCP  10.97.97.97:80 rr\n  -&gt; 10.244.1.39:80               Masq    1      0          0\n  -&gt; 10.244.1.40:80               Masq    1      0          0\n  -&gt; 10.244.2.33:80               Masq    1      0          0\n\n# è®¿é—®10.97.97.97:80è§‚å¯Ÿæ•ˆæœ\n[root@k8s-master01 ~]# curl 10.97.97.97:80\n10.244.2.33\n\nEndpoint\nEndpointæ˜¯kubernetesä¸­çš„ä¸€ä¸ªèµ„æºå¯¹è±¡ï¼Œå­˜å‚¨åœ¨etcdä¸­ï¼Œç”¨æ¥è®°å½•ä¸€ä¸ªserviceå¯¹åº”çš„æ‰€æœ‰podçš„è®¿é—®åœ°å€ï¼Œå®ƒæ˜¯æ ¹æ®serviceé…ç½®æ–‡ä»¶ä¸­selectoræè¿°äº§ç”Ÿçš„ã€‚\nä¸€ä¸ªServiceç”±ä¸€ç»„Podç»„æˆï¼Œè¿™äº›Podé€šè¿‡Endpointsæš´éœ²å‡ºæ¥ï¼ŒEndpointsæ˜¯å®ç°å®é™…æœåŠ¡çš„ç«¯ç‚¹é›†åˆã€‚æ¢å¥è¯è¯´ï¼Œserviceå’Œpodä¹‹é—´çš„è”ç³»æ˜¯é€šè¿‡endpointså®ç°çš„ã€‚\n\nè´Ÿè½½åˆ†å‘ç­–ç•¥\nå¯¹Serviceçš„è®¿é—®è¢«åˆ†å‘åˆ°äº†åç«¯çš„Podä¸Šå»ï¼Œç›®å‰kubernetesæä¾›äº†ä¸¤ç§è´Ÿè½½åˆ†å‘ç­–ç•¥ï¼š\n\nå¦‚æœä¸å®šä¹‰ï¼Œé»˜è®¤ä½¿ç”¨kube-proxyçš„ç­–ç•¥ï¼Œæ¯”å¦‚éšæœºã€è½®è¯¢\n\nåŸºäºå®¢æˆ·ç«¯åœ°å€çš„ä¼šè¯ä¿æŒæ¨¡å¼ï¼Œå³æ¥è‡ªåŒä¸€ä¸ªå®¢æˆ·ç«¯å‘èµ·çš„æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè½¬å‘åˆ°å›ºå®šçš„ä¸€ä¸ªPodä¸Š\næ­¤æ¨¡å¼å¯ä»¥ä½¿åœ¨specä¸­æ·»åŠ sessionAffinity:ClientIPé€‰é¡¹\n\n\n# æŸ¥çœ‹ipvsçš„æ˜ å°„è§„åˆ™ã€rr è½®è¯¢ã€‘\n[root@k8s-master01 ~]# ipvsadm -Ln\nTCP  10.97.97.97:80 rr\n  -&gt; 10.244.1.39:80               Masq    1      0          0\n  -&gt; 10.244.1.40:80               Masq    1      0          0\n  -&gt; 10.244.2.33:80               Masq    1      0          0\n\n# å¾ªç¯è®¿é—®æµ‹è¯•\n[root@k8s-master01 ~]# while true;do curl 10.97.97.97:80; sleep 5; done;\n10.244.1.40\n10.244.1.39\n10.244.2.33\n10.244.1.40\n10.244.1.39\n10.244.2.33\n\n# ä¿®æ”¹åˆ†å‘ç­–ç•¥----sessionAffinity:ClientIP\n\n# æŸ¥çœ‹ipvsè§„åˆ™ã€persistent ä»£è¡¨æŒä¹…ã€‘\n[root@k8s-master01 ~]# ipvsadm -Ln\nTCP  10.97.97.97:80 rr persistent 10800\n  -&gt; 10.244.1.39:80               Masq    1      0          0\n  -&gt; 10.244.1.40:80               Masq    1      0          0\n  -&gt; 10.244.2.33:80               Masq    1      0          0\n\n# å¾ªç¯è®¿é—®æµ‹è¯•\n[root@k8s-master01 ~]# while true;do curl 10.97.97.97; sleep 5; done;\n10.244.2.33\n10.244.2.33\n10.244.2.33\n  \n# åˆ é™¤service\n[root@k8s-master01 ~]# kubectl delete -f service-clusterip.yaml\nservice &quot;service-clusterip&quot; deleted\n\n7.3.3 HeadLinessç±»å‹çš„Serviceåœ¨æŸäº›åœºæ™¯ä¸­ï¼Œå¼€å‘äººå‘˜å¯èƒ½ä¸æƒ³ä½¿ç”¨Serviceæä¾›çš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œè€Œå¸Œæœ›è‡ªå·±æ¥æ§åˆ¶è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œkubernetesæä¾›äº†HeadLiness Serviceï¼Œè¿™ç±»Serviceä¸ä¼šåˆ†é…Cluster IPï¼Œå¦‚æœæƒ³è¦è®¿é—®serviceï¼Œåªèƒ½é€šè¿‡serviceçš„åŸŸåè¿›è¡ŒæŸ¥è¯¢ã€‚\nåˆ›å»ºservice-headliness.yaml\napiVersion: v1\nkind: Service\nmetadata:\n  name: service-headliness\n  namespace: dev\nspec:\n  selector:\n    app: nginx-pod\n  clusterIP: None # å°†clusterIPè®¾ç½®ä¸ºNoneï¼Œå³å¯åˆ›å»ºheadliness Service\n  type: ClusterIP\n  ports:\n  - port: 80    \n    targetPort: 80\n\n# åˆ›å»ºservice\n[root@k8s-master01 ~]# kubectl create -f service-headliness.yaml\nservice&#x2F;service-headliness created\n\n# è·å–serviceï¼Œ å‘ç°CLUSTER-IPæœªåˆ†é…\n[root@k8s-master01 ~]# kubectl get svc service-headliness -n dev -o wide\nNAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE   SELECTOR\nservice-headliness   ClusterIP   None         &lt;none&gt;        80&#x2F;TCP    11s   app&#x3D;nginx-pod\n\n# æŸ¥çœ‹serviceè¯¦æƒ…\n[root@k8s-master01 ~]# kubectl describe svc service-headliness  -n dev\nName:              service-headliness\nNamespace:         dev\nLabels:            &lt;none&gt;\nAnnotations:       &lt;none&gt;\nSelector:          app&#x3D;nginx-pod\nType:              ClusterIP\nIP:                None\nPort:              &lt;unset&gt;  80&#x2F;TCP\nTargetPort:        80&#x2F;TCP\nEndpoints:         10.244.1.39:80,10.244.1.40:80,10.244.2.33:80\nSession Affinity:  None\nEvents:            &lt;none&gt;\n\n# æŸ¥çœ‹åŸŸåçš„è§£ææƒ…å†µ\n[root@k8s-master01 ~]# kubectl exec -it pc-deployment-66cb59b984-8p84h -n dev &#x2F;bin&#x2F;sh\n&#x2F; # cat &#x2F;etc&#x2F;resolv.conf\nnameserver 10.96.0.10\nsearch dev.svc.cluster.local svc.cluster.local cluster.local\n\n[root@k8s-master01 ~]# dig @10.96.0.10 service-headliness.dev.svc.cluster.local\nservice-headliness.dev.svc.cluster.local. 30 IN A 10.244.1.40\nservice-headliness.dev.svc.cluster.local. 30 IN A 10.244.1.39\nservice-headliness.dev.svc.cluster.local. 30 IN A 10.244.2.33\n\n7.3.4 NodePortç±»å‹çš„Serviceåœ¨ä¹‹å‰çš„æ ·ä¾‹ä¸­ï¼Œåˆ›å»ºçš„Serviceçš„ipåœ°å€åªæœ‰é›†ç¾¤å†…éƒ¨æ‰å¯ä»¥è®¿é—®ï¼Œå¦‚æœå¸Œæœ›å°†Serviceæš´éœ²ç»™é›†ç¾¤å¤–éƒ¨ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±è¦ä½¿ç”¨åˆ°å¦å¤–ä¸€ç§ç±»å‹çš„Serviceï¼Œç§°ä¸ºNodePortç±»å‹ã€‚NodePortçš„å·¥ä½œåŸç†å…¶å®å°±æ˜¯å°†serviceçš„ç«¯å£æ˜ å°„åˆ°Nodeçš„ä¸€ä¸ªç«¯å£ä¸Šï¼Œç„¶åå°±å¯ä»¥é€šè¿‡NodeIp:NodePortæ¥è®¿é—®serviceäº†ã€‚\n\nåˆ›å»ºservice-nodeport.yaml\napiVersion: v1\nkind: Service\nmetadata:\n  name: service-nodeport\n  namespace: dev\nspec:\n  selector:\n    app: nginx-pod\n  type: NodePort # serviceç±»å‹\n  ports:\n  - port: 80\n    nodePort: 30002 # æŒ‡å®šç»‘å®šçš„nodeçš„ç«¯å£(é»˜è®¤çš„å–å€¼èŒƒå›´æ˜¯ï¼š30000-32767), å¦‚æœä¸æŒ‡å®šï¼Œä¼šé»˜è®¤åˆ†é…\n    targetPort: 80\n\n# åˆ›å»ºservice\n[root@k8s-master01 ~]# kubectl create -f service-nodeport.yaml\nservice&#x2F;service-nodeport created\n\n# æŸ¥çœ‹service\n[root@k8s-master01 ~]# kubectl get svc -n dev -o wide\nNAME               TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)       SELECTOR\nservice-nodeport   NodePort   10.105.64.191   &lt;none&gt;        80:30002&#x2F;TCP  app&#x3D;nginx-pod\n\n# æ¥ä¸‹æ¥å¯ä»¥é€šè¿‡ç”µè„‘ä¸»æœºçš„æµè§ˆå™¨å»è®¿é—®é›†ç¾¤ä¸­ä»»æ„ä¸€ä¸ªnodeipçš„30002ç«¯å£ï¼Œå³å¯è®¿é—®åˆ°pod\n\n7.3.5 LoadBalancerç±»å‹çš„ServiceLoadBalancerå’ŒNodePortå¾ˆç›¸ä¼¼ï¼Œç›®çš„éƒ½æ˜¯å‘å¤–éƒ¨æš´éœ²ä¸€ä¸ªç«¯å£ï¼ŒåŒºåˆ«åœ¨äºLoadBalancerä¼šåœ¨é›†ç¾¤çš„å¤–éƒ¨å†æ¥åšä¸€ä¸ªè´Ÿè½½å‡è¡¡è®¾å¤‡ï¼Œè€Œè¿™ä¸ªè®¾å¤‡éœ€è¦å¤–éƒ¨ç¯å¢ƒæ”¯æŒçš„ï¼Œå¤–éƒ¨æœåŠ¡å‘é€åˆ°è¿™ä¸ªè®¾å¤‡ä¸Šçš„è¯·æ±‚ï¼Œä¼šè¢«è®¾å¤‡è´Ÿè½½ä¹‹åè½¬å‘åˆ°é›†ç¾¤ä¸­ã€‚\n\n7.3.6 ExternalNameç±»å‹çš„ServiceExternalNameç±»å‹çš„Serviceç”¨äºå¼•å…¥é›†ç¾¤å¤–éƒ¨çš„æœåŠ¡ï¼Œå®ƒé€šè¿‡externalNameå±æ€§æŒ‡å®šå¤–éƒ¨ä¸€ä¸ªæœåŠ¡çš„åœ°å€ï¼Œç„¶ååœ¨é›†ç¾¤å†…éƒ¨è®¿é—®æ­¤serviceå°±å¯ä»¥è®¿é—®åˆ°å¤–éƒ¨çš„æœåŠ¡äº†ã€‚\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: service-externalname\n  namespace: dev\nspec:\n  type: ExternalName # serviceç±»å‹\n  externalName: www.baidu.com  #æ”¹æˆipåœ°å€ä¹Ÿå¯ä»¥\n\n# åˆ›å»ºservice\n[root@k8s-master01 ~]# kubectl  create -f service-externalname.yaml\nservice&#x2F;service-externalname created\n\n# åŸŸåè§£æ\n[root@k8s-master01 ~]# dig @10.96.0.10 service-externalname.dev.svc.cluster.local\nservice-externalname.dev.svc.cluster.local. 30 IN CNAME www.baidu.com.\nwww.baidu.com.          30      IN      CNAME   www.a.shifen.com.\nwww.a.shifen.com.       30      IN      A       39.156.66.18\nwww.a.shifen.com.       30      IN      A       39.156.66.14\n\n7.4 Ingressä»‹ç»åœ¨å‰é¢è¯¾ç¨‹ä¸­å·²ç»æåˆ°ï¼ŒServiceå¯¹é›†ç¾¤ä¹‹å¤–æš´éœ²æœåŠ¡çš„ä¸»è¦æ–¹å¼æœ‰ä¸¤ç§ï¼šNotePortå’ŒLoadBalancerï¼Œä½†æ˜¯è¿™ä¸¤ç§æ–¹å¼ï¼Œéƒ½æœ‰ä¸€å®šçš„ç¼ºç‚¹ï¼š\n\nNodePortæ–¹å¼çš„ç¼ºç‚¹æ˜¯ä¼šå ç”¨å¾ˆå¤šé›†ç¾¤æœºå™¨çš„ç«¯å£ï¼Œé‚£ä¹ˆå½“é›†ç¾¤æœåŠ¡å˜å¤šçš„æ—¶å€™ï¼Œè¿™ä¸ªç¼ºç‚¹å°±æ„ˆå‘æ˜æ˜¾\nLBæ–¹å¼çš„ç¼ºç‚¹æ˜¯æ¯ä¸ªserviceéœ€è¦ä¸€ä¸ªLBï¼Œæµªè´¹ã€éº»çƒ¦ï¼Œå¹¶ä¸”éœ€è¦kubernetesä¹‹å¤–è®¾å¤‡çš„æ”¯æŒ\n\nåŸºäºè¿™ç§ç°çŠ¶ï¼Œkubernetesæä¾›äº†Ingressèµ„æºå¯¹è±¡ï¼ŒIngressåªéœ€è¦ä¸€ä¸ªNodePortæˆ–è€…ä¸€ä¸ªLBå°±å¯ä»¥æ»¡è¶³æš´éœ²å¤šä¸ªServiceçš„éœ€æ±‚ã€‚å·¥ä½œæœºåˆ¶å¤§è‡´å¦‚ä¸‹å›¾è¡¨ç¤ºï¼š\n\nå®é™…ä¸Šï¼ŒIngressç›¸å½“äºä¸€ä¸ª7å±‚çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œæ˜¯kuberneteså¯¹åå‘ä»£ç†çš„ä¸€ä¸ªæŠ½è±¡ï¼Œå®ƒçš„å·¥ä½œåŸç†ç±»ä¼¼äºNginxï¼Œå¯ä»¥ç†è§£æˆåœ¨Ingressé‡Œå»ºç«‹è¯¸å¤šæ˜ å°„è§„åˆ™ï¼ŒIngress Controlleré€šè¿‡ç›‘å¬è¿™äº›é…ç½®è§„åˆ™å¹¶è½¬åŒ–æˆNginxçš„åå‘ä»£ç†é…ç½® , ç„¶åå¯¹å¤–éƒ¨æä¾›æœåŠ¡ã€‚åœ¨è¿™é‡Œæœ‰ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š\n\ningressï¼škubernetesä¸­çš„ä¸€ä¸ªå¯¹è±¡ï¼Œä½œç”¨æ˜¯å®šä¹‰è¯·æ±‚å¦‚ä½•è½¬å‘åˆ°serviceçš„è§„åˆ™\ningress controllerï¼šå…·ä½“å®ç°åå‘ä»£ç†åŠè´Ÿè½½å‡è¡¡çš„ç¨‹åºï¼Œå¯¹ingresså®šä¹‰çš„è§„åˆ™è¿›è¡Œè§£æï¼Œæ ¹æ®é…ç½®çš„è§„åˆ™æ¥å®ç°è¯·æ±‚è½¬å‘ï¼Œå®ç°æ–¹å¼æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚Nginx, Contour, Haproxyç­‰ç­‰\n\nIngressï¼ˆä»¥Nginxä¸ºä¾‹ï¼‰çš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š\n\nç”¨æˆ·ç¼–å†™Ingressè§„åˆ™ï¼Œè¯´æ˜å“ªä¸ªåŸŸåå¯¹åº”kubernetesé›†ç¾¤ä¸­çš„å“ªä¸ªService\nIngressæ§åˆ¶å™¨åŠ¨æ€æ„ŸçŸ¥IngressæœåŠ¡è§„åˆ™çš„å˜åŒ–ï¼Œç„¶åç”Ÿæˆä¸€æ®µå¯¹åº”çš„Nginxåå‘ä»£ç†é…ç½®\nIngressæ§åˆ¶å™¨ä¼šå°†ç”Ÿæˆçš„Nginxé…ç½®å†™å…¥åˆ°ä¸€ä¸ªè¿è¡Œç€çš„NginxæœåŠ¡ä¸­ï¼Œå¹¶åŠ¨æ€æ›´æ–°\nåˆ°æ­¤ä¸ºæ­¢ï¼Œå…¶å®çœŸæ­£åœ¨å·¥ä½œçš„å°±æ˜¯ä¸€ä¸ªNginxäº†ï¼Œå†…éƒ¨é…ç½®äº†ç”¨æˆ·å®šä¹‰çš„è¯·æ±‚è½¬å‘è§„åˆ™\n\n\n7.5 Ingressä½¿ç”¨7.5.1 ç¯å¢ƒå‡†å¤‡æ­å»ºingressç¯å¢ƒ\n# åˆ›å»ºæ–‡ä»¶å¤¹\n[root@k8s-master01 ~]# mkdir ingress-controller\n[root@k8s-master01 ~]# cd ingress-controller&#x2F;\n\n# è·å–ingress-nginxï¼Œæœ¬æ¬¡æ¡ˆä¾‹ä½¿ç”¨çš„æ˜¯0.30ç‰ˆæœ¬\n[root@k8s-master01 ingress-controller]# wget https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;kubernetes&#x2F;ingress-nginx&#x2F;nginx-0.30.0&#x2F;deploy&#x2F;static&#x2F;mandatory.yaml\n[root@k8s-master01 ingress-controller]# wget https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;kubernetes&#x2F;ingress-nginx&#x2F;nginx-0.30.0&#x2F;deploy&#x2F;static&#x2F;provider&#x2F;baremetal&#x2F;service-nodeport.yaml\n\n# ä¿®æ”¹mandatory.yamlæ–‡ä»¶ä¸­çš„ä»“åº“\n# ä¿®æ”¹quay.io&#x2F;kubernetes-ingress-controller&#x2F;nginx-ingress-controller:0.30.0\n# ä¸ºquay-mirror.qiniu.com&#x2F;kubernetes-ingress-controller&#x2F;nginx-ingress-controller:0.30.0\n# åˆ›å»ºingress-nginx\n[root@k8s-master01 ingress-controller]# kubectl apply -f .&#x2F;\n\n# æŸ¥çœ‹ingress-nginx\n[root@k8s-master01 ingress-controller]# kubectl get pod -n ingress-nginx\nNAME                                           READY   STATUS    RESTARTS   AGE\npod&#x2F;nginx-ingress-controller-fbf967dd5-4qpbp   1&#x2F;1     Running   0          12h\n\n# æŸ¥çœ‹service\n[root@k8s-master01 ingress-controller]# kubectl get svc -n ingress-nginx\nNAME            TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)                      AGE\ningress-nginx   NodePort   10.98.75.163   &lt;none&gt;        80:32240&#x2F;TCP,443:31335&#x2F;TCP   11h\n\nå‡†å¤‡serviceå’Œpod\nä¸ºäº†åé¢çš„å®éªŒæ¯”è¾ƒæ–¹ä¾¿ï¼Œåˆ›å»ºå¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ¨¡å‹\n\nåˆ›å»ºtomcat-nginx.yaml\napiVersion: apps&#x2F;v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\n  namespace: dev\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerPort: 80\n\n---\n\napiVersion: apps&#x2F;v1\nkind: Deployment\nmetadata:\n  name: tomcat-deployment\n  namespace: dev\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: tomcat-pod\n  template:\n    metadata:\n      labels:\n        app: tomcat-pod\n    spec:\n      containers:\n      - name: tomcat\n        image: tomcat:8.5-jre10-slim\n        ports:\n        - containerPort: 8080\n\n---\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: nginx-service\n  namespace: dev\nspec:\n  selector:\n    app: nginx-pod\n  clusterIP: None\n  type: ClusterIP\n  ports:\n  - port: 80\n    targetPort: 80\n\n---\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: tomcat-service\n  namespace: dev\nspec:\n  selector:\n    app: tomcat-pod\n  clusterIP: None\n  type: ClusterIP\n  ports:\n  - port: 8080\n    targetPort: 8080\n\n# åˆ›å»º\n[root@k8s-master01 ~]# kubectl create -f tomcat-nginx.yaml\n\n# æŸ¥çœ‹\n[root@k8s-master01 ~]# kubectl get svc -n dev\nNAME             TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE\nnginx-service    ClusterIP   None         &lt;none&gt;        80&#x2F;TCP     48s\ntomcat-service   ClusterIP   None         &lt;none&gt;        8080&#x2F;TCP   48s\n\n7.5.2 Httpä»£ç†åˆ›å»ºingress-http.yaml\napiVersion: extensions&#x2F;v1beta1\nkind: Ingress\nmetadata:\n  name: ingress-http\n  namespace: dev\nspec:\n  rules:\n  - host: nginx.itheima.com\n    http:\n      paths:\n      - path: &#x2F;\n        backend:\n          serviceName: nginx-service\n          servicePort: 80\n  - host: tomcat.itheima.com\n    http:\n      paths:\n      - path: &#x2F;\n        backend:\n          serviceName: tomcat-service\n          servicePort: 8080\n\n# åˆ›å»º\n[root@k8s-master01 ~]# kubectl create -f ingress-http.yaml\ningress.extensions&#x2F;ingress-http created\n\n# æŸ¥çœ‹\n[root@k8s-master01 ~]# kubectl get ing ingress-http -n dev\nNAME           HOSTS                                  ADDRESS   PORTS   AGE\ningress-http   nginx.itheima.com,tomcat.itheima.com             80      22s\n\n# æŸ¥çœ‹è¯¦æƒ…\n[root@k8s-master01 ~]# kubectl describe ing ingress-http  -n dev\n...\nRules:\nHost                Path  Backends\n----                ----  --------\nnginx.itheima.com   &#x2F; nginx-service:80 (10.244.1.96:80,10.244.1.97:80,10.244.2.112:80)\ntomcat.itheima.com  &#x2F; tomcat-service:8080(10.244.1.94:8080,10.244.1.95:8080,10.244.2.111:8080)\n...\n\n# æ¥ä¸‹æ¥,åœ¨æœ¬åœ°ç”µè„‘ä¸Šé…ç½®hostæ–‡ä»¶,è§£æä¸Šé¢çš„ä¸¤ä¸ªåŸŸååˆ°192.168.109.100(master)ä¸Š\n# ç„¶å,å°±å¯ä»¥åˆ†åˆ«è®¿é—®tomcat.itheima.com:32240  å’Œ  nginx.itheima.com:32240 æŸ¥çœ‹æ•ˆæœäº†\n\n7.5.3 Httpsä»£ç†åˆ›å»ºè¯ä¹¦\n# ç”Ÿæˆè¯ä¹¦\nopenssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj &quot;&#x2F;C&#x3D;CN&#x2F;ST&#x3D;BJ&#x2F;L&#x3D;BJ&#x2F;O&#x3D;nginx&#x2F;CN&#x3D;itheima.com&quot;\n\n# åˆ›å»ºå¯†é’¥\nkubectl create secret tls tls-secret --key tls.key --cert tls.crt\n\nåˆ›å»ºingress-https.yaml\napiVersion: extensions&#x2F;v1beta1\nkind: Ingress\nmetadata:\n  name: ingress-https\n  namespace: dev\nspec:\n  tls:\n    - hosts:\n      - nginx.itheima.com\n      - tomcat.itheima.com\n      secretName: tls-secret # æŒ‡å®šç§˜é’¥\n  rules:\n  - host: nginx.itheima.com\n    http:\n      paths:\n      - path: &#x2F;\n        backend:\n          serviceName: nginx-service\n          servicePort: 80\n  - host: tomcat.itheima.com\n    http:\n      paths:\n      - path: &#x2F;\n        backend:\n          serviceName: tomcat-service\n          servicePort: 8080\n\n# åˆ›å»º\n[root@k8s-master01 ~]# kubectl create -f ingress-https.yaml\ningress.extensions&#x2F;ingress-https created\n\n# æŸ¥çœ‹\n[root@k8s-master01 ~]# kubectl get ing ingress-https -n dev\nNAME            HOSTS                                  ADDRESS         PORTS     AGE\ningress-https   nginx.itheima.com,tomcat.itheima.com   10.104.184.38   80, 443   2m42s\n\n# æŸ¥çœ‹è¯¦æƒ…\n[root@k8s-master01 ~]# kubectl describe ing ingress-https -n dev\n...\nTLS:\n  tls-secret terminates nginx.itheima.com,tomcat.itheima.com\nRules:\nHost              Path Backends\n----              ---- --------\nnginx.itheima.com  &#x2F;  nginx-service:80 (10.244.1.97:80,10.244.1.98:80,10.244.2.119:80)\ntomcat.itheima.com &#x2F;  tomcat-service:8080(10.244.1.99:8080,10.244.2.117:8080,10.244.2.120:8080)\n...\n\n# ä¸‹é¢å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®https:&#x2F;&#x2F;nginx.itheima.com:31335 å’Œ https:&#x2F;&#x2F;tomcat.itheima.com:31335æ¥æŸ¥çœ‹äº†\n\n8. æ•°æ®å­˜å‚¨åœ¨å‰é¢å·²ç»æåˆ°ï¼Œå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½å¾ˆçŸ­ï¼Œä¼šè¢«é¢‘ç¹åœ°åˆ›å»ºå’Œé”€æ¯ã€‚é‚£ä¹ˆå®¹å™¨åœ¨é”€æ¯æ—¶ï¼Œä¿å­˜åœ¨å®¹å™¨ä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ¸…é™¤ã€‚è¿™ç§ç»“æœå¯¹ç”¨æˆ·æ¥è¯´ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æ˜¯ä¸ä¹æ„çœ‹åˆ°çš„ã€‚ä¸ºäº†æŒä¹…åŒ–ä¿å­˜å®¹å™¨çš„æ•°æ®ï¼Œkuberneteså¼•å…¥äº†Volumeçš„æ¦‚å¿µã€‚\nVolumeæ˜¯Podä¸­èƒ½å¤Ÿè¢«å¤šä¸ªå®¹å™¨è®¿é—®çš„å…±äº«ç›®å½•ï¼Œå®ƒè¢«å®šä¹‰åœ¨Podä¸Šï¼Œç„¶åè¢«ä¸€ä¸ªPodé‡Œçš„å¤šä¸ªå®¹å™¨æŒ‚è½½åˆ°å…·ä½“çš„æ–‡ä»¶ç›®å½•ä¸‹ï¼Œkubernetesé€šè¿‡Volumeå®ç°åŒä¸€ä¸ªPodä¸­ä¸åŒå®¹å™¨ä¹‹é—´çš„æ•°æ®å…±äº«ä»¥åŠæ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ã€‚Volumeçš„ç”Ÿå‘½å®¹å™¨ä¸ä¸Podä¸­å•ä¸ªå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸç›¸å…³ï¼Œå½“å®¹å™¨ç»ˆæ­¢æˆ–è€…é‡å¯æ—¶ï¼ŒVolumeä¸­çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚\nkubernetesçš„Volumeæ”¯æŒå¤šç§ç±»å‹ï¼Œæ¯”è¾ƒå¸¸è§çš„æœ‰ä¸‹é¢å‡ ä¸ªï¼š\n\nç®€å•å­˜å‚¨ï¼šEmptyDirã€HostPathã€NFS\né«˜çº§å­˜å‚¨ï¼šPVã€PVC\né…ç½®å­˜å‚¨ï¼šConfigMapã€Secret\n\n8.1 åŸºæœ¬å­˜å‚¨8.1.1 EmptyDirEmptyDiræ˜¯æœ€åŸºç¡€çš„Volumeç±»å‹ï¼Œä¸€ä¸ªEmptyDirå°±æ˜¯Hostä¸Šçš„ä¸€ä¸ªç©ºç›®å½•ã€‚\nEmptyDiræ˜¯åœ¨Podè¢«åˆ†é…åˆ°Nodeæ—¶åˆ›å»ºçš„ï¼Œå®ƒçš„åˆå§‹å†…å®¹ä¸ºç©ºï¼Œå¹¶ä¸”æ— é¡»æŒ‡å®šå®¿ä¸»æœºä¸Šå¯¹åº”çš„ç›®å½•æ–‡ä»¶ï¼Œå› ä¸ºkubernetesä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç›®å½•ï¼Œå½“Podé”€æ¯æ—¶ï¼Œ EmptyDirä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ°¸ä¹…åˆ é™¤ã€‚ EmptyDirç”¨é€”å¦‚ä¸‹ï¼š\n\nä¸´æ—¶ç©ºé—´ï¼Œä¾‹å¦‚ç”¨äºæŸäº›åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ‰€éœ€çš„ä¸´æ—¶ç›®å½•ï¼Œä¸”æ— é¡»æ°¸ä¹…ä¿ç•™\nä¸€ä¸ªå®¹å™¨éœ€è¦ä»å¦ä¸€ä¸ªå®¹å™¨ä¸­è·å–æ•°æ®çš„ç›®å½•ï¼ˆå¤šå®¹å™¨å…±äº«ç›®å½•ï¼‰\n\næ¥ä¸‹æ¥ï¼Œé€šè¿‡ä¸€ä¸ªå®¹å™¨ä¹‹é—´æ–‡ä»¶å…±äº«çš„æ¡ˆä¾‹æ¥ä½¿ç”¨ä¸€ä¸‹EmptyDirã€‚\nåœ¨ä¸€ä¸ªPodä¸­å‡†å¤‡ä¸¤ä¸ªå®¹å™¨nginxå’Œbusyboxï¼Œç„¶åå£°æ˜ä¸€ä¸ªVolumeåˆ†åˆ«æŒ‚åœ¨åˆ°ä¸¤ä¸ªå®¹å™¨çš„ç›®å½•ä¸­ï¼Œç„¶ånginxå®¹å™¨è´Ÿè´£å‘Volumeä¸­å†™æ—¥å¿—ï¼Œbusyboxä¸­é€šè¿‡å‘½ä»¤å°†æ—¥å¿—å†…å®¹è¯»åˆ°æ§åˆ¶å°ã€‚\n\nåˆ›å»ºä¸€ä¸ªvolume-emptydir.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: volume-emptydir\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - containerPort: 80\n    volumeMounts:  # å°†logs-volumeæŒ‚åœ¨åˆ°nginxå®¹å™¨ä¸­ï¼Œå¯¹åº”çš„ç›®å½•ä¸º &#x2F;var&#x2F;log&#x2F;nginx\n    - name: logs-volume\n      mountPath: &#x2F;var&#x2F;log&#x2F;nginx\n  - name: busybox\n    image: busybox:1.30\n    command: [&quot;&#x2F;bin&#x2F;sh&quot;,&quot;-c&quot;,&quot;tail -f &#x2F;logs&#x2F;access.log&quot;] # åˆå§‹å‘½ä»¤ï¼ŒåŠ¨æ€è¯»å–æŒ‡å®šæ–‡ä»¶ä¸­å†…å®¹\n    volumeMounts:  # å°†logs-volume æŒ‚åœ¨åˆ°busyboxå®¹å™¨ä¸­ï¼Œå¯¹åº”çš„ç›®å½•ä¸º &#x2F;logs\n    - name: logs-volume\n      mountPath: &#x2F;logs\n  volumes: # å£°æ˜volumeï¼Œ nameä¸ºlogs-volumeï¼Œç±»å‹ä¸ºemptyDir\n  - name: logs-volume\n    emptyDir: &#123;&#125;\n\n# åˆ›å»ºPod\n[root@k8s-master01 ~]# kubectl create -f volume-emptydir.yaml\npod&#x2F;volume-emptydir created\n\n# æŸ¥çœ‹pod\n[root@k8s-master01 ~]# kubectl get pods volume-emptydir -n dev -o wide\nNAME                  READY   STATUS    RESTARTS   AGE      IP       NODE   ...... \nvolume-emptydir       2&#x2F;2     Running   0          97s   10.42.2.9   node1  ......\n\n# é€šè¿‡podIpè®¿é—®nginx\n[root@k8s-master01 ~]# curl 10.42.2.9\n......\n\n# é€šè¿‡kubectl logså‘½ä»¤æŸ¥çœ‹æŒ‡å®šå®¹å™¨çš„æ ‡å‡†è¾“å‡º\n[root@k8s-master01 ~]# kubectl logs -f volume-emptydir -n dev -c busybox\n10.42.1.0 - - [27&#x2F;Jun&#x2F;2021:15:08:54 +0000] &quot;GET &#x2F; HTTP&#x2F;1.1&quot; 200 612 &quot;-&quot; &quot;curl&#x2F;7.29.0&quot; &quot;-&quot;\n\n8.1.2 HostPathä¸ŠèŠ‚è¯¾æåˆ°ï¼ŒEmptyDirä¸­æ•°æ®ä¸ä¼šè¢«æŒä¹…åŒ–ï¼Œå®ƒä¼šéšç€Podçš„ç»“æŸè€Œé”€æ¯ï¼Œå¦‚æœæƒ³ç®€å•çš„å°†æ•°æ®æŒä¹…åŒ–åˆ°ä¸»æœºä¸­ï¼Œå¯ä»¥é€‰æ‹©HostPathã€‚\nHostPathå°±æ˜¯å°†Nodeä¸»æœºä¸­ä¸€ä¸ªå®é™…ç›®å½•æŒ‚åœ¨åˆ°Podä¸­ï¼Œä»¥ä¾›å®¹å™¨ä½¿ç”¨ï¼Œè¿™æ ·çš„è®¾è®¡å°±å¯ä»¥ä¿è¯Podé”€æ¯äº†ï¼Œä½†æ˜¯æ•°æ®ä¾æ®å¯ä»¥å­˜åœ¨äºNodeä¸»æœºä¸Šã€‚\n\nåˆ›å»ºä¸€ä¸ªvolume-hostpath.yamlï¼š\napiVersion: v1\nkind: Pod\nmetadata:\n  name: volume-hostpath\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - containerPort: 80\n    volumeMounts:\n    - name: logs-volume\n      mountPath: &#x2F;var&#x2F;log&#x2F;nginx\n  - name: busybox\n    image: busybox:1.30\n    command: [&quot;&#x2F;bin&#x2F;sh&quot;,&quot;-c&quot;,&quot;tail -f &#x2F;logs&#x2F;access.log&quot;]\n    volumeMounts:\n    - name: logs-volume\n      mountPath: &#x2F;logs\n  volumes:\n  - name: logs-volume\n    hostPath: \n      path: &#x2F;root&#x2F;logs\n      type: DirectoryOrCreate  # ç›®å½•å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºåä½¿ç”¨\n\nå…³äºtypeçš„å€¼çš„ä¸€ç‚¹è¯´æ˜ï¼š\n    DirectoryOrCreate ç›®å½•å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºåä½¿ç”¨\n    Directory   ç›®å½•å¿…é¡»å­˜åœ¨\n    FileOrCreate  æ–‡ä»¶å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºåä½¿ç”¨\n    File æ–‡ä»¶å¿…é¡»å­˜åœ¨ \n    Socket  unixå¥—æ¥å­—å¿…é¡»å­˜åœ¨\n    CharDevice  å­—ç¬¦è®¾å¤‡å¿…é¡»å­˜åœ¨\n    BlockDevice å—è®¾å¤‡å¿…é¡»å­˜åœ¨\n\n# åˆ›å»ºPod\n[root@k8s-master01 ~]# kubectl create -f volume-hostpath.yaml\npod&#x2F;volume-hostpath created\n\n# æŸ¥çœ‹Pod\n[root@k8s-master01 ~]# kubectl get pods volume-hostpath -n dev -o wide\nNAME                  READY   STATUS    RESTARTS   AGE   IP             NODE   ......\npod-volume-hostpath   2&#x2F;2     Running   0          16s   10.42.2.10     node1  ......\n\n#è®¿é—®nginx\n[root@k8s-master01 ~]# curl 10.42.2.10\n\n# æ¥ä¸‹æ¥å°±å¯ä»¥å»hostçš„&#x2F;root&#x2F;logsç›®å½•ä¸‹æŸ¥çœ‹å­˜å‚¨çš„æ–‡ä»¶äº†\n###  æ³¨æ„: ä¸‹é¢çš„æ“ä½œéœ€è¦åˆ°Podæ‰€åœ¨çš„èŠ‚ç‚¹è¿è¡Œï¼ˆæ¡ˆä¾‹ä¸­æ˜¯node1ï¼‰\n[root@node1 ~]# ls &#x2F;root&#x2F;logs&#x2F;\naccess.log  error.log\n\n# åŒæ ·çš„é“ç†ï¼Œå¦‚æœåœ¨æ­¤ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œåˆ°å®¹å™¨ä¸­ä¹Ÿæ˜¯å¯ä»¥çœ‹åˆ°çš„\n\n8.1.3 NFSHostPathå¯ä»¥è§£å†³æ•°æ®æŒä¹…åŒ–çš„é—®é¢˜ï¼Œä½†æ˜¯ä¸€æ—¦NodeèŠ‚ç‚¹æ•…éšœäº†ï¼ŒPodå¦‚æœè½¬ç§»åˆ°äº†åˆ«çš„èŠ‚ç‚¹ï¼Œåˆä¼šå‡ºç°é—®é¢˜äº†ï¼Œæ­¤æ—¶éœ€è¦å‡†å¤‡å•ç‹¬çš„ç½‘ç»œå­˜å‚¨ç³»ç»Ÿï¼Œæ¯”è¾ƒå¸¸ç”¨çš„ç”¨NFSã€CIFSã€‚\nNFSæ˜¯ä¸€ä¸ªç½‘ç»œæ–‡ä»¶å­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥æ­å»ºä¸€å°NFSæœåŠ¡å™¨ï¼Œç„¶åå°†Podä¸­çš„å­˜å‚¨ç›´æ¥è¿æ¥åˆ°NFSç³»ç»Ÿä¸Šï¼Œè¿™æ ·çš„è¯ï¼Œæ— è®ºPodåœ¨èŠ‚ç‚¹ä¸Šæ€ä¹ˆè½¬ç§»ï¼Œåªè¦Nodeè·ŸNFSçš„å¯¹æ¥æ²¡é—®é¢˜ï¼Œæ•°æ®å°±å¯ä»¥æˆåŠŸè®¿é—®ã€‚\n\n1ï¼‰é¦–å…ˆè¦å‡†å¤‡nfsçš„æœåŠ¡å™¨ï¼Œè¿™é‡Œä¸ºäº†ç®€å•ï¼Œç›´æ¥æ˜¯masterèŠ‚ç‚¹åšnfsæœåŠ¡å™¨\n# åœ¨nfsä¸Šå®‰è£…nfsæœåŠ¡\n[root@nfs ~]# yum install nfs-utils -y\n\n# å‡†å¤‡ä¸€ä¸ªå…±äº«ç›®å½•\n[root@nfs ~]# mkdir &#x2F;root&#x2F;data&#x2F;nfs -pv\n\n# å°†å…±äº«ç›®å½•ä»¥è¯»å†™æƒé™æš´éœ²ç»™192.168.5.0&#x2F;24ç½‘æ®µä¸­çš„æ‰€æœ‰ä¸»æœº\n[root@nfs ~]# vim &#x2F;etc&#x2F;exports\n[root@nfs ~]# more &#x2F;etc&#x2F;exports\n&#x2F;root&#x2F;data&#x2F;nfs     192.168.5.0&#x2F;24(rw,no_root_squash)\n\n# å¯åŠ¨nfsæœåŠ¡\n[root@nfs ~]# systemctl restart nfs\n\n2ï¼‰æ¥ä¸‹æ¥ï¼Œè¦åœ¨çš„æ¯ä¸ªnodeèŠ‚ç‚¹ä¸Šéƒ½å®‰è£…ä¸‹nfsï¼Œè¿™æ ·çš„ç›®çš„æ˜¯ä¸ºäº†nodeèŠ‚ç‚¹å¯ä»¥é©±åŠ¨nfsè®¾å¤‡\n# åœ¨nodeä¸Šå®‰è£…nfsæœåŠ¡ï¼Œæ³¨æ„ä¸éœ€è¦å¯åŠ¨\n[root@k8s-master01 ~]# yum install nfs-utils -y\n\n3ï¼‰æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥ç¼–å†™podçš„é…ç½®æ–‡ä»¶äº†ï¼Œåˆ›å»ºvolume-nfs.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: volume-nfs\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - containerPort: 80\n    volumeMounts:\n    - name: logs-volume\n      mountPath: &#x2F;var&#x2F;log&#x2F;nginx\n  - name: busybox\n    image: busybox:1.30\n    command: [&quot;&#x2F;bin&#x2F;sh&quot;,&quot;-c&quot;,&quot;tail -f &#x2F;logs&#x2F;access.log&quot;] \n    volumeMounts:\n    - name: logs-volume\n      mountPath: &#x2F;logs\n  volumes:\n  - name: logs-volume\n    nfs:\n      server: 192.168.5.6  #nfsæœåŠ¡å™¨åœ°å€\n      path: &#x2F;root&#x2F;data&#x2F;nfs #å…±äº«æ–‡ä»¶è·¯å¾„\n\n4ï¼‰æœ€åï¼Œè¿è¡Œä¸‹podï¼Œè§‚å¯Ÿç»“æœ\n# åˆ›å»ºpod\n[root@k8s-master01 ~]# kubectl create -f volume-nfs.yaml\npod&#x2F;volume-nfs created\n\n# æŸ¥çœ‹pod\n[root@k8s-master01 ~]# kubectl get pods volume-nfs -n dev\nNAME                  READY   STATUS    RESTARTS   AGE\nvolume-nfs        2&#x2F;2     Running   0          2m9s\n\n# æŸ¥çœ‹nfsæœåŠ¡å™¨ä¸Šçš„å…±äº«ç›®å½•ï¼Œå‘ç°å·²ç»æœ‰æ–‡ä»¶äº†\n[root@k8s-master01 ~]# ls &#x2F;root&#x2F;data&#x2F;\naccess.log  error.log\n\n8.2 é«˜çº§å­˜å‚¨å‰é¢å·²ç»å­¦ä¹ äº†ä½¿ç”¨NFSæä¾›å­˜å‚¨ï¼Œæ­¤æ—¶å°±è¦æ±‚ç”¨æˆ·ä¼šæ­å»ºNFSç³»ç»Ÿï¼Œå¹¶ä¸”ä¼šåœ¨yamlé…ç½®nfsã€‚ç”±äºkubernetesæ”¯æŒçš„å­˜å‚¨ç³»ç»Ÿæœ‰å¾ˆå¤šï¼Œè¦æ±‚å®¢æˆ·å…¨éƒ½æŒæ¡ï¼Œæ˜¾ç„¶ä¸ç°å®ã€‚ä¸ºäº†èƒ½å¤Ÿå±è”½åº•å±‚å­˜å‚¨å®ç°çš„ç»†èŠ‚ï¼Œæ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ï¼Œ kuberneteså¼•å…¥PVå’ŒPVCä¸¤ç§èµ„æºå¯¹è±¡ã€‚\nPVï¼ˆPersistent Volumeï¼‰æ˜¯æŒä¹…åŒ–å·çš„æ„æ€ï¼Œæ˜¯å¯¹åº•å±‚çš„å…±äº«å­˜å‚¨çš„ä¸€ç§æŠ½è±¡ã€‚ä¸€èˆ¬æƒ…å†µä¸‹PVç”±kubernetesç®¡ç†å‘˜è¿›è¡Œåˆ›å»ºå’Œé…ç½®ï¼Œå®ƒä¸åº•å±‚å…·ä½“çš„å…±äº«å­˜å‚¨æŠ€æœ¯æœ‰å…³ï¼Œå¹¶é€šè¿‡æ’ä»¶å®Œæˆä¸å…±äº«å­˜å‚¨çš„å¯¹æ¥ã€‚\nPVCï¼ˆPersistent Volume Claimï¼‰æ˜¯æŒä¹…å·å£°æ˜çš„æ„æ€ï¼Œæ˜¯ç”¨æˆ·å¯¹äºå­˜å‚¨éœ€æ±‚çš„ä¸€ç§å£°æ˜ã€‚æ¢å¥è¯è¯´ï¼ŒPVCå…¶å®å°±æ˜¯ç”¨æˆ·å‘kubernetesç³»ç»Ÿå‘å‡ºçš„ä¸€ç§èµ„æºéœ€æ±‚ç”³è¯·ã€‚\n\nä½¿ç”¨äº†PVå’ŒPVCä¹‹åï¼Œå·¥ä½œå¯ä»¥å¾—åˆ°è¿›ä¸€æ­¥çš„ç»†åˆ†ï¼š\n\nå­˜å‚¨ï¼šå­˜å‚¨å·¥ç¨‹å¸ˆç»´æŠ¤\nPVï¼š kubernetesç®¡ç†å‘˜ç»´æŠ¤\nPVCï¼škubernetesç”¨æˆ·ç»´æŠ¤\n\n8.2.1 PVPVæ˜¯å­˜å‚¨èµ„æºçš„æŠ½è±¡ï¼Œä¸‹é¢æ˜¯èµ„æºæ¸…å•æ–‡ä»¶:\napiVersion: v1  \nkind: PersistentVolume\nmetadata:\n  name: pv2\nspec:\n  nfs: # å­˜å‚¨ç±»å‹ï¼Œä¸åº•å±‚çœŸæ­£å­˜å‚¨å¯¹åº”\n  capacity:  # å­˜å‚¨èƒ½åŠ›ï¼Œç›®å‰åªæ”¯æŒå­˜å‚¨ç©ºé—´çš„è®¾ç½®\n    storage: 2Gi\n  accessModes:  # è®¿é—®æ¨¡å¼\n  storageClassName: # å­˜å‚¨ç±»åˆ«\n  persistentVolumeReclaimPolicy: # å›æ”¶ç­–ç•¥\n\nPV çš„å…³é”®é…ç½®å‚æ•°è¯´æ˜ï¼š\n\nå­˜å‚¨ç±»å‹\nåº•å±‚å®é™…å­˜å‚¨çš„ç±»å‹ï¼Œkubernetesæ”¯æŒå¤šç§å­˜å‚¨ç±»å‹ï¼Œæ¯ç§å­˜å‚¨ç±»å‹çš„é…ç½®éƒ½æœ‰æ‰€å·®å¼‚\n\nå­˜å‚¨èƒ½åŠ›ï¼ˆcapacityï¼‰\n\n\nç›®å‰åªæ”¯æŒå­˜å‚¨ç©ºé—´çš„è®¾ç½®( storage&#x3D;1Gi )ï¼Œä¸è¿‡æœªæ¥å¯èƒ½ä¼šåŠ å…¥IOPSã€ååé‡ç­‰æŒ‡æ ‡çš„é…ç½®\n\nè®¿é—®æ¨¡å¼ï¼ˆaccessModesï¼‰\nç”¨äºæè¿°ç”¨æˆ·åº”ç”¨å¯¹å­˜å‚¨èµ„æºçš„è®¿é—®æƒé™ï¼Œè®¿é—®æƒé™åŒ…æ‹¬ä¸‹é¢å‡ ç§æ–¹å¼ï¼š\n\nReadWriteOnceï¼ˆRWOï¼‰ï¼šè¯»å†™æƒé™ï¼Œä½†æ˜¯åªèƒ½è¢«å•ä¸ªèŠ‚ç‚¹æŒ‚è½½\nReadOnlyManyï¼ˆROXï¼‰ï¼š åªè¯»æƒé™ï¼Œå¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹æŒ‚è½½\nReadWriteManyï¼ˆRWXï¼‰ï¼šè¯»å†™æƒé™ï¼Œå¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹æŒ‚è½½\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåº•å±‚ä¸åŒçš„å­˜å‚¨ç±»å‹å¯èƒ½æ”¯æŒçš„è®¿é—®æ¨¡å¼ä¸åŒ\n\nå›æ”¶ç­–ç•¥ï¼ˆpersistentVolumeReclaimPolicyï¼‰\nå½“PVä¸å†è¢«ä½¿ç”¨äº†ä¹‹åï¼Œå¯¹å…¶çš„å¤„ç†æ–¹å¼ã€‚ç›®å‰æ”¯æŒä¸‰ç§ç­–ç•¥ï¼š\n\nRetain ï¼ˆä¿ç•™ï¼‰ ä¿ç•™æ•°æ®ï¼Œéœ€è¦ç®¡ç†å‘˜æ‰‹å·¥æ¸…ç†æ•°æ®\nRecycleï¼ˆå›æ”¶ï¼‰ æ¸…é™¤ PV ä¸­çš„æ•°æ®ï¼Œæ•ˆæœç›¸å½“äºæ‰§è¡Œ rm -rf &#x2F;thevolume&#x2F;*\nDelete ï¼ˆåˆ é™¤ï¼‰ ä¸ PV ç›¸è¿çš„åç«¯å­˜å‚¨å®Œæˆ volume çš„åˆ é™¤æ“ä½œï¼Œå½“ç„¶è¿™å¸¸è§äºäº‘æœåŠ¡å•†çš„å­˜å‚¨æœåŠ¡\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåº•å±‚ä¸åŒçš„å­˜å‚¨ç±»å‹å¯èƒ½æ”¯æŒçš„å›æ”¶ç­–ç•¥ä¸åŒ\n\nå­˜å‚¨ç±»åˆ«\nPVå¯ä»¥é€šè¿‡storageClassNameå‚æ•°æŒ‡å®šä¸€ä¸ªå­˜å‚¨ç±»åˆ«\n\nå…·æœ‰ç‰¹å®šç±»åˆ«çš„PVåªèƒ½ä¸è¯·æ±‚äº†è¯¥ç±»åˆ«çš„PVCè¿›è¡Œç»‘å®š\næœªè®¾å®šç±»åˆ«çš„PVåˆ™åªèƒ½ä¸ä¸è¯·æ±‚ä»»ä½•ç±»åˆ«çš„PVCè¿›è¡Œç»‘å®š\n\n\nçŠ¶æ€ï¼ˆstatusï¼‰\nä¸€ä¸ª PV çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå¯èƒ½ä¼šå¤„äº4ä¸­ä¸åŒçš„é˜¶æ®µï¼š\n\nAvailableï¼ˆå¯ç”¨ï¼‰ï¼š è¡¨ç¤ºå¯ç”¨çŠ¶æ€ï¼Œè¿˜æœªè¢«ä»»ä½• PVC ç»‘å®š\nBoundï¼ˆå·²ç»‘å®šï¼‰ï¼š è¡¨ç¤º PV å·²ç»è¢« PVC ç»‘å®š\nReleasedï¼ˆå·²é‡Šæ”¾ï¼‰ï¼š è¡¨ç¤º PVC è¢«åˆ é™¤ï¼Œä½†æ˜¯èµ„æºè¿˜æœªè¢«é›†ç¾¤é‡æ–°å£°æ˜\nFailedï¼ˆå¤±è´¥ï¼‰ï¼š è¡¨ç¤ºè¯¥ PV çš„è‡ªåŠ¨å›æ”¶å¤±è´¥\n\n\n\nå®éªŒ\nä½¿ç”¨NFSä½œä¸ºå­˜å‚¨ï¼Œæ¥æ¼”ç¤ºPVçš„ä½¿ç”¨ï¼Œåˆ›å»º3ä¸ªPVï¼Œå¯¹åº”NFSä¸­çš„3ä¸ªæš´éœ²çš„è·¯å¾„ã€‚\n\nå‡†å¤‡NFSç¯å¢ƒ\n\n# åˆ›å»ºç›®å½•\n[root@nfs ~]# mkdir &#x2F;root&#x2F;data&#x2F;&#123;pv1,pv2,pv3&#125; -pv\n\n# æš´éœ²æœåŠ¡\n[root@nfs ~]# more &#x2F;etc&#x2F;exports\n&#x2F;root&#x2F;data&#x2F;pv1     192.168.5.0&#x2F;24(rw,no_root_squash)\n&#x2F;root&#x2F;data&#x2F;pv2     192.168.5.0&#x2F;24(rw,no_root_squash)\n&#x2F;root&#x2F;data&#x2F;pv3     192.168.5.0&#x2F;24(rw,no_root_squash)\n\n# é‡å¯æœåŠ¡\n[root@nfs ~]#  systemctl restart nfs\n\n\nåˆ›å»ºpv.yaml\n\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name:  pv1\nspec:\n  capacity: \n    storage: 1Gi\n  accessModes:\n  - ReadWriteMany\n  persistentVolumeReclaimPolicy: Retain\n  nfs:\n    path: &#x2F;root&#x2F;data&#x2F;pv1\n    server: 192.168.5.6\n\n---\n\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name:  pv2\nspec:\n  capacity: \n    storage: 2Gi\n  accessModes:\n  - ReadWriteMany\n  persistentVolumeReclaimPolicy: Retain\n  nfs:\n    path: &#x2F;root&#x2F;data&#x2F;pv2\n    server: 192.168.5.6\n    \n---\n\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name:  pv3\nspec:\n  capacity: \n    storage: 3Gi\n  accessModes:\n  - ReadWriteMany\n  persistentVolumeReclaimPolicy: Retain\n  nfs:\n    path: &#x2F;root&#x2F;data&#x2F;pv3\n    server: 192.168.5.6\n\n# åˆ›å»º pv\n[root@k8s-master01 ~]# kubectl create -f pv.yaml\npersistentvolume&#x2F;pv1 created\npersistentvolume&#x2F;pv2 created\npersistentvolume&#x2F;pv3 created\n\n# æŸ¥çœ‹pv\n[root@k8s-master01 ~]# kubectl get pv -o wide\nNAME   CAPACITY   ACCESS MODES  RECLAIM POLICY  STATUS      AGE   VOLUMEMODE\npv1    1Gi        RWX            Retain        Available    10s   Filesystem\npv2    2Gi        RWX            Retain        Available    10s   Filesystem\npv3    3Gi        RWX            Retain        Available    9s    Filesystem\n\n8.2.2 PVCPVCæ˜¯èµ„æºçš„ç”³è¯·ï¼Œç”¨æ¥å£°æ˜å¯¹å­˜å‚¨ç©ºé—´ã€è®¿é—®æ¨¡å¼ã€å­˜å‚¨ç±»åˆ«éœ€æ±‚ä¿¡æ¯ã€‚ä¸‹é¢æ˜¯èµ„æºæ¸…å•æ–‡ä»¶:\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: pvc\n  namespace: dev\nspec:\n  accessModes: # è®¿é—®æ¨¡å¼\n  selector: # é‡‡ç”¨æ ‡ç­¾å¯¹PVé€‰æ‹©\n  storageClassName: # å­˜å‚¨ç±»åˆ«\n  resources: # è¯·æ±‚ç©ºé—´\n    requests:\n      storage: 5Gi\n\nPVC çš„å…³é”®é…ç½®å‚æ•°è¯´æ˜ï¼š\n\nè®¿é—®æ¨¡å¼ï¼ˆaccessModesï¼‰\n\nç”¨äºæè¿°ç”¨æˆ·åº”ç”¨å¯¹å­˜å‚¨èµ„æºçš„è®¿é—®æƒé™\n\né€‰æ‹©æ¡ä»¶ï¼ˆselectorï¼‰\né€šè¿‡Label Selectorçš„è®¾ç½®ï¼Œå¯ä½¿PVCå¯¹äºç³»ç»Ÿä¸­å·±å­˜åœ¨çš„PVè¿›è¡Œç­›é€‰\n\nå­˜å‚¨ç±»åˆ«ï¼ˆstorageClassNameï¼‰\nPVCåœ¨å®šä¹‰æ—¶å¯ä»¥è®¾å®šéœ€è¦çš„åç«¯å­˜å‚¨çš„ç±»åˆ«ï¼Œåªæœ‰è®¾ç½®äº†è¯¥classçš„pvæ‰èƒ½è¢«ç³»ç»Ÿé€‰å‡º\n\nèµ„æºè¯·æ±‚ï¼ˆResources ï¼‰\næè¿°å¯¹å­˜å‚¨èµ„æºçš„è¯·æ±‚\n\n\nå®éªŒ\n\nåˆ›å»ºpvc.yamlï¼Œç”³è¯·pv\n\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: pvc1\n  namespace: dev\nspec:\n  accessModes: \n  - ReadWriteMany\n  resources:\n    requests:\n      storage: 1Gi\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: pvc2\n  namespace: dev\nspec:\n  accessModes: \n  - ReadWriteMany\n  resources:\n    requests:\n      storage: 1Gi\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: pvc3\n  namespace: dev\nspec:\n  accessModes: \n  - ReadWriteMany\n  resources:\n    requests:\n      storage: 1Gi\n\n# åˆ›å»ºpvc\n[root@k8s-master01 ~]# kubectl create -f pvc.yaml\npersistentvolumeclaim&#x2F;pvc1 created\npersistentvolumeclaim&#x2F;pvc2 created\npersistentvolumeclaim&#x2F;pvc3 created\n\n# æŸ¥çœ‹pvc\n[root@k8s-master01 ~]# kubectl get pvc  -n dev -o wide\nNAME   STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE   VOLUMEMODE\npvc1   Bound    pv1      1Gi        RWX                           15s   Filesystem\npvc2   Bound    pv2      2Gi        RWX                           15s   Filesystem\npvc3   Bound    pv3      3Gi        RWX                           15s   Filesystem\n\n# æŸ¥çœ‹pv\n[root@k8s-master01 ~]# kubectl get pv -o wide\nNAME  CAPACITY ACCESS MODES  RECLAIM POLICY  STATUS    CLAIM       AGE     VOLUMEMODE\npv1    1Gi        RWx        Retain          Bound    dev&#x2F;pvc1    3h37m    Filesystem\npv2    2Gi        RWX        Retain          Bound    dev&#x2F;pvc2    3h37m    Filesystem\npv3    3Gi        RWX        Retain          Bound    dev&#x2F;pvc3    3h37m    Filesystem   \n\n\nåˆ›å»ºpods.yaml, ä½¿ç”¨pv\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod1\n  namespace: dev\nspec:\n  containers:\n  - name: busybox\n    image: busybox:1.30\n    command: [&quot;&#x2F;bin&#x2F;sh&quot;,&quot;-c&quot;,&quot;while true;do echo pod1 &gt;&gt; &#x2F;root&#x2F;out.txt; sleep 10; done;&quot;]\n    volumeMounts:\n    - name: volume\n      mountPath: &#x2F;root&#x2F;\n  volumes:\n    - name: volume\n      persistentVolumeClaim:\n        claimName: pvc1\n        readOnly: false\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod2\n  namespace: dev\nspec:\n  containers:\n  - name: busybox\n    image: busybox:1.30\n    command: [&quot;&#x2F;bin&#x2F;sh&quot;,&quot;-c&quot;,&quot;while true;do echo pod2 &gt;&gt; &#x2F;root&#x2F;out.txt; sleep 10; done;&quot;]\n    volumeMounts:\n    - name: volume\n      mountPath: &#x2F;root&#x2F;\n  volumes:\n    - name: volume\n      persistentVolumeClaim:\n        claimName: pvc2\n        readOnly: false\n\n# åˆ›å»ºpod\n[root@k8s-master01 ~]# kubectl create -f pods.yaml\npod&#x2F;pod1 created\npod&#x2F;pod2 created\n\n# æŸ¥çœ‹pod\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nNAME   READY   STATUS    RESTARTS   AGE   IP            NODE   \npod1   1&#x2F;1     Running   0          14s   10.244.1.69   node1   \npod2   1&#x2F;1     Running   0          14s   10.244.1.70   node1  \n\n# æŸ¥çœ‹pvc\n[root@k8s-master01 ~]# kubectl get pvc -n dev -o wide\nNAME   STATUS   VOLUME   CAPACITY   ACCESS MODES      AGE   VOLUMEMODE\npvc1   Bound    pv1      1Gi        RWX               94m   Filesystem\npvc2   Bound    pv2      2Gi        RWX               94m   Filesystem\npvc3   Bound    pv3      3Gi        RWX               94m   Filesystem\n\n# æŸ¥çœ‹pv\n[root@k8s-master01 ~]# kubectl get pv -n dev -o wide\nNAME   CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM       AGE     VOLUMEMODE\npv1    1Gi        RWX            Retain           Bound    dev&#x2F;pvc1    5h11m   Filesystem\npv2    2Gi        RWX            Retain           Bound    dev&#x2F;pvc2    5h11m   Filesystem\npv3    3Gi        RWX            Retain           Bound    dev&#x2F;pvc3    5h11m   Filesystem\n\n# æŸ¥çœ‹nfsä¸­çš„æ–‡ä»¶å­˜å‚¨\n[root@nfs ~]# more &#x2F;root&#x2F;data&#x2F;pv1&#x2F;out.txt\nnode1\nnode1\n[root@nfs ~]# more &#x2F;root&#x2F;data&#x2F;pv2&#x2F;out.txt\nnode2\nnode2\n\n8.2.3 ç”Ÿå‘½å‘¨æœŸPVCå’ŒPVæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼ŒPVå’ŒPVCä¹‹é—´çš„ç›¸äº’ä½œç”¨éµå¾ªä»¥ä¸‹ç”Ÿå‘½å‘¨æœŸï¼š\n\nèµ„æºä¾›åº”ï¼šç®¡ç†å‘˜æ‰‹åŠ¨åˆ›å»ºåº•å±‚å­˜å‚¨å’ŒPV\n\nèµ„æºç»‘å®šï¼šç”¨æˆ·åˆ›å»ºPVCï¼Œkubernetesè´Ÿè´£æ ¹æ®PVCçš„å£°æ˜å»å¯»æ‰¾PVï¼Œå¹¶ç»‘å®š\nåœ¨ç”¨æˆ·å®šä¹‰å¥½PVCä¹‹åï¼Œç³»ç»Ÿå°†æ ¹æ®PVCå¯¹å­˜å‚¨èµ„æºçš„è¯·æ±‚åœ¨å·²å­˜åœ¨çš„PVä¸­é€‰æ‹©ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„\n\nä¸€æ—¦æ‰¾åˆ°ï¼Œå°±å°†è¯¥PVä¸ç”¨æˆ·å®šä¹‰çš„PVCè¿›è¡Œç»‘å®šï¼Œç”¨æˆ·çš„åº”ç”¨å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªPVCäº†\nå¦‚æœæ‰¾ä¸åˆ°ï¼ŒPVCåˆ™ä¼šæ— é™æœŸå¤„äºPendingçŠ¶æ€ï¼Œç›´åˆ°ç­‰åˆ°ç³»ç»Ÿç®¡ç†å‘˜åˆ›å»ºäº†ä¸€ä¸ªç¬¦åˆå…¶è¦æ±‚çš„PV\n\nPVä¸€æ—¦ç»‘å®šåˆ°æŸä¸ªPVCä¸Šï¼Œå°±ä¼šè¢«è¿™ä¸ªPVCç‹¬å ï¼Œä¸èƒ½å†ä¸å…¶ä»–PVCè¿›è¡Œç»‘å®šäº†\n\nèµ„æºä½¿ç”¨ï¼šç”¨æˆ·å¯åœ¨podä¸­åƒvolumeä¸€æ ·ä½¿ç”¨pvc\nPodä½¿ç”¨Volumeçš„å®šä¹‰ï¼Œå°†PVCæŒ‚è½½åˆ°å®¹å™¨å†…çš„æŸä¸ªè·¯å¾„è¿›è¡Œä½¿ç”¨ã€‚\n\nèµ„æºé‡Šæ”¾ï¼šç”¨æˆ·åˆ é™¤pvcæ¥é‡Šæ”¾pv\nå½“å­˜å‚¨èµ„æºä½¿ç”¨å®Œæ¯•åï¼Œç”¨æˆ·å¯ä»¥åˆ é™¤PVCï¼Œä¸è¯¥PVCç»‘å®šçš„PVå°†ä¼šè¢«æ ‡è®°ä¸ºâ€œå·²é‡Šæ”¾â€ï¼Œä½†è¿˜ä¸èƒ½ç«‹åˆ»ä¸å…¶ä»–PVCè¿›è¡Œç»‘å®šã€‚é€šè¿‡ä¹‹å‰PVCå†™å…¥çš„æ•°æ®å¯èƒ½è¿˜è¢«ç•™åœ¨å­˜å‚¨è®¾å¤‡ä¸Šï¼Œåªæœ‰åœ¨æ¸…é™¤ä¹‹åè¯¥PVæ‰èƒ½å†æ¬¡ä½¿ç”¨ã€‚\n\nèµ„æºå›æ”¶ï¼škubernetesæ ¹æ®pvè®¾ç½®çš„å›æ”¶ç­–ç•¥è¿›è¡Œèµ„æºçš„å›æ”¶\nå¯¹äºPVï¼Œç®¡ç†å‘˜å¯ä»¥è®¾å®šå›æ”¶ç­–ç•¥ï¼Œç”¨äºè®¾ç½®ä¸ä¹‹ç»‘å®šçš„PVCé‡Šæ”¾èµ„æºä¹‹åå¦‚ä½•å¤„ç†é—ç•™æ•°æ®çš„é—®é¢˜ã€‚åªæœ‰PVçš„å­˜å‚¨ç©ºé—´å®Œæˆå›æ”¶ï¼Œæ‰èƒ½ä¾›æ–°çš„PVCç»‘å®šå’Œä½¿ç”¨\n\n\n\n8.3 é…ç½®å­˜å‚¨8.3.1 ConfigMapConfigMapæ˜¯ä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„å­˜å‚¨å·ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥å­˜å‚¨é…ç½®ä¿¡æ¯çš„ã€‚\nåˆ›å»ºconfigmap.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: configmap\n  namespace: dev\ndata:\n  info: |\n    username:admin\n    password:123456\n\næ¥ä¸‹æ¥ï¼Œä½¿ç”¨æ­¤é…ç½®æ–‡ä»¶åˆ›å»ºconfigmap\n# åˆ›å»ºconfigmap\n[root@k8s-master01 ~]# kubectl create -f configmap.yaml\nconfigmap&#x2F;configmap created\n\n# æŸ¥çœ‹configmapè¯¦æƒ…\n[root@k8s-master01 ~]# kubectl describe cm configmap -n dev\nName:         configmap\nNamespace:    dev\nLabels:       &lt;none&gt;\nAnnotations:  &lt;none&gt;\n\nData\n&#x3D;&#x3D;&#x3D;&#x3D;\ninfo:\n----\nusername:admin\npassword:123456\n\nEvents:  &lt;none&gt;\n\næ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸ªpod-configmap.yamlï¼Œå°†ä¸Šé¢åˆ›å»ºçš„configmapæŒ‚è½½è¿›å»\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-configmap\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    volumeMounts: # å°†configmapæŒ‚è½½åˆ°ç›®å½•\n    - name: config\n      mountPath: &#x2F;configmap&#x2F;config\n  volumes: # å¼•ç”¨configmap\n  - name: config\n    configMap:\n      name: configmap\n\n# åˆ›å»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-configmap.yaml\npod&#x2F;pod-configmap created\n\n# æŸ¥çœ‹pod\n[root@k8s-master01 ~]# kubectl get pod pod-configmap -n dev\nNAME            READY   STATUS    RESTARTS   AGE\npod-configmap   1&#x2F;1     Running   0          6s\n\n#è¿›å…¥å®¹å™¨\n[root@k8s-master01 ~]# kubectl exec -it pod-configmap -n dev &#x2F;bin&#x2F;sh\n# cd &#x2F;configmap&#x2F;config&#x2F;\n# ls\ninfo\n# more info\nusername:admin\npassword:123456\n\n# å¯ä»¥çœ‹åˆ°æ˜ å°„å·²ç»æˆåŠŸï¼Œæ¯ä¸ªconfigmapéƒ½æ˜ å°„æˆäº†ä¸€ä¸ªç›®å½•\n# key---&gt;æ–‡ä»¶     value----&gt;æ–‡ä»¶ä¸­çš„å†…å®¹\n# æ­¤æ—¶å¦‚æœæ›´æ–°configmapçš„å†…å®¹, å®¹å™¨ä¸­çš„å€¼ä¹Ÿä¼šåŠ¨æ€æ›´æ–°\n\n8.3.2 Secretåœ¨kubernetesä¸­ï¼Œè¿˜å­˜åœ¨ä¸€ç§å’ŒConfigMapéå¸¸ç±»ä¼¼çš„å¯¹è±¡ï¼Œç§°ä¸ºSecretå¯¹è±¡ã€‚å®ƒä¸»è¦ç”¨äºå­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€ç§˜é’¥ã€è¯ä¹¦ç­‰ç­‰ã€‚\n\né¦–å…ˆä½¿ç”¨base64å¯¹æ•°æ®è¿›è¡Œç¼–ç \n\n[root@k8s-master01 ~]# echo -n &#39;admin&#39; | base64 #å‡†å¤‡username\nYWRtaW4&#x3D;\n[root@k8s-master01 ~]# echo -n &#39;123456&#39; | base64 #å‡†å¤‡password\nMTIzNDU2\n\n\næ¥ä¸‹æ¥ç¼–å†™secret.yamlï¼Œå¹¶åˆ›å»ºSecret\n\napiVersion: v1\nkind: Secret\nmetadata:\n  name: secret\n  namespace: dev\ntype: Opaque\ndata:\n  username: YWRtaW4&#x3D;\n  password: MTIzNDU2\n\n# åˆ›å»ºsecret\n[root@k8s-master01 ~]# kubectl create -f secret.yaml\nsecret&#x2F;secret created\n\n# æŸ¥çœ‹secretè¯¦æƒ…\n[root@k8s-master01 ~]# kubectl describe secret secret -n dev\nName:         secret\nNamespace:    dev\nLabels:       &lt;none&gt;\nAnnotations:  &lt;none&gt;\nType:  Opaque\nData\n&#x3D;&#x3D;&#x3D;&#x3D;\npassword:  6 bytes\nusername:  5 bytes\n\n\nåˆ›å»ºpod-secret.yamlï¼Œå°†ä¸Šé¢åˆ›å»ºçš„secretæŒ‚è½½è¿›å»ï¼š\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-secret\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    volumeMounts: # å°†secretæŒ‚è½½åˆ°ç›®å½•\n    - name: config\n      mountPath: &#x2F;secret&#x2F;config\n  volumes:\n  - name: config\n    secret:\n      secretName: secret\n\n# åˆ›å»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-secret.yaml\npod&#x2F;pod-secret created\n\n# æŸ¥çœ‹pod\n[root@k8s-master01 ~]# kubectl get pod pod-secret -n dev\nNAME            READY   STATUS    RESTARTS   AGE\npod-secret      1&#x2F;1     Running   0          2m28s\n\n# è¿›å…¥å®¹å™¨ï¼ŒæŸ¥çœ‹secretä¿¡æ¯ï¼Œå‘ç°å·²ç»è‡ªåŠ¨è§£ç äº†\n[root@k8s-master01 ~]# kubectl exec -it pod-secret &#x2F;bin&#x2F;sh -n dev\n&#x2F; # ls &#x2F;secret&#x2F;config&#x2F;\npassword  username\n&#x2F; # more &#x2F;secret&#x2F;config&#x2F;username\nadmin\n&#x2F; # more &#x2F;secret&#x2F;config&#x2F;password\n123456\n\nè‡³æ­¤ï¼Œå·²ç»å®ç°äº†åˆ©ç”¨secretå®ç°äº†ä¿¡æ¯çš„ç¼–ç ã€‚\n9. å®‰å…¨è®¤è¯9.1 è®¿é—®æ§åˆ¶æ¦‚è¿°Kubernetesä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼é›†ç¾¤çš„ç®¡ç†å·¥å…·ï¼Œä¿è¯é›†ç¾¤çš„å®‰å…¨æ€§æ˜¯å…¶ä¸€ä¸ªé‡è¦çš„ä»»åŠ¡ã€‚æ‰€è°“çš„å®‰å…¨æ€§å…¶å®å°±æ˜¯ä¿è¯å¯¹Kubernetesçš„å„ç§å®¢æˆ·ç«¯è¿›è¡Œè®¤è¯å’Œé‰´æƒæ“ä½œã€‚\nå®¢æˆ·ç«¯\nåœ¨Kubernetesé›†ç¾¤ä¸­ï¼Œå®¢æˆ·ç«¯é€šå¸¸æœ‰ä¸¤ç±»ï¼š\n\nUser Accountï¼šä¸€èˆ¬æ˜¯ç‹¬ç«‹äºkubernetesä¹‹å¤–çš„å…¶ä»–æœåŠ¡ç®¡ç†çš„ç”¨æˆ·è´¦å·ã€‚\nService Accountï¼škubernetesç®¡ç†çš„è´¦å·ï¼Œç”¨äºä¸ºPodä¸­çš„æœåŠ¡è¿›ç¨‹åœ¨è®¿é—®Kubernetesæ—¶æä¾›èº«ä»½æ ‡è¯†ã€‚\n\n\nè®¤è¯ã€æˆæƒä¸å‡†å…¥æ§åˆ¶\nApiServeræ˜¯è®¿é—®åŠç®¡ç†èµ„æºå¯¹è±¡çš„å”¯ä¸€å…¥å£ã€‚ä»»ä½•ä¸€ä¸ªè¯·æ±‚è®¿é—®ApiServerï¼Œéƒ½è¦ç»è¿‡ä¸‹é¢ä¸‰ä¸ªæµç¨‹ï¼š\n\nAuthenticationï¼ˆè®¤è¯ï¼‰ï¼šèº«ä»½é‰´åˆ«ï¼Œåªæœ‰æ­£ç¡®çš„è´¦å·æ‰èƒ½å¤Ÿé€šè¿‡è®¤è¯\nAuthorizationï¼ˆæˆæƒï¼‰ï¼š åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒé™å¯¹è®¿é—®çš„èµ„æºæ‰§è¡Œç‰¹å®šçš„åŠ¨ä½œ\nAdmission Controlï¼ˆå‡†å…¥æ§åˆ¶ï¼‰ï¼šç”¨äºè¡¥å……æˆæƒæœºåˆ¶ä»¥å®ç°æ›´åŠ ç²¾ç»†çš„è®¿é—®æ§åˆ¶åŠŸèƒ½ã€‚\n\n\n9.2 è®¤è¯ç®¡ç†Kubernetesé›†ç¾¤å®‰å…¨çš„æœ€å…³é”®ç‚¹åœ¨äºå¦‚ä½•è¯†åˆ«å¹¶è®¤è¯å®¢æˆ·ç«¯èº«ä»½ï¼Œå®ƒæä¾›äº†3ç§å®¢æˆ·ç«¯èº«ä»½è®¤è¯æ–¹å¼ï¼š\n\nHTTP Baseè®¤è¯ï¼šé€šè¿‡ç”¨æˆ·å+å¯†ç çš„æ–¹å¼è®¤è¯\nè¿™ç§è®¤è¯æ–¹å¼æ˜¯æŠŠâ€œç”¨æˆ·å:å¯†ç â€ç”¨BASE64ç®—æ³•è¿›è¡Œç¼–ç åçš„å­—ç¬¦ä¸²æ”¾åœ¨HTTPè¯·æ±‚ä¸­çš„Header AuthorizationåŸŸé‡Œå‘é€ç»™æœåŠ¡ç«¯ã€‚æœåŠ¡ç«¯æ”¶åˆ°åè¿›è¡Œè§£ç ï¼Œè·å–ç”¨æˆ·ååŠå¯†ç ï¼Œç„¶åè¿›è¡Œç”¨æˆ·èº«ä»½è®¤è¯çš„è¿‡ç¨‹ã€‚\n\nHTTP Tokenè®¤è¯ï¼šé€šè¿‡ä¸€ä¸ªTokenæ¥è¯†åˆ«åˆæ³•ç”¨æˆ·\nè¿™ç§è®¤è¯æ–¹å¼æ˜¯ç”¨ä¸€ä¸ªå¾ˆé•¿çš„éš¾ä»¥è¢«æ¨¡ä»¿çš„å­—ç¬¦ä¸²--Tokenæ¥è¡¨æ˜å®¢æˆ·èº«ä»½çš„ä¸€ç§æ–¹å¼ã€‚æ¯ä¸ªTokenå¯¹åº”ä¸€ä¸ªç”¨æˆ·åï¼Œå½“å®¢æˆ·ç«¯å‘èµ·APIè°ƒç”¨è¯·æ±‚æ—¶ï¼Œéœ€è¦åœ¨HTTP Headeré‡Œæ”¾å…¥Tokenï¼ŒAPI Serveræ¥åˆ°Tokenåä¼šè·ŸæœåŠ¡å™¨ä¸­ä¿å­˜çš„tokenè¿›è¡Œæ¯”å¯¹ï¼Œç„¶åè¿›è¡Œç”¨æˆ·èº«ä»½è®¤è¯çš„è¿‡ç¨‹ã€‚\n\nHTTPSè¯ä¹¦è®¤è¯ï¼šåŸºäºCAæ ¹è¯ä¹¦ç­¾åçš„åŒå‘æ•°å­—è¯ä¹¦è®¤è¯æ–¹å¼\nè¿™ç§è®¤è¯æ–¹å¼æ˜¯å®‰å…¨æ€§æœ€é«˜çš„ä¸€ç§æ–¹å¼ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿæ˜¯æ“ä½œèµ·æ¥æœ€éº»çƒ¦çš„ä¸€ç§æ–¹å¼ã€‚\n\n\nHTTPSè®¤è¯å¤§ä½“åˆ†ä¸º3ä¸ªè¿‡ç¨‹ï¼š\n\nè¯ä¹¦ç”³è¯·å’Œä¸‹å‘\nHTTPSé€šä¿¡åŒæ–¹çš„æœåŠ¡å™¨å‘CAæœºæ„ç”³è¯·è¯ä¹¦ï¼ŒCAæœºæ„ä¸‹å‘æ ¹è¯ä¹¦ã€æœåŠ¡ç«¯è¯ä¹¦åŠç§é’¥ç»™ç”³è¯·è€…\n\nå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„åŒå‘è®¤è¯\n1&gt; å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡ç«¯ä¸‹å‘è‡ªå·±çš„è¯ä¹¦ç»™å®¢æˆ·ç«¯ï¼Œ\n   å®¢æˆ·ç«¯æ¥æ”¶åˆ°è¯ä¹¦åï¼Œé€šè¿‡ç§é’¥è§£å¯†è¯ä¹¦ï¼Œåœ¨è¯ä¹¦ä¸­è·å¾—æœåŠ¡ç«¯çš„å…¬é’¥ï¼Œ\n   å®¢æˆ·ç«¯åˆ©ç”¨æœåŠ¡å™¨ç«¯çš„å…¬é’¥è®¤è¯è¯ä¹¦ä¸­çš„ä¿¡æ¯ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™è®¤å¯è¿™ä¸ªæœåŠ¡å™¨\n2&gt; å®¢æˆ·ç«¯å‘é€è‡ªå·±çš„è¯ä¹¦ç»™æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åˆ°è¯ä¹¦åï¼Œé€šè¿‡ç§é’¥è§£å¯†è¯ä¹¦ï¼Œ\n   åœ¨è¯ä¹¦ä¸­è·å¾—å®¢æˆ·ç«¯çš„å…¬é’¥ï¼Œå¹¶ç”¨è¯¥å…¬é’¥è®¤è¯è¯ä¹¦ä¿¡æ¯ï¼Œç¡®è®¤å®¢æˆ·ç«¯æ˜¯å¦åˆæ³•\n\næœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡\næœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯åå•†å¥½åŠ å¯†æ–¹æ¡ˆåï¼Œå®¢æˆ·ç«¯ä¼šäº§ç”Ÿä¸€ä¸ªéšæœºçš„ç§˜é’¥å¹¶åŠ å¯†ï¼Œç„¶åå‘é€åˆ°æœåŠ¡å™¨ç«¯ã€‚\næœåŠ¡å™¨ç«¯æ¥æ”¶è¿™ä¸ªç§˜é’¥åï¼ŒåŒæ–¹æ¥ä¸‹æ¥é€šä¿¡çš„æ‰€æœ‰å†…å®¹éƒ½é€šè¿‡è¯¥éšæœºç§˜é’¥åŠ å¯†\n\n\n\n\n\n\n\n\n\n\næ³¨æ„: Kuberneteså…è®¸åŒæ—¶é…ç½®å¤šç§è®¤è¯æ–¹å¼ï¼Œåªè¦å…¶ä¸­ä»»æ„ä¸€ä¸ªæ–¹å¼è®¤è¯é€šè¿‡å³å¯\n9.3 æˆæƒç®¡ç†æˆæƒå‘ç”Ÿåœ¨è®¤è¯æˆåŠŸä¹‹åï¼Œé€šè¿‡è®¤è¯å°±å¯ä»¥çŸ¥é“è¯·æ±‚ç”¨æˆ·æ˜¯è°ï¼Œ ç„¶åKubernetesä¼šæ ¹æ®äº‹å…ˆå®šä¹‰çš„æˆæƒç­–ç•¥æ¥å†³å®šç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±ç§°ä¸ºæˆæƒã€‚\næ¯ä¸ªå‘é€åˆ°ApiServerçš„è¯·æ±‚éƒ½å¸¦ä¸Šäº†ç”¨æˆ·å’Œèµ„æºçš„ä¿¡æ¯ï¼šæ¯”å¦‚å‘é€è¯·æ±‚çš„ç”¨æˆ·ã€è¯·æ±‚çš„è·¯å¾„ã€è¯·æ±‚çš„åŠ¨ä½œç­‰ï¼Œæˆæƒå°±æ˜¯æ ¹æ®è¿™äº›ä¿¡æ¯å’Œæˆæƒç­–ç•¥è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç¬¦åˆç­–ç•¥ï¼Œåˆ™è®¤ä¸ºæˆæƒé€šè¿‡ï¼Œå¦åˆ™ä¼šè¿”å›é”™è¯¯ã€‚\nAPI Serverç›®å‰æ”¯æŒä»¥ä¸‹å‡ ç§æˆæƒç­–ç•¥ï¼š\n\nAlwaysDenyï¼šè¡¨ç¤ºæ‹’ç»æ‰€æœ‰è¯·æ±‚ï¼Œä¸€èˆ¬ç”¨äºæµ‹è¯•\nAlwaysAllowï¼šå…è®¸æ¥æ”¶æ‰€æœ‰è¯·æ±‚ï¼Œç›¸å½“äºé›†ç¾¤ä¸éœ€è¦æˆæƒæµç¨‹ï¼ˆKubernetesé»˜è®¤çš„ç­–ç•¥ï¼‰\nABACï¼šåŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼Œè¡¨ç¤ºä½¿ç”¨ç”¨æˆ·é…ç½®çš„æˆæƒè§„åˆ™å¯¹ç”¨æˆ·è¯·æ±‚è¿›è¡ŒåŒ¹é…å’Œæ§åˆ¶\nWebhookï¼šé€šè¿‡è°ƒç”¨å¤–éƒ¨RESTæœåŠ¡å¯¹ç”¨æˆ·è¿›è¡Œæˆæƒ\nNodeï¼šæ˜¯ä¸€ç§ä¸“ç”¨æ¨¡å¼ï¼Œç”¨äºå¯¹kubeletå‘å‡ºçš„è¯·æ±‚è¿›è¡Œè®¿é—®æ§åˆ¶\nRBACï¼šåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆkubeadmå®‰è£…æ–¹å¼ä¸‹çš„é»˜è®¤é€‰é¡¹ï¼‰\n\nRBAC(Role-Based Access Control) åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œä¸»è¦æ˜¯åœ¨æè¿°ä¸€ä»¶äº‹æƒ…ï¼šç»™å“ªäº›å¯¹è±¡æˆäºˆäº†å“ªäº›æƒé™\nå…¶ä¸­æ¶‰åŠåˆ°äº†ä¸‹é¢å‡ ä¸ªæ¦‚å¿µï¼š\n\nå¯¹è±¡ï¼šUserã€Groupsã€ServiceAccount\nè§’è‰²ï¼šä»£è¡¨ç€ä¸€ç»„å®šä¹‰åœ¨èµ„æºä¸Šçš„å¯æ“ä½œåŠ¨ä½œ(æƒé™)çš„é›†åˆ\nç»‘å®šï¼šå°†å®šä¹‰å¥½çš„è§’è‰²è·Ÿç”¨æˆ·ç»‘å®šåœ¨ä¸€èµ·\n\n\nRBACå¼•å…¥äº†4ä¸ªé¡¶çº§èµ„æºå¯¹è±¡ï¼š\n\nRoleã€ClusterRoleï¼šè§’è‰²ï¼Œç”¨äºæŒ‡å®šä¸€ç»„æƒé™\nRoleBindingã€ClusterRoleBindingï¼šè§’è‰²ç»‘å®šï¼Œç”¨äºå°†è§’è‰²ï¼ˆæƒé™ï¼‰èµ‹äºˆç»™å¯¹è±¡\n\nRoleã€ClusterRole\nä¸€ä¸ªè§’è‰²å°±æ˜¯ä¸€ç»„æƒé™çš„é›†åˆï¼Œè¿™é‡Œçš„æƒé™éƒ½æ˜¯è®¸å¯å½¢å¼çš„ï¼ˆç™½åå•ï¼‰ã€‚\n# Roleåªèƒ½å¯¹å‘½åç©ºé—´å†…çš„èµ„æºè¿›è¡Œæˆæƒï¼Œéœ€è¦æŒ‡å®šnameapce\nkind: Role\napiVersion: rbac.authorization.k8s.io&#x2F;v1beta1\nmetadata:\n  namespace: dev\n  name: authorization-role\nrules:\n- apiGroups: [&quot;&quot;]  # æ”¯æŒçš„APIç»„åˆ—è¡¨,&quot;&quot; ç©ºå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ ¸å¿ƒAPIç¾¤\n  resources: [&quot;pods&quot;] # æ”¯æŒçš„èµ„æºå¯¹è±¡åˆ—è¡¨\n  verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;] # å…è®¸çš„å¯¹èµ„æºå¯¹è±¡çš„æ“ä½œæ–¹æ³•åˆ—è¡¨\n\n# ClusterRoleå¯ä»¥å¯¹é›†ç¾¤èŒƒå›´å†…èµ„æºã€è·¨namespacesçš„èŒƒå›´èµ„æºã€éèµ„æºç±»å‹è¿›è¡Œæˆæƒ\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io&#x2F;v1beta1\nmetadata:\n name: authorization-clusterrole\nrules:\n- apiGroups: [&quot;&quot;]\n  resources: [&quot;pods&quot;]\n  verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]\n\néœ€è¦è¯¦ç»†è¯´æ˜çš„æ˜¯ï¼Œrulesä¸­çš„å‚æ•°ï¼š\n\napiGroups: æ”¯æŒçš„APIç»„åˆ—è¡¨\n&quot;&quot;,&quot;apps&quot;, &quot;autoscaling&quot;, &quot;batch&quot;\n\nresourcesï¼šæ”¯æŒçš„èµ„æºå¯¹è±¡åˆ—è¡¨\n&quot;services&quot;, &quot;endpoints&quot;, &quot;pods&quot;,&quot;secrets&quot;,&quot;configmaps&quot;,&quot;crontabs&quot;,&quot;deployments&quot;,&quot;jobs&quot;,\n&quot;nodes&quot;,&quot;rolebindings&quot;,&quot;clusterroles&quot;,&quot;daemonsets&quot;,&quot;replicasets&quot;,&quot;statefulsets&quot;,\n&quot;horizontalpodautoscalers&quot;,&quot;replicationcontrollers&quot;,&quot;cronjobs&quot;\n\nverbsï¼šå¯¹èµ„æºå¯¹è±¡çš„æ“ä½œæ–¹æ³•åˆ—è¡¨\n&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;create&quot;, &quot;update&quot;, &quot;patch&quot;, &quot;delete&quot;, &quot;exec&quot;\n\nRoleBindingã€ClusterRoleBinding\nè§’è‰²ç»‘å®šç”¨æ¥æŠŠä¸€ä¸ªè§’è‰²ç»‘å®šåˆ°ä¸€ä¸ªç›®æ ‡å¯¹è±¡ä¸Šï¼Œç»‘å®šç›®æ ‡å¯ä»¥æ˜¯Userã€Groupæˆ–è€…ServiceAccountã€‚\n# RoleBindingå¯ä»¥å°†åŒä¸€namespaceä¸­çš„subjectç»‘å®šåˆ°æŸä¸ªRoleä¸‹ï¼Œåˆ™æ­¤subjectå³å…·æœ‰è¯¥Roleå®šä¹‰çš„æƒé™\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io&#x2F;v1beta1\nmetadata:\n  name: authorization-role-binding\n  namespace: dev\nsubjects:\n- kind: User\n  name: heima\n  apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: Role\n  name: authorization-role\n  apiGroup: rbac.authorization.k8s.io\n\n# ClusterRoleBindingåœ¨æ•´ä¸ªé›†ç¾¤çº§åˆ«å’Œæ‰€æœ‰namespaceså°†ç‰¹å®šçš„subjectä¸ClusterRoleç»‘å®šï¼Œæˆäºˆæƒé™\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io&#x2F;v1beta1\nmetadata:\n name: authorization-clusterrole-binding\nsubjects:\n- kind: User\n  name: heima\n  apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: ClusterRole\n  name: authorization-clusterrole\n  apiGroup: rbac.authorization.k8s.io\n\nRoleBindingå¼•ç”¨ClusterRoleè¿›è¡Œæˆæƒ\nRoleBindingå¯ä»¥å¼•ç”¨ClusterRoleï¼Œå¯¹å±äºåŒä¸€å‘½åç©ºé—´å†…ClusterRoleå®šä¹‰çš„èµ„æºä¸»ä½“è¿›è¡Œæˆæƒã€‚\nä¸€ç§å¾ˆå¸¸ç”¨çš„åšæ³•å°±æ˜¯ï¼Œé›†ç¾¤ç®¡ç†å‘˜ä¸ºé›†ç¾¤èŒƒå›´é¢„å®šä¹‰å¥½ä¸€ç»„è§’è‰²ï¼ˆClusterRoleï¼‰ï¼Œç„¶ååœ¨å¤šä¸ªå‘½åç©ºé—´ä¸­é‡å¤ä½¿ç”¨è¿™äº›ClusterRoleã€‚è¿™æ ·å¯ä»¥å¤§å¹…æé«˜æˆæƒç®¡ç†å·¥ä½œæ•ˆç‡ï¼Œä¹Ÿä½¿å¾—å„ä¸ªå‘½åç©ºé—´ä¸‹çš„åŸºç¡€æ€§æˆæƒè§„åˆ™ä¸ä½¿ç”¨ä½“éªŒä¿æŒä¸€è‡´ã€‚\n\n# è™½ç„¶authorization-clusterroleæ˜¯ä¸€ä¸ªé›†ç¾¤è§’è‰²ï¼Œä½†æ˜¯å› ä¸ºä½¿ç”¨äº†RoleBinding\n# æ‰€ä»¥heimaåªèƒ½è¯»å–devå‘½åç©ºé—´ä¸­çš„èµ„æº\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io&#x2F;v1beta1\nmetadata:\n  name: authorization-role-binding-ns\n  namespace: dev\nsubjects:\n- kind: User\n  name: heima\n  apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: ClusterRole\n  name: authorization-clusterrole\n  apiGroup: rbac.authorization.k8s.io\n\nå®æˆ˜ï¼šåˆ›å»ºä¸€ä¸ªåªèƒ½ç®¡ç†devç©ºé—´ä¸‹Podsèµ„æºçš„è´¦å·\n\nåˆ›å»ºè´¦å·\n\n# 1) åˆ›å»ºè¯ä¹¦\n[root@k8s-master01 pki]# cd &#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;\n[root@k8s-master01 pki]# (umask 077;openssl genrsa -out devman.key 2048)\n\n# 2) ç”¨apiserverçš„è¯ä¹¦å»ç­¾ç½²\n# 2-1) ç­¾åç”³è¯·ï¼Œç”³è¯·çš„ç”¨æˆ·æ˜¯devman,ç»„æ˜¯devgroup\n[root@k8s-master01 pki]# openssl req -new -key devman.key -out devman.csr -subj &quot;&#x2F;CN&#x3D;devman&#x2F;O&#x3D;devgroup&quot;     \n# 2-2) ç­¾ç½²è¯ä¹¦\n[root@k8s-master01 pki]# openssl x509 -req -in devman.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out devman.crt -days 3650\n\n# 3) è®¾ç½®é›†ç¾¤ã€ç”¨æˆ·ã€ä¸Šä¸‹æ–‡ä¿¡æ¯\n[root@k8s-master01 pki]# kubectl config set-cluster kubernetes --embed-certs&#x3D;true --certificate-authority&#x3D;&#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;ca.crt --server&#x3D;https:&#x2F;&#x2F;192.168.109.100:6443\n\n[root@k8s-master01 pki]# kubectl config set-credentials devman --embed-certs&#x3D;true --client-certificate&#x3D;&#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;devman.crt --client-key&#x3D;&#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;devman.key\n\n[root@k8s-master01 pki]# kubectl config set-context devman@kubernetes --cluster&#x3D;kubernetes --user&#x3D;devman\n\n# åˆ‡æ¢è´¦æˆ·åˆ°devman\n[root@k8s-master01 pki]# kubectl config use-context devman@kubernetes\nSwitched to context &quot;devman@kubernetes&quot;.\n\n# æŸ¥çœ‹devä¸‹podï¼Œå‘ç°æ²¡æœ‰æƒé™\n[root@k8s-master01 pki]# kubectl get pods -n dev\nError from server (Forbidden): pods is forbidden: User &quot;devman&quot; cannot list resource &quot;pods&quot; in API group &quot;&quot; in the namespace &quot;dev&quot;\n\n# åˆ‡æ¢åˆ°adminè´¦æˆ·\n[root@k8s-master01 pki]# kubectl config use-context kubernetes-admin@kubernetes\nSwitched to context &quot;kubernetes-admin@kubernetes&quot;.\n\n2ï¼‰ åˆ›å»ºRoleå’ŒRoleBindingï¼Œä¸ºdevmanç”¨æˆ·æˆæƒ\nkind: Role\napiVersion: rbac.authorization.k8s.io&#x2F;v1beta1\nmetadata:\n  namespace: dev\n  name: dev-role\nrules:\n- apiGroups: [&quot;&quot;]\n  resources: [&quot;pods&quot;]\n  verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]\n  \n---\n\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io&#x2F;v1beta1\nmetadata:\n  name: authorization-role-binding\n  namespace: dev\nsubjects:\n- kind: User\n  name: devman\n  apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: Role\n  name: dev-role\n  apiGroup: rbac.authorization.k8s.io\n\n[root@k8s-master01 pki]# kubectl create -f dev-role.yaml\nrole.rbac.authorization.k8s.io&#x2F;dev-role created\nrolebinding.rbac.authorization.k8s.io&#x2F;authorization-role-binding created\n\n\nåˆ‡æ¢è´¦æˆ·ï¼Œå†æ¬¡éªŒè¯\n\n# åˆ‡æ¢è´¦æˆ·åˆ°devman\n[root@k8s-master01 pki]# kubectl config use-context devman@kubernetes\nSwitched to context &quot;devman@kubernetes&quot;.\n\n# å†æ¬¡æŸ¥çœ‹\n[root@k8s-master01 pki]# kubectl get pods -n dev\nNAME                                 READY   STATUS             RESTARTS   AGE\nnginx-deployment-66cb59b984-8wp2k    1&#x2F;1     Running            0          4d1h\nnginx-deployment-66cb59b984-dc46j    1&#x2F;1     Running            0          4d1h\nnginx-deployment-66cb59b984-thfck    1&#x2F;1     Running            0          4d1h\n\n# ä¸ºäº†ä¸å½±å“åé¢çš„å­¦ä¹ ,åˆ‡å›adminè´¦æˆ·\n[root@k8s-master01 pki]# kubectl config use-context kubernetes-admin@kubernetes\nSwitched to context &quot;kubernetes-admin@kubernetes&quot;.\n\n9.4 å‡†å…¥æ§åˆ¶é€šè¿‡äº†å‰é¢çš„è®¤è¯å’Œæˆæƒä¹‹åï¼Œè¿˜éœ€è¦ç»è¿‡å‡†å…¥æ§åˆ¶å¤„ç†é€šè¿‡ä¹‹åï¼Œapiserveræ‰ä¼šå¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚\nå‡†å…¥æ§åˆ¶æ˜¯ä¸€ä¸ªå¯é…ç½®çš„æ§åˆ¶å™¨åˆ—è¡¨ï¼Œå¯ä»¥é€šè¿‡åœ¨Api-Serverä¸Šé€šè¿‡å‘½ä»¤è¡Œè®¾ç½®é€‰æ‹©æ‰§è¡Œå“ªäº›å‡†å…¥æ§åˆ¶å™¨ï¼š\n--admission-control&#x3D;NamespaceLifecycle,LimitRanger,ServiceAccount,PersistentVolumeLabel,\n                      DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds\n\nåªæœ‰å½“æ‰€æœ‰çš„å‡†å…¥æ§åˆ¶å™¨éƒ½æ£€æŸ¥é€šè¿‡ä¹‹åï¼Œapiserveræ‰æ‰§è¡Œè¯¥è¯·æ±‚ï¼Œå¦åˆ™è¿”å›æ‹’ç»ã€‚\nå½“å‰å¯é…ç½®çš„Admission Controlå‡†å…¥æ§åˆ¶å¦‚ä¸‹ï¼š\n\nAlwaysAdmitï¼šå…è®¸æ‰€æœ‰è¯·æ±‚\nAlwaysDenyï¼šç¦æ­¢æ‰€æœ‰è¯·æ±‚ï¼Œä¸€èˆ¬ç”¨äºæµ‹è¯•\nAlwaysPullImagesï¼šåœ¨å¯åŠ¨å®¹å™¨ä¹‹å‰æ€»å»ä¸‹è½½é•œåƒ\nDenyExecOnPrivilegedï¼šå®ƒä¼šæ‹¦æˆªæ‰€æœ‰æƒ³åœ¨Privileged Containerä¸Šæ‰§è¡Œå‘½ä»¤çš„è¯·æ±‚\nImagePolicyWebhookï¼šè¿™ä¸ªæ’ä»¶å°†å…è®¸åç«¯çš„ä¸€ä¸ªWebhookç¨‹åºæ¥å®Œæˆadmission controllerçš„åŠŸèƒ½ã€‚\nService Accountï¼šå®ç°ServiceAccountå®ç°äº†è‡ªåŠ¨åŒ–\nSecurityContextDenyï¼šè¿™ä¸ªæ’ä»¶å°†ä½¿ç”¨SecurityContextçš„Podä¸­çš„å®šä¹‰å…¨éƒ¨å¤±æ•ˆ\nResourceQuotaï¼šç”¨äºèµ„æºé…é¢ç®¡ç†ç›®çš„ï¼Œè§‚å¯Ÿæ‰€æœ‰è¯·æ±‚ï¼Œç¡®ä¿åœ¨namespaceä¸Šçš„é…é¢ä¸ä¼šè¶…æ ‡\nLimitRangerï¼šç”¨äºèµ„æºé™åˆ¶ç®¡ç†ï¼Œä½œç”¨äºnamespaceä¸Šï¼Œç¡®ä¿å¯¹Podè¿›è¡Œèµ„æºé™åˆ¶\nInitialResourcesï¼šä¸ºæœªè®¾ç½®èµ„æºè¯·æ±‚ä¸é™åˆ¶çš„Podï¼Œæ ¹æ®å…¶é•œåƒçš„å†å²èµ„æºçš„ä½¿ç”¨æƒ…å†µè¿›è¡Œè®¾ç½®\nNamespaceLifecycleï¼šå¦‚æœå°è¯•åœ¨ä¸€ä¸ªä¸å­˜åœ¨çš„namespaceä¸­åˆ›å»ºèµ„æºå¯¹è±¡ï¼Œåˆ™è¯¥åˆ›å»ºè¯·æ±‚å°†è¢«æ‹’ç»ã€‚å½“åˆ é™¤ä¸€ä¸ªnamespaceæ—¶ï¼Œç³»ç»Ÿå°†ä¼šåˆ é™¤è¯¥namespaceä¸­æ‰€æœ‰å¯¹è±¡ã€‚\nDefaultStorageClassï¼šä¸ºäº†å®ç°å…±äº«å­˜å‚¨çš„åŠ¨æ€ä¾›åº”ï¼Œä¸ºæœªæŒ‡å®šStorageClassæˆ–PVçš„PVCå°è¯•åŒ¹é…é»˜è®¤çš„StorageClassï¼Œå°½å¯èƒ½å‡å°‘ç”¨æˆ·åœ¨ç”³è¯·PVCæ—¶æ‰€éœ€äº†è§£çš„åç«¯å­˜å‚¨ç»†èŠ‚\nDefaultTolerationSecondsï¼šè¿™ä¸ªæ’ä»¶ä¸ºé‚£äº›æ²¡æœ‰è®¾ç½®forgiveness tolerationså¹¶å…·æœ‰notready:NoExecuteå’Œunreachable:NoExecuteä¸¤ç§taintsçš„Podè®¾ç½®é»˜è®¤çš„â€œå®¹å¿â€æ—¶é—´ï¼Œä¸º5min\nPodSecurityPolicyï¼šè¿™ä¸ªæ’ä»¶ç”¨äºåœ¨åˆ›å»ºæˆ–ä¿®æ”¹Podæ—¶å†³å®šæ˜¯å¦æ ¹æ®Podçš„security contextå’Œå¯ç”¨çš„PodSecurityPolicyå¯¹Podçš„å®‰å…¨ç­–ç•¥è¿›è¡Œæ§åˆ¶\n\n10. DashBoardä¹‹å‰åœ¨kubernetesä¸­å®Œæˆçš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯é€šè¿‡å‘½ä»¤è¡Œå·¥å…·kubectlå®Œæˆçš„ã€‚å…¶å®ï¼Œä¸ºäº†æä¾›æ›´ä¸°å¯Œçš„ç”¨æˆ·ä½“éªŒï¼Œkubernetesè¿˜å¼€å‘äº†ä¸€ä¸ªåŸºäºwebçš„ç”¨æˆ·ç•Œé¢ï¼ˆDashboardï¼‰ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨Dashboardéƒ¨ç½²å®¹å™¨åŒ–çš„åº”ç”¨ï¼Œè¿˜å¯ä»¥ç›‘æ§åº”ç”¨çš„çŠ¶æ€ï¼Œæ‰§è¡Œæ•…éšœæ’æŸ¥ä»¥åŠç®¡ç†kubernetesä¸­å„ç§èµ„æºã€‚\n10.1 éƒ¨ç½²Dashboard\nä¸‹è½½yamlï¼Œå¹¶è¿è¡ŒDashboard\n\n# ä¸‹è½½yaml\n[root@k8s-master01 ~]# wget  https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;kubernetes&#x2F;dashboard&#x2F;v2.0.0&#x2F;aio&#x2F;deploy&#x2F;recommended.yaml\n\n# ä¿®æ”¹kubernetes-dashboardçš„Serviceç±»å‹\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kubernetes-dashboard\nspec:\n  type: NodePort  # æ–°å¢\n  ports:\n    - port: 443\n      targetPort: 8443\n      nodePort: 30009  # æ–°å¢\n  selector:\n    k8s-app: kubernetes-dashboard\n\n# éƒ¨ç½²\n[root@k8s-master01 ~]# kubectl create -f recommended.yaml\n\n# æŸ¥çœ‹namespaceä¸‹çš„kubernetes-dashboardä¸‹çš„èµ„æº\n[root@k8s-master01 ~]# kubectl get pod,svc -n kubernetes-dashboard\nNAME                                            READY   STATUS    RESTARTS   AGE\npod&#x2F;dashboard-metrics-scraper-c79c65bb7-zwfvw   1&#x2F;1     Running   0          111s\npod&#x2F;kubernetes-dashboard-56484d4c5-z95z5        1&#x2F;1     Running   0          111s\n\nNAME                               TYPE       CLUSTER-IP      EXTERNAL-IP  PORT(S)         AGE\nservice&#x2F;dashboard-metrics-scraper  ClusterIP  10.96.89.218    &lt;none&gt;       8000&#x2F;TCP        111s\nservice&#x2F;kubernetes-dashboard       NodePort   10.104.178.171  &lt;none&gt;       443:30009&#x2F;TCP   111s\n\n2ï¼‰åˆ›å»ºè®¿é—®è´¦æˆ·ï¼Œè·å–token\n# åˆ›å»ºè´¦å·\n[root@k8s-master01-1 ~]# kubectl create serviceaccount dashboard-admin -n kubernetes-dashboard\n\n# æˆæƒ\n[root@k8s-master01-1 ~]# kubectl create clusterrolebinding dashboard-admin-rb --clusterrole&#x3D;cluster-admin --serviceaccount&#x3D;kubernetes-dashboard:dashboard-admin\n\n# è·å–è´¦å·token\n[root@k8s-master01 ~]#  kubectl get secrets -n kubernetes-dashboard | grep dashboard-admin\ndashboard-admin-token-xbqhh        kubernetes.io&#x2F;service-account-token   3      2m35s\n\n[root@k8s-master01 ~]# kubectl describe secrets dashboard-admin-token-xbqhh -n kubernetes-dashboard\nName:         dashboard-admin-token-xbqhh\nNamespace:    kubernetes-dashboard\nLabels:       &lt;none&gt;\nAnnotations:  kubernetes.io&#x2F;service-account.name: dashboard-admin\n              kubernetes.io&#x2F;service-account.uid: 95d84d80-be7a-4d10-a2e0-68f90222d039\n\nType:  kubernetes.io&#x2F;service-account-token\n\nData\n&#x3D;&#x3D;&#x3D;&#x3D;\nnamespace:  20 bytes\ntoken:      eyJhbGciOiJSUzI1NiIsImtpZCI6ImJrYkF4bW5XcDhWcmNGUGJtek5NODFuSXl1aWptMmU2M3o4LTY5a2FKS2cifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4teGJxaGgiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiOTVkODRkODAtYmU3YS00ZDEwLWEyZTAtNjhmOTAyMjJkMDM5Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmVybmV0ZXMtZGFzaGJvYXJkOmRhc2hib2FyZC1hZG1pbiJ9.NAl7e8ZfWWdDoPxkqzJzTB46sK9E8iuJYnUI9vnBaY3Jts7T1g1msjsBnbxzQSYgAG--cV0WYxjndzJY_UWCwaGPrQrt_GunxmOK9AUnzURqm55GR2RXIZtjsWVP2EBatsDgHRmuUbQvTFOvdJB4x3nXcYLN2opAaMqg3rnU2rr-A8zCrIuX_eca12wIp_QiuP3SF-tzpdLpsyRfegTJZl6YnSGyaVkC9id-cxZRb307qdCfXPfCHR_2rt5FVfxARgg_C0e3eFHaaYQO7CitxsnIoIXpOFNAR8aUrmopJyODQIPqBWUehb7FhlU1DCduHnIIXVC_UICZ-MKYewBDLw\nca.crt:     1025 bytes\n\n3ï¼‰é€šè¿‡æµè§ˆå™¨è®¿é—®Dashboardçš„UI\nåœ¨ç™»å½•é¡µé¢ä¸Šè¾“å…¥ä¸Šé¢çš„token\n\nå‡ºç°ä¸‹é¢çš„é¡µé¢ä»£è¡¨æˆåŠŸ\n\n10.2 ä½¿ç”¨DashBoardæœ¬ç« èŠ‚ä»¥Deploymentä¸ºä¾‹æ¼”ç¤ºDashBoardçš„ä½¿ç”¨\næŸ¥çœ‹\né€‰æ‹©æŒ‡å®šçš„å‘½åç©ºé—´devï¼Œç„¶åç‚¹å‡»Deploymentsï¼ŒæŸ¥çœ‹devç©ºé—´ä¸‹çš„æ‰€æœ‰deployment\n\næ‰©ç¼©å®¹\nåœ¨Deploymentä¸Šç‚¹å‡»è§„æ¨¡ï¼Œç„¶åæŒ‡å®šç›®æ ‡å‰¯æœ¬æ•°é‡ï¼Œç‚¹å‡»ç¡®å®š\n\nç¼–è¾‘\nåœ¨Deploymentä¸Šç‚¹å‡»ç¼–è¾‘ï¼Œç„¶åä¿®æ”¹yamlæ–‡ä»¶ï¼Œç‚¹å‡»ç¡®å®š\n\næŸ¥çœ‹Pod\nç‚¹å‡»Pods, æŸ¥çœ‹podsåˆ—è¡¨\n\næ“ä½œPod\né€‰ä¸­æŸä¸ªPodï¼Œå¯ä»¥å¯¹å…¶æ‰§è¡Œæ—¥å¿—ï¼ˆlogsï¼‰ã€è¿›å…¥æ‰§è¡Œï¼ˆexecï¼‰ã€ç¼–è¾‘ã€åˆ é™¤æ“ä½œ\n\n\n\n\n\n\n\n\n\n\nDashboardæä¾›äº†kubectlçš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œè¿™é‡Œä¸å†ä¸€ä¸€æ¼”ç¤º\n","slug":"kubernetes-é»‘é©¬ç¨‹åºå‘˜","date":"2022-04-23T13:10:13.000Z","categories_index":"Kubernetes","tags_index":"kubernetes","author_index":"ITLab"},{"id":"84d66273b8c632d9f270cda34aaa6364","title":"Zookeeperé›†ç¾¤æ­å»ºï¼ˆ3.8.0ï¼‰","content":"Zookeeperé›†ç¾¤æ­å»ºï¼ˆ3.8.0ï¼‰ä½¿ç”¨vagrantåˆ›å»ºä¸‰å°è™šæ‹Ÿæœº\n#æ–°å»ºVagrantfile\nVagrant.configure(&quot;2&quot;) do |config|\n\t(1..3).each do |i|\n\t\tconfig.vm.define &quot;node#&#123;i&#125;&quot; do |node|\n\t\t  node.vm.box &#x3D; &quot;centos&#x2F;7&quot;\n\t\t  node.vm.hostname &#x3D; &quot;node#&#123;i&#125;&quot;\n\t\t  node.vm.provider :virtualbox do |v|\n\t\t\tv.memory &#x3D; 1024\n\t\t\tv.cpus &#x3D; 1\n\t\t  end\n\t\t  node.vm.network :private_network, ip: &quot;192.168.56.10#&#123;i&#125;&quot;\n\t\tend\n\tend\nend\n\n\n\næ‰§è¡Œ\nvagrant up\n\nå¯ä»¥çœ‹åˆ°virtualboxä¸Šå·²ç»åˆ›å»ºå‡ºæ¥ä¸‰ä¸ªè™šæ‹Ÿæœºï¼ˆvagranté»˜è®¤ä½¿ç”¨virtualboxï¼‰ã€‚\n\né€šè¿‡vagrantåˆ›å»ºçš„ä¸‰å°æœºå™¨å¦‚ä¸‹å›¾ï¼š\n\n\n\næœºå™¨åç§°\nIPåœ°å€\n\n\n\nnode1\n192.168.56.101\n\n\nnode2\n192.168.56.102\n\n\nnode3\n192.168.56.103\n\n\nä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤åˆ†åˆ«sshè¿æ¥æœåŠ¡å™¨\nvagrant ssh node1\nvagrant ssh node2\nvagrant ssh node3\n\n\n\nå®‰è£…ä¸€äº›å·¥å…·ç±»ã€zookeeperå¹¶è§£å‹\nsudo yum install wget -y\nwget https:&#x2F;&#x2F;dlcdn.apache.org&#x2F;zookeeper&#x2F;zookeeper-3.8.0&#x2F;apache-zookeeper-3.8.0-bin.tar.gz --no-check-certificate\ntar zxvf apache-zookeeper-3.8.0-bin.tar.gz &amp;&amp; mv apache-zookeeper-3.8.0-bin zookeeper\n\nä¸‰ä¸ªæœºå™¨ä¸Šç»“æ„éƒ½ç±»ä¼¼å¦‚ä¸‹ï¼š\n[vagrant@node2 ~]$ pwd\n&#x2F;home&#x2F;vagrant\n[vagrant@node2 ~]$ ls\napache-zookeeper-3.8.0-bin.tar.gz  zookeeper\n[vagrant@node2 ~]$\n\né…ç½®è¯´æ˜zookeepeerçš„é›†ç¾¤é…ç½®ä¸»è¦å…³æ³¨ä¸‰ç‚¹ã€‚\n1ã€server.xé…ç½®\né»˜è®¤æƒ…å†µä¸‹ï¼Œconfç›®å½•ä¸‹åªæœ‰ä¸€ä¸ª zoo_sample.cfgæ–‡ä»¶ï¼Œéœ€è¦æ‹·è´ä¸€ä»½ä¸º zoo.cfg\n\n2ã€ä¿®æ”¹zoo.cfg\n#è¿™æ˜¯æ•°æ®ç›®å½•ï¼Œé»˜è®¤æ˜¯&#x2F;tmp&#x2F;zookeeperï¼Œè¿™æ˜¯ä¸å…è®¸çš„ï¼Œ&#x2F;tmpæ˜¯ä¸´æ—¶ç›®å½•ï¼Œéœ€è¦ä¿®æ”¹ä¸ºè‡ªå·±çš„è·¯å¾„ï¼Œæˆ‘è¿™é‡Œä¿®æ”¹ä¸ºè‡ªå·±çš„&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;data,é»˜è®¤æ²¡æœ‰dataç›®å½•ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºã€‚\ndataDir&#x3D;&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;data\n#å› ä¸ºæ˜¯æœ‰ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œserver.xçš„xæ˜¯zooæœåŠ¡å™¨çš„æ ‡å¿—ï¼Œéœ€è¦äºmyidçš„å†…å®¹å¯¹åº”ï¼Œæ¥ä¸‹æ¥ä¼šè¯´myidã€‚é¡ºåºæ’åˆ—å°±å¯ä»¥äº†ï¼Œç­‰å·åé¢çš„å†…å®¹æ ¼å¼æ˜¯A:B:C  Aä»£è¡¨çš„æ˜¯æœåŠ¡å™¨çš„åœ°å€ï¼Œ å¯ä»¥æ˜¯hostnameï¼Œä¹Ÿå¯ä»¥æ˜¯ipåœ°å€ï¼Œä½¿ç”¨hostnameéœ€è¦ä¿®æ”¹æ¯ä¸ªæœåŠ¡å™¨çš„&#x2F;etc&#x2F;hostsæ–‡ä»¶ï¼Œä½¿ç”¨ipåˆ™ä¸ç”¨ï¼Œ æˆ‘ä½¿ç”¨çš„æ˜¯ipåœ°å€ã€‚ä¸ç®¡ä½¿ç”¨hostnameè¿˜æ˜¯ipéƒ½è¦ä¿è¯æœåŠ¡å™¨ä¹‹å‰å¯ä»¥é€šä¿¡ã€‚Bä»£è¡¨é€‰ä¸¾Leaderçš„ç«¯å£ï¼Œé»˜è®¤2888ï¼Œ Cä»£è¡¨é›†ç¾¤å†…æœºå™¨é€šè®¯ä½¿ç”¨ï¼ˆLeaderç›‘å¬æ­¤ç«¯å£ï¼‰é»˜è®¤3888ï¼Œä¸ç”¨ä¿®æ”¹ï¼Œå¦‚æœä½ åœ¨ä¸€ä¸ªç”µè„‘ä¸Šæ¨¡æ‹Ÿä¼ªé›†ç¾¤ï¼Œåˆ™éœ€è¦ä¿®æ”¹ï¼Œå¦åˆ™ç«¯å£å†²çªã€‚\nserver.1&#x3D;192.168.56.101:2888:3888\nserver.2&#x3D;192.168.56.102:2888:3888\nserver.3&#x3D;192.168.56.103:2888:3888\n\nä¸‰å°æœºå™¨ä¿®æ”¹å®Œæ¯•åçš„zoo.cfgæ–‡ä»¶å†…å®¹éƒ½æ˜¯\n[vagrant@node1 conf]$ cat zoo.cfg\n# The number of milliseconds of each tick\ntickTime&#x3D;2000\n# The number of ticks that the initial\n# synchronization phase can take\ninitLimit&#x3D;10\n# The number of ticks that can pass between\n# sending a request and getting an acknowledgement\nsyncLimit&#x3D;5\n# the directory where the snapshot is stored.\n# do not use &#x2F;tmp for storage, &#x2F;tmp here is just\n# example sakes.\n#dataDir&#x3D;&#x2F;tmp&#x2F;zookeeper\n# the port at which the clients will connect\nclientPort&#x3D;2181\n# the maximum number of client connections.\n# increase this if you need to handle more clients\n#maxClientCnxns&#x3D;60\n#\n# Be sure to read the maintenance section of the\n# administrator guide before turning on autopurge.\n#\n# https:&#x2F;&#x2F;zookeeper.apache.org&#x2F;doc&#x2F;current&#x2F;zookeeperAdmin.html#sc_maintenance\n#\n# The number of snapshots to retain in dataDir\n#autopurge.snapRetainCount&#x3D;3\n# Purge task interval in hours\n# Set to &quot;0&quot; to disable auto purge feature\n#autopurge.purgeInterval&#x3D;1\n\n## Metrics Providers\n#\n# https:&#x2F;&#x2F;prometheus.io Metrics Exporter\n#metricsProvider.className&#x3D;org.apache.zookeeper.metrics.prometheus.PrometheusMetricsProvider\n#metricsProvider.httpHost&#x3D;0.0.0.0\n#metricsProvider.httpPort&#x3D;7000\n#metricsProvider.exportJvmInfo&#x3D;true\n#è¿™æ˜¯æ•°æ®ç›®å½•ï¼Œé»˜è®¤æ˜¯&#x2F;tmp&#x2F;zookeeperï¼Œè¿™æ˜¯ä¸å…è®¸çš„ï¼Œ&#x2F;tmpæ˜¯ä¸´æ—¶ç›®å½•ï¼Œéœ€è¦ä¿®æ”¹ä¸ºè‡ªå·±çš„è·¯å¾„ï¼Œæˆ‘è¿™é‡Œä¿®æ”¹ä¸ºè‡ªå·±çš„&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;data,é»˜è®¤æ²¡æœ‰dataç›®å½•ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºã€‚\ndataDir&#x3D;&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;data\n#å› ä¸ºæ˜¯æœ‰ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥é¡ºåºæ’åˆ—å°±å¯ä»¥äº†ï¼Œnode1å’Œnode2å’Œnode3æ˜¯æˆ‘çš„hoståå­—ï¼Œæ­¤å¤„ä¹Ÿå¯ä»¥ä½¿ç”¨æ¯ä¸ªæœåŠ¡å™¨çš„ipåœ°å€ï¼Œä½¿ç”¨hostnameéœ€è¦ä¿®æ”¹æ¯ä¸ªæœåŠ¡å™¨çš„&#x2F;etc&#x2F;hostsæ–‡ä»¶ï¼Œä½¿ç”¨ipåˆ™ä¸ç”¨ã€‚ä¸ç®¡ä½¿ç”¨hostnameè¿˜æ˜¯ipéƒ½è¦ä¿è¯æœåŠ¡å™¨ä¹‹å‰å¯ä»¥é€šä¿¡ã€‚2888å’Œ3888æ˜¯zookeeperå†…éƒ¨é€šä¿¡æ¥å£ï¼Œä¸ç”¨ä¿®æ”¹ï¼Œå¦‚æœä½ åœ¨ä¸€ä¸ªç”µè„‘ä¸Šæ¨¡æ‹Ÿä¼ªé›†ç¾¤ï¼Œåˆ™éœ€è¦ä¿®æ”¹ï¼Œå¦åˆ™ç«¯å£å†²çªã€‚\nserver.1&#x3D;192.168.56.101:2888:3888\nserver.2&#x3D;192.168.56.102:2888:3888\nserver.3&#x3D;192.168.56.103:2888:3888\n\n\n\n3ã€éœ€è¦åœ¨æ¯ä¸ªæœºå™¨çš„dataDirç›®å½•ä¸‹åˆ›å»ºmyidæ–‡ä»¶ã€‚é‡Œé¢çš„å†…å®¹å¯¹åº”çš„å°±æ˜¯server.xçš„xï¼Œæ¯”å¦‚node1çš„myidå†…å®¹æ˜¯1ï¼Œnode2çš„myidå†…å®¹æ˜¯2ï¼Œnode3çš„myidå†…å®¹æ˜¯3\n#åœ¨node1è™šæ‹Ÿæœºçš„&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;dataç›®å½•ä¸Šæ‰§è¡Œ\n[vagrant@node1 data]$ pwd\n&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;data\n[vagrant@node1 data]$ echo &quot;1&quot; &gt; myid\n#åœ¨node2è™šæ‹Ÿæœºçš„&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;dataç›®å½•ä¸Šæ‰§è¡Œ\n[vagrant@node2 data]$ pwd\n&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;data\n[vagrant@node2 data]$ echo &quot;2&quot; &gt; myid\n#åœ¨node3è™šæ‹Ÿæœºçš„&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;dataç›®å½•ä¸Šæ‰§è¡Œ\n[vagrant@node3 data]$ pwd\n&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;data\n[vagrant@node3 data]$ echo &quot;3&quot; &gt; myid\n\n4ã€zookeeperéœ€è¦jdkçš„æ”¯æŒ\nsudo yum install java-1.8.0-openjdk -y\n\n\n\nå¯åŠ¨åˆ†åˆ«åœ¨node1ã€node2ã€node3ä¸Šè¿›å…¥zookeeperç›®å½•åï¼Œå¯åŠ¨\nbin&#x2F;zkServer.sh status\n\nè¿™é‡Œéœ€è¦æ³¨æ„ï¼Œç¬¬ä¸€å°å¯åŠ¨çš„æ—¶å€™ï¼Œå¯èƒ½æç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼Œä¸ç”¨ç®¡\n[vagrant@node1 zookeeper]$ bin&#x2F;zkServer.sh status\n&#x2F;usr&#x2F;bin&#x2F;java\nZooKeeper JMX enabled by default\nUsing config: &#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;conf&#x2F;zoo.cfg\nClient port found: 2181. Client address: localhost. Client SSL: false.\nError contacting service. It is probably not running.\n\nè¿™æ˜¯å› ä¸ºè¦è·Ÿå…¶ä»–ä¸¤ä¸ªæœåŠ¡å™¨é€šä¿¡ï¼Œä½†æ˜¯å…¶ä»–ä¸¤å°çš„zookeeperè¿˜æœªå¯åŠ¨ï¼Œå¿½ç•¥ã€‚\nä¸‰å°æœåŠ¡å™¨å¯åŠ¨å®Œæ¯•åï¼ŒæŸ¥çœ‹çŠ¶æ€ã€‚\n#node1æœåŠ¡å™¨\n[vagrant@node1 zookeeper]$ bin&#x2F;zkServer.sh status\n&#x2F;usr&#x2F;bin&#x2F;java\nZooKeeper JMX enabled by default\nUsing config: &#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;conf&#x2F;zoo.cfg\nClient port found: 2181. Client address: localhost. Client SSL: false.\nMode: follower\n#node2æœåŠ¡å™¨\n[vagrant@node2 zookeeper]$ bin&#x2F;zkServer.sh status\n&#x2F;usr&#x2F;bin&#x2F;java\nZooKeeper JMX enabled by default\nUsing config: &#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;conf&#x2F;zoo.cfg\nClient port found: 2181. Client address: localhost. Client SSL: false.\nMode: leader\n#node3æœåŠ¡å™¨\n[vagrant@node3 zookeeper]$ bin&#x2F;zkServer.sh status\n&#x2F;usr&#x2F;bin&#x2F;java\nZooKeeper JMX enabled by default\nUsing config: &#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;conf&#x2F;zoo.cfg\nClient port found: 2181. Client address: localhost. Client SSL: false.\nMode: follower\n\næµ‹è¯•ä½¿ç”¨zkCli.sh è¿æ¥leader(node1æœåŠ¡å™¨)ï¼Œåˆ›å»ºä¸€ä¸ªå«åštestçš„nodeã€‚\n[vagrant@node2 zookeeper]$ bin&#x2F;zkCli.sh\n&#x2F;usr&#x2F;bin&#x2F;java\nConnecting to localhost:2181\n2022-03-30 04:18:52,326 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:zookeeper.version&#x3D;3.8.0-5a02a05eddb59aee6ac762f7ea82e92a68eb9c0f, built on 2022-02-25 08:49 UTC\n2022-03-30 04:18:52,327 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:host.name&#x3D;node2\n2022-03-30 04:18:52,328 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:java.version&#x3D;1.8.0_322\n2022-03-30 04:18:52,328 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:java.vendor&#x3D;Red Hat, Inc.\n2022-03-30 04:18:52,328 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:java.home&#x3D;&#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;java-1.8.0-openjdk-1.8.0.322.b06-1.el7_9.x86_64&#x2F;jre\n2022-03-30 04:18:52,328 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:java.class.path&#x3D;&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;zookeeper-server&#x2F;target&#x2F;classes:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;build&#x2F;classes:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;zookeeper-server&#x2F;target&#x2F;lib&#x2F;*.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;build&#x2F;lib&#x2F;*.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;zookeeper-prometheus-metrics-3.8.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;zookeeper-jute-3.8.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;zookeeper-3.8.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;snappy-java-1.1.7.7.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;slf4j-api-1.7.30.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;simpleclient_servlet-0.9.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;simpleclient_hotspot-0.9.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;simpleclient_common-0.9.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;simpleclient-0.9.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-transport-native-unix-common-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-transport-native-epoll-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-transport-classes-epoll-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-transport-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-tcnative-classes-2.0.48.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-tcnative-2.0.48.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-resolver-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-handler-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-common-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-codec-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-buffer-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;metrics-core-4.1.12.1.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;logback-core-1.2.10.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;logback-classic-1.2.10.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jline-2.14.6.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jetty-util-ajax-9.4.43.v20210629.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jetty-util-9.4.43.v20210629.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jetty-servlet-9.4.43.v20210629.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jetty-server-9.4.43.v20210629.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jetty-security-9.4.43.v20210629.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jetty-io-9.4.43.v20210629.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jetty-http-9.4.43.v20210629.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;javax.servlet-api-3.1.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jackson-databind-2.13.1.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jackson-core-2.13.1.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jackson-annotations-2.13.1.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;commons-io-2.11.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;commons-cli-1.4.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;audience-annotations-0.12.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;zookeeper-*.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;zookeeper-server&#x2F;src&#x2F;main&#x2F;resources&#x2F;lib&#x2F;*.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;conf:\n2022-03-30 04:18:52,328 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:java.library.path&#x3D;&#x2F;usr&#x2F;java&#x2F;packages&#x2F;lib&#x2F;amd64:&#x2F;usr&#x2F;lib64:&#x2F;lib64:&#x2F;lib:&#x2F;usr&#x2F;lib\n2022-03-30 04:18:52,328 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:java.io.tmpdir&#x3D;&#x2F;tmp\n2022-03-30 04:18:52,353 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:java.compiler&#x3D;&lt;NA&gt;\n2022-03-30 04:18:52,353 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:os.name&#x3D;Linux\n2022-03-30 04:18:52,353 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:os.arch&#x3D;amd64\n2022-03-30 04:18:52,353 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:os.version&#x3D;3.10.0-1127.el7.x86_64\n2022-03-30 04:18:52,353 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:user.name&#x3D;vagrant\n2022-03-30 04:18:52,354 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:user.home&#x3D;&#x2F;home&#x2F;vagrant\n2022-03-30 04:18:52,354 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:user.dir&#x3D;&#x2F;home&#x2F;vagrant&#x2F;zookeeper\n2022-03-30 04:18:52,354 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:os.memory.free&#x3D;10MB\n2022-03-30 04:18:52,354 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:os.memory.max&#x3D;247MB\n2022-03-30 04:18:52,354 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:os.memory.total&#x3D;15MB\n2022-03-30 04:18:52,357 [myid:] - INFO  [main:o.a.z.ZooKeeper@637] - Initiating client connection, connectString&#x3D;localhost:2181 sessionTimeout&#x3D;30000 watcher&#x3D;org.apache.zookeeper.ZooKeeperMain$MyWatcher@7c16905e\n2022-03-30 04:18:52,361 [myid:] - INFO  [main:o.a.z.c.X509Util@77] - Setting -D jdk.tls.rejectClientInitiatedRenegotiation&#x3D;true to disable client-initiated TLS renegotiation\n2022-03-30 04:18:52,365 [myid:] - INFO  [main:o.a.z.ClientCnxnSocket@239] - jute.maxbuffer value is 1048575 Bytes\n2022-03-30 04:18:52,376 [myid:] - INFO  [main:o.a.z.ClientCnxn@1732] - zookeeper.request.timeout value is 0. feature enabled&#x3D;false\n2022-03-30 04:18:52,380 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):o.a.z.ClientCnxn$SendThread@1171] - Opening socket connection to server localhost&#x2F;0:0:0:0:0:0:0:1:2181.\n2022-03-30 04:18:52,381 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):o.a.z.ClientCnxn$SendThread@1173] - SASL config status: Will not attempt to authenticate using SASL (unknown error)\n2022-03-30 04:18:52,385 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):o.a.z.ClientCnxn$SendThread@1005] - Socket connection established, initiating session, client: &#x2F;0:0:0:0:0:0:0:1:37554, server: localhost&#x2F;0:0:0:0:0:0:0:1:2181\nWelcome to ZooKeeper!\n2022-03-30 04:18:52,403 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):o.a.z.ClientCnxn$SendThread@1444] - Session establishment complete on server localhost&#x2F;0:0:0:0:0:0:0:1:2181, session id &#x3D; 0x20000309d020003, negotiated timeout &#x3D; 30000\n\nWATCHER::\n\nWatchedEvent state:SyncConnected type:None path:null\nJLine support is enabled\n[zk: localhost:2181(CONNECTED) 0] create &#x2F;test\nCreated &#x2F;test\n[zk: localhost:2181(CONNECTED) 1]\n\næŸ¥çœ‹å…¶ä»–æœåŠ¡å™¨æ˜¯å¦æœ‰testè¿™ä¸ªnodeã€‚\nnode2æœåŠ¡å™¨\n[vagrant@node1 zookeeper]$ bin&#x2F;zkCli.sh\n&#x2F;usr&#x2F;bin&#x2F;java\nConnecting to localhost:2181\n2022-03-30 04:22:55,364 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:zookeeper.version&#x3D;3.8.0-5a02a05eddb59aee6ac762f7ea82e92a68eb9c0f, built on 2022-02-25 08:49 UTC\n2022-03-30 04:22:55,366 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:host.name&#x3D;node1\n2022-03-30 04:22:55,366 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:java.version&#x3D;1.8.0_322\n2022-03-30 04:22:55,367 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:java.vendor&#x3D;Red Hat, Inc.\n2022-03-30 04:22:55,367 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:java.home&#x3D;&#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;java-1.8.0-openjdk-1.8.0.322.b06-1.el7_9.x86_64&#x2F;jre\n2022-03-30 04:22:55,367 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:java.class.path&#x3D;&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;zookeeper-server&#x2F;target&#x2F;classes:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;build&#x2F;classes:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;zookeeper-server&#x2F;target&#x2F;lib&#x2F;*.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;build&#x2F;lib&#x2F;*.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;zookeeper-prometheus-metrics-3.8.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;zookeeper-jute-3.8.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;zookeeper-3.8.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;snappy-java-1.1.7.7.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;slf4j-api-1.7.30.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;simpleclient_servlet-0.9.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;simpleclient_hotspot-0.9.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;simpleclient_common-0.9.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;simpleclient-0.9.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-transport-native-unix-common-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-transport-native-epoll-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-transport-classes-epoll-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-transport-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-tcnative-classes-2.0.48.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-tcnative-2.0.48.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-resolver-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-handler-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-common-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-codec-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-buffer-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;metrics-core-4.1.12.1.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;logback-core-1.2.10.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;logback-classic-1.2.10.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jline-2.14.6.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jetty-util-ajax-9.4.43.v20210629.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jetty-util-9.4.43.v20210629.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jetty-servlet-9.4.43.v20210629.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jetty-server-9.4.43.v20210629.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jetty-security-9.4.43.v20210629.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jetty-io-9.4.43.v20210629.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jetty-http-9.4.43.v20210629.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;javax.servlet-api-3.1.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jackson-databind-2.13.1.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jackson-core-2.13.1.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jackson-annotations-2.13.1.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;commons-io-2.11.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;commons-cli-1.4.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;audience-annotations-0.12.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;zookeeper-*.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;zookeeper-server&#x2F;src&#x2F;main&#x2F;resources&#x2F;lib&#x2F;*.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;conf:.:&#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;java-1.8.0-openjdk-1.8.0.322.b06-1.el7_9.x86_64&#x2F;lib&#x2F;dt.jar:&#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;java-1.8.0-openjdk-1.8.0.322.b06-1.el7_9.x86_64&#x2F;lib&#x2F;tools.jar\n2022-03-30 04:22:55,367 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:java.library.path&#x3D;&#x2F;usr&#x2F;java&#x2F;packages&#x2F;lib&#x2F;amd64:&#x2F;usr&#x2F;lib64:&#x2F;lib64:&#x2F;lib:&#x2F;usr&#x2F;lib\n2022-03-30 04:22:55,367 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:java.io.tmpdir&#x3D;&#x2F;tmp\n2022-03-30 04:22:55,367 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:java.compiler&#x3D;&lt;NA&gt;\n2022-03-30 04:22:55,367 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:os.name&#x3D;Linux\n2022-03-30 04:22:55,367 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:os.arch&#x3D;amd64\n2022-03-30 04:22:55,367 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:os.version&#x3D;3.10.0-1127.el7.x86_64\n2022-03-30 04:22:55,367 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:user.name&#x3D;vagrant\n2022-03-30 04:22:55,367 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:user.home&#x3D;&#x2F;home&#x2F;vagrant\n2022-03-30 04:22:55,367 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:user.dir&#x3D;&#x2F;home&#x2F;vagrant&#x2F;zookeeper\n2022-03-30 04:22:55,367 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:os.memory.free&#x3D;10MB\n2022-03-30 04:22:55,367 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:os.memory.max&#x3D;247MB\n2022-03-30 04:22:55,368 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:os.memory.total&#x3D;15MB\n2022-03-30 04:22:55,370 [myid:] - INFO  [main:o.a.z.ZooKeeper@637] - Initiating client connection, connectString&#x3D;localhost:2181 sessionTimeout&#x3D;30000 watcher&#x3D;org.apache.zookeeper.ZooKeeperMain$MyWatcher@7c16905e\n2022-03-30 04:22:55,374 [myid:] - INFO  [main:o.a.z.c.X509Util@77] - Setting -D jdk.tls.rejectClientInitiatedRenegotiation&#x3D;true to disable client-initiated TLS renegotiation\n2022-03-30 04:22:55,378 [myid:] - INFO  [main:o.a.z.ClientCnxnSocket@239] - jute.maxbuffer value is 1048575 Bytes\n2022-03-30 04:22:55,386 [myid:] - INFO  [main:o.a.z.ClientCnxn@1732] - zookeeper.request.timeout value is 0. feature enabled&#x3D;false\n2022-03-30 04:22:55,397 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):o.a.z.ClientCnxn$SendThread@1171] - Opening socket connection to server localhost&#x2F;127.0.0.1:2181.\n2022-03-30 04:22:55,397 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):o.a.z.ClientCnxn$SendThread@1173] - SASL config status: Will not attempt to authenticate using SASL (unknown error)\n2022-03-30 04:22:55,402 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):o.a.z.ClientCnxn$SendThread@1005] - Socket connection established, initiating session, client: &#x2F;127.0.0.1:52908, server: localhost&#x2F;127.0.0.1:2181\nWelcome to ZooKeeper!\nJLine support is enabled\n2022-03-30 04:22:55,471 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):o.a.z.ClientCnxn$SendThread@1444] - Session establishment complete on server localhost&#x2F;127.0.0.1:2181, session id &#x3D; 0x1000031544f0000, negotiated timeout &#x3D; 30000\n\nWATCHER::\n\nWatchedEvent state:SyncConnected type:None path:null\n[zk: localhost:2181(CONNECTED) 0] ls &#x2F;\n[test, zookeeper]\n[zk: localhost:2181(CONNECTED) 1]\n\n\n\n\nnode3æœåŠ¡å™¨\n[vagrant@node3 zookeeper]$ bin&#x2F;zkCli.sh\n&#x2F;usr&#x2F;bin&#x2F;java\nConnecting to localhost:2181\n2022-03-30 04:20:15,221 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:zookeeper.version&#x3D;3.8.0-5a02a05eddb59aee6ac762f7ea82e92a68eb9c0f, built on 2022-02-25 08:49 UTC\n2022-03-30 04:20:15,223 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:host.name&#x3D;node3\n2022-03-30 04:20:15,223 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:java.version&#x3D;1.8.0_322\n2022-03-30 04:20:15,223 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:java.vendor&#x3D;Red Hat, Inc.\n2022-03-30 04:20:15,223 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:java.home&#x3D;&#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;java-1.8.0-openjdk-1.8.0.322.b06-1.el7_9.x86_64&#x2F;jre\n2022-03-30 04:20:15,223 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:java.class.path&#x3D;&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;zookeeper-server&#x2F;target&#x2F;classes:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;build&#x2F;classes:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;zookeeper-server&#x2F;target&#x2F;lib&#x2F;*.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;build&#x2F;lib&#x2F;*.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;zookeeper-prometheus-metrics-3.8.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;zookeeper-jute-3.8.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;zookeeper-3.8.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;snappy-java-1.1.7.7.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;slf4j-api-1.7.30.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;simpleclient_servlet-0.9.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;simpleclient_hotspot-0.9.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;simpleclient_common-0.9.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;simpleclient-0.9.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-transport-native-unix-common-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-transport-native-epoll-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-transport-classes-epoll-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-transport-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-tcnative-classes-2.0.48.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-tcnative-2.0.48.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-resolver-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-handler-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-common-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-codec-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;netty-buffer-4.1.73.Final.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;metrics-core-4.1.12.1.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;logback-core-1.2.10.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;logback-classic-1.2.10.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jline-2.14.6.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jetty-util-ajax-9.4.43.v20210629.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jetty-util-9.4.43.v20210629.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jetty-servlet-9.4.43.v20210629.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jetty-server-9.4.43.v20210629.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jetty-security-9.4.43.v20210629.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jetty-io-9.4.43.v20210629.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jetty-http-9.4.43.v20210629.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;javax.servlet-api-3.1.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jackson-databind-2.13.1.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jackson-core-2.13.1.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;jackson-annotations-2.13.1.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;commons-io-2.11.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;commons-cli-1.4.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;lib&#x2F;audience-annotations-0.12.0.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;zookeeper-*.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;zookeeper-server&#x2F;src&#x2F;main&#x2F;resources&#x2F;lib&#x2F;*.jar:&#x2F;home&#x2F;vagrant&#x2F;zookeeper&#x2F;bin&#x2F;..&#x2F;conf:\n2022-03-30 04:20:15,223 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:java.library.path&#x3D;&#x2F;usr&#x2F;java&#x2F;packages&#x2F;lib&#x2F;amd64:&#x2F;usr&#x2F;lib64:&#x2F;lib64:&#x2F;lib:&#x2F;usr&#x2F;lib\n2022-03-30 04:20:15,223 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:java.io.tmpdir&#x3D;&#x2F;tmp\n2022-03-30 04:20:15,224 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:java.compiler&#x3D;&lt;NA&gt;\n2022-03-30 04:20:15,224 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:os.name&#x3D;Linux\n2022-03-30 04:20:15,224 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:os.arch&#x3D;amd64\n2022-03-30 04:20:15,224 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:os.version&#x3D;3.10.0-1127.el7.x86_64\n2022-03-30 04:20:15,224 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:user.name&#x3D;vagrant\n2022-03-30 04:20:15,224 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:user.home&#x3D;&#x2F;home&#x2F;vagrant\n2022-03-30 04:20:15,224 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:user.dir&#x3D;&#x2F;home&#x2F;vagrant&#x2F;zookeeper\n2022-03-30 04:20:15,224 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:os.memory.free&#x3D;10MB\n2022-03-30 04:20:15,224 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:os.memory.max&#x3D;247MB\n2022-03-30 04:20:15,224 [myid:] - INFO  [main:o.a.z.Environment@98] - Client environment:os.memory.total&#x3D;15MB\n2022-03-30 04:20:15,227 [myid:] - INFO  [main:o.a.z.ZooKeeper@637] - Initiating client connection, connectString&#x3D;localhost:2181 sessionTimeout&#x3D;30000 watcher&#x3D;org.apache.zookeeper.ZooKeeperMain$MyWatcher@7c16905e\n2022-03-30 04:20:15,231 [myid:] - INFO  [main:o.a.z.c.X509Util@77] - Setting -D jdk.tls.rejectClientInitiatedRenegotiation&#x3D;true to disable client-initiated TLS renegotiation\n2022-03-30 04:20:15,235 [myid:] - INFO  [main:o.a.z.ClientCnxnSocket@239] - jute.maxbuffer value is 1048575 Bytes\n2022-03-30 04:20:15,249 [myid:] - INFO  [main:o.a.z.ClientCnxn@1732] - zookeeper.request.timeout value is 0. feature enabled&#x3D;false\n2022-03-30 04:20:15,254 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):o.a.z.ClientCnxn$SendThread@1171] - Opening socket connection to server localhost&#x2F;0:0:0:0:0:0:0:1:2181.\n2022-03-30 04:20:15,255 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):o.a.z.ClientCnxn$SendThread@1173] - SASL config status: Will not attempt to authenticate using SASL (unknown error)\n2022-03-30 04:20:15,259 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):o.a.z.ClientCnxn$SendThread@1005] - Socket connection established, initiating session, client: &#x2F;0:0:0:0:0:0:0:1:37874, server: localhost&#x2F;0:0:0:0:0:0:0:1:2181\nWelcome to ZooKeeper!\nJLine support is enabled\n2022-03-30 04:20:15,338 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):o.a.z.ClientCnxn$SendThread@1444] - Session establishment complete on server localhost&#x2F;0:0:0:0:0:0:0:1:2181, session id &#x3D; 0x300003148b90000, negotiated timeout &#x3D; 30000\n\nWATCHER::\n\nWatchedEvent state:SyncConnected type:None path:null\n[zk: localhost:2181(CONNECTED) 0] ls &#x2F;\n[test, zookeeper]\n[zk: localhost:2181(CONNECTED) 1]\n\nå¯ä»¥çœ‹åˆ°node2å’Œnode3æœåŠ¡å™¨ä¸Šçš„zookeeperä¹Ÿæœ‰&#x2F;testè¿™ä¸ªnodeã€‚è¯´æ˜é›†ç¾¤æ²¡é—®é¢˜ã€‚\nWEBUIæµè§ˆä½¿ç”¨dockeréƒ¨ç½²webUI\ndocker run -d -p *080:8080 -e ZK_DEFAULT_NODE&#x3D;192.168.56.102:2181&#x2F; -e USER&#x3D;zkweb -e PASSWORD&#x3D;zkweb --name zk-web -t tobilg&#x2F;zookeeper-webui\n\nè®¿é—®\n\n\n","slug":"Zookeeperé›†ç¾¤æ­å»ºï¼ˆ3-8-0ï¼‰","date":"2022-04-23T13:01:21.000Z","categories_index":"Zookeeper","tags_index":"Zookeeper cluster,3.8.0","author_index":"ITLab"},{"id":"63b66b84785bad4685f03c761bd73fdb","title":"spring-authorization-serveræˆæƒæœåŠ¡å™¨Oauth2.1ï¼ˆæ–°ç‰ˆï¼‰","content":"\n\n\n\n\n\n\n\n\nè¯´æ˜\nspring Security5 æ—¶å€™ï¼Œä¸æ¨èä½¿ç”¨spring-security-oauth2ã€‚æä¾›äº†æ–°çš„æ–¹æ³•ï¼ˆhttps://github.com/spring-projects/spring-authorization-serverï¼‰\n\néœ€è¦æ³¨æ„çš„æ˜¯è¯¥æ–¹å¼æ”¯æŒçš„å¹¶ä¸æ˜¯oauth2ï¼Œè€Œæ˜¯oauth2.1ï¼Œä»€ä¹ˆæ˜¯oauth2.1å‘¢ï¼Ÿæ¨èæŸ¥çœ‹ï¼šhttps://oauth.net/2.1/å’Œhttps://aaronparecki.com/2019/12/12/21/its-time-for-oauth-2-dot-1ã€‚\næ‘˜å–oauth2.netç½‘ç«™ä¸Šå¯¹æ¯”oauth2çš„è¯´æ˜ï¼š\nä¸»è¦åŒºåˆ«ï¼ˆä»¥ä¸‹ä½¿ç”¨ç¿»è¯‘è½¯ä»¶ç¿»è¯‘ï¼Œå¤§è‡´æ„æ€æ²¡é”™ï¼‰\n\nä½¿ç”¨æˆæƒä»£ç æµçš„æ‰€æœ‰ OAuth å®¢æˆ·ç«¯éƒ½éœ€è¦ PKCE\nå¿…é¡»ä½¿ç”¨ç²¾ç¡®çš„å­—ç¬¦ä¸²åŒ¹é…æ¥æ¯”è¾ƒé‡å®šå‘ URI\nresponse_type=tokenæœ¬è§„èŒƒä¸­çœç•¥äº†éšå¼æˆæƒ ( )\næœ¬è§„èŒƒä¸­çœç•¥äº†èµ„æºæ‰€æœ‰è€…å¯†ç å‡­è¯æˆæƒ\nä¸è®°åä»¤ç‰Œç”¨æ³•çœç•¥äº†åœ¨ URI çš„æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­ä½¿ç”¨ä¸è®°åä»¤ç‰Œ\nå…¬å…±å®¢æˆ·ç«¯çš„åˆ·æ–°ä»¤ç‰Œå¿…é¡»å—å‘é€æ–¹é™åˆ¶æˆ–ä¸€æ¬¡æ€§ä½¿ç”¨\n\n\n\n\n\n\n\n\n\n\nå®˜æ–¹demoè¿è¡Œ\næ ¹æ®https://github.com/spring-projects/spring-authorization-serverä¸Šè¯´æ˜ä½¿ç”¨gradleå‘½ä»¤è¿è¡Œå³å¯ã€‚\n\n\n\n\n\n\n\n\n\n\næ‹·è´å®˜æ–¹ä»£ç ï¼ˆåŸºæœ¬æœªåšæ›´æ”¹ï¼‰ï¼Œä½¿ç”¨postmanè¿›è¡Œæµ‹è¯•ã€‚\n    ä»£ç ä½ç½®ï¼šauthorization-server\n\nâ€‹\t\t\nauthorization-server\nâ”œâ”€â”€ README.md\nâ”œâ”€â”€ authorization-server.iml\nâ”œâ”€â”€ pom.xml\nâ””â”€â”€ src\n    â”œâ”€â”€ main\n    â”‚   â”œâ”€â”€ java\n    â”‚   â”‚   â””â”€â”€ com\n    â”‚   â”‚       â””â”€â”€ xpp\n    â”‚   â”‚           â””â”€â”€ ssgo\n    â”‚   â”‚               â””â”€â”€ as\n    â”‚   â”‚                   â”œâ”€â”€ AuthorizationServerApplication.java\n    â”‚   â”‚                   â”œâ”€â”€ config\n    â”‚   â”‚                   â”‚   â”œâ”€â”€ SecurityConfig.java\n    â”‚   â”‚                   â”‚   â””â”€â”€ WebAuthorizationServerConfig.java\n    â”‚   â”‚                   â””â”€â”€ jose\n    â”‚   â”‚                       â”œâ”€â”€ Jwks.java\n    â”‚   â”‚                       â””â”€â”€ KeyGeneratorUtils.java\n    â”‚   â””â”€â”€ resources\n    â”‚       â”œâ”€â”€ data.sql\n    â”‚       â””â”€â”€ application.yml\n    â””â”€â”€ test\n        â””â”€â”€ java\n\n\n\n\n\n\n\n\n\n\n\n\næµ‹è¯•\n\nå¯åŠ¨é¡¹ç›®\næŸ¥çœ‹è‡ªåŠ¨åˆ›å»ºçš„è¡¨ç»“æ„ï¼š\næµè§ˆå™¨è®¿é—®ï¼šhttps://localhost:8080/h2-console\n\nç‚¹å‡»Connectï¼š\n\næˆ‘ä»¬çœ‹åˆ°æœ‰äº”å¼ è¡¨åˆ›å»ºï¼Œæ‰“å¼€è¡¨ä¼šå‘ç°æ•°æ®ä¹Ÿè¢«åˆå§‹åŒ–è¿›å»äº†ã€‚\n\næˆæƒç æ¨¡å¼\nè¯·æ±‚æˆæƒç æ¨¡å¼åœ°å€ï¼šhttp://localhost:8080/oauth2/authorize?response_type=code&amp;client_id=messaging-client&amp;scope=message.read&amp;redirect_uri=https://baidu.com\n\nè¾“å…¥ç”¨æˆ·åå¯†ç (user1, password):\n\nå‹¾é€‰æˆæƒscopeï¼Œç‚¹å‡»submit consentæŒ‰é’®ï¼š\n\næ‹·è´åœ°å€æ ï¼šhttps://www.baidu.com/?code=dPEZCnsiz2WPk5mWdnPImxbSQkbwK7-yPKmg56JuR2NHbswtbXWZFjgZr6MEXfIqi8JhRourmlSSYVVfGuCN-46ep8jbQwxHsqrUVeeY-1XRHkpqaQ2UM9-ulbTsU0mg\næˆæƒç code&#x3D;dPEZCnsiz2WPk5mWdnPImxbSQkbwK7-yPKmg56JuR2NHbswtbXWZFjgZr6MEXfIqi8JhRourmlSSYVVfGuCN-46ep8jbQwxHsqrUVeeY-1XRHkpqaQ2UM9-ulbTsU0mg\næ‰“å¼€postman é€šè¿‡è¯¥codeè·å–access_token:\n\n\nç‚¹å‡»sendï¼Œè¿”å›ï¼š\n\nJSONæ•°æ®å¦‚ä¸‹ï¼š\n&#123;\n    &quot;access_token&quot;: &quot;eyJraWQiOiI3NzlmYTBkMC1kYmI5LTRkOGMtYTljNy1iMWE3N2U1MjU3ZDMiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJ1c2VyMSIsImF1ZCI6Im1lc3NhZ2luZy1jbGllbnQiLCJuYmYiOjE2Mjk4ODM3NTgsInNjb3BlIjpbIm1lc3NhZ2UucmVhZCJdLCJpc3MiOiJodHRwOlwvXC9hdXRoLXNlcnZlcjo5MDAwIiwiZXhwIjoxNjI5ODg0MDU4LCJpYXQiOjE2Mjk4ODM3NTh9.DONZ0BYwqikDpX36yifOraxr6h_AX4uUAbLqnitC1vEaRHIZVuaSXcLesXx2XxIOyfKu-gglMxho83-JnNU60sX9QQVgnzsHQIExFoBtnFIOmj6mrxOcuTLFWEjya1fqN9rRDAHDInNkTpHICdzKWAtnRR_N7Xwt87B7EwcmAaZedLEyRZo6xQWrx_nIDIsdalxDHricniK7lYxMRHBzXIiV7hIFUtjfPCTGGUhuV3Etu5WGJpo9loOGezTydttvcHttlC8A71viDBR8jD0fQ5Z6NZuq1CfK3rBoh1jXmGUp8g8fi7WTeA2zKyLYYYPSot5FiHcecpc9bAPIh8oPEA&quot;,\n    &quot;refresh_token&quot;: &quot;m166TmZ_o8XpP_wunxsjRRHqH5qbyMMVZz6-tRPQe_73DiKKd5ujdA8TdiwPDgxw6bnYE6MjlTcLy7Cc30BDYsZhHwr7PKXqX0QyQCwkiFRIkrmQOmvCAl-GO_R4gwWZ&quot;,\n    &quot;scope&quot;: &quot;message.read&quot;,\n    &quot;token_type&quot;: &quot;Bearer&quot;,\n    &quot;expires_in&quot;: 299\n&#125;\n\nåˆ·æ–°token\n\n\nè¯·æ±‚åç»“æœï¼š\n\nJSONæ•°æ®æ˜¯ï¼š\n&#123;\n    &quot;access_token&quot;: &quot;eyJraWQiOiI3NzlmYTBkMC1kYmI5LTRkOGMtYTljNy1iMWE3N2U1MjU3ZDMiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJ1c2VyMSIsImF1ZCI6Im1lc3NhZ2luZy1jbGllbnQiLCJuYmYiOjE2Mjk4ODM5MzgsInNjb3BlIjpbIm1lc3NhZ2UucmVhZCJdLCJpc3MiOiJodHRwOlwvXC9hdXRoLXNlcnZlcjo5MDAwIiwiZXhwIjoxNjI5ODg0MjM4LCJpYXQiOjE2Mjk4ODM5Mzh9.GoCvmcLHIWYEN7-_jJQw3cOAC1TOH_If6VuxhgzsRIw2jfeJlgdKRxC9a_meRzoZGWcDb95aM_BPEwFgXsOgiXM5u_NTTaB9j6xEOoaTP_KA8V9bbqw63C-_nYlIzRQwYZUy4YHFDA-bOrUGjZxtRbr1WxP27iwiSMnXQ8XOI8P-gN5mr3EW7gxIr7vtoP1duwmqROirUuskw74YAr2l6ZDxdn7AEG17Qqb5gWYU9j61NHuyJGT7Vy1RQJT_G__vsLVaf-1z7CnE1_9IxSRGQf4TlKDG2F2C7TEGqGnNXQa5Sc-CPjh7hNHEirqH0_rBnKFwG9irtbS7eCFLporjkg&quot;,\n    &quot;refresh_token&quot;: &quot;m166TmZ_o8XpP_wunxsjRRHqH5qbyMMVZz6-tRPQe_73DiKKd5ujdA8TdiwPDgxw6bnYE6MjlTcLy7Cc30BDYsZhHwr7PKXqX0QyQCwkiFRIkrmQOmvCAl-GO_R4gwWZ&quot;,\n    &quot;scope&quot;: &quot;message.read&quot;,\n    &quot;token_type&quot;: &quot;Bearer&quot;,\n    &quot;expires_in&quot;: 300\n&#125;\n\nç®€åŒ–æ¨¡å¼ï¼ˆresponse_type&#x3D;tokenï¼‰åœ¨oauth2.1è¢«ç§»é™¤.\n\nå®¢æˆ·ç«¯æ¨¡å¼ï¼š\n\n\nè¿”å›ç»“æœå¦‚å›¾ï¼š\n\nJSONç»“æœï¼š\n&#123;\n    &quot;access_token&quot;: &quot;eyJraWQiOiJjOGRhNzAwZC0zNzUyLTQyMTMtOTFmZi1hOTlmMjY5NTU4NTciLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJtZXNzYWdpbmctY2xpZW50IiwiYXVkIjoibWVzc2FnaW5nLWNsaWVudCIsIm5iZiI6MTYyOTg4MzEzNywic2NvcGUiOlsib3BlbmlkIiwibWVzc2FnZS5yZWFkIiwibWVzc2FnZS53cml0ZSJdLCJpc3MiOiJodHRwOlwvXC9hdXRoLXNlcnZlcjo5MDAwIiwiZXhwIjoxNjI5ODgzNDM3LCJpYXQiOjE2Mjk4ODMxMzd9.NvTu-y5AxLXLSSC_FvxgG3ZYCsOdQRBQgay5sZOmgPAPHcNrTeau7RtdQPoYL7rxedbbfgzBzBOQA3wYepMcuWqO7DBc3kB-I6D6c8nImMo24hSVDTXqnGEtyAUWUhiWJPY1IvVmgksZdaemXQUjFQmBM6Lxt32nBVz8Ap7NXb4oqIbr2bkYodvPRLdYY0PeMpPKAqJuKl4nnRzTCGWx9koJ4KGynkCo3KtMjpv3WuarVKpyiUIhTRlOOAI7wrGplFukaKXpNriMMwasFNtcKfSdWQ6iIDtFs1oUOfE7NJ8EY1FkUaZP1brrHzJgrSvaQPATOfNMFWAA7MN6DzUrlQ&quot;,\n    &quot;scope&quot;: &quot;openid message.read message.write&quot;,\n    &quot;token_type&quot;: &quot;Bearer&quot;,\n    &quot;expires_in&quot;: 300\n&#125;\n\nå¯†ç æ¨¡å¼ åœ¨oauth2.1è¢«ç§»é™¤ã€‚\nä¹‹å‰ä»¥ä¸ºæ˜¯bugï¼Œå°±ç»™æäº†issueï¼ˆhttps://github.com/spring-projects/spring-authorization-server/issues/419ï¼‰ï¼Œå®˜æ–¹å›å¤ä¸æ”¯æŒã€‚\nä½†æ˜¯æœ‰æ‰©å±•æ–¹å¼ã€‚è¿˜æ²¡å¼„ã€‚å…·ä½“å¯çœ‹æˆ‘æå‡ºçš„issueçš„ä½œè€…å›å¤ã€‚\n\n\n\n\n\n\n\n\n\n\n\nspring-security-oauth2çš„å®ç°æ–¹å¼ï¼Œå¯æŸ¥çœ‹æˆ‘ä¹‹å‰çš„ç¬”è®°\nçŸ¥ä¹ï¼šhttps://zhuanlan.zhihu.com/p/403379055\ngithubæºç ï¼šhttps://github.com/xpp1109/spring-security-lt5-oauth2\n\n\n\n\n\n\n\n\n\næœ¬æ–‡å†…å®¹githubåœ°å€æ˜¯ï¼šhttps://github.com/xpp1109/spring-security-gte5-oauth2\n\n\n\n\n\n\n\n\n\nä¸€é”®ä¸‰è”ï¼Œå…³æ³¨ã€ç‚¹èµã€åˆ†äº«ã€‚å®Œç»“æ’’èŠ±ï¼Œè°¢è°¢ï¼\n\næ¢¦æƒ³è¶Šæ˜¯ç¾ä¸½ï¼Œå°±è¶Šæ˜¯æ˜¾å¾—é¥ä¸å¯åŠã€‚å¯å¥‡æ€ªçš„æ˜¯ï¼Œä¸€æ—¦ä½ ä¸‹å®šäº†å†³å¿ƒï¼Œå¾ˆå¿«åœ°ï¼Œé‚£äº›æ¢¦æƒ³å°±ä¸€ä¸€æˆä¸ºäº†ç°å®ï¼\n\n","slug":"æ–°ç‰ˆauthorization-server","date":"2022-04-22T09:57:14.000Z","categories_index":"Java,Spring Security,Spring Boot","tags_index":"Spring Security,spring-authorization-server,Oauth2.1,Java","author_index":"ITLab"}]